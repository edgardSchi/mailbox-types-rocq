<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<link href="resources/coqdoc.css" rel="stylesheet" type="text/css" />
<link href="resources/coqdocjs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resources/config.js"></script>
<script type="text/javascript" src="resources/coqdocjs.js"></script>
</head>

<body onload="document.getElementById('content').focus()">
  <div id="header">
    <span class="left">
      <span class="modulename"> <script> document.write(document.title) </script> </span>
    </span>

    <span class="button" id="toggle-proofs"></span>

    <span class="right">
      <a href="../">Project Page</a>
      <a href="./indexpage.html"> Index </a>
      <a href="./toc.html"> Table of Contents </a>
    </span>
</div>
    <div id="content" tabindex="-1" onblur="document.getElementById('content').focus()">
    <div id="main">
<h1 class="libtitle">MailboxTypes.Dblib.DeBruijn</h1>

<div class="code">
<span class="id" title="keyword">Set Implicit Arguments</span>.<br/>
<span class="id" title="keyword">Generalizable All Variables</span>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">Stdlib</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="library">Arith</span>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">Stdlib</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="library">Lia</span>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">MailboxTypes</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="MailboxTypes.Dblib.DblibTactics.html#"><span class="id" title="library">Dblib.DblibTactics</span></a>.<br/>

<br/>
<span class="comment">(*&nbsp;----------------------------------------------------------------------------&nbsp;*)</span><br/>

<br/>
<span class="comment">(*&nbsp;Terminology.&nbsp;*)</span><br/>

<br/>
<span class="comment">(*&nbsp;A&nbsp;variable,&nbsp;represented&nbsp;as&nbsp;a&nbsp;de&nbsp;Bruijn&nbsp;index,&nbsp;is&nbsp;<span class="inlinecode"><span class="id" title="var">k</span></span>-free&nbsp;if&nbsp;it&nbsp;is&nbsp;greater<br/>
&nbsp;&nbsp;&nbsp;than&nbsp;or&nbsp;equal&nbsp;to&nbsp;<span class="inlinecode"><span class="id" title="var">k</span></span>.&nbsp;It&nbsp;is&nbsp;<span class="inlinecode"><span class="id" title="var">k</span></span>-bound&nbsp;otherwise.&nbsp;This&nbsp;terminology&nbsp;is&nbsp;useful<br/>
&nbsp;&nbsp;&nbsp;when&nbsp;one&nbsp;traverses&nbsp;a&nbsp;term&nbsp;and&nbsp;<span class="inlinecode"><span class="id" title="var">k</span></span>&nbsp;represents&nbsp;the&nbsp;number&nbsp;of&nbsp;binders&nbsp;that&nbsp;have<br/>
&nbsp;&nbsp;&nbsp;been&nbsp;entered.&nbsp;*)</span><br/>

<br/>
<span class="comment">(*&nbsp;----------------------------------------------------------------------------&nbsp;*)</span><br/>

<br/>
<span class="comment">(*&nbsp;Operations&nbsp;provided&nbsp;by&nbsp;the&nbsp;client.&nbsp;*)</span><br/>

<br/>
<span class="comment">(*&nbsp;We&nbsp;expect&nbsp;the&nbsp;client&nbsp;to&nbsp;define&nbsp;a&nbsp;type&nbsp;<span class="inlinecode"><span class="id" title="var">V</span></span>&nbsp;of&nbsp;values&nbsp;and&nbsp;a&nbsp;type&nbsp;<span class="inlinecode"><span class="id" title="var">T</span></span>&nbsp;of&nbsp;terms.<br/>
&nbsp;&nbsp;&nbsp;These&nbsp;types&nbsp;may&nbsp;coincide,&nbsp;but&nbsp;need&nbsp;not&nbsp;coincide.&nbsp;The&nbsp;client&nbsp;provides&nbsp;a&nbsp;number<br/>
&nbsp;&nbsp;&nbsp;of&nbsp;operations&nbsp;on&nbsp;values&nbsp;and&nbsp;terms,&nbsp;described&nbsp;below,&nbsp;and&nbsp;the&nbsp;library&nbsp;provides<br/>
&nbsp;&nbsp;&nbsp;lifting&nbsp;and&nbsp;substitution&nbsp;operations.&nbsp;Lifting&nbsp;maps&nbsp;values&nbsp;to&nbsp;values&nbsp;and&nbsp;terms<br/>
&nbsp;&nbsp;&nbsp;to&nbsp;terms,&nbsp;while&nbsp;substitution&nbsp;allows&nbsp;substituting&nbsp;values&nbsp;for&nbsp;variables&nbsp;within<br/>
&nbsp;&nbsp;&nbsp;terms.&nbsp;*)</span><br/>

<br/>
<span class="comment">(*&nbsp;Our&nbsp;use&nbsp;of&nbsp;the&nbsp;terminology&nbsp;``value''&nbsp;and&nbsp;``term''&nbsp;is&nbsp;arbitrary.&nbsp;It&nbsp;is<br/>
&nbsp;&nbsp;&nbsp;inspired&nbsp;by&nbsp;the&nbsp;operational&nbsp;semantics&nbsp;of&nbsp;the&nbsp;call-by-value&nbsp;lambda-calculus.<br/>
&nbsp;&nbsp;&nbsp;The&nbsp;point&nbsp;is&nbsp;that&nbsp;<span class="inlinecode"><span class="id" title="var">V</span></span>&nbsp;--&nbsp;the&nbsp;type&nbsp;of&nbsp;the&nbsp;things&nbsp;that&nbsp;are&nbsp;substituted&nbsp;for<br/>
&nbsp;&nbsp;&nbsp;variables&nbsp;--&nbsp;and&nbsp;<span class="inlinecode"><span class="id" title="var">T</span></span>&nbsp;--&nbsp;the&nbsp;type&nbsp;of&nbsp;the&nbsp;things&nbsp;within&nbsp;which&nbsp;substitution&nbsp;is<br/>
&nbsp;&nbsp;&nbsp;performed&nbsp;--&nbsp;need&nbsp;not&nbsp;coincide.&nbsp;*)</span><br/>

<br/>
<span class="comment">(*&nbsp;Since&nbsp;values&nbsp;are&nbsp;substituted&nbsp;for&nbsp;variables,&nbsp;and&nbsp;since&nbsp;we&nbsp;need&nbsp;an&nbsp;identity<br/>
&nbsp;&nbsp;&nbsp;substitution,&nbsp;there&nbsp;follows&nbsp;that&nbsp;a&nbsp;variable&nbsp;must&nbsp;be&nbsp;a&nbsp;value,&nbsp;or,&nbsp;more<br/>
&nbsp;&nbsp;&nbsp;precisely,&nbsp;there&nbsp;must&nbsp;exist&nbsp;a&nbsp;function&nbsp;that&nbsp;maps&nbsp;variables&nbsp;to&nbsp;values.&nbsp;*)</span><br/>

<br/>
<span class="id" title="keyword">Class</span> <a id="Var" class="idref" href="#Var"><span class="id" title="record">Var</span></a> (<a id="V:1" class="idref" href="#V:1"><span class="id" title="binder">V</span></a> : <span class="id" title="keyword">Type</span>) := {<br/>
&nbsp;&nbsp;<a id="var" class="idref" href="#var"><span class="id" title="projection">var</span></a>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#V:1"><span class="id" title="variable">V</span></a><br/>
}.<br/>

<br/>
<span class="comment">(*&nbsp;Let&nbsp;us&nbsp;immediately&nbsp;define&nbsp;<span class="inlinecode"><span class="id" title="var">var</span></span>&nbsp;at&nbsp;variables.&nbsp;This&nbsp;may&nbsp;help&nbsp;clarify<br/>
&nbsp;&nbsp;&nbsp;things,&nbsp;and&nbsp;it&nbsp;is&nbsp;used&nbsp;in&nbsp;the&nbsp;statement&nbsp;of&nbsp;some&nbsp;laws&nbsp;below.&nbsp;*)</span><br/>

<br/>
<span class="id" title="keyword">Instance</span> <a id="Var_idx" class="idref" href="#Var_idx"><span class="id" title="instance">Var_idx</span></a> : <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#Var"><span class="id" title="class">Var</span></a> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a> := {<br/>
&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#var"><span class="id" title="method">var</span></a> <a id="x:4" class="idref" href="#x:4"><span class="id" title="binder">x</span></a> := <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#x:4"><span class="id" title="variable">x</span></a><br/>
}.<br/>

<br/>
<span class="comment">(*&nbsp;<span class="inlinecode"><span class="id" title="var">traverse</span></span>&nbsp;can&nbsp;be&nbsp;thought&nbsp;of&nbsp;as&nbsp;a&nbsp;semantic&nbsp;substitution&nbsp;function.&nbsp;The&nbsp;idea<br/>
&nbsp;&nbsp;&nbsp;is,&nbsp;<span class="inlinecode"><span class="id" title="var">traverse</span></span> <span class="inlinecode"><span class="id" title="var">f</span></span> <span class="inlinecode"><span class="id" title="var">l</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span>&nbsp;traverses&nbsp;the&nbsp;term&nbsp;<span class="inlinecode"><span class="id" title="var">t</span></span>,&nbsp;incrementing&nbsp;the&nbsp;index&nbsp;<span class="inlinecode"><span class="id" title="var">l</span></span><br/>
&nbsp;&nbsp;&nbsp;whenever&nbsp;a&nbsp;binder&nbsp;is&nbsp;entered,&nbsp;and,&nbsp;at&nbsp;every&nbsp;variable&nbsp;<span class="inlinecode"><span class="id" title="var">x</span></span>,&nbsp;it&nbsp;invokes&nbsp;<span class="inlinecode"><span class="id" title="var">f</span></span> <span class="inlinecode"><span class="id" title="var">l</span></span> <span class="inlinecode"><span class="id" title="var">x</span></span>.<br/>
&nbsp;&nbsp;&nbsp;This&nbsp;produces&nbsp;a&nbsp;value,&nbsp;which&nbsp;is&nbsp;grafted&nbsp;instead&nbsp;of&nbsp;<span class="inlinecode"><span class="id" title="var">x</span></span>.&nbsp;*)</span><br/>

<br/>
<span class="comment">(*&nbsp;The&nbsp;definition&nbsp;of&nbsp;<span class="inlinecode"><span class="id" title="var">traverse</span></span>&nbsp;is&nbsp;the&nbsp;main&nbsp;task&nbsp;that&nbsp;we&nbsp;require&nbsp;of&nbsp;the&nbsp;client.<br/>
&nbsp;&nbsp;&nbsp;Via&nbsp;the&nbsp;manner&nbsp;in&nbsp;which&nbsp;<span class="inlinecode"><span class="id" title="var">l</span></span>&nbsp;is&nbsp;incremented,&nbsp;this&nbsp;function&nbsp;determines&nbsp;the<br/>
&nbsp;&nbsp;&nbsp;binding&nbsp;structure&nbsp;of&nbsp;terms.&nbsp;*)</span><br/>

<br/>
<span class="id" title="keyword">Class</span> <a id="Traverse" class="idref" href="#Traverse"><span class="id" title="record">Traverse</span></a> (<a id="V:5" class="idref" href="#V:5"><span class="id" title="binder">V</span></a> <a id="T:6" class="idref" href="#T:6"><span class="id" title="binder">T</span></a> : <span class="id" title="keyword">Type</span>) := {<br/>
&nbsp;&nbsp;<a id="traverse" class="idref" href="#traverse"><span class="id" title="projection">traverse</span></a>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">(</span></a><a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#V:5"><span class="id" title="variable">V</span></a><a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">(</span></a><a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#T:6"><span class="id" title="variable">T</span></a> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#T:6"><span class="id" title="variable">T</span></a><a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">)</span></a><br/>
}.<br/>

<br/>
<span class="comment">(*&nbsp;<span class="inlinecode"><span class="id" title="var">traverse_var</span></span>&nbsp;is&nbsp;a&nbsp;specialization&nbsp;of&nbsp;<span class="inlinecode"><span class="id" title="var">traverse</span></span>&nbsp;to&nbsp;the&nbsp;case&nbsp;where&nbsp;<span class="inlinecode"><span class="id" title="var">f</span></span><br/>
&nbsp;&nbsp;&nbsp;maps&nbsp;variables&nbsp;to&nbsp;variables.&nbsp;*)</span><br/>

<br/>
<span class="id" title="keyword">Notation</span> <a id="traverse_var" class="idref" href="#traverse_var"><span class="id" title="abbreviation">traverse_var</span></a> <span class="id" title="var">f</span> := (<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#traverse"><span class="id" title="method">traverse</span></a> (<span class="id" title="keyword">fun</span> <a id="l:9" class="idref" href="#l:9"><span class="id" title="binder">l</span></a> <a id="x:10" class="idref" href="#x:10"><span class="id" title="binder">x</span></a> =&gt; <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#var"><span class="id" title="method">var</span></a> (<span class="id" title="var">f</span> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#l:9"><span class="id" title="variable">l</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#x:10"><span class="id" title="variable">x</span></a>))).<br/>

<br/>
<span class="comment">(*&nbsp;We&nbsp;expect&nbsp;the&nbsp;client&nbsp;to&nbsp;establish&nbsp;the&nbsp;following&nbsp;properties&nbsp;of&nbsp;<span class="inlinecode"><span class="id" title="var">traverse</span></span>.&nbsp;*)</span><br/>

<br/>
<span class="comment">(*&nbsp;If&nbsp;<span class="inlinecode"><span class="id" title="var">f</span></span>&nbsp;is&nbsp;injective,&nbsp;then&nbsp;<span class="inlinecode"><span class="id" title="var">traverse_var</span></span> <span class="inlinecode"><span class="id" title="var">f</span></span>&nbsp;is&nbsp;injective.&nbsp;*)</span><br/>

<br/>
<span class="comment">(*&nbsp;This&nbsp;reflects&nbsp;the&nbsp;fact&nbsp;that&nbsp;<span class="inlinecode"><span class="id" title="var">traverse</span></span>&nbsp;preserves&nbsp;the&nbsp;structure&nbsp;of&nbsp;the&nbsp;term.<br/>
&nbsp;&nbsp;&nbsp;It&nbsp;acts&nbsp;only&nbsp;on&nbsp;variables.&nbsp;*)</span><br/>

<br/>
<span class="id" title="keyword">Class</span> <a id="TraverseVarInjective" class="idref" href="#TraverseVarInjective"><span class="id" title="record">TraverseVarInjective</span></a> `{<a id="H:12" class="idref" href="#H:12"><span class="id" title="binder">Var</span></a> <a id="V:11" class="idref" href="#V:11"><span class="id" title="binder"><span id="H:12" class="id">V</span></span></a>, <a id="H0:14" class="idref" href="#H0:14"><span class="id" title="binder">Traverse</span></a> <a id="H0:14" class="idref" href="#H0:14"><span class="id" title="binder">V</span></a> <a id="T:13" class="idref" href="#T:13"><span class="id" title="binder"><span id="H0:14" class="id">T</span></span></a>} := {<br/>
&nbsp;&nbsp;<a id="traverse_var_injective" class="idref" href="#traverse_var_injective"><span class="id" title="projection">traverse_var_injective</span></a>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="f:16" class="idref" href="#f:16"><span class="id" title="binder">f</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">(</span></a><span class="id" title="keyword">forall</span> <a id="x1:17" class="idref" href="#x1:17"><span class="id" title="binder">x1</span></a> <a id="x2:18" class="idref" href="#x2:18"><span class="id" title="binder">x2</span></a> <a id="l:19" class="idref" href="#l:19"><span class="id" title="binder">l</span></a>, <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#f:16"><span class="id" title="variable">f</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#l:19"><span class="id" title="variable">l</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#x1:17"><span class="id" title="variable">x1</span></a> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#f:16"><span class="id" title="variable">f</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#l:19"><span class="id" title="variable">l</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#x2:18"><span class="id" title="variable">x2</span></a> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#x1:17"><span class="id" title="variable">x1</span></a> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#x2:18"><span class="id" title="variable">x2</span></a><a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="t1:20" class="idref" href="#t1:20"><span class="id" title="binder">t1</span></a> <a id="t2:21" class="idref" href="#t2:21"><span class="id" title="binder">t2</span></a> <a id="l:22" class="idref" href="#l:22"><span class="id" title="binder">l</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#traverse_var"><span class="id" title="abbreviation">traverse_var</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#f:16"><span class="id" title="variable">f</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#l:22"><span class="id" title="variable">l</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#t1:20"><span class="id" title="variable">t1</span></a> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#traverse_var"><span class="id" title="abbreviation">traverse_var</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#f:16"><span class="id" title="variable">f</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#l:22"><span class="id" title="variable">l</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#t2:21"><span class="id" title="variable">t2</span></a> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#t1:20"><span class="id" title="variable">t1</span></a> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#t2:21"><span class="id" title="variable">t2</span></a><br/>
}.<br/>

<br/>
<span class="comment">(*&nbsp;Two&nbsp;successive&nbsp;traversals&nbsp;can&nbsp;be&nbsp;fused.&nbsp;*)</span><br/>

<br/>
<span class="comment">(*&nbsp;This&nbsp;law&nbsp;is&nbsp;analogous&nbsp;to&nbsp;the&nbsp;law&nbsp;that&nbsp;describes&nbsp;the&nbsp;composition&nbsp;of&nbsp;two<br/>
&nbsp;&nbsp;&nbsp;syntactic&nbsp;substitutions&nbsp;--&nbsp;see&nbsp;<span class="inlinecode"><span class="id" title="var">SubstSubst</span></span>&nbsp;below.&nbsp;*)</span><br/>

<br/>
<span class="id" title="keyword">Class</span> <a id="TraverseFunctorial" class="idref" href="#TraverseFunctorial"><span class="id" title="record">TraverseFunctorial</span></a> `{<a id="H:25" class="idref" href="#H:25"><span class="id" title="binder">Traverse</span></a> <a id="V:24" class="idref" href="#V:24"><span class="id" title="binder"><span id="H:25" class="id">V</span></span></a> <a id="H:25" class="idref" href="#H:25"><span class="id" title="binder">V</span></a>, <a id="H0:27" class="idref" href="#H0:27"><span class="id" title="binder">Traverse</span></a> <a id="H0:27" class="idref" href="#H0:27"><span class="id" title="binder">V</span></a> <a id="T:26" class="idref" href="#T:26"><span class="id" title="binder"><span id="H0:27" class="id">T</span></span></a>} := {<br/>
&nbsp;&nbsp;<a id="traverse_functorial" class="idref" href="#traverse_functorial"><span class="id" title="projection">traverse_functorial</span></a>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="f:29" class="idref" href="#f:29"><span class="id" title="binder">f</span></a> <a id="g:30" class="idref" href="#g:30"><span class="id" title="binder">g</span></a> <a id="t:31" class="idref" href="#t:31"><span class="id" title="binder">t</span></a> <a id="l:32" class="idref" href="#l:32"><span class="id" title="binder">l</span></a>,                                                             <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#traverse"><span class="id" title="method">traverse</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#g:30"><span class="id" title="variable">g</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#l:32"><span class="id" title="variable">l</span></a> (<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#traverse"><span class="id" title="method">traverse</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#f:29"><span class="id" title="variable">f</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#l:32"><span class="id" title="variable">l</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#t:31"><span class="id" title="variable">t</span></a>) <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#traverse"><span class="id" title="method">traverse</span></a> (<span class="id" title="keyword">fun</span> <a id="l:33" class="idref" href="#l:33"><span class="id" title="binder">l</span></a> <a id="x:34" class="idref" href="#x:34"><span class="id" title="binder">x</span></a> =&gt; <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#traverse"><span class="id" title="method">traverse</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#g:30"><span class="id" title="variable">g</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#l:33"><span class="id" title="variable">l</span></a> (<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#f:29"><span class="id" title="variable">f</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#l:33"><span class="id" title="variable">l</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#x:34"><span class="id" title="variable">x</span></a>)) <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#l:32"><span class="id" title="variable">l</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#t:31"><span class="id" title="variable">t</span></a><br/>
}.<br/>

<br/>
<span class="comment">(*&nbsp;<span class="inlinecode"><span class="id" title="var">traverse</span></span>&nbsp;is&nbsp;position-independent.&nbsp;That&nbsp;is,&nbsp;adding&nbsp;<span class="inlinecode"><span class="id" title="var">p</span></span>&nbsp;to&nbsp;the&nbsp;argument<br/>
&nbsp;&nbsp;&nbsp;of&nbsp;<span class="inlinecode"><span class="id" title="var">traverse</span></span>&nbsp;leads&nbsp;to&nbsp;adding&nbsp;<span class="inlinecode"><span class="id" title="var">p</span></span>&nbsp;to&nbsp;the&nbsp;argument&nbsp;of&nbsp;every&nbsp;call&nbsp;to&nbsp;<span class="inlinecode"><span class="id" title="var">f</span></span>.<br/>
&nbsp;&nbsp;&nbsp;Furthermore,&nbsp;<span class="inlinecode"><span class="id" title="var">traverse</span></span>&nbsp;is&nbsp;compatible&nbsp;with&nbsp;extensional&nbsp;equality.&nbsp;*)</span><br/>

<br/>
<span class="id" title="keyword">Class</span> <a id="TraverseRelative" class="idref" href="#TraverseRelative"><span class="id" title="record">TraverseRelative</span></a> `{<a id="H:38" class="idref" href="#H:38"><span class="id" title="binder">Traverse</span></a> <a id="V:36" class="idref" href="#V:36"><span class="id" title="binder"><span id="H:38" class="id">V</span></span></a> <a id="T:37" class="idref" href="#T:37"><span class="id" title="binder"><span id="H:38" class="id">T</span></span></a>} := {<br/>
&nbsp;&nbsp;<a id="traverse_relative" class="idref" href="#traverse_relative"><span class="id" title="projection">traverse_relative</span></a>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="f:40" class="idref" href="#f:40"><span class="id" title="binder">f</span></a> <a id="g:41" class="idref" href="#g:41"><span class="id" title="binder">g</span></a> <a id="p:42" class="idref" href="#p:42"><span class="id" title="binder">p</span></a> <a id="t:43" class="idref" href="#t:43"><span class="id" title="binder">t</span></a> <a id="m:44" class="idref" href="#m:44"><span class="id" title="binder">m</span></a> <a id="l:45" class="idref" href="#l:45"><span class="id" title="binder">l</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">(</span></a><span class="id" title="keyword">forall</span> <a id="l:46" class="idref" href="#l:46"><span class="id" title="binder">l</span></a> <a id="x:47" class="idref" href="#x:47"><span class="id" title="binder">x</span></a>, <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#f:40"><span class="id" title="variable">f</span></a> (<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#l:46"><span class="id" title="variable">l</span></a> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#p:42"><span class="id" title="variable">p</span></a>) <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#x:47"><span class="id" title="variable">x</span></a> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#g:41"><span class="id" title="variable">g</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#l:46"><span class="id" title="variable">l</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#x:47"><span class="id" title="variable">x</span></a><a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#m:44"><span class="id" title="variable">m</span></a> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#l:45"><span class="id" title="variable">l</span></a> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#p:42"><span class="id" title="variable">p</span></a> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#traverse"><span class="id" title="method">traverse</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#f:40"><span class="id" title="variable">f</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#m:44"><span class="id" title="variable">m</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#t:43"><span class="id" title="variable">t</span></a> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#traverse"><span class="id" title="method">traverse</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#g:41"><span class="id" title="variable">g</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#l:45"><span class="id" title="variable">l</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#t:43"><span class="id" title="variable">t</span></a><br/>
}.<br/>

<br/>
<span class="comment">(*&nbsp;<span class="inlinecode"><span class="id" title="var">traverse</span></span>&nbsp;identifies&nbsp;<span class="inlinecode"><span class="id" title="var">var</span></span>&nbsp;and&nbsp;simplifies&nbsp;to&nbsp;a&nbsp;call&nbsp;to&nbsp;<span class="inlinecode"><span class="id" title="var">f</span></span>.&nbsp;*)</span><br/>

<br/>
<span class="id" title="keyword">Class</span> <a id="TraverseIdentifiesVar" class="idref" href="#TraverseIdentifiesVar"><span class="id" title="record">TraverseIdentifiesVar</span></a> `{<a id="H:50" class="idref" href="#H:50"><span class="id" title="binder">Var</span></a> <a id="V:49" class="idref" href="#V:49"><span class="id" title="binder"><span id="H:50" class="id">V</span></span></a>, <a id="H0:51" class="idref" href="#H0:51"><span class="id" title="binder">Traverse</span></a> <a id="H0:51" class="idref" href="#H0:51"><span class="id" title="binder">V</span></a> <a id="H0:51" class="idref" href="#H0:51"><span class="id" title="binder">V</span></a>} := {<br/>
&nbsp;&nbsp;<a id="traverse_identifies_var" class="idref" href="#traverse_identifies_var"><span class="id" title="projection">traverse_identifies_var</span></a>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="f:53" class="idref" href="#f:53"><span class="id" title="binder">f</span></a> <a id="l:54" class="idref" href="#l:54"><span class="id" title="binder">l</span></a> <a id="x:55" class="idref" href="#x:55"><span class="id" title="binder">x</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#traverse"><span class="id" title="method">traverse</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#f:53"><span class="id" title="variable">f</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#l:54"><span class="id" title="variable">l</span></a> (<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#var"><span class="id" title="method">var</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#x:55"><span class="id" title="variable">x</span></a>) <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#f:53"><span class="id" title="variable">f</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#l:54"><span class="id" title="variable">l</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#x:55"><span class="id" title="variable">x</span></a><br/>
}.<br/>

<br/>
<span class="comment">(*&nbsp;The&nbsp;application&nbsp;of&nbsp;<span class="inlinecode"><span class="id" title="var">traverse_var</span></span>&nbsp;to&nbsp;the&nbsp;identity&nbsp;is&nbsp;the&nbsp;identity.&nbsp;*)</span><br/>

<br/>
<span class="id" title="keyword">Class</span> <a id="TraverseVarIsIdentity" class="idref" href="#TraverseVarIsIdentity"><span class="id" title="record">TraverseVarIsIdentity</span></a> `{<a id="H:58" class="idref" href="#H:58"><span class="id" title="binder">Var</span></a> <a id="V:57" class="idref" href="#V:57"><span class="id" title="binder"><span id="H:58" class="id">V</span></span></a>, <a id="H0:60" class="idref" href="#H0:60"><span class="id" title="binder">Traverse</span></a> <a id="H0:60" class="idref" href="#H0:60"><span class="id" title="binder">V</span></a> <a id="T:59" class="idref" href="#T:59"><span class="id" title="binder"><span id="H0:60" class="id">T</span></span></a>} := {<br/>
&nbsp;&nbsp;<a id="traverse_var_is_identity" class="idref" href="#traverse_var_is_identity"><span class="id" title="projection">traverse_var_is_identity</span></a>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="f:62" class="idref" href="#f:62"><span class="id" title="binder">f</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">(</span></a><span class="id" title="keyword">forall</span> <a id="l:63" class="idref" href="#l:63"><span class="id" title="binder">l</span></a> <a id="x:64" class="idref" href="#x:64"><span class="id" title="binder">x</span></a>, <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#f:62"><span class="id" title="variable">f</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#l:63"><span class="id" title="variable">l</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#x:64"><span class="id" title="variable">x</span></a> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#var"><span class="id" title="method">var</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#x:64"><span class="id" title="variable">x</span></a><a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="t:65" class="idref" href="#t:65"><span class="id" title="binder">t</span></a> <a id="l:66" class="idref" href="#l:66"><span class="id" title="binder">l</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#traverse"><span class="id" title="method">traverse</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#f:62"><span class="id" title="variable">f</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#l:66"><span class="id" title="variable">l</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#t:65"><span class="id" title="variable">t</span></a> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#t:65"><span class="id" title="variable">t</span></a><br/>
}.<br/>

<br/>
<span class="comment">(*&nbsp;----------------------------------------------------------------------------&nbsp;*)</span><br/>

<br/>
<span class="comment">(*&nbsp;Operations&nbsp;provided&nbsp;by&nbsp;the&nbsp;library.&nbsp;*)</span><br/>

<br/>
<span class="comment">(*&nbsp;<span class="inlinecode"><span class="id" title="var">lift</span></span> <span class="inlinecode"><span class="id" title="var">w</span></span> <span class="inlinecode"><span class="id" title="var">k</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span>&nbsp;is&nbsp;the&nbsp;term&nbsp;obtained&nbsp;by&nbsp;adding&nbsp;<span class="inlinecode"><span class="id" title="var">w</span></span>&nbsp;to&nbsp;the&nbsp;<span class="inlinecode"><span class="id" title="var">k</span></span>-free&nbsp;variables<br/>
&nbsp;&nbsp;&nbsp;of&nbsp;the&nbsp;term&nbsp;<span class="inlinecode"><span class="id" title="var">t</span></span>.&nbsp;*)</span><br/>

<br/>
<span class="id" title="keyword">Class</span> <a id="Lift" class="idref" href="#Lift"><span class="id" title="record">Lift</span></a> (<a id="T:68" class="idref" href="#T:68"><span class="id" title="binder">T</span></a> : <span class="id" title="keyword">Type</span>) := {<br/>
&nbsp;&nbsp;<a id="lift" class="idref" href="#lift"><span class="id" title="projection">lift</span></a>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#T:68"><span class="id" title="variable">T</span></a> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#T:68"><span class="id" title="variable">T</span></a><br/>
}.<br/>

<br/>
<span class="comment">(*&nbsp;Let&nbsp;us&nbsp;immediately&nbsp;define&nbsp;<span class="inlinecode"><span class="id" title="var">lift</span></span>&nbsp;at&nbsp;variables.&nbsp;This&nbsp;may&nbsp;help&nbsp;clarify<br/>
&nbsp;&nbsp;&nbsp;things,&nbsp;and&nbsp;it&nbsp;is&nbsp;used&nbsp;in&nbsp;the&nbsp;statement&nbsp;of&nbsp;some&nbsp;laws&nbsp;below.&nbsp;*)</span><br/>

<br/>
<span class="id" title="keyword">Instance</span> <a id="Lift_idx" class="idref" href="#Lift_idx"><span class="id" title="instance">Lift_idx</span></a> : <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#Lift"><span class="id" title="class">Lift</span></a> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a> := {<br/>
&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#lift"><span class="id" title="method">lift</span></a> <a id="w:71" class="idref" href="#w:71"><span class="id" title="binder">w</span></a> <a id="k:72" class="idref" href="#k:72"><span class="id" title="binder">k</span></a> <a id="x:73" class="idref" href="#x:73"><span class="id" title="binder">x</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">if</span> <span class="id" title="definition">le_gt_dec</span> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#k:72"><span class="id" title="variable">k</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#x:73"><span class="id" title="variable">x</span></a> <span class="id" title="keyword">then</span> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#w:71"><span class="id" title="variable">w</span></a> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#x:73"><span class="id" title="variable">x</span></a> <span class="id" title="keyword">else</span> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#x:73"><span class="id" title="variable">x</span></a><br/>
}.<br/>

<br/>
<span class="comment">(*&nbsp;<span class="inlinecode"><span class="id" title="var">shift</span></span> <span class="inlinecode"><span class="id" title="var">k</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span>&nbsp;is&nbsp;an&nbsp;abbreviation&nbsp;for&nbsp;<span class="inlinecode"><span class="id" title="var">lift</span></span> <span class="inlinecode">1</span> <span class="inlinecode"><span class="id" title="var">k</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span>.&nbsp;*)</span><br/>

<br/>
<span class="comment">(*&nbsp;From&nbsp;a&nbsp;programming&nbsp;language&nbsp;point&nbsp;of&nbsp;view,&nbsp;<span class="inlinecode"><span class="id" title="var">shift</span></span>&nbsp;can&nbsp;be&nbsp;understood<br/>
&nbsp;&nbsp;&nbsp;as&nbsp;an&nbsp;end-of-scope&nbsp;construct.&nbsp;That&nbsp;is,&nbsp;if&nbsp;we&nbsp;are&nbsp;working&nbsp;in&nbsp;a&nbsp;context<br/>
&nbsp;&nbsp;&nbsp;where&nbsp;the&nbsp;variable&nbsp;<span class="inlinecode"><span class="id" title="var">k</span></span>&nbsp;exists,&nbsp;then&nbsp;writing&nbsp;<span class="inlinecode"><span class="id" title="var">shift</span></span> <span class="inlinecode"><span class="id" title="var">k</span></span> <span class="inlinecode">.</span>&nbsp;allows&nbsp;us&nbsp;to<br/>
&nbsp;&nbsp;&nbsp;go&nbsp;back&nbsp;to&nbsp;a&nbsp;context&nbsp;where&nbsp;this&nbsp;variable&nbsp;does&nbsp;not&nbsp;exist&nbsp;any&nbsp;more.&nbsp;In<br/>
&nbsp;&nbsp;&nbsp;this&nbsp;context,&nbsp;we&nbsp;can&nbsp;place&nbsp;a&nbsp;term&nbsp;<span class="inlinecode"><span class="id" title="var">t</span></span>&nbsp;that&nbsp;makes&nbsp;sense&nbsp;in&nbsp;the&nbsp;absence<br/>
&nbsp;&nbsp;&nbsp;of&nbsp;this&nbsp;variable.&nbsp;Thus,&nbsp;<span class="inlinecode"><span class="id" title="var">shift</span></span> <span class="inlinecode"><span class="id" title="var">k</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span>&nbsp;can&nbsp;be&nbsp;read&nbsp;intuitively&nbsp;as&nbsp;<span class="inlinecode"><span class="id" title="keyword">end</span></span> <span class="inlinecode"><span class="id" title="var">k</span></span>
   <span class="inlinecode"><span class="id" title="tactic">in</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span>,&nbsp;that&nbsp;is,&nbsp;end&nbsp;the&nbsp;scope&nbsp;of&nbsp;the&nbsp;variable&nbsp;<span class="inlinecode"><span class="id" title="var">k</span></span>&nbsp;before&nbsp;interpreting<br/>
&nbsp;&nbsp;&nbsp;the&nbsp;term&nbsp;<span class="inlinecode"><span class="id" title="var">t</span></span>.&nbsp;*)</span><br/>

<br/>
<span class="id" title="keyword">Notation</span> <a id="shift" class="idref" href="#shift"><span class="id" title="abbreviation">shift</span></a> :=<br/>
&nbsp;&nbsp;(<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#lift"><span class="id" title="method">lift</span></a> 1).<br/>

<br/>
<span class="comment">(*&nbsp;<span class="inlinecode"><span class="id" title="tactic">subst</span></span> <span class="inlinecode"><span class="id" title="var">v</span></span> <span class="inlinecode"><span class="id" title="var">k</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span>&nbsp;is&nbsp;the&nbsp;term&nbsp;obtained&nbsp;by&nbsp;substituting&nbsp;the&nbsp;value&nbsp;<span class="inlinecode"><span class="id" title="var">v</span></span>&nbsp;for<br/>
&nbsp;&nbsp;&nbsp;the&nbsp;variable&nbsp;<span class="inlinecode"><span class="id" title="var">k</span></span>&nbsp;in&nbsp;the&nbsp;term&nbsp;<span class="inlinecode"><span class="id" title="var">t</span></span>.&nbsp;*)</span><br/>

<br/>
<span class="comment">(*&nbsp;From&nbsp;a&nbsp;programming&nbsp;language&nbsp;point&nbsp;of&nbsp;view,&nbsp;<span class="inlinecode"><span class="id" title="tactic">subst</span></span>&nbsp;can&nbsp;be&nbsp;understood&nbsp;as<br/>
&nbsp;&nbsp;&nbsp;a&nbsp;<span class="inlinecode"><span class="id" title="keyword">let</span></span>&nbsp;construct.&nbsp;That&nbsp;is,&nbsp;<span class="inlinecode"><span class="id" title="tactic">subst</span></span> <span class="inlinecode"><span class="id" title="var">v</span></span> <span class="inlinecode"><span class="id" title="var">k</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span>&nbsp;is&nbsp;in&nbsp;a&nbsp;certain&nbsp;sense&nbsp;equivalent<br/>
&nbsp;&nbsp;&nbsp;to&nbsp;<span class="inlinecode"><span class="id" title="keyword">let</span></span> <span class="inlinecode"><span class="id" title="var">k</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">v</span></span> <span class="inlinecode"><span class="id" title="tactic">in</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span>.&nbsp;It&nbsp;is&nbsp;a&nbsp;binding&nbsp;construct&nbsp;for&nbsp;the&nbsp;variable&nbsp;<span class="inlinecode"><span class="id" title="var">k</span></span>,&nbsp;in&nbsp;the<br/>
&nbsp;&nbsp;&nbsp;sense&nbsp;that&nbsp;if&nbsp;<span class="inlinecode"><span class="id" title="tactic">subst</span></span> <span class="inlinecode"><span class="id" title="var">v</span></span> <span class="inlinecode"><span class="id" title="var">k</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span>&nbsp;is&nbsp;used&nbsp;in&nbsp;a&nbsp;context&nbsp;where&nbsp;<span class="inlinecode"><span class="id" title="var">k</span></span>&nbsp;does&nbsp;not&nbsp;exist,<br/>
&nbsp;&nbsp;&nbsp;then&nbsp;inside&nbsp;the&nbsp;sub-term&nbsp;<span class="inlinecode"><span class="id" title="var">t</span></span>,&nbsp;the&nbsp;variable&nbsp;<span class="inlinecode"><span class="id" title="var">k</span></span>&nbsp;exists.&nbsp;*)</span><br/>

<br/>
<span class="id" title="keyword">Class</span> <a id="Subst" class="idref" href="#Subst"><span class="id" title="record">Subst</span></a> (<a id="V:74" class="idref" href="#V:74"><span class="id" title="binder">V</span></a> <a id="T:75" class="idref" href="#T:75"><span class="id" title="binder">T</span></a> : <span class="id" title="keyword">Type</span>) := {<br/>
&nbsp;&nbsp;<a id="subst" class="idref" href="#subst"><span class="id" title="projection">subst</span></a>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#V:74"><span class="id" title="variable">V</span></a> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#T:75"><span class="id" title="variable">T</span></a> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#T:75"><span class="id" title="variable">T</span></a><br/>
}.<br/>

<br/>
<span class="comment">(*&nbsp;Let&nbsp;us&nbsp;immediately&nbsp;define&nbsp;<span class="inlinecode"><span class="id" title="tactic">subst</span></span>&nbsp;at&nbsp;variables.&nbsp;This&nbsp;may&nbsp;help&nbsp;clarify<br/>
&nbsp;&nbsp;&nbsp;things,&nbsp;and&nbsp;it&nbsp;is&nbsp;used&nbsp;in&nbsp;the&nbsp;statement&nbsp;of&nbsp;some&nbsp;laws&nbsp;below.&nbsp;This&nbsp;definition<br/>
&nbsp;&nbsp;&nbsp;does&nbsp;not&nbsp;constitute&nbsp;an&nbsp;instance&nbsp;of&nbsp;the&nbsp;class&nbsp;<span class="inlinecode"><span class="id" title="var">Subst</span></span>&nbsp;because&nbsp;we&nbsp;need&nbsp;a<br/>
&nbsp;&nbsp;&nbsp;heterogeneous&nbsp;version&nbsp;of&nbsp;substitution,&nbsp;one&nbsp;that&nbsp;maps&nbsp;variables&nbsp;to&nbsp;values,<br/>
&nbsp;&nbsp;&nbsp;as&nbsp;a&nbsp;basic&nbsp;building&nbsp;block.&nbsp;A&nbsp;homogeneous&nbsp;instance&nbsp;definition&nbsp;follows.&nbsp;*)</span><br/>

<br/>
<span class="comment">(*&nbsp;Note&nbsp;that&nbsp;<span class="inlinecode"><span class="id" title="var">subst_idx</span></span>&nbsp;depends&nbsp;on&nbsp;<span class="inlinecode"><span class="id" title="var">var</span></span>.&nbsp;*)</span><br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="subst_idx" class="idref" href="#subst_idx"><span class="id" title="definition">subst_idx</span></a> `{<a id="H:79" class="idref" href="#H:79"><span class="id" title="binder">Var</span></a> <a id="V:78" class="idref" href="#V:78"><span class="id" title="binder"><span id="H:79" class="id">V</span></span></a>} (<a id="v:80" class="idref" href="#v:80"><span class="id" title="binder">v</span></a> : <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#V:78"><span class="id" title="variable">V</span></a>) (<a id="k:81" class="idref" href="#k:81"><span class="id" title="binder">k</span></a> <a id="x:82" class="idref" href="#x:82"><span class="id" title="binder">x</span></a> : <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>) : <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#V:78"><span class="id" title="variable">V</span></a> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="definition">lt_eq_lt_dec</span> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#x:82"><span class="id" title="variable">x</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#k:81"><span class="id" title="variable">k</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Specif.html#inleft"><span class="id" title="constructor">inleft</span></a> (<a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Specif.html#left"><span class="id" title="constructor">left</span></a> <span class="id" title="var">_</span>)  =&gt; <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#var"><span class="id" title="method">var</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#x:82"><span class="id" title="variable">x</span></a><br/>
&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Specif.html#inleft"><span class="id" title="constructor">inleft</span></a> (<a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Specif.html#right"><span class="id" title="constructor">right</span></a> <span class="id" title="var">_</span>) =&gt; <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#v:80"><span class="id" title="variable">v</span></a><br/>
&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Specif.html#inright"><span class="id" title="constructor">inright</span></a> <span class="id" title="var">_</span>        =&gt; <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#var"><span class="id" title="method">var</span></a> (<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#x:82"><span class="id" title="variable">x</span></a> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Peano.html#::nat_scope:x_'-'_x"><span class="id" title="notation">-</span></a> 1)<br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Instance</span> <a id="Subst_idx" class="idref" href="#Subst_idx"><span class="id" title="instance">Subst_idx</span></a> : <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#Subst"><span class="id" title="class">Subst</span></a> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a> := {<br/>
&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#subst"><span class="id" title="method">subst</span></a> := <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#subst_idx"><span class="id" title="definition">subst_idx</span></a><br/>
}.<br/>

<br/>
<span class="comment">(*&nbsp;The&nbsp;predicate&nbsp;<span class="inlinecode"><span class="id" title="var">closed</span></span> <span class="inlinecode"><span class="id" title="var">k</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span>&nbsp;means&nbsp;that&nbsp;the&nbsp;term&nbsp;<span class="inlinecode"><span class="id" title="var">t</span></span>&nbsp;is&nbsp;<span class="inlinecode"><span class="id" title="var">k</span></span>-closed,&nbsp;that&nbsp;is,<br/>
&nbsp;&nbsp;&nbsp;it&nbsp;has&nbsp;no&nbsp;<span class="inlinecode"><span class="id" title="var">k</span></span>-free&nbsp;variables.&nbsp;In&nbsp;particular,&nbsp;if&nbsp;<span class="inlinecode"><span class="id" title="var">k</span></span>&nbsp;is&nbsp;0,&nbsp;then&nbsp;<span class="inlinecode"><span class="id" title="var">t</span></span>&nbsp;is&nbsp;closed.&nbsp;*)</span><br/>

<br/>
<span class="comment">(*&nbsp;We&nbsp;defined&nbsp;<span class="inlinecode"><span class="id" title="var">closed</span></span>&nbsp;in&nbsp;terms&nbsp;of&nbsp;<span class="inlinecode"><span class="id" title="var">lift</span></span>:&nbsp;a&nbsp;term&nbsp;is&nbsp;closed&nbsp;if&nbsp;and&nbsp;only&nbsp;if&nbsp;it<br/>
&nbsp;&nbsp;&nbsp;is&nbsp;invariant&nbsp;under&nbsp;shifting&nbsp;(lifting&nbsp;by&nbsp;one).&nbsp;We&nbsp;show&nbsp;that&nbsp;this&nbsp;implies<br/>
&nbsp;&nbsp;&nbsp;that&nbsp;it&nbsp;is&nbsp;also&nbsp;invariant&nbsp;under&nbsp;arbitrary&nbsp;lifting&nbsp;and&nbsp;under&nbsp;substitution.<br/>
&nbsp;&nbsp;&nbsp;It&nbsp;is&nbsp;important&nbsp;to&nbsp;use&nbsp;a&nbsp;quantifier-free&nbsp;definition&nbsp;of&nbsp;closedness,&nbsp;as&nbsp;this<br/>
&nbsp;&nbsp;&nbsp;makes&nbsp;it&nbsp;much&nbsp;easier&nbsp;to&nbsp;write&nbsp;tactics&nbsp;that&nbsp;construct&nbsp;and&nbsp;destruct&nbsp;closedness<br/>
&nbsp;&nbsp;&nbsp;assertions.&nbsp;*)</span><br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="closed" class="idref" href="#closed"><span class="id" title="definition">closed</span></a> `{<a id="H:84" class="idref" href="#H:84"><span class="id" title="binder">Lift</span></a> <a id="T:83" class="idref" href="#T:83"><span class="id" title="binder"><span id="H:84" class="id">T</span></span></a>} <a id="k:85" class="idref" href="#k:85"><span class="id" title="binder">k</span></a> <a id="t:86" class="idref" href="#t:86"><span class="id" title="binder">t</span></a> :=<br/>
&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#shift"><span class="id" title="abbreviation">shift</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#k:85"><span class="id" title="variable">k</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#t:86"><span class="id" title="variable">t</span></a> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#t:86"><span class="id" title="variable">t</span></a>.<br/>

<br/>
<span class="comment">(*&nbsp;<span class="inlinecode"><span class="id" title="var">rotate</span></span> <span class="inlinecode"><span class="id" title="var">n</span></span>&nbsp;maps&nbsp;the&nbsp;variable&nbsp;<span class="inlinecode">0</span>&nbsp;to&nbsp;the&nbsp;variable&nbsp;<span class="inlinecode"><span class="id" title="var">n</span></span>,&nbsp;maps&nbsp;<span class="inlinecode"><span class="id" title="var">n</span></span>&nbsp;to&nbsp;<span class="inlinecode"><span class="id" title="var">n</span>-1</span>,&nbsp;...,<br/>
&nbsp;&nbsp;&nbsp;<span class="inlinecode">1</span>&nbsp;to&nbsp;<span class="inlinecode">0</span>.&nbsp;It&nbsp;preserves&nbsp;every&nbsp;variable&nbsp;above&nbsp;<span class="inlinecode"><span class="id" title="var">n</span></span>.&nbsp;In&nbsp;particular,&nbsp;<span class="inlinecode"><span class="id" title="var">rotate</span></span> <span class="inlinecode">1</span><br/>
&nbsp;&nbsp;&nbsp;exchanges&nbsp;the&nbsp;variables&nbsp;<span class="inlinecode">0</span>&nbsp;and&nbsp;<span class="inlinecode">1</span>.&nbsp;*)</span><br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="rotate" class="idref" href="#rotate"><span class="id" title="definition">rotate</span></a> `{<a id="H:88" class="idref" href="#H:88"><span class="id" title="binder">Var</span></a> <a id="V:87" class="idref" href="#V:87"><span class="id" title="binder"><span id="H:88" class="id">V</span></span></a>, <a id="H0:90" class="idref" href="#H0:90"><span class="id" title="binder">Lift</span></a> <a id="T:89" class="idref" href="#T:89"><span class="id" title="binder"><span id="H0:90" class="id">T</span></span></a>, <a id="H1:91" class="idref" href="#H1:91"><span class="id" title="binder">Subst</span></a> <a id="H1:91" class="idref" href="#H1:91"><span class="id" title="binder">V</span></a> <a id="H1:91" class="idref" href="#H1:91"><span class="id" title="binder">T</span></a>} (<a id="n:92" class="idref" href="#n:92"><span class="id" title="binder">n</span></a> : <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>) (<a id="t:93" class="idref" href="#t:93"><span class="id" title="binder">t</span></a> : <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#T:89"><span class="id" title="variable">T</span></a>) : <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#T:89"><span class="id" title="variable">T</span></a> :=<br/>
&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#subst"><span class="id" title="method">subst</span></a> (<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#var"><span class="id" title="method">var</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#n:92"><span class="id" title="variable">n</span></a>) 0 (<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#shift"><span class="id" title="abbreviation">shift</span></a> (<a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Datatypes.html#S"><span class="id" title="constructor">S</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#n:92"><span class="id" title="variable">n</span></a>) <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#t:93"><span class="id" title="variable">t</span></a>).<br/>

<br/>
<span class="comment">(*&nbsp;----------------------------------------------------------------------------&nbsp;*)</span><br/>

<br/>
<span class="comment">(*&nbsp;Properties&nbsp;of&nbsp;these&nbsp;operations.&nbsp;*)</span><br/>

<br/>
<span class="comment">(*&nbsp;<span class="inlinecode"><span class="id" title="var">lift</span></span>&nbsp;commutes&nbsp;with&nbsp;<span class="inlinecode"><span class="id" title="var">var</span></span>.&nbsp;*)</span><br/>

<br/>
<span class="comment">(*&nbsp;This&nbsp;law&nbsp;alone&nbsp;is&nbsp;probably&nbsp;not&nbsp;of&nbsp;great&nbsp;interest&nbsp;to&nbsp;the&nbsp;client,&nbsp;who&nbsp;needs&nbsp;a<br/>
&nbsp;&nbsp;&nbsp;more&nbsp;general&nbsp;way&nbsp;of&nbsp;simplifying&nbsp;the&nbsp;application&nbsp;of&nbsp;<span class="inlinecode"><span class="id" title="var">lift</span></span>&nbsp;to&nbsp;a&nbsp;constructor.<br/>
&nbsp;&nbsp;&nbsp;We&nbsp;name&nbsp;this&nbsp;property&nbsp;because&nbsp;it&nbsp;is&nbsp;used&nbsp;by&nbsp;some&nbsp;of&nbsp;our&nbsp;lemmas.&nbsp;*)</span><br/>

<br/>
<span class="id" title="keyword">Class</span> <a id="LiftVar" class="idref" href="#LiftVar"><span class="id" title="record">LiftVar</span></a> `{<a id="H:95" class="idref" href="#H:95"><span class="id" title="binder">Var</span></a> <a id="A:94" class="idref" href="#A:94"><span class="id" title="binder"><span id="H:95" class="id">A</span></span></a>, <a id="H0:96" class="idref" href="#H0:96"><span class="id" title="binder">Lift</span></a> <a id="H0:96" class="idref" href="#H0:96"><span class="id" title="binder">A</span></a>} := {<br/>
&nbsp;&nbsp;<a id="lift_var" class="idref" href="#lift_var"><span class="id" title="projection">lift_var</span></a>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="w:98" class="idref" href="#w:98"><span class="id" title="binder">w</span></a> <a id="k:99" class="idref" href="#k:99"><span class="id" title="binder">k</span></a> <a id="x:100" class="idref" href="#x:100"><span class="id" title="binder">x</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#lift"><span class="id" title="method">lift</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#w:98"><span class="id" title="variable">w</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#k:99"><span class="id" title="variable">k</span></a> (<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#var"><span class="id" title="method">var</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#x:100"><span class="id" title="variable">x</span></a>) <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#var"><span class="id" title="method">var</span></a> (<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#lift"><span class="id" title="method">lift</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#w:98"><span class="id" title="variable">w</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#k:99"><span class="id" title="variable">k</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#x:100"><span class="id" title="variable">x</span></a>)<br/>
}.<br/>

<br/>
<span class="comment">(*&nbsp;<span class="inlinecode"><span class="id" title="var">lift</span></span> <span class="inlinecode">0</span>&nbsp;is&nbsp;the&nbsp;identity.&nbsp;*)</span><br/>

<br/>
<span class="id" title="keyword">Class</span> <a id="LiftZero" class="idref" href="#LiftZero"><span class="id" title="record">LiftZero</span></a> `{<a id="H:103" class="idref" href="#H:103"><span class="id" title="binder">Lift</span></a> <a id="T:102" class="idref" href="#T:102"><span class="id" title="binder"><span id="H:103" class="id">T</span></span></a>} := {<br/>
&nbsp;&nbsp;<a id="lift_zero" class="idref" href="#lift_zero"><span class="id" title="projection">lift_zero</span></a>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="k:105" class="idref" href="#k:105"><span class="id" title="binder">k</span></a> <a id="t:106" class="idref" href="#t:106"><span class="id" title="binder">t</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#lift"><span class="id" title="method">lift</span></a> 0 <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#k:105"><span class="id" title="variable">k</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#t:106"><span class="id" title="variable">t</span></a> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#t:106"><span class="id" title="variable">t</span></a><br/>
}.<br/>

<br/>
<span class="comment">(*&nbsp;<span class="inlinecode"><span class="id" title="var">lift</span></span>&nbsp;is&nbsp;injective.&nbsp;*)</span><br/>

<br/>
<span class="id" title="keyword">Class</span> <a id="LiftInjective" class="idref" href="#LiftInjective"><span class="id" title="record">LiftInjective</span></a> `{<a id="H:109" class="idref" href="#H:109"><span class="id" title="binder">Lift</span></a> <a id="T:108" class="idref" href="#T:108"><span class="id" title="binder"><span id="H:109" class="id">T</span></span></a>} := {<br/>
&nbsp;&nbsp;<a id="lift_injective" class="idref" href="#lift_injective"><span class="id" title="projection">lift_injective</span></a>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="w:111" class="idref" href="#w:111"><span class="id" title="binder">w</span></a> <a id="k:112" class="idref" href="#k:112"><span class="id" title="binder">k</span></a> <a id="t1:113" class="idref" href="#t1:113"><span class="id" title="binder">t1</span></a> <a id="t2:114" class="idref" href="#t2:114"><span class="id" title="binder">t2</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#lift"><span class="id" title="method">lift</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#w:111"><span class="id" title="variable">w</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#k:112"><span class="id" title="variable">k</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#t1:113"><span class="id" title="variable">t1</span></a> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#lift"><span class="id" title="method">lift</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#w:111"><span class="id" title="variable">w</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#k:112"><span class="id" title="variable">k</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#t2:114"><span class="id" title="variable">t2</span></a> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#t1:113"><span class="id" title="variable">t1</span></a> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#t2:114"><span class="id" title="variable">t2</span></a><br/>
}.<br/>

<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">lift_injective</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span> <span class="id" title="var">h</span>: <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#lift"><span class="id" title="method">lift</span></a> ?<span class="id" title="var">w</span> ?<span class="id" title="var">k</span> ?<span class="id" title="var">t1</span> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#lift"><span class="id" title="method">lift</span></a> ?<span class="id" title="var">w</span> ?<span class="id" title="var">k</span> ?<span class="id" title="var">t2</span> |- <span class="id" title="var">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">generalize</span> (<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#lift_injective"><span class="id" title="method">lift_injective</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">h</span>); <span class="id" title="tactic">clear</span> <span class="id" title="var">h</span>; <span class="id" title="tactic">intro</span> <span class="id" title="var">h</span>; <span class="id" title="tactic">try</span> (<span class="id" title="tactic">subst</span> <span class="id" title="var">t1</span>)<br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="comment">(*&nbsp;<span class="inlinecode"><span class="id" title="var">lift</span></span>&nbsp;commutes&nbsp;with&nbsp;itself.&nbsp;*)</span><br/>

<br/>
<span class="comment">(*&nbsp;In&nbsp;the&nbsp;special&nbsp;case&nbsp;where&nbsp;<span class="inlinecode"><span class="id" title="var">wk</span></span>&nbsp;and&nbsp;<span class="inlinecode"><span class="id" title="var">ws</span></span>&nbsp;are&nbsp;1,&nbsp;the&nbsp;law&nbsp;becomes:<br/>
&nbsp;&nbsp;&nbsp;<span class="inlinecode"><span class="id" title="var">k</span></span> <span class="inlinecode">&lt;=</span> <span class="inlinecode"><span class="id" title="var">s</span></span> <span class="inlinecode">-&gt;</span> <span class="inlinecode"><span class="id" title="var">shift</span></span> <span class="inlinecode"><span class="id" title="var">k</span></span> <span class="inlinecode">(<span class="id" title="var">shift</span></span> <span class="inlinecode"><span class="id" title="var">s</span></span> <span class="inlinecode"><span class="id" title="var">t</span>)</span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">shift</span></span> <span class="inlinecode">(1</span> <span class="inlinecode">+</span> <span class="inlinecode"><span class="id" title="var">s</span>)</span> <span class="inlinecode">(<span class="id" title="var">shift</span></span> <span class="inlinecode"><span class="id" title="var">k</span></span> <span class="inlinecode"><span class="id" title="var">t</span>)</span>.<br/>
&nbsp;&nbsp;&nbsp;Since&nbsp;<span class="inlinecode"><span class="id" title="var">k</span></span>&nbsp;is&nbsp;the&nbsp;smaller&nbsp;index,&nbsp;it&nbsp;is&nbsp;always&nbsp;called&nbsp;<span class="inlinecode"><span class="id" title="var">k</span></span>,&nbsp;regardless<br/>
&nbsp;&nbsp;&nbsp;of&nbsp;whether&nbsp;<span class="inlinecode"><span class="id" title="var">s</span></span>&nbsp;is&nbsp;or&nbsp;is&nbsp;not&nbsp;in&nbsp;scope.&nbsp;Conversely,&nbsp;since&nbsp;<span class="inlinecode"><span class="id" title="var">s</span></span>&nbsp;is&nbsp;the<br/>
&nbsp;&nbsp;&nbsp;larger&nbsp;index,&nbsp;it&nbsp;is&nbsp;called&nbsp;<span class="inlinecode"><span class="id" title="var">s</span></span>&nbsp;when&nbsp;<span class="inlinecode"><span class="id" title="var">k</span></span>&nbsp;is&nbsp;not&nbsp;in&nbsp;scope,&nbsp;but&nbsp;it&nbsp;is<br/>
&nbsp;&nbsp;&nbsp;called&nbsp;<span class="inlinecode">1</span> <span class="inlinecode">+</span> <span class="inlinecode"><span class="id" title="var">s</span></span>&nbsp;when&nbsp;<span class="inlinecode"><span class="id" title="var">k</span></span>&nbsp;is&nbsp;in&nbsp;scope.&nbsp;The&nbsp;law&nbsp;expresses&nbsp;the&nbsp;fact<br/>
&nbsp;&nbsp;&nbsp;that&nbsp;ending&nbsp;the&nbsp;scope&nbsp;of&nbsp;<span class="inlinecode"><span class="id" title="var">k</span></span>&nbsp;first,&nbsp;then&nbsp;the&nbsp;scope&nbsp;of&nbsp;<span class="inlinecode"><span class="id" title="var">s</span></span>,&nbsp;is&nbsp;the<br/>
&nbsp;&nbsp;&nbsp;same&nbsp;as&nbsp;ending&nbsp;the&nbsp;scope&nbsp;of&nbsp;<span class="inlinecode">1</span> <span class="inlinecode">+</span> <span class="inlinecode"><span class="id" title="var">s</span></span>,&nbsp;then&nbsp;the&nbsp;scope&nbsp;of&nbsp;<span class="inlinecode"><span class="id" title="var">k</span></span>.&nbsp;It&nbsp;is<br/>
&nbsp;&nbsp;&nbsp;a&nbsp;commutation&nbsp;law&nbsp;with&nbsp;a&nbsp;slight&nbsp;technical&nbsp;adjustment.&nbsp;*)</span><br/>

<br/>
<span class="comment">(*&nbsp;Roughly&nbsp;speaking,&nbsp;<span class="inlinecode"><span class="id" title="keyword">end</span></span> <span class="inlinecode"><span class="id" title="var">k</span></span> <span class="inlinecode"><span class="id" title="tactic">in</span></span> <span class="inlinecode"><span class="id" title="keyword">end</span></span> <span class="inlinecode"><span class="id" title="var">s</span></span> <span class="inlinecode"><span class="id" title="tactic">in</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span>&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;<span class="inlinecode"><span class="id" title="keyword">end</span></span> <span class="inlinecode"><span class="id" title="var">s</span></span> <span class="inlinecode"><span class="id" title="tactic">in</span></span>
   <span class="inlinecode"><span class="id" title="keyword">end</span></span> <span class="inlinecode"><span class="id" title="var">k</span></span> <span class="inlinecode"><span class="id" title="tactic">in</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span>.&nbsp;*)</span><br/>

<br/>
<span class="id" title="keyword">Class</span> <a id="LiftLift" class="idref" href="#LiftLift"><span class="id" title="record">LiftLift</span></a> `{<a id="H:117" class="idref" href="#H:117"><span class="id" title="binder">Lift</span></a> <a id="T:116" class="idref" href="#T:116"><span class="id" title="binder"><span id="H:117" class="id">T</span></span></a>} := {<br/>
&nbsp;&nbsp;<a id="lift_lift" class="idref" href="#lift_lift"><span class="id" title="projection">lift_lift</span></a>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="t:119" class="idref" href="#t:119"><span class="id" title="binder">t</span></a> <a id="k:120" class="idref" href="#k:120"><span class="id" title="binder">k</span></a> <a id="s:121" class="idref" href="#s:121"><span class="id" title="binder">s</span></a> <a id="wk:122" class="idref" href="#wk:122"><span class="id" title="binder">wk</span></a> <a id="ws:123" class="idref" href="#ws:123"><span class="id" title="binder">ws</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#k:120"><span class="id" title="variable">k</span></a> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Peano.html#cb53cf0ee22c036a03b4a9281c68b5a3"><span class="id" title="notation">&lt;=</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#s:121"><span class="id" title="variable">s</span></a> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#lift"><span class="id" title="method">lift</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#wk:122"><span class="id" title="variable">wk</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#k:120"><span class="id" title="variable">k</span></a> (<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#lift"><span class="id" title="method">lift</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#ws:123"><span class="id" title="variable">ws</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#s:121"><span class="id" title="variable">s</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#t:119"><span class="id" title="variable">t</span></a>) <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#lift"><span class="id" title="method">lift</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#ws:123"><span class="id" title="variable">ws</span></a> (<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#wk:122"><span class="id" title="variable">wk</span></a> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#s:121"><span class="id" title="variable">s</span></a>) (<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#lift"><span class="id" title="method">lift</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#wk:122"><span class="id" title="variable">wk</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#k:120"><span class="id" title="variable">k</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#t:119"><span class="id" title="variable">t</span></a>)<br/>
}.<br/>

<br/>
<span class="comment">(*&nbsp;One&nbsp;might&nbsp;wonder&nbsp;whether&nbsp;it&nbsp;is&nbsp;sufficient&nbsp;for&nbsp;this&nbsp;law&nbsp;to&nbsp;consider<br/>
&nbsp;&nbsp;&nbsp;the&nbsp;case&nbsp;where&nbsp;<span class="inlinecode"><span class="id" title="var">k</span></span> <span class="inlinecode">&lt;=</span> <span class="inlinecode"><span class="id" title="var">s</span></span>&nbsp;holds.&nbsp;What&nbsp;happens&nbsp;in&nbsp;the&nbsp;other&nbsp;cases?<br/>
&nbsp;&nbsp;&nbsp;Well,&nbsp;one&nbsp;can&nbsp;check&nbsp;that&nbsp;if&nbsp;<span class="inlinecode"><span class="id" title="var">k</span></span> <span class="inlinecode">&gt;=</span> <span class="inlinecode"><span class="id" title="var">s</span></span> <span class="inlinecode">+</span> <span class="inlinecode"><span class="id" title="var">ws</span></span>&nbsp;holds,&nbsp;then&nbsp;the&nbsp;law<br/>
&nbsp;&nbsp;&nbsp;applies&nbsp;in&nbsp;the&nbsp;other&nbsp;direction.&nbsp;The&nbsp;following&nbsp;lemma&nbsp;proves&nbsp;this.&nbsp;*)</span><br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="lift_lift_reversed" class="idref" href="#lift_lift_reversed"><span class="id" title="lemma">lift_lift_reversed</span></a>:<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> `{<a id="H:126" class="idref" href="#H:126"><span class="id" title="binder">Lift</span></a> <a id="T:125" class="idref" href="#T:125"><span class="id" title="binder"><span id="H:126" class="id">T</span></span></a>},<br/>
&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#LiftLift"><span class="id" title="class">LiftLift</span></a> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="wk:127" class="idref" href="#wk:127"><span class="id" title="binder">wk</span></a> <a id="k:128" class="idref" href="#k:128"><span class="id" title="binder">k</span></a> <a id="ws:129" class="idref" href="#ws:129"><span class="id" title="binder">ws</span></a> <a id="s:130" class="idref" href="#s:130"><span class="id" title="binder">s</span></a> <a id="t:131" class="idref" href="#t:131"><span class="id" title="binder">t</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#k:128"><span class="id" title="variable">k</span></a> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Peano.html#73030c22bc0b1fa771c65aa5414c65f9"><span class="id" title="notation">&gt;=</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#s:130"><span class="id" title="variable">s</span></a> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#ws:129"><span class="id" title="variable">ws</span></a> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#lift"><span class="id" title="method">lift</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#wk:127"><span class="id" title="variable">wk</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#k:128"><span class="id" title="variable">k</span></a> (<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#lift"><span class="id" title="method">lift</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#ws:129"><span class="id" title="variable">ws</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#s:130"><span class="id" title="variable">s</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#t:131"><span class="id" title="variable">t</span></a>) <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#lift"><span class="id" title="method">lift</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#ws:129"><span class="id" title="variable">ws</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#s:130"><span class="id" title="variable">s</span></a> (<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#lift"><span class="id" title="method">lift</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#wk:127"><span class="id" title="variable">wk</span></a> (<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#k:128"><span class="id" title="variable">k</span></a> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Peano.html#::nat_scope:x_'-'_x"><span class="id" title="notation">-</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#ws:129"><span class="id" title="variable">ws</span></a>) <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#t:131"><span class="id" title="variable">t</span></a>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">replace</span> <span class="id" title="var">k</span> <span class="id" title="keyword">with</span> (<span class="id" title="var">ws</span> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">(</span></a><span class="id" title="var">k</span> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Peano.html#::nat_scope:x_'-'_x"><span class="id" title="notation">-</span></a> <span class="id" title="var">ws</span><a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">)</span></a>) <span class="id" title="tactic">by</span> <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">erewrite</span> &lt;- <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#lift_lift"><span class="id" title="method">lift_lift</span></a> <span class="id" title="tactic">by</span> <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">replace</span> (<span class="id" title="var">ws</span> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">(</span></a><span class="id" title="var">k</span> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Peano.html#::nat_scope:x_'-'_x"><span class="id" title="notation">-</span></a> <span class="id" title="var">ws</span><a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Peano.html#::nat_scope:x_'-'_x"><span class="id" title="notation">-</span></a> <span class="id" title="var">ws</span>) <span class="id" title="keyword">with</span> (<span class="id" title="var">k</span> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Peano.html#::nat_scope:x_'-'_x"><span class="id" title="notation">-</span></a> <span class="id" title="var">ws</span>) <span class="id" title="tactic">by</span> <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">reflexivity</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="comment">(*&nbsp;If&nbsp;<span class="inlinecode"><span class="id" title="var">ws</span></span>&nbsp;is&nbsp;1,&nbsp;then&nbsp;the&nbsp;two&nbsp;cases&nbsp;considered&nbsp;above,&nbsp;namely&nbsp;<span class="inlinecode"><span class="id" title="var">k</span></span> <span class="inlinecode">&lt;=</span> <span class="inlinecode"><span class="id" title="var">s</span></span><br/>
&nbsp;&nbsp;&nbsp;and&nbsp;<span class="inlinecode"><span class="id" title="var">k</span></span> <span class="inlinecode">&gt;=</span> <span class="inlinecode"><span class="id" title="var">s</span></span> <span class="inlinecode">+</span> <span class="inlinecode"><span class="id" title="var">ws</span></span>,&nbsp;are&nbsp;exhaustive.&nbsp;Now,&nbsp;what&nbsp;happens&nbsp;when&nbsp;<span class="inlinecode"><span class="id" title="var">k</span></span>&nbsp;is<br/>
&nbsp;&nbsp;&nbsp;comprised&nbsp;between&nbsp;<span class="inlinecode"><span class="id" title="var">s</span></span>&nbsp;and&nbsp;<span class="inlinecode"><span class="id" title="var">s</span></span> <span class="inlinecode">+</span> <span class="inlinecode"><span class="id" title="var">ws</span></span>?&nbsp;The&nbsp;following&nbsp;law&nbsp;answers&nbsp;this<br/>
&nbsp;&nbsp;&nbsp;question.&nbsp;This&nbsp;law&nbsp;also&nbsp;covers&nbsp;the&nbsp;extreme&nbsp;cases&nbsp;where&nbsp;<span class="inlinecode"><span class="id" title="var">k</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">s</span></span>&nbsp;and<br/>
&nbsp;&nbsp;&nbsp;<span class="inlinecode"><span class="id" title="var">k</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">s</span></span> <span class="inlinecode">+</span> <span class="inlinecode"><span class="id" title="var">ws</span></span>,&nbsp;which&nbsp;may&nbsp;seem&nbsp;surprising,&nbsp;since&nbsp;they&nbsp;are&nbsp;already<br/>
&nbsp;&nbsp;&nbsp;covered&nbsp;by&nbsp;<span class="inlinecode"><span class="id" title="var">lift_lift</span></span>.&nbsp;The&nbsp;law&nbsp;below&nbsp;states&nbsp;that,&nbsp;in&nbsp;this&nbsp;case,<br/>
&nbsp;&nbsp;&nbsp;the&nbsp;two&nbsp;<span class="inlinecode"><span class="id" title="var">lift</span></span>&nbsp;operations&nbsp;can&nbsp;be&nbsp;combined&nbsp;into&nbsp;a&nbsp;single&nbsp;one.&nbsp;Note<br/>
&nbsp;&nbsp;&nbsp;that&nbsp;the&nbsp;exact&nbsp;value&nbsp;of&nbsp;<span class="inlinecode"><span class="id" title="var">k</span></span>&nbsp;is&nbsp;irrelevant&nbsp;as&nbsp;long&nbsp;as&nbsp;it&nbsp;lies&nbsp;within<br/>
&nbsp;&nbsp;&nbsp;this&nbsp;interval.&nbsp;*)</span><br/>

<br/>
<span class="id" title="keyword">Class</span> <a id="LiftLiftFuse" class="idref" href="#LiftLiftFuse"><span class="id" title="record">LiftLiftFuse</span></a> `{<a id="H:133" class="idref" href="#H:133"><span class="id" title="binder">Lift</span></a> <a id="T:132" class="idref" href="#T:132"><span class="id" title="binder"><span id="H:133" class="id">T</span></span></a>} := {<br/>
&nbsp;&nbsp;<a id="lift_lift_fuse" class="idref" href="#lift_lift_fuse"><span class="id" title="projection">lift_lift_fuse</span></a>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="t:135" class="idref" href="#t:135"><span class="id" title="binder">t</span></a> <a id="k:136" class="idref" href="#k:136"><span class="id" title="binder">k</span></a> <a id="s:137" class="idref" href="#s:137"><span class="id" title="binder">s</span></a> <a id="wk:138" class="idref" href="#wk:138"><span class="id" title="binder">wk</span></a> <a id="ws:139" class="idref" href="#ws:139"><span class="id" title="binder">ws</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#s:137"><span class="id" title="variable">s</span></a> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Peano.html#e25b6ed2455c445c4a805315e6c2e053"><span class="id" title="notation">&lt;=</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#k:136"><span class="id" title="variable">k</span></a> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Peano.html#e25b6ed2455c445c4a805315e6c2e053"><span class="id" title="notation">&lt;=</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#s:137"><span class="id" title="variable">s</span></a> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#ws:139"><span class="id" title="variable">ws</span></a> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#lift"><span class="id" title="method">lift</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#wk:138"><span class="id" title="variable">wk</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#k:136"><span class="id" title="variable">k</span></a> (<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#lift"><span class="id" title="method">lift</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#ws:139"><span class="id" title="variable">ws</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#s:137"><span class="id" title="variable">s</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#t:135"><span class="id" title="variable">t</span></a>) <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#lift"><span class="id" title="method">lift</span></a> (<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#wk:138"><span class="id" title="variable">wk</span></a> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#ws:139"><span class="id" title="variable">ws</span></a>) <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#s:137"><span class="id" title="variable">s</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#t:135"><span class="id" title="variable">t</span></a><br/>
}.<br/>

<br/>
<span class="comment">(*&nbsp;<span class="inlinecode"><span class="id" title="tactic">subst</span></span>&nbsp;identifies&nbsp;<span class="inlinecode"><span class="id" title="var">var</span></span>&nbsp;and&nbsp;simplifies&nbsp;to&nbsp;<span class="inlinecode"><span class="id" title="var">subst_idx</span></span>.&nbsp;*)</span><br/>

<br/>
<span class="comment">(*&nbsp;This&nbsp;law&nbsp;alone&nbsp;is&nbsp;probably&nbsp;not&nbsp;of&nbsp;great&nbsp;interest&nbsp;to&nbsp;the&nbsp;client,&nbsp;who&nbsp;needs&nbsp;a<br/>
&nbsp;&nbsp;&nbsp;more&nbsp;general&nbsp;way&nbsp;of&nbsp;simplifying&nbsp;the&nbsp;application&nbsp;of&nbsp;<span class="inlinecode"><span class="id" title="tactic">subst</span></span>&nbsp;to&nbsp;a&nbsp;constructor.<br/>
&nbsp;&nbsp;&nbsp;We&nbsp;name&nbsp;this&nbsp;property&nbsp;because&nbsp;it&nbsp;is&nbsp;used&nbsp;by&nbsp;some&nbsp;of&nbsp;our&nbsp;lemmas.&nbsp;*)</span><br/>

<br/>
<span class="id" title="keyword">Class</span> <a id="SubstVar" class="idref" href="#SubstVar"><span class="id" title="record">SubstVar</span></a> `{<a id="H:142" class="idref" href="#H:142"><span class="id" title="binder">Var</span></a> <a id="A:141" class="idref" href="#A:141"><span class="id" title="binder"><span id="H:142" class="id">A</span></span></a>, <a id="H0:143" class="idref" href="#H0:143"><span class="id" title="binder">Subst</span></a> <a id="H0:143" class="idref" href="#H0:143"><span class="id" title="binder">A</span></a> <a id="H0:143" class="idref" href="#H0:143"><span class="id" title="binder">A</span></a>} := {<br/>
&nbsp;&nbsp;<a id="subst_var" class="idref" href="#subst_var"><span class="id" title="projection">subst_var</span></a>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="a:145" class="idref" href="#a:145"><span class="id" title="binder">a</span></a> <a id="k:146" class="idref" href="#k:146"><span class="id" title="binder">k</span></a> <a id="x:147" class="idref" href="#x:147"><span class="id" title="binder">x</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#subst"><span class="id" title="method">subst</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#a:145"><span class="id" title="variable">a</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#k:146"><span class="id" title="variable">k</span></a> (<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#var"><span class="id" title="method">var</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#x:147"><span class="id" title="variable">x</span></a>) <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#subst_idx"><span class="id" title="definition">subst_idx</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#a:145"><span class="id" title="variable">a</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#k:146"><span class="id" title="variable">k</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#x:147"><span class="id" title="variable">x</span></a><br/>
}.<br/>

<br/>
<span class="comment">(*&nbsp;A&nbsp;substitution&nbsp;for&nbsp;the&nbsp;variable&nbsp;<span class="inlinecode"><span class="id" title="var">k</span></span>&nbsp;vanishes&nbsp;when&nbsp;it&nbsp;reaches&nbsp;an<br/>
&nbsp;&nbsp;&nbsp;end-of-scope&nbsp;marker&nbsp;for&nbsp;the&nbsp;variable&nbsp;<span class="inlinecode"><span class="id" title="var">k</span></span>.&nbsp;This&nbsp;is&nbsp;expressed&nbsp;by<br/>
&nbsp;&nbsp;&nbsp;the&nbsp;following&nbsp;law.&nbsp;*)</span><br/>

<br/>
<span class="id" title="keyword">Class</span> <a id="SubstLift" class="idref" href="#SubstLift"><span class="id" title="record">SubstLift</span></a> `{<a id="H:150" class="idref" href="#H:150"><span class="id" title="binder">Lift</span></a> <a id="T:149" class="idref" href="#T:149"><span class="id" title="binder"><span id="H:150" class="id">T</span></span></a>, <a id="H0:152" class="idref" href="#H0:152"><span class="id" title="binder">Subst</span></a> <a id="V:151" class="idref" href="#V:151"><span class="id" title="binder"><span id="H0:152" class="id">V</span></span></a> <a id="H0:152" class="idref" href="#H0:152"><span class="id" title="binder">T</span></a>} := {<br/>
&nbsp;&nbsp;<a id="subst_lift" class="idref" href="#subst_lift"><span class="id" title="projection">subst_lift</span></a>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="v:154" class="idref" href="#v:154"><span class="id" title="binder">v</span></a> <a id="k:155" class="idref" href="#k:155"><span class="id" title="binder">k</span></a> <a id="t:156" class="idref" href="#t:156"><span class="id" title="binder">t</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#subst"><span class="id" title="method">subst</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#v:154"><span class="id" title="variable">v</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#k:155"><span class="id" title="variable">k</span></a> (<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#shift"><span class="id" title="abbreviation">shift</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#k:155"><span class="id" title="variable">k</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#t:156"><span class="id" title="variable">t</span></a>) <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#t:156"><span class="id" title="variable">t</span></a><br/>
}.<br/>

<br/>
<span class="comment">(*&nbsp;<span class="inlinecode"><span class="id" title="var">lift</span></span>&nbsp;and&nbsp;<span class="inlinecode"><span class="id" title="tactic">subst</span></span>&nbsp;commute.&nbsp;*)</span><br/>

<br/>
<span class="comment">(*&nbsp;Roughly&nbsp;speaking,&nbsp;<span class="inlinecode"><span class="id" title="keyword">end</span></span> <span class="inlinecode"><span class="id" title="var">k</span></span> <span class="inlinecode"><span class="id" title="tactic">in</span></span> <span class="inlinecode"><span class="id" title="keyword">let</span></span> <span class="inlinecode"><span class="id" title="var">s</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">v</span></span> <span class="inlinecode"><span class="id" title="tactic">in</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span>&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;<span class="inlinecode"><span class="id" title="keyword">let</span></span> <span class="inlinecode"><span class="id" title="var">s</span></span> <span class="inlinecode">=</span> <span class="inlinecode">(<span class="id" title="keyword">end</span></span>
   <span class="inlinecode"><span class="id" title="var">k</span></span> <span class="inlinecode"><span class="id" title="tactic">in</span></span> <span class="inlinecode"><span class="id" title="var">v</span>)</span> <span class="inlinecode"><span class="id" title="tactic">in</span></span> <span class="inlinecode">(<span class="id" title="keyword">end</span></span> <span class="inlinecode"><span class="id" title="var">k</span></span> <span class="inlinecode"><span class="id" title="tactic">in</span></span> <span class="inlinecode"><span class="id" title="var">t</span>)</span>.&nbsp;At&nbsp;least,&nbsp;that&nbsp;is&nbsp;the&nbsp;idea.&nbsp;The&nbsp;``technical<br/>
&nbsp;&nbsp;&nbsp;adjustments''&nbsp;make&nbsp;it&nbsp;quite&nbsp;difficult&nbsp;to&nbsp;understand&nbsp;what&nbsp;is&nbsp;going&nbsp;on&nbsp;in<br/>
&nbsp;&nbsp;&nbsp;detail.&nbsp;*)</span><br/>

<br/>
<span class="comment">(*&nbsp;Below,&nbsp;we&nbsp;propose&nbsp;two&nbsp;laws,&nbsp;which&nbsp;cover&nbsp;the&nbsp;cases&nbsp;<span class="inlinecode"><span class="id" title="var">k</span></span> <span class="inlinecode">&lt;=</span> <span class="inlinecode"><span class="id" title="var">s</span></span>&nbsp;and&nbsp;<span class="inlinecode"><span class="id" title="var">s</span></span> <span class="inlinecode">&lt;=</span> <span class="inlinecode"><span class="id" title="var">k</span></span>.&nbsp;It<br/>
&nbsp;&nbsp;&nbsp;may&nbsp;seem&nbsp;somewhat&nbsp;troubling&nbsp;that&nbsp;these&nbsp;cases&nbsp;are&nbsp;not&nbsp;disjoint!&nbsp;When&nbsp;<span class="inlinecode"><span class="id" title="var">k</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">s</span></span>,<br/>
&nbsp;&nbsp;&nbsp;the&nbsp;two&nbsp;right-hand&nbsp;sides&nbsp;differ&nbsp;in&nbsp;a&nbsp;certain&nbsp;manner&nbsp;that&nbsp;is&nbsp;described&nbsp;by&nbsp;the<br/>
&nbsp;&nbsp;&nbsp;law&nbsp;<span class="inlinecode"><span class="id" title="var">PunPun</span></span>&nbsp;shown&nbsp;further&nbsp;on.&nbsp;*)</span><br/>

<br/>
<span class="comment">(*&nbsp;We&nbsp;also&nbsp;offer&nbsp;a&nbsp;general&nbsp;law,&nbsp;which&nbsp;unifies&nbsp;these&nbsp;two&nbsp;laws,&nbsp;and&nbsp;arbitrarily<br/>
&nbsp;&nbsp;&nbsp;gives&nbsp;preference&nbsp;to&nbsp;the&nbsp;second&nbsp;law&nbsp;in&nbsp;the&nbsp;case&nbsp;where&nbsp;<span class="inlinecode"><span class="id" title="var">k</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">s</span></span>.&nbsp;It&nbsp;is&nbsp;not<br/>
&nbsp;&nbsp;&nbsp;clear&nbsp;whether&nbsp;this&nbsp;complex&nbsp;general&nbsp;law&nbsp;is&nbsp;of&nbsp;any&nbsp;use&nbsp;in&nbsp;practice.&nbsp;*)</span><br/>

<br/>
<span class="id" title="keyword">Class</span> <a id="LiftSubst1" class="idref" href="#LiftSubst1"><span class="id" title="record">LiftSubst1</span></a> `{<a id="H:159" class="idref" href="#H:159"><span class="id" title="binder">Lift</span></a> <a id="V:158" class="idref" href="#V:158"><span class="id" title="binder"><span id="H:159" class="id">V</span></span></a>, <a id="H0:161" class="idref" href="#H0:161"><span class="id" title="binder">Lift</span></a> <a id="T:160" class="idref" href="#T:160"><span class="id" title="binder"><span id="H0:161" class="id">T</span></span></a>, <a id="H1:162" class="idref" href="#H1:162"><span class="id" title="binder">Subst</span></a> <a id="H1:162" class="idref" href="#H1:162"><span class="id" title="binder">V</span></a> <a id="H1:162" class="idref" href="#H1:162"><span class="id" title="binder">T</span></a>} := {<br/>
&nbsp;&nbsp;<a id="lift_subst_1" class="idref" href="#lift_subst_1"><span class="id" title="projection">lift_subst_1</span></a>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="t:164" class="idref" href="#t:164"><span class="id" title="binder">t</span></a> <a id="k:165" class="idref" href="#k:165"><span class="id" title="binder">k</span></a> <a id="v:166" class="idref" href="#v:166"><span class="id" title="binder">v</span></a> <a id="s:167" class="idref" href="#s:167"><span class="id" title="binder">s</span></a> <a id="w:168" class="idref" href="#w:168"><span class="id" title="binder">w</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#k:165"><span class="id" title="variable">k</span></a> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Peano.html#cb53cf0ee22c036a03b4a9281c68b5a3"><span class="id" title="notation">&lt;=</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#s:167"><span class="id" title="variable">s</span></a> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#lift"><span class="id" title="method">lift</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#w:168"><span class="id" title="variable">w</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#k:165"><span class="id" title="variable">k</span></a> (<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#subst"><span class="id" title="method">subst</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#v:166"><span class="id" title="variable">v</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#s:167"><span class="id" title="variable">s</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#t:164"><span class="id" title="variable">t</span></a>) <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#subst"><span class="id" title="method">subst</span></a> (<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#lift"><span class="id" title="method">lift</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#w:168"><span class="id" title="variable">w</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#k:165"><span class="id" title="variable">k</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#v:166"><span class="id" title="variable">v</span></a>) (<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#w:168"><span class="id" title="variable">w</span></a> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#s:167"><span class="id" title="variable">s</span></a>) (<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#lift"><span class="id" title="method">lift</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#w:168"><span class="id" title="variable">w</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#k:165"><span class="id" title="variable">k</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#t:164"><span class="id" title="variable">t</span></a>)<br/>
}.<br/>

<br/>
<span class="id" title="keyword">Class</span> <a id="LiftSubst2" class="idref" href="#LiftSubst2"><span class="id" title="record">LiftSubst2</span></a> `{<a id="H:171" class="idref" href="#H:171"><span class="id" title="binder">Lift</span></a> <a id="V:170" class="idref" href="#V:170"><span class="id" title="binder"><span id="H:171" class="id">V</span></span></a>, <a id="H0:173" class="idref" href="#H0:173"><span class="id" title="binder">Lift</span></a> <a id="T:172" class="idref" href="#T:172"><span class="id" title="binder"><span id="H0:173" class="id">T</span></span></a>, <a id="H1:174" class="idref" href="#H1:174"><span class="id" title="binder">Subst</span></a> <a id="H1:174" class="idref" href="#H1:174"><span class="id" title="binder">V</span></a> <a id="H1:174" class="idref" href="#H1:174"><span class="id" title="binder">T</span></a>} := {<br/>
&nbsp;&nbsp;<a id="lift_subst_2" class="idref" href="#lift_subst_2"><span class="id" title="projection">lift_subst_2</span></a>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="t:176" class="idref" href="#t:176"><span class="id" title="binder">t</span></a> <a id="k:177" class="idref" href="#k:177"><span class="id" title="binder">k</span></a> <a id="v:178" class="idref" href="#v:178"><span class="id" title="binder">v</span></a> <a id="s:179" class="idref" href="#s:179"><span class="id" title="binder">s</span></a> <a id="w:180" class="idref" href="#w:180"><span class="id" title="binder">w</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#s:179"><span class="id" title="variable">s</span></a> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Peano.html#cb53cf0ee22c036a03b4a9281c68b5a3"><span class="id" title="notation">&lt;=</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#k:177"><span class="id" title="variable">k</span></a> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#lift"><span class="id" title="method">lift</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#w:180"><span class="id" title="variable">w</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#k:177"><span class="id" title="variable">k</span></a> (<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#subst"><span class="id" title="method">subst</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#v:178"><span class="id" title="variable">v</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#s:179"><span class="id" title="variable">s</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#t:176"><span class="id" title="variable">t</span></a>) <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#subst"><span class="id" title="method">subst</span></a> (<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#lift"><span class="id" title="method">lift</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#w:180"><span class="id" title="variable">w</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#k:177"><span class="id" title="variable">k</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#v:178"><span class="id" title="variable">v</span></a>) <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#s:179"><span class="id" title="variable">s</span></a> (<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#lift"><span class="id" title="method">lift</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#w:180"><span class="id" title="variable">w</span></a> (1 <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#k:177"><span class="id" title="variable">k</span></a>) <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#t:176"><span class="id" title="variable">t</span></a>)<br/>
}.<br/>

<br/>
<span class="id" title="keyword">Class</span> <a id="LiftSubst" class="idref" href="#LiftSubst"><span class="id" title="record">LiftSubst</span></a> `{<a id="H:183" class="idref" href="#H:183"><span class="id" title="binder">Lift</span></a> <a id="V:182" class="idref" href="#V:182"><span class="id" title="binder"><span id="H:183" class="id">V</span></span></a>, <a id="H0:185" class="idref" href="#H0:185"><span class="id" title="binder">Lift</span></a> <a id="T:184" class="idref" href="#T:184"><span class="id" title="binder"><span id="H0:185" class="id">T</span></span></a>, <a id="H1:186" class="idref" href="#H1:186"><span class="id" title="binder">Subst</span></a> <a id="H1:186" class="idref" href="#H1:186"><span class="id" title="binder">V</span></a> <a id="H1:186" class="idref" href="#H1:186"><span class="id" title="binder">T</span></a>} := {<br/>
&nbsp;&nbsp;<a id="lift_subst" class="idref" href="#lift_subst"><span class="id" title="projection">lift_subst</span></a>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="t:188" class="idref" href="#t:188"><span class="id" title="binder">t</span></a> <a id="k:189" class="idref" href="#k:189"><span class="id" title="binder">k</span></a> <a id="v:190" class="idref" href="#v:190"><span class="id" title="binder">v</span></a> <a id="s:191" class="idref" href="#s:191"><span class="id" title="binder">s</span></a> <a id="w:192" class="idref" href="#w:192"><span class="id" title="binder">w</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#lift"><span class="id" title="method">lift</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#w:192"><span class="id" title="variable">w</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#k:189"><span class="id" title="variable">k</span></a> (<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#subst"><span class="id" title="method">subst</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#v:190"><span class="id" title="variable">v</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#s:191"><span class="id" title="variable">s</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#t:188"><span class="id" title="variable">t</span></a>) <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#subst"><span class="id" title="method">subst</span></a> (<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#lift"><span class="id" title="method">lift</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#w:192"><span class="id" title="variable">w</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#k:189"><span class="id" title="variable">k</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#v:190"><span class="id" title="variable">v</span></a>) (<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#lift"><span class="id" title="method">lift</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#w:192"><span class="id" title="variable">w</span></a> (1 <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#k:189"><span class="id" title="variable">k</span></a>) <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#s:191"><span class="id" title="variable">s</span></a>) (<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#lift"><span class="id" title="method">lift</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#w:192"><span class="id" title="variable">w</span></a> (<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#shift"><span class="id" title="abbreviation">shift</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#s:191"><span class="id" title="variable">s</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#k:189"><span class="id" title="variable">k</span></a>) <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#t:188"><span class="id" title="variable">t</span></a>)<br/>
}.<br/>

<br/>
<span class="comment">(*&nbsp;<span class="inlinecode"><span class="id" title="tactic">subst</span></span>&nbsp;commutes&nbsp;with&nbsp;itself.&nbsp;*)</span><br/>

<br/>
<span class="comment">(*&nbsp;Roughly&nbsp;speaking,&nbsp;<span class="inlinecode"><span class="id" title="keyword">let</span></span> <span class="inlinecode"><span class="id" title="var">s</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">v</span></span> <span class="inlinecode"><span class="id" title="tactic">in</span></span> <span class="inlinecode"><span class="id" title="keyword">let</span></span> <span class="inlinecode"><span class="id" title="var">k</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">w</span></span> <span class="inlinecode"><span class="id" title="tactic">in</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span>&nbsp;is&nbsp;equivalent&nbsp;to<br/>
&nbsp;&nbsp;&nbsp;<span class="inlinecode"><span class="id" title="keyword">let</span></span> <span class="inlinecode"><span class="id" title="var">k</span></span> <span class="inlinecode">=</span> <span class="inlinecode">(<span class="id" title="keyword">let</span></span> <span class="inlinecode"><span class="id" title="var">s</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">v</span></span> <span class="inlinecode"><span class="id" title="tactic">in</span></span> <span class="inlinecode"><span class="id" title="var">w</span>)</span> <span class="inlinecode"><span class="id" title="tactic">in</span></span> <span class="inlinecode"><span class="id" title="keyword">let</span></span> <span class="inlinecode"><span class="id" title="var">s</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">v</span></span> <span class="inlinecode"><span class="id" title="tactic">in</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span>,&nbsp;again&nbsp;with&nbsp;``technical<br/>
&nbsp;&nbsp;&nbsp;adjustments''.&nbsp;*)</span><br/>

<br/>
<span class="comment">(*&nbsp;This&nbsp;law&nbsp;covers&nbsp;only&nbsp;the&nbsp;case&nbsp;where&nbsp;<span class="inlinecode"><span class="id" title="var">k</span></span> <span class="inlinecode">&lt;=</span> <span class="inlinecode"><span class="id" title="var">s</span></span>.&nbsp;I&nbsp;am&nbsp;not&nbsp;sure&nbsp;what&nbsp;can<br/>
&nbsp;&nbsp;&nbsp;be&nbsp;said&nbsp;about&nbsp;the&nbsp;other&nbsp;case.&nbsp;Of&nbsp;course&nbsp;the&nbsp;law&nbsp;can&nbsp;be&nbsp;read&nbsp;from&nbsp;right<br/>
&nbsp;&nbsp;&nbsp;to&nbsp;left,&nbsp;and&nbsp;this&nbsp;says&nbsp;something&nbsp;about&nbsp;the&nbsp;case&nbsp;where&nbsp;<span class="inlinecode"><span class="id" title="var">k</span></span> <span class="inlinecode">&gt;=</span> <span class="inlinecode">1</span> <span class="inlinecode">+</span> <span class="inlinecode"><span class="id" title="var">s</span></span>,&nbsp;but<br/>
&nbsp;&nbsp;&nbsp;only&nbsp;if&nbsp;the&nbsp;values&nbsp;<span class="inlinecode"><span class="id" title="var">v</span></span>&nbsp;and&nbsp;<span class="inlinecode"><span class="id" title="var">w</span></span>&nbsp;are&nbsp;of&nbsp;a&nbsp;specific&nbsp;form.&nbsp;Maybe&nbsp;there&nbsp;is<br/>
&nbsp;&nbsp;&nbsp;nothing&nbsp;more&nbsp;to&nbsp;be&nbsp;said.&nbsp;*)</span><br/>

<br/>
<span class="id" title="keyword">Class</span> <a id="SubstSubst" class="idref" href="#SubstSubst"><span class="id" title="record">SubstSubst</span></a> `{<a id="H:195" class="idref" href="#H:195"><span class="id" title="binder">Lift</span></a> <a id="V:194" class="idref" href="#V:194"><span class="id" title="binder"><span id="H:195" class="id">V</span></span></a>, <a id="H0:196" class="idref" href="#H0:196"><span class="id" title="binder">Subst</span></a> <a id="H0:196" class="idref" href="#H0:196"><span class="id" title="binder">V</span></a> <a id="H0:196" class="idref" href="#H0:196"><span class="id" title="binder">V</span></a>, <a id="H1:198" class="idref" href="#H1:198"><span class="id" title="binder">Subst</span></a> <a id="H1:198" class="idref" href="#H1:198"><span class="id" title="binder">V</span></a> <a id="T:197" class="idref" href="#T:197"><span class="id" title="binder"><span id="H1:198" class="id">T</span></span></a>} := {<br/>
&nbsp;&nbsp;<a id="subst_subst" class="idref" href="#subst_subst"><span class="id" title="projection">subst_subst</span></a>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="t:200" class="idref" href="#t:200"><span class="id" title="binder">t</span></a> <a id="k:201" class="idref" href="#k:201"><span class="id" title="binder">k</span></a> <a id="v:202" class="idref" href="#v:202"><span class="id" title="binder">v</span></a> <a id="s:203" class="idref" href="#s:203"><span class="id" title="binder">s</span></a> <a id="w:204" class="idref" href="#w:204"><span class="id" title="binder">w</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#k:201"><span class="id" title="variable">k</span></a> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Peano.html#cb53cf0ee22c036a03b4a9281c68b5a3"><span class="id" title="notation">&lt;=</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#s:203"><span class="id" title="variable">s</span></a> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#subst"><span class="id" title="method">subst</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#v:202"><span class="id" title="variable">v</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#s:203"><span class="id" title="variable">s</span></a> (<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#subst"><span class="id" title="method">subst</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#w:204"><span class="id" title="variable">w</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#k:201"><span class="id" title="variable">k</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#t:200"><span class="id" title="variable">t</span></a>) <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#subst"><span class="id" title="method">subst</span></a> (<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#subst"><span class="id" title="method">subst</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#v:202"><span class="id" title="variable">v</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#s:203"><span class="id" title="variable">s</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#w:204"><span class="id" title="variable">w</span></a>) <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#k:201"><span class="id" title="variable">k</span></a> (<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#subst"><span class="id" title="method">subst</span></a> (<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#shift"><span class="id" title="abbreviation">shift</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#k:201"><span class="id" title="variable">k</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#v:202"><span class="id" title="variable">v</span></a>) (1 <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#s:203"><span class="id" title="variable">s</span></a>) <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#t:200"><span class="id" title="variable">t</span></a>)<br/>
}.<br/>

<br/>
<span class="comment">(*&nbsp;Substituting&nbsp;<span class="inlinecode"><span class="id" title="var">x</span></span>&nbsp;for&nbsp;<span class="inlinecode"><span class="id" title="var">x</span></span>&nbsp;is&nbsp;the&nbsp;identity.&nbsp;This&nbsp;is&nbsp;known&nbsp;as&nbsp;a&nbsp;pun.&nbsp;*)</span><br/>

<br/>
<span class="comment">(*&nbsp;In&nbsp;a&nbsp;de&nbsp;Bruijn&nbsp;setting,&nbsp;it&nbsp;does&nbsp;not&nbsp;even&nbsp;make&nbsp;sense&nbsp;to&nbsp;speak&nbsp;of&nbsp;replacing<br/>
&nbsp;&nbsp;&nbsp;a&nbsp;variable&nbsp;with&nbsp;itself,&nbsp;because&nbsp;in&nbsp;the&nbsp;term&nbsp;<span class="inlinecode"><span class="id" title="tactic">subst</span></span> <span class="inlinecode"><span class="id" title="var">v</span></span> <span class="inlinecode"><span class="id" title="var">k</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span>,&nbsp;the&nbsp;value&nbsp;<span class="inlinecode"><span class="id" title="var">v</span></span><br/>
&nbsp;&nbsp;&nbsp;and&nbsp;the&nbsp;variable&nbsp;<span class="inlinecode"><span class="id" title="var">k</span></span>&nbsp;inhabit&nbsp;different&nbsp;spaces.&nbsp;*)</span><br/>

<br/>
<span class="comment">(*&nbsp;Instead,&nbsp;we&nbsp;can&nbsp;write&nbsp;<span class="inlinecode"><span class="id" title="keyword">let</span></span> <span class="inlinecode"><span class="id" title="var">S</span></span> <span class="inlinecode"><span class="id" title="var">k</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">k</span></span> <span class="inlinecode"><span class="id" title="tactic">in</span></span> <span class="inlinecode"><span class="id" title="keyword">end</span></span> <span class="inlinecode"><span class="id" title="var">k</span></span> <span class="inlinecode"><span class="id" title="tactic">in</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span>.&nbsp;This&nbsp;introduces&nbsp;<span class="inlinecode"><span class="id" title="var">S</span></span> <span class="inlinecode"><span class="id" title="var">k</span></span>&nbsp;as<br/>
&nbsp;&nbsp;&nbsp;an&nbsp;alias&nbsp;for&nbsp;<span class="inlinecode"><span class="id" title="var">k</span></span>,&nbsp;then&nbsp;forgets&nbsp;about&nbsp;<span class="inlinecode"><span class="id" title="var">k</span></span>,&nbsp;so&nbsp;<span class="inlinecode"><span class="id" title="var">S</span></span> <span class="inlinecode"><span class="id" title="var">k</span></span>&nbsp;is&nbsp;renumbered&nbsp;and&nbsp;becomes<br/>
&nbsp;&nbsp;&nbsp;<span class="inlinecode"><span class="id" title="var">k</span></span>&nbsp;again.&nbsp;Or&nbsp;we&nbsp;can&nbsp;write&nbsp;<span class="inlinecode"><span class="id" title="keyword">let</span></span> <span class="inlinecode"><span class="id" title="var">k</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">k</span></span> <span class="inlinecode"><span class="id" title="tactic">in</span></span> <span class="inlinecode"><span class="id" title="keyword">end</span></span> <span class="inlinecode"><span class="id" title="var">S</span></span> <span class="inlinecode"><span class="id" title="var">k</span></span> <span class="inlinecode"><span class="id" title="tactic">in</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span>.&nbsp;This&nbsp;introduces&nbsp;<span class="inlinecode"><span class="id" title="var">k</span></span><br/>
&nbsp;&nbsp;&nbsp;as&nbsp;an&nbsp;alias&nbsp;for&nbsp;the&nbsp;old&nbsp;<span class="inlinecode"><span class="id" title="var">k</span></span>,&nbsp;which&nbsp;gets&nbsp;renumbered&nbsp;and&nbsp;becomes&nbsp;<span class="inlinecode"><span class="id" title="var">S</span></span> <span class="inlinecode"><span class="id" title="var">k</span></span>,&nbsp;then<br/>
&nbsp;&nbsp;&nbsp;forgets&nbsp;about&nbsp;<span class="inlinecode"><span class="id" title="var">S</span></span> <span class="inlinecode"><span class="id" title="var">k</span></span>.&nbsp;In&nbsp;each&nbsp;of&nbsp;these&nbsp;two&nbsp;cases,&nbsp;we&nbsp;introduce&nbsp;a&nbsp;new&nbsp;variable<br/>
&nbsp;&nbsp;&nbsp;and&nbsp;forget&nbsp;about&nbsp;the&nbsp;old&nbsp;one;&nbsp;the&nbsp;apparent&nbsp;difference&nbsp;lies&nbsp;in&nbsp;how&nbsp;we&nbsp;number<br/>
&nbsp;&nbsp;&nbsp;the&nbsp;new&nbsp;variable,&nbsp;but&nbsp;this&nbsp;makes&nbsp;no&nbsp;deep&nbsp;difference.&nbsp;We&nbsp;give&nbsp;the&nbsp;variants<br/>
&nbsp;&nbsp;&nbsp;of&nbsp;the&nbsp;law&nbsp;for&nbsp;puns,&nbsp;plus&nbsp;a&nbsp;law&nbsp;that&nbsp;helps&nbsp;recognize&nbsp;these&nbsp;two&nbsp;variants&nbsp;as<br/>
&nbsp;&nbsp;&nbsp;equal.&nbsp;*)</span><br/>

<br/>
<span class="id" title="keyword">Class</span> <a id="Pun1" class="idref" href="#Pun1"><span class="id" title="record">Pun1</span></a> `{<a id="H:207" class="idref" href="#H:207"><span class="id" title="binder">Var</span></a> <a id="V:206" class="idref" href="#V:206"><span class="id" title="binder"><span id="H:207" class="id">V</span></span></a>, <a id="H0:209" class="idref" href="#H0:209"><span class="id" title="binder">Lift</span></a> <a id="T:208" class="idref" href="#T:208"><span class="id" title="binder"><span id="H0:209" class="id">T</span></span></a>, <a id="H1:210" class="idref" href="#H1:210"><span class="id" title="binder">Subst</span></a> <a id="H1:210" class="idref" href="#H1:210"><span class="id" title="binder">V</span></a> <a id="H1:210" class="idref" href="#H1:210"><span class="id" title="binder">T</span></a>} := {<br/>
&nbsp;&nbsp;<a id="pun_1" class="idref" href="#pun_1"><span class="id" title="projection">pun_1</span></a>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="t:212" class="idref" href="#t:212"><span class="id" title="binder">t</span></a> <a id="k:213" class="idref" href="#k:213"><span class="id" title="binder">k</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#subst"><span class="id" title="method">subst</span></a> (<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#var"><span class="id" title="method">var</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#k:213"><span class="id" title="variable">k</span></a>) (<a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Datatypes.html#S"><span class="id" title="constructor">S</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#k:213"><span class="id" title="variable">k</span></a>) (<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#shift"><span class="id" title="abbreviation">shift</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#k:213"><span class="id" title="variable">k</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#t:212"><span class="id" title="variable">t</span></a>) <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#t:212"><span class="id" title="variable">t</span></a><br/>
}.<br/>

<br/>
<span class="id" title="keyword">Class</span> <a id="Pun2" class="idref" href="#Pun2"><span class="id" title="record">Pun2</span></a> `{<a id="H:216" class="idref" href="#H:216"><span class="id" title="binder">Var</span></a> <a id="V:215" class="idref" href="#V:215"><span class="id" title="binder"><span id="H:216" class="id">V</span></span></a>, <a id="H0:218" class="idref" href="#H0:218"><span class="id" title="binder">Lift</span></a> <a id="T:217" class="idref" href="#T:217"><span class="id" title="binder"><span id="H0:218" class="id">T</span></span></a>, <a id="H1:219" class="idref" href="#H1:219"><span class="id" title="binder">Subst</span></a> <a id="H1:219" class="idref" href="#H1:219"><span class="id" title="binder">V</span></a> <a id="H1:219" class="idref" href="#H1:219"><span class="id" title="binder">T</span></a>} := {<br/>
&nbsp;&nbsp;<a id="pun_2" class="idref" href="#pun_2"><span class="id" title="projection">pun_2</span></a>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="t:221" class="idref" href="#t:221"><span class="id" title="binder">t</span></a> <a id="k:222" class="idref" href="#k:222"><span class="id" title="binder">k</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#subst"><span class="id" title="method">subst</span></a> (<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#var"><span class="id" title="method">var</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#k:222"><span class="id" title="variable">k</span></a>) <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#k:222"><span class="id" title="variable">k</span></a> (<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#shift"><span class="id" title="abbreviation">shift</span></a> (<a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Datatypes.html#S"><span class="id" title="constructor">S</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#k:222"><span class="id" title="variable">k</span></a>) <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#t:221"><span class="id" title="variable">t</span></a>) <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#t:221"><span class="id" title="variable">t</span></a><br/>
}.<br/>

<br/>
<span class="id" title="keyword">Class</span> <a id="PunPun" class="idref" href="#PunPun"><span class="id" title="record">PunPun</span></a> `{<a id="H:225" class="idref" href="#H:225"><span class="id" title="binder">Var</span></a> <a id="V:224" class="idref" href="#V:224"><span class="id" title="binder"><span id="H:225" class="id">V</span></span></a>, <a id="H0:227" class="idref" href="#H0:227"><span class="id" title="binder">Lift</span></a> <a id="T:226" class="idref" href="#T:226"><span class="id" title="binder"><span id="H0:227" class="id">T</span></span></a>, <a id="H1:228" class="idref" href="#H1:228"><span class="id" title="binder">Subst</span></a> <a id="H1:228" class="idref" href="#H1:228"><span class="id" title="binder">V</span></a> <a id="H1:228" class="idref" href="#H1:228"><span class="id" title="binder">T</span></a>} := {<br/>
&nbsp;&nbsp;<a id="pun_pun" class="idref" href="#pun_pun"><span class="id" title="projection">pun_pun</span></a>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="v:230" class="idref" href="#v:230"><span class="id" title="binder">v</span></a> <a id="w:231" class="idref" href="#w:231"><span class="id" title="binder">w</span></a> <a id="k:232" class="idref" href="#k:232"><span class="id" title="binder">k</span></a> <a id="t:233" class="idref" href="#t:233"><span class="id" title="binder">t</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#subst"><span class="id" title="method">subst</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#v:230"><span class="id" title="variable">v</span></a> (<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#w:231"><span class="id" title="variable">w</span></a> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#k:232"><span class="id" title="variable">k</span></a>) (<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#lift"><span class="id" title="method">lift</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#w:231"><span class="id" title="variable">w</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#k:232"><span class="id" title="variable">k</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#t:233"><span class="id" title="variable">t</span></a>) <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#subst"><span class="id" title="method">subst</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#v:230"><span class="id" title="variable">v</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#k:232"><span class="id" title="variable">k</span></a> (<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#lift"><span class="id" title="method">lift</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#w:231"><span class="id" title="variable">w</span></a> (1 <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#k:232"><span class="id" title="variable">k</span></a>) <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#t:233"><span class="id" title="variable">t</span></a>)<br/>
}.<br/>

<br/>
<span class="comment">(*&nbsp;<span class="inlinecode"><span class="id" title="var">rotate</span></span> <span class="inlinecode">1</span>&nbsp;exchanges&nbsp;the&nbsp;variables&nbsp;<span class="inlinecode">0</span>&nbsp;and&nbsp;<span class="inlinecode">1</span>,&nbsp;so&nbsp;it&nbsp;is&nbsp;own&nbsp;inverse.&nbsp;*)</span><br/>

<br/>
<span class="id" title="keyword">Class</span> <a id="Rotate1SelfInverse" class="idref" href="#Rotate1SelfInverse"><span class="id" title="record">Rotate1SelfInverse</span></a> `{<a id="H:236" class="idref" href="#H:236"><span class="id" title="binder">Var</span></a> <a id="V:235" class="idref" href="#V:235"><span class="id" title="binder"><span id="H:236" class="id">V</span></span></a>, <a id="H0:238" class="idref" href="#H0:238"><span class="id" title="binder">Lift</span></a> <a id="T:237" class="idref" href="#T:237"><span class="id" title="binder"><span id="H0:238" class="id">T</span></span></a>, <a id="H1:239" class="idref" href="#H1:239"><span class="id" title="binder">Subst</span></a> <a id="H1:239" class="idref" href="#H1:239"><span class="id" title="binder">V</span></a> <a id="H1:239" class="idref" href="#H1:239"><span class="id" title="binder">T</span></a>} := {<br/>
&nbsp;&nbsp;<a id="rotate1_self_inverse" class="idref" href="#rotate1_self_inverse"><span class="id" title="projection">rotate1_self_inverse</span></a>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="t:241" class="idref" href="#t:241"><span class="id" title="binder">t</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#rotate"><span class="id" title="definition">rotate</span></a> 1 (<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#rotate"><span class="id" title="definition">rotate</span></a> 1 <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#t:241"><span class="id" title="variable">t</span></a>) <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#t:241"><span class="id" title="variable">t</span></a><br/>
}.<br/>

<br/>
<span class="comment">(*&nbsp;----------------------------------------------------------------------------&nbsp;*)</span><br/>
<span class="comment">(*&nbsp;----------------------------------------------------------------------------&nbsp;*)</span><br/>

<br/>
<span class="comment">(*&nbsp;A&nbsp;few&nbsp;consequences&nbsp;of&nbsp;the&nbsp;properties&nbsp;that&nbsp;the&nbsp;user&nbsp;proves&nbsp;about&nbsp;<span class="inlinecode"><span class="id" title="var">traverse</span></span>.&nbsp;*)</span><br/>

<br/>
<span class="comment">(*&nbsp;We&nbsp;could&nbsp;present&nbsp;these&nbsp;properties&nbsp;in&nbsp;the&nbsp;form&nbsp;of&nbsp;classes,&nbsp;as&nbsp;opposed&nbsp;to&nbsp;lemmas.<br/>
&nbsp;&nbsp;&nbsp;This&nbsp;would&nbsp;be&nbsp;perhaps&nbsp;slightly&nbsp;more&nbsp;convenient&nbsp;but&nbsp;also&nbsp;more&nbsp;confusing.&nbsp;It&nbsp;is<br/>
&nbsp;&nbsp;&nbsp;seems&nbsp;preferable&nbsp;to&nbsp;work&nbsp;directly&nbsp;with&nbsp;the&nbsp;basic&nbsp;classes&nbsp;that&nbsp;the&nbsp;user&nbsp;knows<br/>
&nbsp;&nbsp;&nbsp;about.&nbsp;*)</span><br/>

<br/>
<span class="comment">(*&nbsp;<span class="inlinecode"><span class="id" title="var">traverse</span></span>&nbsp;is&nbsp;compatible&nbsp;with&nbsp;extensional&nbsp;equality.&nbsp;*)</span><br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="traverse_extensional" class="idref" href="#traverse_extensional"><span class="id" title="lemma">traverse_extensional</span></a>:<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> `{<a id="H:245" class="idref" href="#H:245"><span class="id" title="binder">Traverse</span></a> <a id="V:243" class="idref" href="#V:243"><span class="id" title="binder"><span id="H:245" class="id">V</span></span></a> <a id="T:244" class="idref" href="#T:244"><span class="id" title="binder"><span id="H:245" class="id">T</span></span></a>},<br/>
&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#TraverseRelative"><span class="id" title="class">TraverseRelative</span></a> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="f:246" class="idref" href="#f:246"><span class="id" title="binder">f</span></a> <a id="g:247" class="idref" href="#g:247"><span class="id" title="binder">g</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">(</span></a><span class="id" title="keyword">forall</span> <a id="l:248" class="idref" href="#l:248"><span class="id" title="binder">l</span></a> <a id="x:249" class="idref" href="#x:249"><span class="id" title="binder">x</span></a>, <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#f:246"><span class="id" title="variable">f</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#l:248"><span class="id" title="variable">l</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#x:249"><span class="id" title="variable">x</span></a> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#g:247"><span class="id" title="variable">g</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#l:248"><span class="id" title="variable">l</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#x:249"><span class="id" title="variable">x</span></a><a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="t:250" class="idref" href="#t:250"><span class="id" title="binder">t</span></a> <a id="l:251" class="idref" href="#l:251"><span class="id" title="binder">l</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#traverse"><span class="id" title="method">traverse</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#f:246"><span class="id" title="variable">f</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#l:251"><span class="id" title="variable">l</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#t:250"><span class="id" title="variable">t</span></a> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#traverse"><span class="id" title="method">traverse</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#g:247"><span class="id" title="variable">g</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#l:251"><span class="id" title="variable">l</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#t:250"><span class="id" title="variable">t</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#traverse_relative"><span class="id" title="method">traverse_relative</span></a> <span class="id" title="keyword">with</span> (<span class="id" title="var">p</span> := 0).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">m</span> ?. <span class="id" title="tactic">replace</span> (<span class="id" title="var">m</span> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a> 0) <span class="id" title="keyword">with</span> <span class="id" title="var">m</span> <span class="id" title="tactic">by</span> <span class="id" title="var">lia</span>. <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">lia</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="comment">(*&nbsp;A&nbsp;composition&nbsp;of&nbsp;<span class="inlinecode"><span class="id" title="var">traverse</span></span>&nbsp;with&nbsp;<span class="inlinecode"><span class="id" title="var">traverse_var</span></span>&nbsp;simplifies&nbsp;to&nbsp;a&nbsp;single&nbsp;call<br/>
&nbsp;&nbsp;&nbsp;to&nbsp;<span class="inlinecode"><span class="id" title="var">traverse</span></span>.&nbsp;In&nbsp;other&nbsp;words,&nbsp;composing&nbsp;a&nbsp;substitution&nbsp;and&nbsp;a&nbsp;(not<br/>
&nbsp;&nbsp;&nbsp;necessarily&nbsp;bijective)&nbsp;renaming&nbsp;yields&nbsp;another&nbsp;substitution.&nbsp;*)</span><br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="traverse_traverse_var" class="idref" href="#traverse_traverse_var"><span class="id" title="lemma">traverse_traverse_var</span></a>:<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> `{<a id="H:253" class="idref" href="#H:253"><span class="id" title="binder">Var</span></a> <a id="V:252" class="idref" href="#V:252"><span class="id" title="binder"><span id="H:253" class="id">V</span></span></a>, <a id="H0:254" class="idref" href="#H0:254"><span class="id" title="binder">Traverse</span></a> <a id="H0:254" class="idref" href="#H0:254"><span class="id" title="binder">V</span></a> <a id="H0:254" class="idref" href="#H0:254"><span class="id" title="binder">V</span></a>, <a id="H1:256" class="idref" href="#H1:256"><span class="id" title="binder">Traverse</span></a> <a id="H1:256" class="idref" href="#H1:256"><span class="id" title="binder">V</span></a> <a id="T:255" class="idref" href="#T:255"><span class="id" title="binder"><span id="H1:256" class="id">T</span></span></a>},<br/>
&nbsp;&nbsp;@<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#TraverseFunctorial"><span class="id" title="class">TraverseFunctorial</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#V:252"><span class="id" title="variable">V</span></a> <span class="id" title="var">_</span> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#T:255"><span class="id" title="variable">T</span></a> <span class="id" title="var">_</span> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;@<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#TraverseRelative"><span class="id" title="class">TraverseRelative</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#V:252"><span class="id" title="variable">V</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#T:255"><span class="id" title="variable">T</span></a> <span class="id" title="var">_</span> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <span class="comment">(*&nbsp;TraverseExtensional&nbsp;*)</span><br/>
&nbsp;&nbsp;@<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#TraverseIdentifiesVar"><span class="id" title="class">TraverseIdentifiesVar</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#V:252"><span class="id" title="variable">V</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="f:257" class="idref" href="#f:257"><span class="id" title="binder">f</span></a> <a id="g:258" class="idref" href="#g:258"><span class="id" title="binder">g</span></a> <a id="t:259" class="idref" href="#t:259"><span class="id" title="binder">t</span></a> <a id="l:260" class="idref" href="#l:260"><span class="id" title="binder">l</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#traverse"><span class="id" title="method">traverse</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#g:258"><span class="id" title="variable">g</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#l:260"><span class="id" title="variable">l</span></a> (<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#traverse_var"><span class="id" title="abbreviation">traverse_var</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#f:257"><span class="id" title="variable">f</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#l:260"><span class="id" title="variable">l</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#t:259"><span class="id" title="variable">t</span></a>) <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#traverse"><span class="id" title="method">traverse</span></a> (<span class="id" title="keyword">fun</span> <a id="l:261" class="idref" href="#l:261"><span class="id" title="binder">l</span></a> <a id="x:262" class="idref" href="#x:262"><span class="id" title="binder">x</span></a> =&gt; <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#g:258"><span class="id" title="variable">g</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#l:261"><span class="id" title="variable">l</span></a> (<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#f:257"><span class="id" title="variable">f</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#l:261"><span class="id" title="variable">l</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#x:262"><span class="id" title="variable">x</span></a>)) <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#l:260"><span class="id" title="variable">l</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#t:259"><span class="id" title="variable">t</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#traverse_functorial"><span class="id" title="method">traverse_functorial</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> (<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#traverse_extensional"><span class="id" title="lemma">traverse_extensional</span></a> <span class="id" title="var">_</span>).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eauto</span> <span class="id" title="keyword">using</span> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#traverse_identifies_var"><span class="id" title="method">traverse_identifies_var</span></a>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="comment">(*&nbsp;----------------------------------------------------------------------------&nbsp;*)</span><br/>

<br/>
<span class="comment">(*&nbsp;This&nbsp;internal&nbsp;tactic&nbsp;helps&nbsp;prove&nbsp;goals&nbsp;by&nbsp;examination&nbsp;of&nbsp;all&nbsp;cases.&nbsp;*)</span><br/>

<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">just_do_it</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#subst"><span class="id" title="method">subst</span></a>, <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#Subst_idx"><span class="id" title="instance">Subst_idx</span></a>, <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#subst_idx"><span class="id" title="definition">subst_idx</span></a>, <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#lift"><span class="id" title="method">lift</span></a>, <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#Lift_idx"><span class="id" title="instance">Lift_idx</span></a>, <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#var"><span class="id" title="method">var</span></a>, <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#Var_idx"><span class="id" title="instance">Var_idx</span></a>;<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>;<br/>
&nbsp;&nbsp;<span class="id" title="var">dblib_by_cases</span>; <span class="id" title="tactic">eauto</span> <span class="id" title="keyword">with</span> <span class="id" title="var">lia</span>.<br/>

<br/>
<span class="comment">(*&nbsp;The&nbsp;following&nbsp;two&nbsp;lemmas&nbsp;re-state&nbsp;the&nbsp;definition&nbsp;of&nbsp;<span class="inlinecode"><span class="id" title="var">lift</span></span>&nbsp;at&nbsp;type&nbsp;<span class="inlinecode"><span class="id" title="var">nat</span></span>.&nbsp;*)</span><br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="lift_idx_recent" class="idref" href="#lift_idx_recent"><span class="id" title="lemma">lift_idx_recent</span></a>:<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="w:263" class="idref" href="#w:263"><span class="id" title="binder">w</span></a> <a id="k:264" class="idref" href="#k:264"><span class="id" title="binder">k</span></a> <a id="x:265" class="idref" href="#x:265"><span class="id" title="binder">x</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#k:264"><span class="id" title="variable">k</span></a> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Peano.html#::nat_scope:x_'&gt;'_x"><span class="id" title="notation">&gt;</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#x:265"><span class="id" title="variable">x</span></a> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#lift"><span class="id" title="method">lift</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#w:263"><span class="id" title="variable">w</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#k:264"><span class="id" title="variable">k</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#x:265"><span class="id" title="variable">x</span></a> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#x:265"><span class="id" title="variable">x</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">just_do_it</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="lift_idx_old" class="idref" href="#lift_idx_old"><span class="id" title="lemma">lift_idx_old</span></a>:<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="w:266" class="idref" href="#w:266"><span class="id" title="binder">w</span></a> <a id="k:267" class="idref" href="#k:267"><span class="id" title="binder">k</span></a> <a id="x:268" class="idref" href="#x:268"><span class="id" title="binder">x</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#k:267"><span class="id" title="variable">k</span></a> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Peano.html#cb53cf0ee22c036a03b4a9281c68b5a3"><span class="id" title="notation">&lt;=</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#x:268"><span class="id" title="variable">x</span></a> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#lift"><span class="id" title="method">lift</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#w:266"><span class="id" title="variable">w</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#k:267"><span class="id" title="variable">k</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#x:268"><span class="id" title="variable">x</span></a> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#w:266"><span class="id" title="variable">w</span></a> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#x:268"><span class="id" title="variable">x</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">just_do_it</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="comment">(*&nbsp;This&nbsp;tactic&nbsp;applies&nbsp;whichever&nbsp;of&nbsp;the&nbsp;above&nbsp;two&nbsp;lemmas&nbsp;is&nbsp;applicable.&nbsp;*)</span><br/>

<br/>
<span class="id" title="keyword">Create HintDb</span> <span class="id" title="var">lift_idx_hints</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;more&nbsp;hints&nbsp;to&nbsp;be&nbsp;added&nbsp;later&nbsp;on&nbsp;into&nbsp;this&nbsp;database&nbsp;*)</span><br/>

<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">lift_idx</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="tactic">first</span> [ <span class="id" title="tactic">rewrite</span> @<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#lift_idx_recent"><span class="id" title="lemma">lift_idx_recent</span></a> <span class="id" title="tactic">by</span> <span class="id" title="tactic">solve</span> [ <span class="id" title="var">lia</span> | <span class="id" title="tactic">eauto</span> <span class="id" title="keyword">with</span> <span class="id" title="var">lift_idx_hints</span> ]<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="tactic">rewrite</span> @<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#lift_idx_old"><span class="id" title="lemma">lift_idx_old</span></a> <span class="id" title="tactic">by</span> <span class="id" title="var">lia</span> ].<br/>

<br/>
<span class="id" title="keyword">Hint Extern</span> 1 =&gt; <span class="id" title="var">lift_idx</span> : <span class="id" title="var">lift_idx</span>.<br/>

<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">lift_idx_in</span> <span class="id" title="var">h</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="tactic">first</span> [ <span class="id" title="tactic">rewrite</span> @<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#lift_idx_recent"><span class="id" title="lemma">lift_idx_recent</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">h</span> <span class="id" title="tactic">by</span> <span class="id" title="tactic">solve</span> [ <span class="id" title="var">lia</span> | <span class="id" title="tactic">eauto</span> <span class="id" title="keyword">with</span> <span class="id" title="var">lift_idx_hints</span> ]<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="tactic">rewrite</span> @<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#lift_idx_old"><span class="id" title="lemma">lift_idx_old</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">h</span> <span class="id" title="tactic">by</span> <span class="id" title="var">lia</span> ].<br/>

<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">lift_idx_all</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="tactic">first</span> [ <span class="id" title="tactic">rewrite</span> @<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#lift_idx_recent"><span class="id" title="lemma">lift_idx_recent</span></a> <span class="id" title="tactic">in</span> * <span class="id" title="tactic">by</span> <span class="id" title="tactic">solve</span> [ <span class="id" title="var">lia</span> | <span class="id" title="tactic">eauto</span> <span class="id" title="keyword">with</span> <span class="id" title="var">lift_idx_hints</span> ]<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="tactic">rewrite</span> @<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#lift_idx_old"><span class="id" title="lemma">lift_idx_old</span></a> <span class="id" title="tactic">in</span> * <span class="id" title="tactic">by</span> <span class="id" title="var">lia</span> ].<br/>

<br/>
<span class="comment">(*&nbsp;This&nbsp;tactic&nbsp;finds&nbsp;an&nbsp;occurrence&nbsp;of&nbsp;<span class="inlinecode"><span class="id" title="var">lift</span></span> <span class="inlinecode"><span class="id" title="var">_</span></span> <span class="inlinecode"><span class="id" title="var">_</span></span> <span class="inlinecode"><span class="id" title="var">_</span></span>&nbsp;at&nbsp;type&nbsp;<span class="inlinecode"><span class="id" title="var">nat</span></span>&nbsp;and<br/>
&nbsp;&nbsp;&nbsp;examines&nbsp;both&nbsp;cases.&nbsp;*)</span><br/>

<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">destruct_lift_idx</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span> |- <span class="id" title="keyword">context</span>[@<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#lift"><span class="id" title="method">lift</span></a> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> ?<span class="id" title="var">y</span> ?<span class="id" title="var">x</span>] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="definition">le_gt_dec</span> <span class="id" title="var">y</span> <span class="id" title="var">x</span>); <span class="id" title="var">lift_idx</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="comment">(*&nbsp;Our&nbsp;definition&nbsp;of&nbsp;<span class="inlinecode"><span class="id" title="var">lift</span></span>&nbsp;at&nbsp;type&nbsp;<span class="inlinecode"><span class="id" title="var">nat</span></span>&nbsp;satisfies&nbsp;the&nbsp;properties&nbsp;listed&nbsp;above.&nbsp;*)</span><br/>

<br/>
<span class="id" title="keyword">Instance</span> <a id="LiftVar_idx" class="idref" href="#LiftVar_idx"><span class="id" title="instance">LiftVar_idx</span></a>: @<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#LiftVar"><span class="id" title="class">LiftVar</span></a> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span>.<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">constructor</span>. <span class="id" title="var">just_do_it</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Instance</span> <a id="LiftZero_idx" class="idref" href="#LiftZero_idx"><span class="id" title="instance">LiftZero_idx</span></a>: @<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#LiftZero"><span class="id" title="class">LiftZero</span></a> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a> <span class="id" title="var">_</span>.<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">constructor</span>. <span class="id" title="var">just_do_it</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Instance</span> <a id="LiftInjective_idx" class="idref" href="#LiftInjective_idx"><span class="id" title="instance">LiftInjective_idx</span></a>: @<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#LiftInjective"><span class="id" title="class">LiftInjective</span></a> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a> <span class="id" title="var">_</span>.<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">constructor</span>. <span class="id" title="var">just_do_it</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Instance</span> <a id="LiftLift_idx" class="idref" href="#LiftLift_idx"><span class="id" title="instance">LiftLift_idx</span></a>: @<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#LiftLift"><span class="id" title="class">LiftLift</span></a> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a> <span class="id" title="var">_</span>.<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">constructor</span>. <span class="id" title="var">just_do_it</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Instance</span> <a id="LiftLiftFuse_idx" class="idref" href="#LiftLiftFuse_idx"><span class="id" title="instance">LiftLiftFuse_idx</span></a>: @<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#LiftLiftFuse"><span class="id" title="class">LiftLiftFuse</span></a> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a> <span class="id" title="var">_</span>.<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">constructor</span>. <span class="id" title="var">just_do_it</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="comment">(*&nbsp;We&nbsp;could&nbsp;also&nbsp;state&nbsp;and&nbsp;prove&nbsp;that&nbsp;our&nbsp;definition&nbsp;of&nbsp;<span class="inlinecode"><span class="id" title="tactic">subst</span></span>&nbsp;at&nbsp;type&nbsp;<span class="inlinecode"><span class="id" title="var">nat</span></span><br/>
&nbsp;&nbsp;&nbsp;satisfies&nbsp;the&nbsp;properties&nbsp;listed&nbsp;above.&nbsp;However,&nbsp;this&nbsp;would&nbsp;not&nbsp;be&nbsp;very<br/>
&nbsp;&nbsp;&nbsp;interesting,&nbsp;because&nbsp;we&nbsp;need&nbsp;more&nbsp;general&nbsp;statements&nbsp;about&nbsp;<span class="inlinecode"><span class="id" title="var">subst_idx</span></span>,<br/>
&nbsp;&nbsp;&nbsp;which&nbsp;is&nbsp;heterogeneous:&nbsp;the&nbsp;type&nbsp;<span class="inlinecode"><span class="id" title="var">V</span></span>&nbsp;is&nbsp;not&nbsp;<span class="inlinecode"><span class="id" title="var">nat</span></span>.&nbsp;We&nbsp;are&nbsp;able&nbsp;to&nbsp;get&nbsp;away<br/>
&nbsp;&nbsp;&nbsp;without&nbsp;making&nbsp;these&nbsp;more&nbsp;general&nbsp;statements&nbsp;explicit:&nbsp;they&nbsp;appear&nbsp;inside<br/>
&nbsp;&nbsp;&nbsp;some&nbsp;proofs&nbsp;and&nbsp;we&nbsp;prove&nbsp;them&nbsp;on&nbsp;the&nbsp;fly.&nbsp;*)</span><br/>

<br/>
<span class="comment">(*&nbsp;The&nbsp;following&nbsp;three&nbsp;lemmas&nbsp;re-state&nbsp;the&nbsp;definition&nbsp;of&nbsp;<span class="inlinecode"><span class="id" title="var">subst_idx</span></span>.&nbsp;*)</span><br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="subst_idx_miss_1" class="idref" href="#subst_idx_miss_1"><span class="id" title="lemma">subst_idx_miss_1</span></a>:<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> `{<a id="H:270" class="idref" href="#H:270"><span class="id" title="binder">Var</span></a> <a id="V:269" class="idref" href="#V:269"><span class="id" title="binder"><span id="H:270" class="id">V</span></span></a>} <a id="v:271" class="idref" href="#v:271"><span class="id" title="binder">v</span></a> <a id="k:272" class="idref" href="#k:272"><span class="id" title="binder">k</span></a> <a id="x:273" class="idref" href="#x:273"><span class="id" title="binder">x</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#k:272"><span class="id" title="variable">k</span></a> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Peano.html#::nat_scope:x_'&gt;'_x"><span class="id" title="notation">&gt;</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#x:273"><span class="id" title="variable">x</span></a> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#subst_idx"><span class="id" title="definition">subst_idx</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#v:271"><span class="id" title="variable">v</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#k:272"><span class="id" title="variable">k</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#x:273"><span class="id" title="variable">x</span></a> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#var"><span class="id" title="method">var</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#x:273"><span class="id" title="variable">x</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">just_do_it</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="subst_idx_identity" class="idref" href="#subst_idx_identity"><span class="id" title="lemma">subst_idx_identity</span></a>:<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> `{<a id="H:275" class="idref" href="#H:275"><span class="id" title="binder">Var</span></a> <a id="V:274" class="idref" href="#V:274"><span class="id" title="binder"><span id="H:275" class="id">V</span></span></a>} <a id="v:276" class="idref" href="#v:276"><span class="id" title="binder">v</span></a> <a id="k:277" class="idref" href="#k:277"><span class="id" title="binder">k</span></a> <a id="x:278" class="idref" href="#x:278"><span class="id" title="binder">x</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#k:277"><span class="id" title="variable">k</span></a> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#x:278"><span class="id" title="variable">x</span></a> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#subst_idx"><span class="id" title="definition">subst_idx</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#v:276"><span class="id" title="variable">v</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#k:277"><span class="id" title="variable">k</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#x:278"><span class="id" title="variable">x</span></a> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#v:276"><span class="id" title="variable">v</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">just_do_it</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="subst_idx_miss_2" class="idref" href="#subst_idx_miss_2"><span class="id" title="lemma">subst_idx_miss_2</span></a>:<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> `{<a id="H:280" class="idref" href="#H:280"><span class="id" title="binder">Var</span></a> <a id="V:279" class="idref" href="#V:279"><span class="id" title="binder"><span id="H:280" class="id">V</span></span></a>} <a id="v:281" class="idref" href="#v:281"><span class="id" title="binder">v</span></a> <a id="k:282" class="idref" href="#k:282"><span class="id" title="binder">k</span></a> <a id="x:283" class="idref" href="#x:283"><span class="id" title="binder">x</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#k:282"><span class="id" title="variable">k</span></a> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Peano.html#::nat_scope:x_'&lt;'_x"><span class="id" title="notation">&lt;</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#x:283"><span class="id" title="variable">x</span></a> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#subst_idx"><span class="id" title="definition">subst_idx</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#v:281"><span class="id" title="variable">v</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#k:282"><span class="id" title="variable">k</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#x:283"><span class="id" title="variable">x</span></a> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#var"><span class="id" title="method">var</span></a> (<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#x:283"><span class="id" title="variable">x</span></a> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Peano.html#::nat_scope:x_'-'_x"><span class="id" title="notation">-</span></a> 1).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">just_do_it</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="comment">(*&nbsp;This&nbsp;tactic&nbsp;applies&nbsp;whichever&nbsp;of&nbsp;the&nbsp;above&nbsp;three&nbsp;lemmas&nbsp;is&nbsp;applicable.&nbsp;*)</span><br/>

<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">subst_idx</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="tactic">first</span> [<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> @<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#subst_idx_identity"><span class="id" title="lemma">subst_idx_identity</span></a> <span class="id" title="tactic">by</span> <span class="id" title="var">lia</span><br/>
&nbsp;&nbsp;| <span class="id" title="tactic">rewrite</span> @<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#subst_idx_miss_1"><span class="id" title="lemma">subst_idx_miss_1</span></a> <span class="id" title="tactic">by</span> <span class="id" title="var">lia</span><br/>
&nbsp;&nbsp;| <span class="id" title="tactic">rewrite</span> @<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#subst_idx_miss_2"><span class="id" title="lemma">subst_idx_miss_2</span></a> <span class="id" title="tactic">by</span> <span class="id" title="var">lia</span><br/>
&nbsp;&nbsp;].<br/>

<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">subst_idx_in</span> <span class="id" title="var">h</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="tactic">first</span> [<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> @<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#subst_idx_identity"><span class="id" title="lemma">subst_idx_identity</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">h</span> <span class="id" title="tactic">by</span> <span class="id" title="var">lia</span><br/>
&nbsp;&nbsp;| <span class="id" title="tactic">rewrite</span> @<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#subst_idx_miss_1"><span class="id" title="lemma">subst_idx_miss_1</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">h</span> <span class="id" title="tactic">by</span> <span class="id" title="var">lia</span><br/>
&nbsp;&nbsp;| <span class="id" title="tactic">rewrite</span> @<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#subst_idx_miss_2"><span class="id" title="lemma">subst_idx_miss_2</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">h</span> <span class="id" title="tactic">by</span> <span class="id" title="var">lia</span><br/>
&nbsp;&nbsp;].<br/>

<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">subst_idx_all</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="tactic">first</span> [<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> @<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#subst_idx_identity"><span class="id" title="lemma">subst_idx_identity</span></a> <span class="id" title="tactic">in</span> * <span class="id" title="tactic">by</span> <span class="id" title="var">lia</span><br/>
&nbsp;&nbsp;| <span class="id" title="tactic">rewrite</span> @<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#subst_idx_miss_1"><span class="id" title="lemma">subst_idx_miss_1</span></a> <span class="id" title="tactic">in</span> * <span class="id" title="tactic">by</span> <span class="id" title="var">lia</span><br/>
&nbsp;&nbsp;| <span class="id" title="tactic">rewrite</span> @<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#subst_idx_miss_2"><span class="id" title="lemma">subst_idx_miss_2</span></a> <span class="id" title="tactic">in</span> * <span class="id" title="tactic">by</span> <span class="id" title="var">lia</span><br/>
&nbsp;&nbsp;].<br/>

<br/>
<span class="comment">(*&nbsp;A&nbsp;little&nbsp;lemma:&nbsp;replacing&nbsp;a&nbsp;variable&nbsp;with&nbsp;a&nbsp;variable&nbsp;always&nbsp;yields&nbsp;a<br/>
&nbsp;&nbsp;&nbsp;variable.&nbsp;*)</span><br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="subst_idx_var" class="idref" href="#subst_idx_var"><span class="id" title="lemma">subst_idx_var</span></a>:<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> `{<a id="H:285" class="idref" href="#H:285"><span class="id" title="binder">Var</span></a> <a id="V:284" class="idref" href="#V:284"><span class="id" title="binder"><span id="H:285" class="id">V</span></span></a>},<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="v:286" class="idref" href="#v:286"><span class="id" title="binder">v</span></a> <a id="k:287" class="idref" href="#k:287"><span class="id" title="binder">k</span></a> <a id="x:288" class="idref" href="#x:288"><span class="id" title="binder">x</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#subst_idx"><span class="id" title="definition">subst_idx</span></a> (<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#var"><span class="id" title="method">var</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#v:286"><span class="id" title="variable">v</span></a>) <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#k:287"><span class="id" title="variable">k</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#x:288"><span class="id" title="variable">x</span></a> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#var"><span class="id" title="method">var</span></a> (<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#subst_idx"><span class="id" title="definition">subst_idx</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#v:286"><span class="id" title="variable">v</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#k:287"><span class="id" title="variable">k</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#x:288"><span class="id" title="variable">x</span></a>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">just_do_it</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="comment">(*&nbsp;----------------------------------------------------------------------------&nbsp;*)</span><br/>

<br/>
<span class="comment">(*&nbsp;This&nbsp;is&nbsp;our&nbsp;generic&nbsp;definition&nbsp;of&nbsp;<span class="inlinecode"><span class="id" title="var">lift</span></span>&nbsp;in&nbsp;terms&nbsp;of&nbsp;<span class="inlinecode"><span class="id" title="var">traverse</span></span>.&nbsp;*)</span><br/>

<br/>
<span class="id" title="keyword">Instance</span> <a id="Lift_Traverse" class="idref" href="#Lift_Traverse"><span class="id" title="instance">Lift_Traverse</span></a> `{<a id="H:290" class="idref" href="#H:290"><span class="id" title="binder">Var</span></a> <a id="V:289" class="idref" href="#V:289"><span class="id" title="binder"><span id="H:290" class="id">V</span></span></a>, <a id="H0:292" class="idref" href="#H0:292"><span class="id" title="binder">Traverse</span></a> <a id="H0:292" class="idref" href="#H0:292"><span class="id" title="binder">V</span></a> <a id="T:291" class="idref" href="#T:291"><span class="id" title="binder"><span id="H0:292" class="id">T</span></span></a>} : <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#Lift"><span class="id" title="class">Lift</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#T:291"><span class="id" title="variable">T</span></a> := {<br/>
&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#lift"><span class="id" title="method">lift</span></a> <a id="w:293" class="idref" href="#w:293"><span class="id" title="binder">w</span></a> <a id="k:294" class="idref" href="#k:294"><span class="id" title="binder">k</span></a> <a id="t:295" class="idref" href="#t:295"><span class="id" title="binder">t</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#traverse"><span class="id" title="method">traverse</span></a> (<span class="id" title="keyword">fun</span> <a id="l:296" class="idref" href="#l:296"><span class="id" title="binder">l</span></a> <a id="x:297" class="idref" href="#x:297"><span class="id" title="binder">x</span></a> =&gt; <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#var"><span class="id" title="method">var</span></a> (<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#lift"><span class="id" title="method">lift</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#w:293"><span class="id" title="variable">w</span></a> (<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#l:296"><span class="id" title="variable">l</span></a> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#k:294"><span class="id" title="variable">k</span></a>) <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#x:297"><span class="id" title="variable">x</span></a>)) 0 <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#t:295"><span class="id" title="variable">t</span></a><br/>
}.<br/>

<br/>
<span class="comment">(*&nbsp;This&nbsp;lemma&nbsp;repeats&nbsp;the&nbsp;definition&nbsp;(!)&nbsp;and&nbsp;is&nbsp;useful&nbsp;when&nbsp;rewriting.&nbsp;*)</span><br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="expand_lift" class="idref" href="#expand_lift"><span class="id" title="lemma">expand_lift</span></a>:<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> `{<a id="H:299" class="idref" href="#H:299"><span class="id" title="binder">Var</span></a> <a id="V:298" class="idref" href="#V:298"><span class="id" title="binder"><span id="H:299" class="id">V</span></span></a>, <a id="H0:301" class="idref" href="#H0:301"><span class="id" title="binder">Traverse</span></a> <a id="H0:301" class="idref" href="#H0:301"><span class="id" title="binder">V</span></a> <a id="T:300" class="idref" href="#T:300"><span class="id" title="binder"><span id="H0:301" class="id">T</span></span></a>},<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="w:302" class="idref" href="#w:302"><span class="id" title="binder">w</span></a> <a id="k:303" class="idref" href="#k:303"><span class="id" title="binder">k</span></a> <a id="t:304" class="idref" href="#t:304"><span class="id" title="binder">t</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#lift"><span class="id" title="method">lift</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#w:302"><span class="id" title="variable">w</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#k:303"><span class="id" title="variable">k</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#t:304"><span class="id" title="variable">t</span></a> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#traverse"><span class="id" title="method">traverse</span></a> (<span class="id" title="keyword">fun</span> <a id="l:305" class="idref" href="#l:305"><span class="id" title="binder">l</span></a> <a id="x:306" class="idref" href="#x:306"><span class="id" title="binder">x</span></a> =&gt; <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#var"><span class="id" title="method">var</span></a> (<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#lift"><span class="id" title="method">lift</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#w:302"><span class="id" title="variable">w</span></a> (<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#l:305"><span class="id" title="variable">l</span></a> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#k:303"><span class="id" title="variable">k</span></a>) <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#x:306"><span class="id" title="variable">x</span></a>)) 0 <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#t:304"><span class="id" title="variable">t</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">reflexivity</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="comment">(*&nbsp;This&nbsp;auxiliary&nbsp;tactic&nbsp;simplifies&nbsp;expressions&nbsp;of&nbsp;the&nbsp;form&nbsp;<span class="inlinecode"><span class="id" title="var">x</span></span> <span class="inlinecode">+</span> <span class="inlinecode">0</span>&nbsp;in<br/>
&nbsp;&nbsp;&nbsp;the&nbsp;goal.&nbsp;It&nbsp;does&nbsp;*not*&nbsp;affect&nbsp;<span class="inlinecode"><span class="id" title="var">x</span></span> <span class="inlinecode">+</span> <span class="inlinecode">?<span class="id" title="var">y</span></span>&nbsp;where&nbsp;<span class="inlinecode"><span class="id" title="var">y</span></span>&nbsp;is&nbsp;a<br/>
&nbsp;&nbsp;&nbsp;meta-variable.&nbsp;*)</span><br/>

<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">add_0_r</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span> |- <span class="id" title="keyword">context</span>[?<span class="id" title="var">x</span> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a> 0] =&gt; <span class="id" title="tactic">rewrite</span> (<span class="id" title="lemma">Nat.add_0_r</span> <span class="id" title="var">x</span>) <span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">add_0_r_in</span> <span class="id" title="var">h</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="keyword">match</span> <span class="id" title="keyword">type</span> <span class="id" title="keyword">of</span> <span class="id" title="var">h</span> <span class="id" title="keyword">with</span> <span class="id" title="keyword">context</span>[?<span class="id" title="var">x</span> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a> 0] =&gt; <span class="id" title="tactic">rewrite</span> (<span class="id" title="lemma">Nat.add_0_r</span> <span class="id" title="var">x</span>) <span class="id" title="tactic">in</span> <span class="id" title="var">h</span> <span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="comment">(*&nbsp;It&nbsp;is&nbsp;worth&nbsp;noting&nbsp;that&nbsp;instead&nbsp;of&nbsp;writing:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;traverse&nbsp;(fun&nbsp;l&nbsp;x&nbsp;=&gt;&nbsp;var&nbsp;(lift&nbsp;w&nbsp;(l&nbsp;+&nbsp;k)&nbsp;x))&nbsp;0&nbsp;t<br/>
&nbsp;&nbsp;&nbsp;one&nbsp;might&nbsp;have&nbsp;instead&nbsp;written:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;traverse&nbsp;(fun&nbsp;l&nbsp;x&nbsp;=&gt;&nbsp;var&nbsp;(lift&nbsp;w&nbsp;l&nbsp;x))&nbsp;k&nbsp;t<br/>
&nbsp;&nbsp;&nbsp;Indeed,&nbsp;because&nbsp;<span class="inlinecode"><span class="id" title="var">traverse</span></span>&nbsp;is&nbsp;relative,&nbsp;these&nbsp;two&nbsp;expressions&nbsp;are<br/>
&nbsp;&nbsp;&nbsp;equivalent.&nbsp;The&nbsp;following&nbsp;lemma&nbsp;states&nbsp;this&nbsp;fact.&nbsp;When&nbsp;used&nbsp;as&nbsp;a<br/>
&nbsp;&nbsp;&nbsp;rewriting&nbsp;rule,&nbsp;it&nbsp;recognizes&nbsp;a&nbsp;general&nbsp;form&nbsp;of&nbsp;the&nbsp;above&nbsp;expressions<br/>
&nbsp;&nbsp;&nbsp;and&nbsp;replaces&nbsp;it&nbsp;with&nbsp;an&nbsp;application&nbsp;of&nbsp;<span class="inlinecode"><span class="id" title="var">lift</span></span>.&nbsp;*)</span><br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="recognize_lift" class="idref" href="#recognize_lift"><span class="id" title="lemma">recognize_lift</span></a>:<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> `{<a id="H:308" class="idref" href="#H:308"><span class="id" title="binder">Var</span></a> <a id="V:307" class="idref" href="#V:307"><span class="id" title="binder"><span id="H:308" class="id">V</span></span></a>, <a id="H0:310" class="idref" href="#H0:310"><span class="id" title="binder">Traverse</span></a> <a id="H0:310" class="idref" href="#H0:310"><span class="id" title="binder">V</span></a> <a id="T:309" class="idref" href="#T:309"><span class="id" title="binder"><span id="H0:310" class="id">T</span></span></a>},<br/>
&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#TraverseRelative"><span class="id" title="class">TraverseRelative</span></a> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="w:311" class="idref" href="#w:311"><span class="id" title="binder">w</span></a> <a id="k1:312" class="idref" href="#k1:312"><span class="id" title="binder">k1</span></a> <a id="k2:313" class="idref" href="#k2:313"><span class="id" title="binder">k2</span></a> <a id="t:314" class="idref" href="#t:314"><span class="id" title="binder">t</span></a>,<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="traverse_:315" class="idref" href="#traverse_:315"><span class="id" title="binder">traverse_</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#traverse_:315"><span class="id" title="variable">traverse_</span></a> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#traverse"><span class="id" title="method">traverse</span></a> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <span class="comment">(*&nbsp;helps&nbsp;rewrite&nbsp;*)</span><br/>
&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#traverse_:315"><span class="id" title="variable">traverse_</span></a> (<span class="id" title="keyword">fun</span> <a id="l:316" class="idref" href="#l:316"><span class="id" title="binder">l</span></a> <a id="x:317" class="idref" href="#x:317"><span class="id" title="binder">x</span></a> =&gt; <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#var"><span class="id" title="method">var</span></a> (<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#lift"><span class="id" title="method">lift</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#w:311"><span class="id" title="variable">w</span></a> (<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#l:316"><span class="id" title="variable">l</span></a> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#k2:313"><span class="id" title="variable">k2</span></a>) <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#x:317"><span class="id" title="variable">x</span></a>)) <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#k1:312"><span class="id" title="variable">k1</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#t:314"><span class="id" title="variable">t</span></a> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#lift"><span class="id" title="method">lift</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#w:311"><span class="id" title="variable">w</span></a> (<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#k1:312"><span class="id" title="variable">k1</span></a> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#k2:313"><span class="id" title="variable">k2</span></a>) <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#t:314"><span class="id" title="variable">t</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="tactic">subst</span>. <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#traverse_relative"><span class="id" title="method">traverse_relative</span></a>; [ | <span class="id" title="tactic">instantiate</span> (1 := <span class="id" title="var">k1</span>); <span class="id" title="var">lia</span> ].<br/>
&nbsp;&nbsp;<span class="id" title="var">just_do_it</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="comment">(*&nbsp;This&nbsp;tactic&nbsp;recognizes&nbsp;an&nbsp;application&nbsp;of&nbsp;the&nbsp;user's&nbsp;<span class="inlinecode"><span class="id" title="var">traverse_term</span></span><br/>
&nbsp;&nbsp;&nbsp;function&nbsp;that&nbsp;is&nbsp;really&nbsp;a&nbsp;<span class="inlinecode"><span class="id" title="var">lift</span></span>&nbsp;operation,&nbsp;and&nbsp;folds&nbsp;it.&nbsp;*)</span><br/>

<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">recognize_lift</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#recognize_lift"><span class="id" title="lemma">recognize_lift</span></a> <span class="id" title="tactic">by</span> <span class="id" title="tactic">eauto</span> <span class="id" title="keyword">with</span> <span class="id" title="var">typeclass_instances</span>;<br/>
&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="lemma">Nat.add_0_l</span>. <span class="comment">(*&nbsp;useful&nbsp;when&nbsp;<span class="inlinecode"><span class="id" title="var">k1</span></span>&nbsp;is&nbsp;zero&nbsp;*)</span><br/>

<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">recognize_lift_in</span> <span class="id" title="var">h</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#recognize_lift"><span class="id" title="lemma">recognize_lift</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">h</span> <span class="id" title="tactic">by</span> <span class="id" title="tactic">eauto</span> <span class="id" title="keyword">with</span> <span class="id" title="var">typeclass_instances</span>;<br/>
&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="lemma">Nat.add_0_l</span> <span class="id" title="tactic">in</span> <span class="id" title="var">h</span>. <span class="comment">(*&nbsp;useful&nbsp;when&nbsp;<span class="inlinecode"><span class="id" title="var">k1</span></span>&nbsp;is&nbsp;zero&nbsp;*)</span><br/>

<br/>
<span class="comment">(*&nbsp;The&nbsp;tactic&nbsp;<span class="inlinecode"><span class="id" title="var">simpl_lift</span></span>&nbsp;is&nbsp;used&nbsp;to&nbsp;simplify&nbsp;an&nbsp;application&nbsp;of&nbsp;<span class="inlinecode"><span class="id" title="var">lift</span></span>&nbsp;to&nbsp;a<br/>
&nbsp;&nbsp;&nbsp;concrete&nbsp;term,&nbsp;such&nbsp;as&nbsp;<span class="inlinecode"><span class="id" title="var">TApp</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode">...</span>,&nbsp;where&nbsp;<span class="inlinecode"><span class="id" title="var">TApp</span></span>&nbsp;is&nbsp;a&nbsp;user-defined<br/>
&nbsp;&nbsp;&nbsp;constructor&nbsp;of&nbsp;the&nbsp;user-defined&nbsp;type&nbsp;of&nbsp;<span class="inlinecode"><span class="id" title="var">term</span></span>s.&nbsp;We&nbsp;assume&nbsp;that&nbsp;the&nbsp;user<br/>
&nbsp;&nbsp;&nbsp;has&nbsp;manually&nbsp;rewritten&nbsp;one&nbsp;or&nbsp;several&nbsp;occurrences&nbsp;of&nbsp;<span class="inlinecode"><span class="id" title="var">lift</span></span>&nbsp;using&nbsp;the&nbsp;lemma<br/>
&nbsp;&nbsp;&nbsp;<span class="inlinecode"><span class="id" title="var">expand_lift</span></span>,&nbsp;so&nbsp;as&nbsp;to&nbsp;indicate&nbsp;where&nbsp;simplification&nbsp;is&nbsp;desired.&nbsp;Thus,&nbsp;one<br/>
&nbsp;&nbsp;&nbsp;or&nbsp;several&nbsp;instances&nbsp;of&nbsp;<span class="inlinecode"><span class="id" title="var">traverse</span></span>&nbsp;must&nbsp;be&nbsp;visible&nbsp;in&nbsp;a&nbsp;hypothesis&nbsp;or&nbsp;in&nbsp;the<br/>
&nbsp;&nbsp;&nbsp;goal.&nbsp;We&nbsp;further&nbsp;assume&nbsp;that&nbsp;<span class="inlinecode"><span class="id" title="tactic">simpl</span></span> <span class="inlinecode">(@<span class="id" title="var">traverse</span></span> <span class="inlinecode"><span class="id" title="var">_</span></span> <span class="inlinecode"><span class="id" title="var">_</span></span> <span class="inlinecode"><span class="id" title="var">_</span>)</span>&nbsp;has&nbsp;been&nbsp;used&nbsp;so&nbsp;as&nbsp;to<br/>
&nbsp;&nbsp;&nbsp;replace&nbsp;the&nbsp;generic&nbsp;<span class="inlinecode"><span class="id" title="var">traverse</span></span>&nbsp;with&nbsp;user-defined&nbsp;<span class="inlinecode"><span class="id" title="var">_traverse</span></span>&nbsp;functions.&nbsp;We<br/>
&nbsp;&nbsp;&nbsp;start&nbsp;there&nbsp;and&nbsp;do&nbsp;the&nbsp;rest&nbsp;of&nbsp;the&nbsp;work.&nbsp;*)</span><br/>

<br/>
<span class="comment">(*&nbsp;A&nbsp;difficulty&nbsp;arises&nbsp;when&nbsp;the&nbsp;goal&nbsp;or&nbsp;hypothesis&nbsp;contains&nbsp;instances&nbsp;of<br/>
&nbsp;&nbsp;&nbsp;<span class="inlinecode"><span class="id" title="var">lift</span></span>&nbsp;at&nbsp;multiple&nbsp;types.&nbsp;In&nbsp;that&nbsp;case,&nbsp;after&nbsp;expanding&nbsp;<span class="inlinecode"><span class="id" title="var">traverse</span></span>,&nbsp;we&nbsp;find<br/>
&nbsp;&nbsp;&nbsp;multiple&nbsp;user-defined&nbsp;<span class="inlinecode"><span class="id" title="var">_traverse</span></span>&nbsp;functions,&nbsp;each&nbsp;of&nbsp;which&nbsp;we&nbsp;must&nbsp;deal<br/>
&nbsp;&nbsp;&nbsp;with&nbsp;in&nbsp;turn.&nbsp;&nbsp;After&nbsp;dealing&nbsp;with&nbsp;one&nbsp;specific&nbsp;<span class="inlinecode"><span class="id" title="var">_traverse</span></span>&nbsp;function,&nbsp;we&nbsp;use<br/>
&nbsp;&nbsp;&nbsp;<span class="inlinecode"><span class="id" title="var">recognize_lift</span></span>&nbsp;at&nbsp;a&nbsp;specific&nbsp;type&nbsp;in&nbsp;order&nbsp;to&nbsp;eliminate&nbsp;all&nbsp;occurrences<br/>
&nbsp;&nbsp;&nbsp;of&nbsp;this&nbsp;particular&nbsp;<span class="inlinecode"><span class="id" title="var">_traverse</span></span>&nbsp;function.&nbsp;We&nbsp;are&nbsp;then&nbsp;able&nbsp;to&nbsp;iterate&nbsp;this<br/>
&nbsp;&nbsp;&nbsp;process&nbsp;without&nbsp;looping.&nbsp;*)</span><br/>

<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">simpl_lift</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span><br/>
<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Case:&nbsp;<span class="inlinecode"><span class="id" title="var">_traverse</span></span>&nbsp;appears&nbsp;in&nbsp;the&nbsp;goal.&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;this&nbsp;binds&nbsp;the&nbsp;meta-variable&nbsp;<span class="inlinecode"><span class="id" title="var">_traverse</span></span>&nbsp;to&nbsp;the&nbsp;user's&nbsp;<span class="inlinecode"><span class="id" title="var">traverse_term</span></span>&nbsp;*)</span><br/>
&nbsp;&nbsp;|- <span class="id" title="keyword">context</span>[?<span class="id" title="var">_traverse</span> (<span class="id" title="keyword">fun</span> <a id="l:318" class="idref" href="#l:318"><span class="id" title="binder"><span id="l:320" class="id">l</span></span></a> <a id="x:319" class="idref" href="#x:319"><span class="id" title="binder"><span id="x:321" class="id">x</span></span></a> : <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a> =&gt; <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#var"><span class="id" title="method">var</span></a> (<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#lift"><span class="id" title="method">lift</span></a> ?<span class="id" title="var">w</span> (<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#l:318"><span class="id" title="variable">l</span></a> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a> ?<span class="id" title="var">k</span>) <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#x:319"><span class="id" title="variable">x</span></a>)) <span class="id" title="var">_</span> <span class="id" title="var">_</span>] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;this&nbsp;causes&nbsp;the&nbsp;reduction&nbsp;of&nbsp;the&nbsp;fixpoint:&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">_traverse</span>; <span class="id" title="tactic">fold</span> <span class="id" title="var">_traverse</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;we&nbsp;now&nbsp;have&nbsp;a&nbsp;term&nbsp;of&nbsp;the&nbsp;form&nbsp;<span class="inlinecode"><span class="id" title="var">TApp</span></span> <span class="inlinecode">(<span class="id" title="var">traverse_term</span></span> <span class="inlinecode">...)</span> <span class="inlinecode">...</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;There&nbsp;remains&nbsp;to&nbsp;recognize&nbsp;the&nbsp;definition&nbsp;of&nbsp;<span class="inlinecode"><span class="id" title="var">lift</span></span>.&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Nat.add_0_r</span>; <span class="comment">(*&nbsp;useful&nbsp;when&nbsp;we&nbsp;have&nbsp;traversed&nbsp;a&nbsp;binder:&nbsp;1&nbsp;+&nbsp;0&nbsp;is&nbsp;1&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;use&nbsp;<span class="inlinecode"><span class="id" title="var">recognize_lift</span></span>&nbsp;at&nbsp;the&nbsp;specific&nbsp;type&nbsp;of&nbsp;the&nbsp;<span class="inlinecode"><span class="id" title="var">_traverse</span></span>&nbsp;function<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;that&nbsp;we&nbsp;have&nbsp;just&nbsp;simplified&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="keyword">type</span> <span class="id" title="keyword">of</span> <span class="id" title="var">_traverse</span> <span class="id" title="keyword">with</span> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">(</span></a><a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> ?<span class="id" title="var">V</span><a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> ?<span class="id" title="var">T</span> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> ?<span class="id" title="var">T</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="tactic">rewrite</span> (@<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#recognize_lift"><span class="id" title="lemma">recognize_lift</span></a> <span class="id" title="var">V</span> <span class="id" title="var">_</span> <span class="id" title="var">T</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>) <span class="id" title="tactic">by</span> <span class="id" title="tactic">eauto</span> <span class="id" title="keyword">with</span> <span class="id" title="var">typeclass_instances</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="lemma">Nat.add_0_l</span> <span class="comment">(*&nbsp;useful&nbsp;when&nbsp;<span class="inlinecode"><span class="id" title="var">k1</span></span>&nbsp;is&nbsp;zero&nbsp;and&nbsp;we&nbsp;are&nbsp;at&nbsp;a&nbsp;leaf&nbsp;*)</span><br/>
<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Case:&nbsp;<span class="inlinecode"><span class="id" title="var">_traverse</span></span>&nbsp;appears&nbsp;in&nbsp;a&nbsp;hypothesis.&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;this&nbsp;binds&nbsp;the&nbsp;meta-variable&nbsp;<span class="inlinecode"><span class="id" title="var">_traverse</span></span>&nbsp;to&nbsp;the&nbsp;user's&nbsp;<span class="inlinecode"><span class="id" title="var">traverse_term</span></span>&nbsp;*)</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">h</span>: <span class="id" title="keyword">context</span>[?<span class="id" title="var">_traverse</span> (<span class="id" title="keyword">fun</span> <a id="l:322" class="idref" href="#l:322"><span class="id" title="binder"><span id="l:324" class="id">l</span></span></a> <a id="x:323" class="idref" href="#x:323"><span class="id" title="binder"><span id="x:325" class="id">x</span></span></a> : <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a> =&gt; <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#var"><span class="id" title="method">var</span></a> (<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#lift"><span class="id" title="method">lift</span></a> ?<span class="id" title="var">w</span> (<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#l:322"><span class="id" title="variable">l</span></a> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a> ?<span class="id" title="var">k</span>) <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#x:323"><span class="id" title="variable">x</span></a>)) <span class="id" title="var">_</span> <span class="id" title="var">_</span>] |- <span class="id" title="var">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;this&nbsp;causes&nbsp;the&nbsp;reduction&nbsp;of&nbsp;the&nbsp;fixpoint:&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">_traverse</span> <span class="id" title="tactic">in</span> <span class="id" title="var">h</span>; <span class="id" title="tactic">fold</span> <span class="id" title="var">_traverse</span> <span class="id" title="tactic">in</span> <span class="id" title="var">h</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;we&nbsp;now&nbsp;have&nbsp;a&nbsp;term&nbsp;of&nbsp;the&nbsp;form&nbsp;<span class="inlinecode"><span class="id" title="var">TApp</span></span> <span class="inlinecode">(<span class="id" title="var">traverse_term</span></span> <span class="inlinecode">...)</span> <span class="inlinecode">...</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;There&nbsp;remains&nbsp;to&nbsp;recognize&nbsp;the&nbsp;definition&nbsp;of&nbsp;<span class="inlinecode"><span class="id" title="var">lift</span></span>.&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">add_0_r_in</span> <span class="id" title="var">h</span>; <span class="comment">(*&nbsp;useful&nbsp;when&nbsp;we&nbsp;have&nbsp;traversed&nbsp;a&nbsp;binder:&nbsp;1&nbsp;+&nbsp;0&nbsp;is&nbsp;1&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;use&nbsp;<span class="inlinecode"><span class="id" title="var">recognize_lift</span></span>&nbsp;at&nbsp;the&nbsp;specific&nbsp;type&nbsp;of&nbsp;the&nbsp;<span class="inlinecode"><span class="id" title="var">_traverse</span></span>&nbsp;function<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;that&nbsp;we&nbsp;have&nbsp;just&nbsp;simplified&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="keyword">type</span> <span class="id" title="keyword">of</span> <span class="id" title="var">_traverse</span> <span class="id" title="keyword">with</span> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">(</span></a><a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> ?<span class="id" title="var">V</span><a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> ?<span class="id" title="var">T</span> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> ?<span class="id" title="var">T</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="tactic">rewrite</span> (@<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#recognize_lift"><span class="id" title="lemma">recognize_lift</span></a> <span class="id" title="var">V</span> <span class="id" title="var">_</span> <span class="id" title="var">T</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>)  <span class="id" title="tactic">in</span> <span class="id" title="var">h</span> <span class="id" title="tactic">by</span> <span class="id" title="tactic">eauto</span> <span class="id" title="keyword">with</span> <span class="id" title="var">typeclass_instances</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="lemma">Nat.add_0_l</span> <span class="id" title="tactic">in</span> <span class="id" title="var">h</span> <span class="comment">(*&nbsp;useful&nbsp;when&nbsp;<span class="inlinecode"><span class="id" title="var">k1</span></span>&nbsp;is&nbsp;zero&nbsp;and&nbsp;we&nbsp;are&nbsp;at&nbsp;a&nbsp;leaf&nbsp;*)</span><br/>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="comment">(*&nbsp;This&nbsp;tactic&nbsp;attempts&nbsp;to&nbsp;all&nbsp;occurrences&nbsp;of&nbsp;<span class="inlinecode"><span class="id" title="var">lift</span></span>&nbsp;in&nbsp;the&nbsp;goal.&nbsp;*)</span><br/>

<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">simpl_lift_goal</span> :=<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;this&nbsp;replaces&nbsp;<span class="inlinecode"><span class="id" title="var">lift</span></span>&nbsp;with&nbsp;applications&nbsp;of&nbsp;<span class="inlinecode"><span class="id" title="var">traverse</span></span>&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="tactic">rewrite</span> @<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#expand_lift"><span class="id" title="lemma">expand_lift</span></a>;<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;this&nbsp;replaces&nbsp;the&nbsp;generic&nbsp;<span class="inlinecode"><span class="id" title="var">traverse</span></span>&nbsp;with&nbsp;the&nbsp;user's&nbsp;<span class="inlinecode"><span class="id" title="var">_traverse</span></span>&nbsp;functions&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" title="tactic">simpl</span> (@<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#traverse"><span class="id" title="method">traverse</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>);<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;this&nbsp;simplifies&nbsp;applications&nbsp;of&nbsp;each&nbsp;<span class="inlinecode"><span class="id" title="var">_traverse</span></span>&nbsp;function&nbsp;and&nbsp;folds&nbsp;them&nbsp;back&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="var">simpl_lift</span>;<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;if&nbsp;we&nbsp;have&nbsp;exposed&nbsp;applications&nbsp;of&nbsp;<span class="inlinecode"><span class="id" title="var">lift_idx</span></span>,&nbsp;try&nbsp;simplifying&nbsp;them&nbsp;away&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="var">lift_idx</span>;<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;if&nbsp;this&nbsp;exposes&nbsp;uses&nbsp;of&nbsp;<span class="inlinecode"><span class="id" title="var">var</span></span>,&nbsp;replace&nbsp;them&nbsp;with&nbsp;the&nbsp;user's&nbsp;<span class="inlinecode"><span class="id" title="var">TVar</span></span>&nbsp;constructor&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" title="tactic">simpl</span> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#var"><span class="id" title="method">var</span></a>.<br/>

<br/>
<span class="id" title="keyword">Hint Extern</span> 1 (<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#lift"><span class="id" title="method">lift</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <span class="id" title="var">_</span>) =&gt; <span class="id" title="var">simpl_lift_goal</span> : <span class="id" title="var">simpl_lift_goal</span>.<br/>
<span class="id" title="keyword">Hint Extern</span> 1 (<span class="id" title="var">_</span> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#lift"><span class="id" title="method">lift</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>) =&gt; <span class="id" title="var">simpl_lift_goal</span> : <span class="id" title="var">simpl_lift_goal</span>.<br/>

<br/>
<span class="comment">(*&nbsp;This&nbsp;tactic&nbsp;attempts&nbsp;to&nbsp;simplify&nbsp;all&nbsp;occurrences&nbsp;of&nbsp;<span class="inlinecode"><span class="id" title="var">lift</span></span>&nbsp;in&nbsp;the&nbsp;goal<br/>
&nbsp;&nbsp;&nbsp;and&nbsp;the&nbsp;hypotheses.&nbsp;*)</span><br/>

<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">simpl_lift_all</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="tactic">rewrite</span> @<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#expand_lift"><span class="id" title="lemma">expand_lift</span></a> <span class="id" title="tactic">in</span> *;<br/>
&nbsp;&nbsp;<span class="id" title="tactic">simpl</span> (@<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#traverse"><span class="id" title="method">traverse</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>) <span class="id" title="tactic">in</span> *;<br/>
&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="var">simpl_lift</span>;<br/>
&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="var">lift_idx_all</span>;<br/>
&nbsp;&nbsp;<span class="id" title="tactic">simpl</span> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#var"><span class="id" title="method">var</span></a> <span class="id" title="tactic">in</span> *.<br/>

<br/>
<span class="comment">(*&nbsp;This&nbsp;tactic&nbsp;attempts&nbsp;to&nbsp;simplify&nbsp;all&nbsp;occurrences&nbsp;of&nbsp;<span class="inlinecode"><span class="id" title="var">lift</span></span>&nbsp;in&nbsp;a&nbsp;specific<br/>
&nbsp;&nbsp;&nbsp;hypothesis.&nbsp;*)</span><br/>

<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">simpl_lift_in</span> <span class="id" title="var">h</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="tactic">rewrite</span> @<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#expand_lift"><span class="id" title="lemma">expand_lift</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">h</span>;<br/>
&nbsp;&nbsp;<span class="id" title="tactic">simpl</span> (@<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#traverse"><span class="id" title="method">traverse</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>) <span class="id" title="tactic">in</span> <span class="id" title="var">h</span>;<br/>
&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="var">simpl_lift</span>;<br/>
&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="var">lift_idx_in</span> <span class="id" title="var">h</span>;<br/>
&nbsp;&nbsp;<span class="id" title="tactic">simpl</span> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#var"><span class="id" title="method">var</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">h</span>.<br/>

<br/>
<span class="comment">(*&nbsp;----------------------------------------------------------------------------&nbsp;*)</span><br/>

<br/>
<span class="comment">(*&nbsp;Our&nbsp;definition&nbsp;of&nbsp;<span class="inlinecode"><span class="id" title="var">lift</span></span>&nbsp;in&nbsp;terms&nbsp;of&nbsp;<span class="inlinecode"><span class="id" title="var">traverse</span></span>&nbsp;satisfies&nbsp;all&nbsp;of&nbsp;the&nbsp;desired<br/>
&nbsp;&nbsp;&nbsp;properties.&nbsp;*)</span><br/>

<br/>
<span class="id" title="keyword">Instance</span> <a id="LiftVar_Traverse" class="idref" href="#LiftVar_Traverse"><span class="id" title="instance">LiftVar_Traverse</span></a>:<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> `{<a id="H:327" class="idref" href="#H:327"><span class="id" title="binder">Var</span></a> <a id="V:326" class="idref" href="#V:326"><span class="id" title="binder"><span id="H:327" class="id">V</span></span></a>, <a id="H0:328" class="idref" href="#H0:328"><span class="id" title="binder">Traverse</span></a> <a id="H0:328" class="idref" href="#H0:328"><span class="id" title="binder">V</span></a> <a id="H0:328" class="idref" href="#H0:328"><span class="id" title="binder">V</span></a>},<br/>
&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#TraverseIdentifiesVar"><span class="id" title="class">TraverseIdentifiesVar</span></a> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;@<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#LiftVar"><span class="id" title="class">LiftVar</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#V:326"><span class="id" title="variable">V</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">constructor</span>. <span class="id" title="tactic">unfold</span> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#lift"><span class="id" title="method">lift</span></a>, <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#Lift_Traverse"><span class="id" title="instance">Lift_Traverse</span></a>. <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#traverse_identifies_var"><span class="id" title="method">traverse_identifies_var</span></a>. <span class="id" title="tactic">reflexivity</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Instance</span> <a id="LiftZero_Traverse" class="idref" href="#LiftZero_Traverse"><span class="id" title="instance">LiftZero_Traverse</span></a>:<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> `{<a id="H:330" class="idref" href="#H:330"><span class="id" title="binder">Var</span></a> <a id="V:329" class="idref" href="#V:329"><span class="id" title="binder"><span id="H:330" class="id">V</span></span></a>, <a id="H0:331" class="idref" href="#H0:331"><span class="id" title="binder">Traverse</span></a> <a id="H0:331" class="idref" href="#H0:331"><span class="id" title="binder">V</span></a> <a id="H0:331" class="idref" href="#H0:331"><span class="id" title="binder">V</span></a>},<br/>
&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#TraverseVarIsIdentity"><span class="id" title="class">TraverseVarIsIdentity</span></a> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;@<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#LiftZero"><span class="id" title="class">LiftZero</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#V:329"><span class="id" title="variable">V</span></a> <span class="id" title="var">_</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">constructor</span>. <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#lift"><span class="id" title="method">lift</span></a>, <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#Lift_Traverse"><span class="id" title="instance">Lift_Traverse</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#traverse_var_is_identity"><span class="id" title="method">traverse_var_is_identity</span></a>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#lift_zero"><span class="id" title="method">lift_zero</span></a>. <span class="id" title="tactic">reflexivity</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Instance</span> <a id="LiftInjective_Traverse" class="idref" href="#LiftInjective_Traverse"><span class="id" title="instance">LiftInjective_Traverse</span></a>:<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> `{<a id="H:333" class="idref" href="#H:333"><span class="id" title="binder">Var</span></a> <a id="V:332" class="idref" href="#V:332"><span class="id" title="binder"><span id="H:333" class="id">V</span></span></a>, <a id="H0:335" class="idref" href="#H0:335"><span class="id" title="binder">Traverse</span></a> <a id="H0:335" class="idref" href="#H0:335"><span class="id" title="binder">V</span></a> <a id="T:334" class="idref" href="#T:334"><span class="id" title="binder"><span id="H0:335" class="id">T</span></span></a>},<br/>
&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#TraverseVarInjective"><span class="id" title="class">TraverseVarInjective</span></a> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;@<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#LiftInjective"><span class="id" title="class">LiftInjective</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#T:334"><span class="id" title="variable">T</span></a> <span class="id" title="var">_</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">constructor</span>. <span class="id" title="tactic">unfold</span> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#lift"><span class="id" title="method">lift</span></a>, <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#Lift_Traverse"><span class="id" title="instance">Lift_Traverse</span></a>. <span class="id" title="tactic">intros</span> <span class="id" title="var">w</span> <span class="id" title="var">k</span>. <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#traverse_var_injective"><span class="id" title="method">traverse_var_injective</span></a> <span class="id" title="keyword">with</span> (<span class="id" title="var">f</span> := <span class="id" title="keyword">fun</span> <a id="l:336" class="idref" href="#l:336"><span class="id" title="binder"><span id="l:338" class="id">l</span></span></a> <a id="x:337" class="idref" href="#x:337"><span class="id" title="binder"><span id="x:339" class="id">x</span></span></a> =&gt; <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#lift"><span class="id" title="method">lift</span></a> <span class="id" title="var">w</span> (<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#l:336"><span class="id" title="variable">l</span></a> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a> <span class="id" title="var">k</span>) <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#x:337"><span class="id" title="variable">x</span></a>).<br/>
&nbsp;&nbsp;+ <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">eapply</span> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#lift_injective"><span class="id" title="method">lift_injective</span></a>. <span class="id" title="var">eassumption</span>.<br/>
&nbsp;&nbsp;+ <span class="id" title="var">eassumption</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Instance</span> <a id="LiftLift_Traverse" class="idref" href="#LiftLift_Traverse"><span class="id" title="instance">LiftLift_Traverse</span></a>:<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> `{<a id="H:341" class="idref" href="#H:341"><span class="id" title="binder">Var</span></a> <a id="V:340" class="idref" href="#V:340"><span class="id" title="binder"><span id="H:341" class="id">V</span></span></a>, <a id="H0:342" class="idref" href="#H0:342"><span class="id" title="binder">Traverse</span></a> <a id="H0:342" class="idref" href="#H0:342"><span class="id" title="binder">V</span></a> <a id="H0:342" class="idref" href="#H0:342"><span class="id" title="binder">V</span></a>, <a id="H1:344" class="idref" href="#H1:344"><span class="id" title="binder">Traverse</span></a> <a id="H1:344" class="idref" href="#H1:344"><span class="id" title="binder">V</span></a> <a id="T:343" class="idref" href="#T:343"><span class="id" title="binder"><span id="H1:344" class="id">T</span></span></a>},<br/>
&nbsp;&nbsp;@<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#TraverseFunctorial"><span class="id" title="class">TraverseFunctorial</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#V:340"><span class="id" title="variable">V</span></a> <span class="id" title="var">_</span> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#T:343"><span class="id" title="variable">T</span></a> <span class="id" title="var">_</span> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;@<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#TraverseRelative"><span class="id" title="class">TraverseRelative</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#V:340"><span class="id" title="variable">V</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#T:343"><span class="id" title="variable">T</span></a> <span class="id" title="var">_</span> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <span class="comment">(*&nbsp;TraverseExtensional&nbsp;*)</span><br/>
&nbsp;&nbsp;@<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#TraverseIdentifiesVar"><span class="id" title="class">TraverseIdentifiesVar</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#V:340"><span class="id" title="variable">V</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;@<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#LiftLift"><span class="id" title="class">LiftLift</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#T:343"><span class="id" title="variable">T</span></a> <span class="id" title="var">_</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">constructor</span>. <span class="id" title="tactic">unfold</span> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#lift"><span class="id" title="method">lift</span></a>, <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#Lift_Traverse"><span class="id" title="instance">Lift_Traverse</span></a>. <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> (<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#traverse_traverse_var"><span class="id" title="lemma">traverse_traverse_var</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> (<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#traverse_traverse_var"><span class="id" title="lemma">traverse_traverse_var</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> (<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#traverse_extensional"><span class="id" title="lemma">traverse_extensional</span></a> <span class="id" title="var">_</span>).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="tactic">f_equal</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#lift_lift"><span class="id" title="method">lift_lift</span></a> <span class="id" title="tactic">by</span> <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">f_equal</span>. <span class="id" title="var">lia</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Instance</span> <a id="LiftLiftFuse_Traverse" class="idref" href="#LiftLiftFuse_Traverse"><span class="id" title="instance">LiftLiftFuse_Traverse</span></a>:<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> `{<a id="H:346" class="idref" href="#H:346"><span class="id" title="binder">Var</span></a> <a id="V:345" class="idref" href="#V:345"><span class="id" title="binder"><span id="H:346" class="id">V</span></span></a>, <a id="H0:347" class="idref" href="#H0:347"><span class="id" title="binder">Traverse</span></a> <a id="H0:347" class="idref" href="#H0:347"><span class="id" title="binder">V</span></a> <a id="H0:347" class="idref" href="#H0:347"><span class="id" title="binder">V</span></a>, <a id="H1:349" class="idref" href="#H1:349"><span class="id" title="binder">Traverse</span></a> <a id="H1:349" class="idref" href="#H1:349"><span class="id" title="binder">V</span></a> <a id="T:348" class="idref" href="#T:348"><span class="id" title="binder"><span id="H1:349" class="id">T</span></span></a>},<br/>
&nbsp;&nbsp;@<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#TraverseFunctorial"><span class="id" title="class">TraverseFunctorial</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#V:345"><span class="id" title="variable">V</span></a> <span class="id" title="var">_</span> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#T:348"><span class="id" title="variable">T</span></a> <span class="id" title="var">_</span> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;@<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#TraverseRelative"><span class="id" title="class">TraverseRelative</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#V:345"><span class="id" title="variable">V</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#T:348"><span class="id" title="variable">T</span></a> <span class="id" title="var">_</span> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <span class="comment">(*&nbsp;TraverseExtensional&nbsp;*)</span><br/>
&nbsp;&nbsp;@<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#TraverseIdentifiesVar"><span class="id" title="class">TraverseIdentifiesVar</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#V:345"><span class="id" title="variable">V</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;@<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#LiftLiftFuse"><span class="id" title="class">LiftLiftFuse</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#T:348"><span class="id" title="variable">T</span></a> <span class="id" title="var">_</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">constructor</span>. <span class="id" title="tactic">unfold</span> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#lift"><span class="id" title="method">lift</span></a>, <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#Lift_Traverse"><span class="id" title="instance">Lift_Traverse</span></a>. <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> (<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#traverse_traverse_var"><span class="id" title="lemma">traverse_traverse_var</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> (<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#traverse_extensional"><span class="id" title="lemma">traverse_extensional</span></a> <span class="id" title="var">_</span>).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="tactic">f_equal</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#lift_lift_fuse"><span class="id" title="method">lift_lift_fuse</span></a> <span class="id" title="tactic">by</span> <span class="id" title="var">lia</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="comment">(*&nbsp;----------------------------------------------------------------------------&nbsp;*)</span><br/>

<br/>
<span class="comment">(*&nbsp;This&nbsp;is&nbsp;our&nbsp;generic&nbsp;definition&nbsp;of&nbsp;<span class="inlinecode"><span class="id" title="tactic">subst</span></span>&nbsp;in&nbsp;terms&nbsp;of&nbsp;<span class="inlinecode"><span class="id" title="var">traverse</span></span>.&nbsp;*)</span><br/>

<br/>
<span class="id" title="keyword">Instance</span> <a id="Subst_Traverse" class="idref" href="#Subst_Traverse"><span class="id" title="instance">Subst_Traverse</span></a> `{<a id="H:351" class="idref" href="#H:351"><span class="id" title="binder">Var</span></a> <a id="V:350" class="idref" href="#V:350"><span class="id" title="binder"><span id="H:351" class="id">V</span></span></a>, <a id="H0:352" class="idref" href="#H0:352"><span class="id" title="binder">Traverse</span></a> <a id="H0:352" class="idref" href="#H0:352"><span class="id" title="binder">V</span></a> <a id="H0:352" class="idref" href="#H0:352"><span class="id" title="binder">V</span></a>, <a id="H1:354" class="idref" href="#H1:354"><span class="id" title="binder">Traverse</span></a> <a id="H1:354" class="idref" href="#H1:354"><span class="id" title="binder">V</span></a> <a id="T:353" class="idref" href="#T:353"><span class="id" title="binder"><span id="H1:354" class="id">T</span></span></a>} : <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#Subst"><span class="id" title="class">Subst</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#V:350"><span class="id" title="variable">V</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#T:353"><span class="id" title="variable">T</span></a> := {<br/>
&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#subst"><span class="id" title="method">subst</span></a> <a id="v:355" class="idref" href="#v:355"><span class="id" title="binder">v</span></a> <a id="k:356" class="idref" href="#k:356"><span class="id" title="binder">k</span></a> <a id="t:357" class="idref" href="#t:357"><span class="id" title="binder">t</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#traverse"><span class="id" title="method">traverse</span></a> (<span class="id" title="keyword">fun</span> <a id="l:358" class="idref" href="#l:358"><span class="id" title="binder">l</span></a> <a id="x:359" class="idref" href="#x:359"><span class="id" title="binder">x</span></a> =&gt; <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#subst_idx"><span class="id" title="definition">subst_idx</span></a> (<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#lift"><span class="id" title="method">lift</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#l:358"><span class="id" title="variable">l</span></a> 0 <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#v:355"><span class="id" title="variable">v</span></a>) (<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#l:358"><span class="id" title="variable">l</span></a> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#k:356"><span class="id" title="variable">k</span></a>) <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#x:359"><span class="id" title="variable">x</span></a>) 0 <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#t:357"><span class="id" title="variable">t</span></a><br/>
}.<br/>

<br/>
<span class="comment">(*&nbsp;This&nbsp;lemma&nbsp;repeats&nbsp;the&nbsp;definition&nbsp;(!)&nbsp;and&nbsp;is&nbsp;useful&nbsp;when&nbsp;rewriting.&nbsp;*)</span><br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="expand_subst" class="idref" href="#expand_subst"><span class="id" title="lemma">expand_subst</span></a>:<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> `{<a id="H:361" class="idref" href="#H:361"><span class="id" title="binder">Var</span></a> <a id="V:360" class="idref" href="#V:360"><span class="id" title="binder"><span id="H:361" class="id">V</span></span></a>, <a id="H0:362" class="idref" href="#H0:362"><span class="id" title="binder">Traverse</span></a> <a id="H0:362" class="idref" href="#H0:362"><span class="id" title="binder">V</span></a> <a id="H0:362" class="idref" href="#H0:362"><span class="id" title="binder">V</span></a>, <a id="H1:364" class="idref" href="#H1:364"><span class="id" title="binder">Traverse</span></a> <a id="H1:364" class="idref" href="#H1:364"><span class="id" title="binder">V</span></a> <a id="T:363" class="idref" href="#T:363"><span class="id" title="binder"><span id="H1:364" class="id">T</span></span></a>},<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="v:365" class="idref" href="#v:365"><span class="id" title="binder">v</span></a> <a id="k:366" class="idref" href="#k:366"><span class="id" title="binder">k</span></a> <a id="t:367" class="idref" href="#t:367"><span class="id" title="binder">t</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#subst"><span class="id" title="method">subst</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#v:365"><span class="id" title="variable">v</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#k:366"><span class="id" title="variable">k</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#t:367"><span class="id" title="variable">t</span></a> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#traverse"><span class="id" title="method">traverse</span></a> (<span class="id" title="keyword">fun</span> <a id="l:368" class="idref" href="#l:368"><span class="id" title="binder">l</span></a> <a id="x:369" class="idref" href="#x:369"><span class="id" title="binder">x</span></a> =&gt; <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#subst_idx"><span class="id" title="definition">subst_idx</span></a> (<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#lift"><span class="id" title="method">lift</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#l:368"><span class="id" title="variable">l</span></a> 0 <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#v:365"><span class="id" title="variable">v</span></a>) (<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#l:368"><span class="id" title="variable">l</span></a> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#k:366"><span class="id" title="variable">k</span></a>) <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#x:369"><span class="id" title="variable">x</span></a>) 0 <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#t:367"><span class="id" title="variable">t</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">reflexivity</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="comment">(*&nbsp;Again,&nbsp;because&nbsp;<span class="inlinecode"><span class="id" title="var">traverse</span></span>&nbsp;is&nbsp;relative,&nbsp;there&nbsp;can&nbsp;be&nbsp;several&nbsp;ways&nbsp;of<br/>
&nbsp;&nbsp;&nbsp;writing&nbsp;a&nbsp;substitution.&nbsp;The&nbsp;following&nbsp;lemma&nbsp;states&nbsp;this.&nbsp;When&nbsp;used<br/>
&nbsp;&nbsp;&nbsp;as&nbsp;a&nbsp;rewriting&nbsp;rule,&nbsp;it&nbsp;helps&nbsp;recognize&nbsp;applications&nbsp;of&nbsp;<span class="inlinecode"><span class="id" title="tactic">subst</span></span>.&nbsp;*)</span><br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="recognize_subst" class="idref" href="#recognize_subst"><span class="id" title="lemma">recognize_subst</span></a>:<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> `{<a id="H:371" class="idref" href="#H:371"><span class="id" title="binder">Var</span></a> <a id="V:370" class="idref" href="#V:370"><span class="id" title="binder"><span id="H:371" class="id">V</span></span></a>, <a id="H0:372" class="idref" href="#H0:372"><span class="id" title="binder">Traverse</span></a> <a id="H0:372" class="idref" href="#H0:372"><span class="id" title="binder">V</span></a> <a id="H0:372" class="idref" href="#H0:372"><span class="id" title="binder">V</span></a>, <a id="H1:374" class="idref" href="#H1:374"><span class="id" title="binder">Traverse</span></a> <a id="H1:374" class="idref" href="#H1:374"><span class="id" title="binder">V</span></a> <a id="T:373" class="idref" href="#T:373"><span class="id" title="binder"><span id="H1:374" class="id">T</span></span></a>},<br/>
&nbsp;&nbsp;@<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#TraverseFunctorial"><span class="id" title="class">TraverseFunctorial</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#V:370"><span class="id" title="variable">V</span></a> <span class="id" title="var">_</span> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#V:370"><span class="id" title="variable">V</span></a> <span class="id" title="var">_</span> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;@<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#TraverseIdentifiesVar"><span class="id" title="class">TraverseIdentifiesVar</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#V:370"><span class="id" title="variable">V</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;@<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#TraverseRelative"><span class="id" title="class">TraverseRelative</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#V:370"><span class="id" title="variable">V</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#V:370"><span class="id" title="variable">V</span></a> <span class="id" title="var">_</span> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;@<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#TraverseRelative"><span class="id" title="class">TraverseRelative</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#V:370"><span class="id" title="variable">V</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#T:373"><span class="id" title="variable">T</span></a> <span class="id" title="var">_</span> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="traverse_:375" class="idref" href="#traverse_:375"><span class="id" title="binder">traverse_</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#traverse_:375"><span class="id" title="variable">traverse_</span></a> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#traverse"><span class="id" title="method">traverse</span></a> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <span class="comment">(*&nbsp;helps&nbsp;rewrite&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="v:376" class="idref" href="#v:376"><span class="id" title="binder">v</span></a> <a id="k2:377" class="idref" href="#k2:377"><span class="id" title="binder">k2</span></a> <a id="k1:378" class="idref" href="#k1:378"><span class="id" title="binder">k1</span></a> <a id="t:379" class="idref" href="#t:379"><span class="id" title="binder">t</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#traverse_:375"><span class="id" title="variable">traverse_</span></a> (<span class="id" title="keyword">fun</span> <a id="l:380" class="idref" href="#l:380"><span class="id" title="binder">l</span></a> <a id="x:381" class="idref" href="#x:381"><span class="id" title="binder">x</span></a> =&gt; <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#subst_idx"><span class="id" title="definition">subst_idx</span></a> (<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#lift"><span class="id" title="method">lift</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#l:380"><span class="id" title="variable">l</span></a> 0 <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#v:376"><span class="id" title="variable">v</span></a>) (<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#l:380"><span class="id" title="variable">l</span></a> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#k2:377"><span class="id" title="variable">k2</span></a>) <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#x:381"><span class="id" title="variable">x</span></a>) <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#k1:378"><span class="id" title="variable">k1</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#t:379"><span class="id" title="variable">t</span></a> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#subst"><span class="id" title="method">subst</span></a> (<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#lift"><span class="id" title="method">lift</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#k1:378"><span class="id" title="variable">k1</span></a> 0 <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#v:376"><span class="id" title="variable">v</span></a>) (<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#k1:378"><span class="id" title="variable">k1</span></a> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#k2:377"><span class="id" title="variable">k2</span></a>) <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#t:379"><span class="id" title="variable">t</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#subst"><span class="id" title="method">subst</span></a>, <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#Subst_Traverse"><span class="id" title="instance">Subst_Traverse</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#traverse_relative"><span class="id" title="method">traverse_relative</span></a>; [ | <span class="id" title="tactic">instantiate</span> (1 := <span class="id" title="var">k1</span>); <span class="id" title="var">lia</span> ].<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">f_equal</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#lift_lift_fuse"><span class="id" title="method">lift_lift_fuse</span></a> <span class="id" title="tactic">by</span> <span class="id" title="var">lia</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">lia</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="comment">(*&nbsp;This&nbsp;tactic&nbsp;recognizes&nbsp;an&nbsp;application&nbsp;of&nbsp;the&nbsp;user's&nbsp;<span class="inlinecode"><span class="id" title="var">traverse_term</span></span><br/>
&nbsp;&nbsp;&nbsp;function&nbsp;that&nbsp;is&nbsp;really&nbsp;a&nbsp;<span class="inlinecode"><span class="id" title="tactic">subst</span></span>&nbsp;operation,&nbsp;and&nbsp;folds&nbsp;it.&nbsp;*)</span><br/>

<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">recognize_subst</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#recognize_subst"><span class="id" title="lemma">recognize_subst</span></a> <span class="id" title="tactic">by</span> <span class="id" title="tactic">eauto</span> <span class="id" title="keyword">with</span> <span class="id" title="var">typeclass_instances</span>;<br/>
&nbsp;&nbsp;<span class="id" title="tactic">try</span> <span class="id" title="tactic">rewrite</span> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#lift_zero"><span class="id" title="method">lift_zero</span></a>; <span class="comment">(*&nbsp;useful&nbsp;when&nbsp;<span class="inlinecode"><span class="id" title="var">k1</span></span>&nbsp;is&nbsp;zero&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="lemma">Nat.add_0_l</span>. <span class="comment">(*&nbsp;useful&nbsp;when&nbsp;<span class="inlinecode"><span class="id" title="var">k1</span></span>&nbsp;is&nbsp;zero&nbsp;*)</span><br/>

<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">recognize_subst_in</span> <span class="id" title="var">h</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#recognize_subst"><span class="id" title="lemma">recognize_subst</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">h</span> <span class="id" title="tactic">by</span> <span class="id" title="tactic">eauto</span> <span class="id" title="keyword">with</span> <span class="id" title="var">typeclass_instances</span>;<br/>
&nbsp;&nbsp;<span class="id" title="tactic">try</span> <span class="id" title="tactic">rewrite</span> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#lift_zero"><span class="id" title="method">lift_zero</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">h</span>; <span class="comment">(*&nbsp;useful&nbsp;when&nbsp;<span class="inlinecode"><span class="id" title="var">k1</span></span>&nbsp;is&nbsp;zero&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="lemma">Nat.add_0_l</span> <span class="id" title="tactic">in</span> <span class="id" title="var">h</span>. <span class="comment">(*&nbsp;useful&nbsp;when&nbsp;<span class="inlinecode"><span class="id" title="var">k1</span></span>&nbsp;is&nbsp;zero&nbsp;*)</span><br/>

<br/>
<span class="comment">(*&nbsp;This&nbsp;tactic&nbsp;is&nbsp;used&nbsp;to&nbsp;simplify&nbsp;an&nbsp;application&nbsp;of&nbsp;<span class="inlinecode"><span class="id" title="tactic">subst</span></span>&nbsp;to&nbsp;a&nbsp;concrete<br/>
&nbsp;&nbsp;&nbsp;term,&nbsp;such&nbsp;as&nbsp;<span class="inlinecode"><span class="id" title="var">TApp</span></span> <span class="inlinecode"><span class="id" title="var">t1</span></span> <span class="inlinecode"><span class="id" title="var">t2</span></span>,&nbsp;where&nbsp;<span class="inlinecode"><span class="id" title="var">TApp</span></span>&nbsp;is&nbsp;a&nbsp;user-defined&nbsp;constructor&nbsp;of<br/>
&nbsp;&nbsp;&nbsp;the&nbsp;user-defined&nbsp;type&nbsp;of&nbsp;<span class="inlinecode"><span class="id" title="var">term</span></span>s.&nbsp;We&nbsp;assume&nbsp;that&nbsp;the&nbsp;user&nbsp;has&nbsp;manually<br/>
&nbsp;&nbsp;&nbsp;rewritten&nbsp;one&nbsp;occurrence&nbsp;of&nbsp;<span class="inlinecode"><span class="id" title="tactic">subst</span></span>&nbsp;using&nbsp;the&nbsp;lemma&nbsp;<span class="inlinecode"><span class="id" title="var">expand_subst</span></span>,&nbsp;so&nbsp;as&nbsp;to<br/>
&nbsp;&nbsp;&nbsp;indicate&nbsp;where&nbsp;simplification&nbsp;is&nbsp;desired.&nbsp;Thus,&nbsp;one&nbsp;instance&nbsp;of&nbsp;<span class="inlinecode"><span class="id" title="var">traverse</span></span><br/>
&nbsp;&nbsp;&nbsp;must&nbsp;be&nbsp;visible&nbsp;in&nbsp;a&nbsp;hypothesis&nbsp;or&nbsp;in&nbsp;the&nbsp;goal.&nbsp;We&nbsp;start&nbsp;there&nbsp;and&nbsp;do&nbsp;the<br/>
&nbsp;&nbsp;&nbsp;rest&nbsp;of&nbsp;the&nbsp;work.&nbsp;*)</span><br/>

<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">simpl_subst</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span><br/>
<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Case:&nbsp;<span class="inlinecode"><span class="id" title="var">_traverse</span></span>&nbsp;appears&nbsp;in&nbsp;the&nbsp;goal.&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;this&nbsp;binds&nbsp;the&nbsp;meta-variable&nbsp;<span class="inlinecode"><span class="id" title="var">_traverse</span></span>&nbsp;to&nbsp;the&nbsp;user's&nbsp;<span class="inlinecode"><span class="id" title="var">traverse_term</span></span>&nbsp;*)</span><br/>
&nbsp;&nbsp;|- <span class="id" title="keyword">context</span>[?<span class="id" title="var">_traverse</span> (<span class="id" title="keyword">fun</span> <a id="l:382" class="idref" href="#l:382"><span class="id" title="binder"><span id="l:384" class="id">l</span></span></a> <a id="x:383" class="idref" href="#x:383"><span class="id" title="binder"><span id="x:385" class="id">x</span></span></a> : <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a> =&gt; <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#subst_idx"><span class="id" title="definition">subst_idx</span></a> (<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#lift"><span class="id" title="method">lift</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#l:382"><span class="id" title="variable">l</span></a> 0 ?<span class="id" title="var">v</span>) (<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#l:382"><span class="id" title="variable">l</span></a> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a> ?<span class="id" title="var">k</span>) <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#x:383"><span class="id" title="variable">x</span></a>) <span class="id" title="var">_</span> <span class="id" title="var">_</span>] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;this&nbsp;causes&nbsp;the&nbsp;reduction&nbsp;of&nbsp;the&nbsp;fixpoint:&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">_traverse</span>; <span class="id" title="tactic">fold</span> <span class="id" title="var">_traverse</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;we&nbsp;now&nbsp;have&nbsp;a&nbsp;term&nbsp;of&nbsp;the&nbsp;form&nbsp;<span class="inlinecode"><span class="id" title="var">TApp</span></span> <span class="inlinecode">(<span class="id" title="var">traverse_term</span></span> <span class="inlinecode">...)</span> <span class="inlinecode">(<span class="id" title="var">traverse_term</span></span> <span class="inlinecode">...)</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;There&nbsp;remains&nbsp;to&nbsp;recognize&nbsp;the&nbsp;definition&nbsp;of&nbsp;<span class="inlinecode"><span class="id" title="tactic">subst</span></span>.&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Nat.add_0_r</span>; <span class="comment">(*&nbsp;useful&nbsp;when&nbsp;we&nbsp;have&nbsp;traversed&nbsp;a&nbsp;binder:&nbsp;1&nbsp;+&nbsp;0&nbsp;is&nbsp;1&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;use&nbsp;<span class="inlinecode"><span class="id" title="var">recognize_subst</span></span>&nbsp;at&nbsp;the&nbsp;specific&nbsp;type&nbsp;of&nbsp;the&nbsp;<span class="inlinecode"><span class="id" title="var">_traverse</span></span>&nbsp;function<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;that&nbsp;we&nbsp;have&nbsp;just&nbsp;simplified&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="keyword">type</span> <span class="id" title="keyword">of</span> <span class="id" title="var">_traverse</span> <span class="id" title="keyword">with</span> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">(</span></a><a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> ?<span class="id" title="var">V</span><a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> ?<span class="id" title="var">T</span> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> ?<span class="id" title="var">T</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="tactic">rewrite</span> (@<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#recognize_subst"><span class="id" title="lemma">recognize_subst</span></a> <span class="id" title="var">V</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">T</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>) <span class="id" title="tactic">by</span> <span class="id" title="tactic">eauto</span> <span class="id" title="keyword">with</span> <span class="id" title="var">typeclass_instances</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="lemma">Nat.add_0_l</span>; <span class="comment">(*&nbsp;useful&nbsp;when&nbsp;<span class="inlinecode"><span class="id" title="var">k1</span></span>&nbsp;is&nbsp;zero&nbsp;and&nbsp;we&nbsp;are&nbsp;at&nbsp;a&nbsp;leaf&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="tactic">rewrite</span> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#lift_zero"><span class="id" title="method">lift_zero</span></a> <span class="comment">(*&nbsp;useful&nbsp;when&nbsp;<span class="inlinecode"><span class="id" title="var">k1</span></span>&nbsp;is&nbsp;zero&nbsp;and&nbsp;we&nbsp;are&nbsp;at&nbsp;a&nbsp;leaf&nbsp;*)</span><br/>
<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Case:&nbsp;<span class="inlinecode"><span class="id" title="var">_traverse</span></span>&nbsp;appears&nbsp;in&nbsp;a&nbsp;hypothesis.&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;this&nbsp;binds&nbsp;the&nbsp;meta-variable&nbsp;<span class="inlinecode"><span class="id" title="var">_traverse</span></span>&nbsp;to&nbsp;the&nbsp;user's&nbsp;<span class="inlinecode"><span class="id" title="var">traverse_term</span></span>&nbsp;*)</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">h</span>: <span class="id" title="keyword">context</span>[?<span class="id" title="var">_traverse</span> (<span class="id" title="keyword">fun</span> <a id="l:386" class="idref" href="#l:386"><span class="id" title="binder"><span id="l:388" class="id">l</span></span></a> <a id="x:387" class="idref" href="#x:387"><span class="id" title="binder"><span id="x:389" class="id">x</span></span></a> : <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a> =&gt; <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#subst_idx"><span class="id" title="definition">subst_idx</span></a> (<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#lift"><span class="id" title="method">lift</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#l:386"><span class="id" title="variable">l</span></a> 0 ?<span class="id" title="var">v</span>) (<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#l:386"><span class="id" title="variable">l</span></a> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a> ?<span class="id" title="var">k</span>) <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#x:387"><span class="id" title="variable">x</span></a>) <span class="id" title="var">_</span> <span class="id" title="var">_</span>] |- <span class="id" title="var">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;this&nbsp;causes&nbsp;the&nbsp;reduction&nbsp;of&nbsp;the&nbsp;fixpoint:&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">_traverse</span> <span class="id" title="tactic">in</span> <span class="id" title="var">h</span>; <span class="id" title="tactic">fold</span> <span class="id" title="var">_traverse</span> <span class="id" title="tactic">in</span> <span class="id" title="var">h</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;we&nbsp;now&nbsp;have&nbsp;a&nbsp;term&nbsp;of&nbsp;the&nbsp;form&nbsp;<span class="inlinecode"><span class="id" title="var">TApp</span></span> <span class="inlinecode">(<span class="id" title="var">traverse_term</span></span> <span class="inlinecode">...)</span> <span class="inlinecode">(<span class="id" title="var">traverse_term</span></span> <span class="inlinecode">...)</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;There&nbsp;remains&nbsp;to&nbsp;recognize&nbsp;the&nbsp;definition&nbsp;of&nbsp;<span class="inlinecode"><span class="id" title="tactic">subst</span></span>.&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">add_0_r_in</span> <span class="id" title="var">h</span>; <span class="comment">(*&nbsp;useful&nbsp;when&nbsp;we&nbsp;have&nbsp;traversed&nbsp;a&nbsp;binder:&nbsp;1&nbsp;+&nbsp;0&nbsp;is&nbsp;1&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;use&nbsp;<span class="inlinecode"><span class="id" title="var">recognize_subst</span></span>&nbsp;at&nbsp;the&nbsp;specific&nbsp;type&nbsp;of&nbsp;the&nbsp;<span class="inlinecode"><span class="id" title="var">_traverse</span></span>&nbsp;function<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;that&nbsp;we&nbsp;have&nbsp;just&nbsp;simplified&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="keyword">type</span> <span class="id" title="keyword">of</span> <span class="id" title="var">_traverse</span> <span class="id" title="keyword">with</span> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">(</span></a><a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> ?<span class="id" title="var">V</span><a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> ?<span class="id" title="var">T</span> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> ?<span class="id" title="var">T</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="tactic">rewrite</span> (@<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#recognize_subst"><span class="id" title="lemma">recognize_subst</span></a> <span class="id" title="var">V</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">T</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>) <span class="id" title="tactic">in</span> <span class="id" title="var">h</span> <span class="id" title="tactic">by</span> <span class="id" title="tactic">eauto</span> <span class="id" title="keyword">with</span> <span class="id" title="var">typeclass_instances</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="lemma">Nat.add_0_l</span> <span class="id" title="tactic">in</span> <span class="id" title="var">h</span>; <span class="comment">(*&nbsp;useful&nbsp;when&nbsp;<span class="inlinecode"><span class="id" title="var">k1</span></span>&nbsp;is&nbsp;zero&nbsp;and&nbsp;we&nbsp;are&nbsp;at&nbsp;a&nbsp;leaf&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="tactic">rewrite</span> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#lift_zero"><span class="id" title="method">lift_zero</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">h</span> <span class="comment">(*&nbsp;useful&nbsp;when&nbsp;<span class="inlinecode"><span class="id" title="var">k1</span></span>&nbsp;is&nbsp;zero&nbsp;and&nbsp;we&nbsp;are&nbsp;at&nbsp;a&nbsp;leaf&nbsp;*)</span><br/>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="comment">(*&nbsp;This&nbsp;tactic&nbsp;attempts&nbsp;to&nbsp;simplify&nbsp;all&nbsp;occurrences&nbsp;of&nbsp;<span class="inlinecode"><span class="id" title="tactic">subst</span></span>&nbsp;in&nbsp;the&nbsp;goal.&nbsp;*)</span><br/>

<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">simpl_subst_goal</span> :=<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;this&nbsp;replaces&nbsp;<span class="inlinecode"><span class="id" title="tactic">subst</span></span>&nbsp;with&nbsp;applications&nbsp;of&nbsp;<span class="inlinecode"><span class="id" title="var">traverse</span></span>&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="tactic">rewrite</span> @<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#expand_subst"><span class="id" title="lemma">expand_subst</span></a>;<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;this&nbsp;replaces&nbsp;the&nbsp;generic&nbsp;<span class="inlinecode"><span class="id" title="var">traverse</span></span>&nbsp;with&nbsp;the&nbsp;user's&nbsp;<span class="inlinecode"><span class="id" title="var">_traverse</span></span>&nbsp;functions&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" title="tactic">simpl</span> (@<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#traverse"><span class="id" title="method">traverse</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>);<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;this&nbsp;simplifies&nbsp;applications&nbsp;of&nbsp;each&nbsp;<span class="inlinecode"><span class="id" title="var">_traverse</span></span>&nbsp;function&nbsp;and&nbsp;folds&nbsp;them&nbsp;back&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="var">simpl_subst</span>;<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;if&nbsp;we&nbsp;have&nbsp;exposed&nbsp;applications&nbsp;of&nbsp;<span class="inlinecode"><span class="id" title="var">subst_idx</span></span>,&nbsp;try&nbsp;simplifying&nbsp;them&nbsp;away&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="var">subst_idx</span>;<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;if&nbsp;this&nbsp;exposes&nbsp;uses&nbsp;of&nbsp;<span class="inlinecode"><span class="id" title="var">var</span></span>,&nbsp;replace&nbsp;them&nbsp;with&nbsp;the&nbsp;user's&nbsp;<span class="inlinecode"><span class="id" title="var">TVar</span></span>&nbsp;constructor&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" title="tactic">simpl</span> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#var"><span class="id" title="method">var</span></a>.<br/>

<br/>
<span class="id" title="keyword">Hint Extern</span> 1 (<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#subst"><span class="id" title="method">subst</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <span class="id" title="var">_</span>) =&gt; <span class="id" title="var">simpl_subst_goal</span> : <span class="id" title="var">simpl_subst_goal</span>.<br/>
<span class="id" title="keyword">Hint Extern</span> 1 (<span class="id" title="var">_</span> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#subst"><span class="id" title="method">subst</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>) =&gt; <span class="id" title="var">simpl_subst_goal</span> : <span class="id" title="var">simpl_subst_goal</span>.<br/>

<br/>
<span class="comment">(*&nbsp;This&nbsp;tactic&nbsp;attempts&nbsp;to&nbsp;simplify&nbsp;all&nbsp;occurrences&nbsp;of&nbsp;<span class="inlinecode"><span class="id" title="tactic">subst</span></span>&nbsp;in&nbsp;the&nbsp;goal<br/>
&nbsp;&nbsp;&nbsp;and&nbsp;the&nbsp;hypotheses.&nbsp;*)</span><br/>

<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">simpl_subst_all</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="tactic">rewrite</span> @<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#expand_subst"><span class="id" title="lemma">expand_subst</span></a> <span class="id" title="tactic">in</span> *;<br/>
&nbsp;&nbsp;<span class="id" title="tactic">simpl</span> (@<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#traverse"><span class="id" title="method">traverse</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>) <span class="id" title="tactic">in</span> *;<br/>
&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="var">simpl_subst</span>;<br/>
&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="var">subst_idx_all</span>;<br/>
&nbsp;&nbsp;<span class="id" title="tactic">simpl</span> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#var"><span class="id" title="method">var</span></a> <span class="id" title="tactic">in</span> *.<br/>

<br/>
<span class="comment">(*&nbsp;This&nbsp;tactic&nbsp;attempts&nbsp;to&nbsp;simplify&nbsp;all&nbsp;occurrences&nbsp;of&nbsp;<span class="inlinecode"><span class="id" title="tactic">subst</span></span>&nbsp;in&nbsp;a&nbsp;specific<br/>
&nbsp;&nbsp;&nbsp;hypothesis.&nbsp;*)</span><br/>

<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">simpl_subst_in</span> <span class="id" title="var">h</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="tactic">rewrite</span> @<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#expand_subst"><span class="id" title="lemma">expand_subst</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">h</span>;<br/>
&nbsp;&nbsp;<span class="id" title="tactic">simpl</span> (@<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#traverse"><span class="id" title="method">traverse</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>) <span class="id" title="tactic">in</span> <span class="id" title="var">h</span>;<br/>
&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="var">simpl_subst</span>;<br/>
&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="var">subst_idx_in</span> <span class="id" title="var">h</span>;<br/>
&nbsp;&nbsp;<span class="id" title="tactic">simpl</span> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#var"><span class="id" title="method">var</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">h</span>.<br/>

<br/>
<span class="comment">(*&nbsp;----------------------------------------------------------------------------&nbsp;*)</span><br/>

<br/>
<span class="comment">(*&nbsp;Our&nbsp;definition&nbsp;of&nbsp;<span class="inlinecode"><span class="id" title="tactic">subst</span></span>&nbsp;in&nbsp;terms&nbsp;of&nbsp;<span class="inlinecode"><span class="id" title="var">traverse</span></span>&nbsp;satisfies&nbsp;all&nbsp;of&nbsp;the&nbsp;desired<br/>
&nbsp;&nbsp;&nbsp;properties.&nbsp;*)</span><br/>

<br/>
<span class="id" title="keyword">Instance</span> <a id="SubstVar_Traverse" class="idref" href="#SubstVar_Traverse"><span class="id" title="instance">SubstVar_Traverse</span></a>:<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> `{<a id="H:391" class="idref" href="#H:391"><span class="id" title="binder">Var</span></a> <a id="V:390" class="idref" href="#V:390"><span class="id" title="binder"><span id="H:391" class="id">V</span></span></a>, <a id="H0:392" class="idref" href="#H0:392"><span class="id" title="binder">Traverse</span></a> <a id="H0:392" class="idref" href="#H0:392"><span class="id" title="binder">V</span></a> <a id="H0:392" class="idref" href="#H0:392"><span class="id" title="binder">V</span></a>},<br/>
&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#TraverseIdentifiesVar"><span class="id" title="class">TraverseIdentifiesVar</span></a> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#TraverseVarIsIdentity"><span class="id" title="class">TraverseVarIsIdentity</span></a> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#SubstVar"><span class="id" title="class">SubstVar</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">constructor</span>. <span class="id" title="tactic">unfold</span> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#subst"><span class="id" title="method">subst</span></a>, <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#Subst_Traverse"><span class="id" title="instance">Subst_Traverse</span></a>. <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#traverse_identifies_var"><span class="id" title="method">traverse_identifies_var</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#lift_zero"><span class="id" title="method">lift_zero</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">reflexivity</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Instance</span> <a id="SubstLift_Traverse" class="idref" href="#SubstLift_Traverse"><span class="id" title="instance">SubstLift_Traverse</span></a>:<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> `{<a id="H:394" class="idref" href="#H:394"><span class="id" title="binder">Var</span></a> <a id="V:393" class="idref" href="#V:393"><span class="id" title="binder"><span id="H:394" class="id">V</span></span></a>, <a id="H0:395" class="idref" href="#H0:395"><span class="id" title="binder">Traverse</span></a> <a id="H0:395" class="idref" href="#H0:395"><span class="id" title="binder">V</span></a> <a id="H0:395" class="idref" href="#H0:395"><span class="id" title="binder">V</span></a>, <a id="H1:397" class="idref" href="#H1:397"><span class="id" title="binder">Traverse</span></a> <a id="H1:397" class="idref" href="#H1:397"><span class="id" title="binder">V</span></a> <a id="T:396" class="idref" href="#T:396"><span class="id" title="binder"><span id="H1:397" class="id">T</span></span></a>},<br/>
&nbsp;&nbsp;@<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#TraverseFunctorial"><span class="id" title="class">TraverseFunctorial</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#V:393"><span class="id" title="variable">V</span></a> <span class="id" title="var">_</span> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#T:396"><span class="id" title="variable">T</span></a> <span class="id" title="var">_</span> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;@<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#TraverseIdentifiesVar"><span class="id" title="class">TraverseIdentifiesVar</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#V:393"><span class="id" title="variable">V</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;@<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#TraverseVarIsIdentity"><span class="id" title="class">TraverseVarIsIdentity</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#V:393"><span class="id" title="variable">V</span></a> <span class="id" title="var">_</span> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#T:396"><span class="id" title="variable">T</span></a> <span class="id" title="var">_</span> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;@<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#SubstLift"><span class="id" title="class">SubstLift</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#T:396"><span class="id" title="variable">T</span></a> <span class="id" title="var">_</span> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#V:393"><span class="id" title="variable">V</span></a> <span class="id" title="var">_</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">constructor</span>. <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;First,&nbsp;argue&nbsp;that&nbsp;everything&nbsp;boils&nbsp;down&nbsp;to&nbsp;examining&nbsp;what&nbsp;happens<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;at&nbsp;variables.&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#lift"><span class="id" title="method">lift</span></a>, <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#Lift_Traverse"><span class="id" title="instance">Lift_Traverse</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#subst"><span class="id" title="method">subst</span></a>, <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#Subst_Traverse"><span class="id" title="instance">Subst_Traverse</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#traverse_functorial"><span class="id" title="method">traverse_functorial</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#traverse_var_is_identity"><span class="id" title="method">traverse_var_is_identity</span></a>. <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#traverse_identifies_var"><span class="id" title="method">traverse_identifies_var</span></a>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;At&nbsp;the&nbsp;leaves,&nbsp;there&nbsp;remains&nbsp;a&nbsp;basic&nbsp;lemma,&nbsp;which&nbsp;we&nbsp;prove&nbsp;on&nbsp;the&nbsp;fly.&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" title="var">just_do_it</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Instance</span> <a id="LiftSubst1_Traverse" class="idref" href="#LiftSubst1_Traverse"><span class="id" title="instance">LiftSubst1_Traverse</span></a>:<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> `{<a id="H:399" class="idref" href="#H:399"><span class="id" title="binder">Var</span></a> <a id="V:398" class="idref" href="#V:398"><span class="id" title="binder"><span id="H:399" class="id">V</span></span></a>, <a id="H0:400" class="idref" href="#H0:400"><span class="id" title="binder">Traverse</span></a> <a id="H0:400" class="idref" href="#H0:400"><span class="id" title="binder">V</span></a> <a id="H0:400" class="idref" href="#H0:400"><span class="id" title="binder">V</span></a>, <a id="H1:402" class="idref" href="#H1:402"><span class="id" title="binder">Traverse</span></a> <a id="H1:402" class="idref" href="#H1:402"><span class="id" title="binder">V</span></a> <a id="T:401" class="idref" href="#T:401"><span class="id" title="binder"><span id="H1:402" class="id">T</span></span></a>},<br/>
&nbsp;&nbsp;@<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#TraverseRelative"><span class="id" title="class">TraverseRelative</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#V:398"><span class="id" title="variable">V</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#V:398"><span class="id" title="variable">V</span></a> <span class="id" title="var">_</span> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;@<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#TraverseRelative"><span class="id" title="class">TraverseRelative</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#V:398"><span class="id" title="variable">V</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#T:401"><span class="id" title="variable">T</span></a> <span class="id" title="var">_</span> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <span class="comment">(*&nbsp;TraverseExtensional&nbsp;*)</span><br/>
&nbsp;&nbsp;@<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#TraverseFunctorial"><span class="id" title="class">TraverseFunctorial</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#V:398"><span class="id" title="variable">V</span></a> <span class="id" title="var">_</span> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#V:398"><span class="id" title="variable">V</span></a> <span class="id" title="var">_</span> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;@<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#TraverseFunctorial"><span class="id" title="class">TraverseFunctorial</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#V:398"><span class="id" title="variable">V</span></a> <span class="id" title="var">_</span> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#T:401"><span class="id" title="variable">T</span></a> <span class="id" title="var">_</span> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;@<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#TraverseIdentifiesVar"><span class="id" title="class">TraverseIdentifiesVar</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#V:398"><span class="id" title="variable">V</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;@<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#LiftSubst1"><span class="id" title="class">LiftSubst1</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#V:398"><span class="id" title="variable">V</span></a> <span class="id" title="var">_</span> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#T:401"><span class="id" title="variable">T</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">constructor</span>. <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;First,&nbsp;argue&nbsp;that&nbsp;everything&nbsp;boils&nbsp;down&nbsp;to&nbsp;examining&nbsp;what&nbsp;happens<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;at&nbsp;variables.&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#lift"><span class="id" title="method">lift</span></a> <span class="id" title="tactic">at</span> 1 3. <span class="id" title="tactic">unfold</span> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#Lift_Traverse"><span class="id" title="instance">Lift_Traverse</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#subst"><span class="id" title="method">subst</span></a>, <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#Subst_Traverse"><span class="id" title="instance">Subst_Traverse</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">do</span> 2 <span class="id" title="tactic">rewrite</span> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#traverse_functorial"><span class="id" title="method">traverse_functorial</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> (<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#traverse_extensional"><span class="id" title="lemma">traverse_extensional</span></a> <span class="id" title="var">_</span>). <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#traverse_identifies_var"><span class="id" title="method">traverse_identifies_var</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="var">recognize_lift</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;This&nbsp;is&nbsp;what&nbsp;must&nbsp;be&nbsp;proven&nbsp;at&nbsp;variables.&nbsp;Tidy&nbsp;it&nbsp;up&nbsp;slightly.&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#lift_lift"><span class="id" title="method">lift_lift</span></a> <span class="id" title="tactic">by</span> <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">replace</span> (<span class="id" title="var">l</span> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">(</span></a><span class="id" title="var">w</span> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a> <span class="id" title="var">s</span><a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">)</span></a>) <span class="id" title="keyword">with</span> (<span class="id" title="var">w</span> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">(</span></a><span class="id" title="var">l</span> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a> <span class="id" title="var">s</span><a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">)</span></a>) <span class="id" title="tactic">by</span> <span class="id" title="var">lia</span>. <span class="comment">(*&nbsp;optional&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;We&nbsp;now&nbsp;recognize&nbsp;a&nbsp;heterogeneous&nbsp;version&nbsp;of&nbsp;<span class="inlinecode"><span class="id" title="var">LiftSubst1</span></span>&nbsp;at&nbsp;types<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="inlinecode"><span class="id" title="var">nat</span></span>&nbsp;and&nbsp;<span class="inlinecode"><span class="id" title="var">V</span></span>.&nbsp;We&nbsp;could&nbsp;make&nbsp;it&nbsp;a&nbsp;separate&nbsp;lemma,&nbsp;but&nbsp;brute&nbsp;force<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;is&nbsp;more&nbsp;concise.&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" title="tactic">replace</span> (<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#lift"><span class="id" title="method">lift</span></a> <span class="id" title="var">w</span> (<span class="id" title="var">l</span> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a> <span class="id" title="var">k</span>) <span class="id" title="var">x</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">with</span> ((<span class="id" title="keyword">let</span> (<a id="lift0:403" class="idref" href="#lift0:403"><span class="id" title="binder"><span id="lift0:404" class="id">lift0</span></span></a>) := <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#Lift_idx"><span class="id" title="instance">Lift_idx</span></a> <span class="id" title="tactic">in</span> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#lift0:403"><span class="id" title="variable">lift0</span></a>) <span class="id" title="var">w</span> (<span class="id" title="var">l</span> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a> <span class="id" title="var">k</span>) <span class="id" title="var">x</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">by</span> (<span class="id" title="tactic">unfold</span> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#lift"><span class="id" title="method">lift</span></a>; <span class="id" title="tactic">reflexivity</span>).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#Lift_idx"><span class="id" title="instance">Lift_idx</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#subst_idx"><span class="id" title="definition">subst_idx</span></a>. <span class="id" title="var">dblib_by_cases</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">rewrite</span> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#lift_var"><span class="id" title="method">lift_var</span></a>; <span class="id" title="var">just_do_it</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Instance</span> <a id="LiftSubst2_Traverse" class="idref" href="#LiftSubst2_Traverse"><span class="id" title="instance">LiftSubst2_Traverse</span></a>:<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> `{<a id="H:406" class="idref" href="#H:406"><span class="id" title="binder">Var</span></a> <a id="V:405" class="idref" href="#V:405"><span class="id" title="binder"><span id="H:406" class="id">V</span></span></a>, <a id="H0:407" class="idref" href="#H0:407"><span class="id" title="binder">Traverse</span></a> <a id="H0:407" class="idref" href="#H0:407"><span class="id" title="binder">V</span></a> <a id="H0:407" class="idref" href="#H0:407"><span class="id" title="binder">V</span></a>, <a id="H1:409" class="idref" href="#H1:409"><span class="id" title="binder">Traverse</span></a> <a id="H1:409" class="idref" href="#H1:409"><span class="id" title="binder">V</span></a> <a id="T:408" class="idref" href="#T:408"><span class="id" title="binder"><span id="H1:409" class="id">T</span></span></a>},<br/>
&nbsp;&nbsp;@<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#TraverseRelative"><span class="id" title="class">TraverseRelative</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#V:405"><span class="id" title="variable">V</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#V:405"><span class="id" title="variable">V</span></a> <span class="id" title="var">_</span> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;@<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#TraverseRelative"><span class="id" title="class">TraverseRelative</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#V:405"><span class="id" title="variable">V</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#T:408"><span class="id" title="variable">T</span></a> <span class="id" title="var">_</span> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <span class="comment">(*&nbsp;TraverseExtensional&nbsp;*)</span><br/>
&nbsp;&nbsp;@<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#TraverseFunctorial"><span class="id" title="class">TraverseFunctorial</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#V:405"><span class="id" title="variable">V</span></a> <span class="id" title="var">_</span> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#V:405"><span class="id" title="variable">V</span></a> <span class="id" title="var">_</span> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;@<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#TraverseFunctorial"><span class="id" title="class">TraverseFunctorial</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#V:405"><span class="id" title="variable">V</span></a> <span class="id" title="var">_</span> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#T:408"><span class="id" title="variable">T</span></a> <span class="id" title="var">_</span> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;@<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#TraverseIdentifiesVar"><span class="id" title="class">TraverseIdentifiesVar</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#V:405"><span class="id" title="variable">V</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;@<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#LiftSubst2"><span class="id" title="class">LiftSubst2</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#V:405"><span class="id" title="variable">V</span></a> <span class="id" title="var">_</span> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#T:408"><span class="id" title="variable">T</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">constructor</span>. <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;First,&nbsp;argue&nbsp;that&nbsp;everything&nbsp;boils&nbsp;down&nbsp;to&nbsp;examining&nbsp;what&nbsp;happens<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;at&nbsp;variables.&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#lift"><span class="id" title="method">lift</span></a> <span class="id" title="tactic">at</span> 1 3. <span class="id" title="tactic">unfold</span> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#Lift_Traverse"><span class="id" title="instance">Lift_Traverse</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#subst"><span class="id" title="method">subst</span></a>, <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#Subst_Traverse"><span class="id" title="instance">Subst_Traverse</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">do</span> 2 <span class="id" title="tactic">rewrite</span> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#traverse_functorial"><span class="id" title="method">traverse_functorial</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> (<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#traverse_extensional"><span class="id" title="lemma">traverse_extensional</span></a> <span class="id" title="var">_</span>). <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#traverse_identifies_var"><span class="id" title="method">traverse_identifies_var</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="var">recognize_lift</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;This&nbsp;is&nbsp;what&nbsp;must&nbsp;be&nbsp;proven&nbsp;at&nbsp;variables.&nbsp;Tidy&nbsp;it&nbsp;up&nbsp;slightly.&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#lift_lift"><span class="id" title="method">lift_lift</span></a> <span class="id" title="tactic">by</span> <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">replace</span> (<span class="id" title="var">l</span> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">(</span></a>1 <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a> <span class="id" title="var">k</span><a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">)</span></a>) <span class="id" title="keyword">with</span> (1 <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">(</span></a><span class="id" title="var">l</span> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a> <span class="id" title="var">k</span><a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">)</span></a>) <span class="id" title="tactic">by</span> <span class="id" title="var">lia</span>. <span class="comment">(*&nbsp;optional&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;We&nbsp;now&nbsp;recognize&nbsp;a&nbsp;heterogeneous&nbsp;version&nbsp;of&nbsp;<span class="inlinecode"><span class="id" title="var">LiftSubst2</span></span>&nbsp;at&nbsp;types<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="inlinecode"><span class="id" title="var">nat</span></span>&nbsp;and&nbsp;<span class="inlinecode"><span class="id" title="var">V</span></span>.&nbsp;We&nbsp;could&nbsp;make&nbsp;it&nbsp;a&nbsp;separate&nbsp;lemma,&nbsp;but&nbsp;brute&nbsp;force<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;is&nbsp;more&nbsp;concise.&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" title="tactic">replace</span> (<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#lift"><span class="id" title="method">lift</span></a> <span class="id" title="var">w</span> (1 <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">(</span></a><span class="id" title="var">l</span> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a> <span class="id" title="var">k</span><a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">)</span></a>) <span class="id" title="var">x</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">with</span> ((<span class="id" title="keyword">let</span> (<a id="lift0:410" class="idref" href="#lift0:410"><span class="id" title="binder"><span id="lift0:411" class="id">lift0</span></span></a>) := <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#Lift_idx"><span class="id" title="instance">Lift_idx</span></a> <span class="id" title="tactic">in</span> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#lift0:410"><span class="id" title="variable">lift0</span></a>) <span class="id" title="var">w</span> (1 <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">(</span></a><span class="id" title="var">l</span> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a> <span class="id" title="var">k</span><a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">)</span></a>) <span class="id" title="var">x</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">by</span> (<span class="id" title="tactic">unfold</span> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#lift"><span class="id" title="method">lift</span></a>; <span class="id" title="tactic">reflexivity</span>).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#Lift_idx"><span class="id" title="instance">Lift_idx</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#subst_idx"><span class="id" title="definition">subst_idx</span></a>. <span class="id" title="var">dblib_by_cases</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">rewrite</span> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#lift_var"><span class="id" title="method">lift_var</span></a>; <span class="id" title="var">just_do_it</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="comment">(*&nbsp;<span class="inlinecode"><span class="id" title="var">LiftSubst1</span></span>&nbsp;and&nbsp;<span class="inlinecode"><span class="id" title="var">LiftSubst2</span></span>&nbsp;imply&nbsp;<span class="inlinecode"><span class="id" title="var">LiftSubst</span></span>.&nbsp;No&nbsp;surprise,&nbsp;since&nbsp;the<br/>
&nbsp;&nbsp;&nbsp;latter&nbsp;law&nbsp;is&nbsp;just&nbsp;a&nbsp;combination&nbsp;of&nbsp;the&nbsp;former&nbsp;two.&nbsp;*)</span><br/>

<br/>
<span class="id" title="keyword">Instance</span> <a id="LiftSubst_LiftSubst12" class="idref" href="#LiftSubst_LiftSubst12"><span class="id" title="instance">LiftSubst_LiftSubst12</span></a> `{<a id="H:413" class="idref" href="#H:413"><span class="id" title="binder">Lift</span></a> <a id="V:412" class="idref" href="#V:412"><span class="id" title="binder"><span id="H:413" class="id">V</span></span></a>, <a id="H0:415" class="idref" href="#H0:415"><span class="id" title="binder">Lift</span></a> <a id="T:414" class="idref" href="#T:414"><span class="id" title="binder"><span id="H0:415" class="id">T</span></span></a>, <a id="H1:416" class="idref" href="#H1:416"><span class="id" title="binder">Subst</span></a> <a id="H1:416" class="idref" href="#H1:416"><span class="id" title="binder">V</span></a> <a id="H1:416" class="idref" href="#H1:416"><span class="id" title="binder">T</span></a>} :<br/>
&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#LiftSubst1"><span class="id" title="class">LiftSubst1</span></a> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#LiftSubst2"><span class="id" title="class">LiftSubst2</span></a> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#LiftSubst"><span class="id" title="class">LiftSubst</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">constructor</span>. <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="definition">le_gt_dec</span> <span class="id" title="var">s</span> <span class="id" title="var">k</span>); <span class="id" title="tactic">do</span> 2 <span class="id" title="var">lift_idx</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Case&nbsp;<span class="inlinecode"><span class="id" title="var">s</span></span> <span class="inlinecode">&lt;=</span> <span class="inlinecode"><span class="id" title="var">k</span></span>.&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#lift_subst_2"><span class="id" title="method">lift_subst_2</span></a>. <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Case&nbsp;<span class="inlinecode"><span class="id" title="var">s</span></span> <span class="inlinecode">&gt;</span> <span class="inlinecode"><span class="id" title="var">k</span></span>.&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#lift_subst_1"><span class="id" title="method">lift_subst_1</span></a>. <span class="id" title="var">lia</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Instance</span> <a id="SubstSubst_Traverse" class="idref" href="#SubstSubst_Traverse"><span class="id" title="instance">SubstSubst_Traverse</span></a>:<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> `{<a id="H:418" class="idref" href="#H:418"><span class="id" title="binder">Var</span></a> <a id="V:417" class="idref" href="#V:417"><span class="id" title="binder"><span id="H:418" class="id">V</span></span></a>, <a id="H0:419" class="idref" href="#H0:419"><span class="id" title="binder">Traverse</span></a> <a id="H0:419" class="idref" href="#H0:419"><span class="id" title="binder">V</span></a> <a id="H0:419" class="idref" href="#H0:419"><span class="id" title="binder">V</span></a>, <a id="H1:421" class="idref" href="#H1:421"><span class="id" title="binder">Traverse</span></a> <a id="H1:421" class="idref" href="#H1:421"><span class="id" title="binder">V</span></a> <a id="T:420" class="idref" href="#T:420"><span class="id" title="binder"><span id="H1:421" class="id">T</span></span></a>},<br/>
&nbsp;&nbsp;@<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#TraverseRelative"><span class="id" title="class">TraverseRelative</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#V:417"><span class="id" title="variable">V</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#V:417"><span class="id" title="variable">V</span></a> <span class="id" title="var">_</span> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;@<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#TraverseRelative"><span class="id" title="class">TraverseRelative</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#V:417"><span class="id" title="variable">V</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#T:420"><span class="id" title="variable">T</span></a> <span class="id" title="var">_</span> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <span class="comment">(*&nbsp;TraverseExtensional&nbsp;*)</span><br/>
&nbsp;&nbsp;@<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#TraverseIdentifiesVar"><span class="id" title="class">TraverseIdentifiesVar</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#V:417"><span class="id" title="variable">V</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;@<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#TraverseVarIsIdentity"><span class="id" title="class">TraverseVarIsIdentity</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#V:417"><span class="id" title="variable">V</span></a> <span class="id" title="var">_</span> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#V:417"><span class="id" title="variable">V</span></a> <span class="id" title="var">_</span> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;@<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#TraverseFunctorial"><span class="id" title="class">TraverseFunctorial</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#V:417"><span class="id" title="variable">V</span></a> <span class="id" title="var">_</span> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#V:417"><span class="id" title="variable">V</span></a> <span class="id" title="var">_</span> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;@<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#TraverseFunctorial"><span class="id" title="class">TraverseFunctorial</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#V:417"><span class="id" title="variable">V</span></a> <span class="id" title="var">_</span> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#T:420"><span class="id" title="variable">T</span></a> <span class="id" title="var">_</span> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;@<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#SubstSubst"><span class="id" title="class">SubstSubst</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#V:417"><span class="id" title="variable">V</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#T:420"><span class="id" title="variable">T</span></a> <span class="id" title="var">_</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">constructor</span>. <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;First,&nbsp;argue&nbsp;that&nbsp;everything&nbsp;boils&nbsp;down&nbsp;to&nbsp;examining&nbsp;what&nbsp;happens<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;at&nbsp;variables.&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#subst"><span class="id" title="method">subst</span></a> <span class="id" title="tactic">at</span> 1 2 3 5. <span class="id" title="tactic">unfold</span> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#Subst_Traverse"><span class="id" title="instance">Subst_Traverse</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">do</span> 2 <span class="id" title="tactic">rewrite</span> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#traverse_functorial"><span class="id" title="method">traverse_functorial</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> (<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#traverse_extensional"><span class="id" title="lemma">traverse_extensional</span></a> <span class="id" title="var">_</span>). <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">do</span> 2 <span class="id" title="var">recognize_subst</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;This&nbsp;is&nbsp;what&nbsp;must&nbsp;be&nbsp;proven&nbsp;at&nbsp;variables.&nbsp;Tidy&nbsp;it&nbsp;up&nbsp;slightly.&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#lift_subst_1"><span class="id" title="method">lift_subst_1</span></a> <span class="id" title="tactic">by</span> <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;We&nbsp;now&nbsp;recognize&nbsp;a&nbsp;heterogeneous&nbsp;version&nbsp;of&nbsp;<span class="inlinecode"><span class="id" title="var">SubstSubst</span></span>&nbsp;at&nbsp;types<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="inlinecode"><span class="id" title="var">nat</span></span>&nbsp;and&nbsp;<span class="inlinecode"><span class="id" title="var">V</span></span>.&nbsp;We&nbsp;could&nbsp;make&nbsp;it&nbsp;a&nbsp;separate&nbsp;lemma,&nbsp;but&nbsp;brute&nbsp;force<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;is&nbsp;more&nbsp;concise.&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#subst_idx"><span class="id" title="definition">subst_idx</span></a>; <span class="id" title="var">dblib_by_cases</span>; <span class="id" title="tactic">repeat</span> <span class="id" title="tactic">rewrite</span> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#subst_var"><span class="id" title="method">subst_var</span></a>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">solve</span> [ <span class="id" title="var">just_do_it</span> ].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;The&nbsp;special&nbsp;case&nbsp;<span class="inlinecode"><span class="id" title="var">x</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">l</span></span> <span class="inlinecode">+</span> <span class="inlinecode"><span class="id" title="var">s</span></span> <span class="inlinecode">+</span> <span class="inlinecode">1</span>&nbsp;remains.&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">subst_idx</span>. <span class="id" title="tactic">rewrite</span> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#lift_lift"><span class="id" title="method">lift_lift</span></a> <span class="id" title="tactic">by</span> <span class="id" title="var">lia</span>. <span class="id" title="tactic">rewrite</span> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#subst_lift"><span class="id" title="method">subst_lift</span></a>. <span class="id" title="tactic">reflexivity</span>. <span class="comment">(*&nbsp;Phew!&nbsp;*)</span><br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Instance</span> <a id="Pun1_Traverse" class="idref" href="#Pun1_Traverse"><span class="id" title="instance">Pun1_Traverse</span></a>:<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> `{<a id="H:423" class="idref" href="#H:423"><span class="id" title="binder">Var</span></a> <a id="V:422" class="idref" href="#V:422"><span class="id" title="binder"><span id="H:423" class="id">V</span></span></a>, <a id="H0:424" class="idref" href="#H0:424"><span class="id" title="binder">Traverse</span></a> <a id="H0:424" class="idref" href="#H0:424"><span class="id" title="binder">V</span></a> <a id="H0:424" class="idref" href="#H0:424"><span class="id" title="binder">V</span></a>, <a id="H1:426" class="idref" href="#H1:426"><span class="id" title="binder">Traverse</span></a> <a id="H1:426" class="idref" href="#H1:426"><span class="id" title="binder">V</span></a> <a id="T:425" class="idref" href="#T:425"><span class="id" title="binder"><span id="H1:426" class="id">T</span></span></a>},<br/>
&nbsp;&nbsp;@<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#TraverseFunctorial"><span class="id" title="class">TraverseFunctorial</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#V:422"><span class="id" title="variable">V</span></a> <span class="id" title="var">_</span> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#T:425"><span class="id" title="variable">T</span></a> <span class="id" title="var">_</span> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;@<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#TraverseVarIsIdentity"><span class="id" title="class">TraverseVarIsIdentity</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#V:422"><span class="id" title="variable">V</span></a> <span class="id" title="var">_</span> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#T:425"><span class="id" title="variable">T</span></a> <span class="id" title="var">_</span> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;@<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#TraverseIdentifiesVar"><span class="id" title="class">TraverseIdentifiesVar</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#V:422"><span class="id" title="variable">V</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;@<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#Pun1"><span class="id" title="class">Pun1</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#V:422"><span class="id" title="variable">V</span></a> <span class="id" title="var">_</span> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#T:425"><span class="id" title="variable">T</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">constructor</span>. <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#lift"><span class="id" title="method">lift</span></a>, <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#Lift_Traverse"><span class="id" title="instance">Lift_Traverse</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#subst"><span class="id" title="method">subst</span></a>, <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#Subst_Traverse"><span class="id" title="instance">Subst_Traverse</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#traverse_functorial"><span class="id" title="method">traverse_functorial</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#traverse_var_is_identity"><span class="id" title="method">traverse_var_is_identity</span></a>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#traverse_identifies_var"><span class="id" title="method">traverse_identifies_var</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#lift_var"><span class="id" title="method">lift_var</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="var">just_do_it</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Instance</span> <a id="Pun2_Traverse" class="idref" href="#Pun2_Traverse"><span class="id" title="instance">Pun2_Traverse</span></a>:<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> `{<a id="H:428" class="idref" href="#H:428"><span class="id" title="binder">Var</span></a> <a id="V:427" class="idref" href="#V:427"><span class="id" title="binder"><span id="H:428" class="id">V</span></span></a>, <a id="H0:429" class="idref" href="#H0:429"><span class="id" title="binder">Traverse</span></a> <a id="H0:429" class="idref" href="#H0:429"><span class="id" title="binder">V</span></a> <a id="H0:429" class="idref" href="#H0:429"><span class="id" title="binder">V</span></a>, <a id="H1:431" class="idref" href="#H1:431"><span class="id" title="binder">Traverse</span></a> <a id="H1:431" class="idref" href="#H1:431"><span class="id" title="binder">V</span></a> <a id="T:430" class="idref" href="#T:430"><span class="id" title="binder"><span id="H1:431" class="id">T</span></span></a>},<br/>
&nbsp;&nbsp;@<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#TraverseFunctorial"><span class="id" title="class">TraverseFunctorial</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#V:427"><span class="id" title="variable">V</span></a> <span class="id" title="var">_</span> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#T:430"><span class="id" title="variable">T</span></a> <span class="id" title="var">_</span> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;@<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#TraverseVarIsIdentity"><span class="id" title="class">TraverseVarIsIdentity</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#V:427"><span class="id" title="variable">V</span></a> <span class="id" title="var">_</span> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#T:430"><span class="id" title="variable">T</span></a> <span class="id" title="var">_</span> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;@<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#TraverseIdentifiesVar"><span class="id" title="class">TraverseIdentifiesVar</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#V:427"><span class="id" title="variable">V</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;@<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#Pun2"><span class="id" title="class">Pun2</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#V:427"><span class="id" title="variable">V</span></a> <span class="id" title="var">_</span> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#T:430"><span class="id" title="variable">T</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">constructor</span>. <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#lift"><span class="id" title="method">lift</span></a>, <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#Lift_Traverse"><span class="id" title="instance">Lift_Traverse</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#subst"><span class="id" title="method">subst</span></a>, <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#Subst_Traverse"><span class="id" title="instance">Subst_Traverse</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#traverse_functorial"><span class="id" title="method">traverse_functorial</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#traverse_var_is_identity"><span class="id" title="method">traverse_var_is_identity</span></a>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#traverse_identifies_var"><span class="id" title="method">traverse_identifies_var</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#lift_var"><span class="id" title="method">lift_var</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="var">just_do_it</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Instance</span> <a id="PunPun_Traverse" class="idref" href="#PunPun_Traverse"><span class="id" title="instance">PunPun_Traverse</span></a>:<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> `{<a id="H:433" class="idref" href="#H:433"><span class="id" title="binder">Var</span></a> <a id="V:432" class="idref" href="#V:432"><span class="id" title="binder"><span id="H:433" class="id">V</span></span></a>, <a id="H0:434" class="idref" href="#H0:434"><span class="id" title="binder">Traverse</span></a> <a id="H0:434" class="idref" href="#H0:434"><span class="id" title="binder">V</span></a> <a id="H0:434" class="idref" href="#H0:434"><span class="id" title="binder">V</span></a>, <a id="H1:436" class="idref" href="#H1:436"><span class="id" title="binder">Traverse</span></a> <a id="H1:436" class="idref" href="#H1:436"><span class="id" title="binder">V</span></a> <a id="T:435" class="idref" href="#T:435"><span class="id" title="binder"><span id="H1:436" class="id">T</span></span></a>},<br/>
&nbsp;&nbsp;@<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#TraverseRelative"><span class="id" title="class">TraverseRelative</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#V:432"><span class="id" title="variable">V</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#T:435"><span class="id" title="variable">T</span></a> <span class="id" title="var">_</span> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <span class="comment">(*&nbsp;TraverseExtensional&nbsp;*)</span><br/>
&nbsp;&nbsp;@<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#TraverseFunctorial"><span class="id" title="class">TraverseFunctorial</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#V:432"><span class="id" title="variable">V</span></a> <span class="id" title="var">_</span> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#T:435"><span class="id" title="variable">T</span></a> <span class="id" title="var">_</span> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;@<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#TraverseIdentifiesVar"><span class="id" title="class">TraverseIdentifiesVar</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#V:432"><span class="id" title="variable">V</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;@<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#PunPun"><span class="id" title="class">PunPun</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#V:432"><span class="id" title="variable">V</span></a> <span class="id" title="var">_</span> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#T:435"><span class="id" title="variable">T</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">constructor</span>. <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#lift"><span class="id" title="method">lift</span></a>, <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#Lift_Traverse"><span class="id" title="instance">Lift_Traverse</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#subst"><span class="id" title="method">subst</span></a>, <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#Subst_Traverse"><span class="id" title="instance">Subst_Traverse</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">do</span> 2 <span class="id" title="tactic">rewrite</span> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#traverse_functorial"><span class="id" title="method">traverse_functorial</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> (<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#traverse_extensional"><span class="id" title="lemma">traverse_extensional</span></a> <span class="id" title="var">_</span>). <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">do</span> 2 <span class="id" title="tactic">rewrite</span> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#traverse_identifies_var"><span class="id" title="method">traverse_identifies_var</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="var">just_do_it</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="comment">(*&nbsp;------------------------------------------------------------------------------&nbsp;*)</span><br/>

<br/>
<span class="comment">(*&nbsp;Properties&nbsp;of&nbsp;the&nbsp;predicate&nbsp;<span class="inlinecode"><span class="id" title="var">closed</span></span>.&nbsp;*)</span><br/>

<br/>
<span class="comment">(*&nbsp;This&nbsp;technical&nbsp;lemma&nbsp;helps&nbsp;prove&nbsp;<span class="inlinecode"><span class="id" title="var">closed_monotonic</span></span>&nbsp;below.&nbsp;*)</span><br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="closed_increment" class="idref" href="#closed_increment"><span class="id" title="lemma">closed_increment</span></a>:<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> `{<a id="H:438" class="idref" href="#H:438"><span class="id" title="binder">Lift</span></a> <a id="T:437" class="idref" href="#T:437"><span class="id" title="binder"><span id="H:438" class="id">T</span></span></a>},<br/>
&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#LiftLift"><span class="id" title="class">LiftLift</span></a> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="k:439" class="idref" href="#k:439"><span class="id" title="binder">k</span></a> <a id="t:440" class="idref" href="#t:440"><span class="id" title="binder">t</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#closed"><span class="id" title="definition">closed</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#k:439"><span class="id" title="variable">k</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#t:440"><span class="id" title="variable">t</span></a> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#closed"><span class="id" title="definition">closed</span></a> (1 <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#k:439"><span class="id" title="variable">k</span></a>) <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#t:440"><span class="id" title="variable">t</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#closed"><span class="id" title="definition">closed</span></a>. <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span> <span class="id" title="var">h</span>: <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#shift"><span class="id" title="abbreviation">shift</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <span class="id" title="var">_</span> |- <span class="id" title="var">_</span> =&gt; <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">h</span> <span class="id" title="tactic">at</span> 1 <span class="id" title="keyword">end</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#lift_lift"><span class="id" title="method">lift_lift</span></a> <span class="id" title="tactic">by</span> <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">congruence</span>. <span class="comment">(*&nbsp;amazing,&nbsp;isn't&nbsp;it?&nbsp;*)</span><br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="comment">(*&nbsp;If&nbsp;a&nbsp;term&nbsp;is&nbsp;<span class="inlinecode"><span class="id" title="var">k</span></span>-closed,&nbsp;then&nbsp;it&nbsp;is&nbsp;also&nbsp;<span class="inlinecode"><span class="id" title="var">j</span></span>-closed&nbsp;for&nbsp;any&nbsp;<span class="inlinecode"><span class="id" title="var">j</span></span>&nbsp;that<br/>
&nbsp;&nbsp;&nbsp;is&nbsp;greater&nbsp;than&nbsp;or&nbsp;equal&nbsp;to&nbsp;<span class="inlinecode"><span class="id" title="var">k</span></span>.&nbsp;*)</span><br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="closed_monotonic" class="idref" href="#closed_monotonic"><span class="id" title="lemma">closed_monotonic</span></a>:<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> `{<a id="H:442" class="idref" href="#H:442"><span class="id" title="binder">Lift</span></a> <a id="T:441" class="idref" href="#T:441"><span class="id" title="binder"><span id="H:442" class="id">T</span></span></a>},<br/>
&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#LiftLift"><span class="id" title="class">LiftLift</span></a> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="k:443" class="idref" href="#k:443"><span class="id" title="binder">k</span></a> <a id="t:444" class="idref" href="#t:444"><span class="id" title="binder">t</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#closed"><span class="id" title="definition">closed</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#k:443"><span class="id" title="variable">k</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#t:444"><span class="id" title="variable">t</span></a> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="j:445" class="idref" href="#j:445"><span class="id" title="binder">j</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#j:445"><span class="id" title="variable">j</span></a> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Peano.html#73030c22bc0b1fa771c65aa5414c65f9"><span class="id" title="notation">&gt;=</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#k:443"><span class="id" title="variable">k</span></a> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#closed"><span class="id" title="definition">closed</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#j:445"><span class="id" title="variable">j</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#t:444"><span class="id" title="variable">t</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">do</span> 6 <span class="id" title="tactic">intro</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Inductive&nbsp;reformulation.&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="keyword">forall</span> <a id="i:446" class="idref" href="#i:446"><span class="id" title="binder"><span id="i:447" class="id">i</span></span></a>, <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#closed"><span class="id" title="definition">closed</span></a> (<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#i:446"><span class="id" title="variable">i</span></a> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a> <span class="id" title="var">k</span>) <span class="id" title="var">t</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">i</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;Base&nbsp;case.&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;Inductive&nbsp;case.&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">replace</span> (<a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Datatypes.html#S"><span class="id" title="constructor">S</span></a> <span class="id" title="var">i</span> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a> <span class="id" title="var">k</span>) <span class="id" title="keyword">with</span> (1 <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">(</span></a><span class="id" title="var">i</span> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a> <span class="id" title="var">k</span><a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">)</span></a>) <span class="id" title="tactic">by</span> <span class="id" title="var">lia</span>. <span class="id" title="tactic">eauto</span> <span class="id" title="keyword">using</span> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#closed_increment"><span class="id" title="lemma">closed_increment</span></a> <span class="id" title="keyword">with</span> <span class="id" title="var">typeclass_instances</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Conclusion.&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">j</span> ?.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">replace</span> <span class="id" title="var">j</span> <span class="id" title="keyword">with</span> (<a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">(</span></a><span class="id" title="var">j</span> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Peano.html#::nat_scope:x_'-'_x"><span class="id" title="notation">-</span></a> <span class="id" title="var">k</span><a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a> <span class="id" title="var">k</span>) <span class="id" title="tactic">by</span> <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eauto</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="comment">(*&nbsp;A&nbsp;closed&nbsp;term&nbsp;is&nbsp;invariant&nbsp;under&nbsp;lifting.&nbsp;*)</span><br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="closed_lift_invariant" class="idref" href="#closed_lift_invariant"><span class="id" title="lemma">closed_lift_invariant</span></a>:<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> `{<a id="H:449" class="idref" href="#H:449"><span class="id" title="binder">Lift</span></a> <a id="T:448" class="idref" href="#T:448"><span class="id" title="binder"><span id="H:449" class="id">T</span></span></a>},<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> { <span class="id" title="var">_</span> : <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#LiftZero"><span class="id" title="class">LiftZero</span></a> },<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> { <span class="id" title="var">_</span> : <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#LiftLift"><span class="id" title="class">LiftLift</span></a> },<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> { <span class="id" title="var">_</span> : <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#LiftLiftFuse"><span class="id" title="class">LiftLiftFuse</span></a> },<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="k:450" class="idref" href="#k:450"><span class="id" title="binder">k</span></a> <a id="t:451" class="idref" href="#t:451"><span class="id" title="binder">t</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#closed"><span class="id" title="definition">closed</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#k:450"><span class="id" title="variable">k</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#t:451"><span class="id" title="variable">t</span></a> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="j:452" class="idref" href="#j:452"><span class="id" title="binder">j</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#j:452"><span class="id" title="variable">j</span></a> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Peano.html#73030c22bc0b1fa771c65aa5414c65f9"><span class="id" title="notation">&gt;=</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#k:450"><span class="id" title="variable">k</span></a> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="w:453" class="idref" href="#w:453"><span class="id" title="binder">w</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#lift"><span class="id" title="method">lift</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#w:453"><span class="id" title="variable">w</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#j:452"><span class="id" title="variable">j</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#t:451"><span class="id" title="variable">t</span></a> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#t:451"><span class="id" title="variable">t</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">w</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Base&nbsp;case.&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" title="tactic">eauto</span> <span class="id" title="keyword">using</span> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#lift_zero"><span class="id" title="method">lift_zero</span></a>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Inductive&nbsp;case.&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" title="tactic">change</span> (<a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Datatypes.html#S"><span class="id" title="constructor">S</span></a> <span class="id" title="var">w</span>) <span class="id" title="keyword">with</span> (1 <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a> <span class="id" title="var">w</span>).<br/>
&nbsp;&nbsp;<span class="id" title="var">erewrite</span> &lt;- <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#lift_lift_fuse"><span class="id" title="method">lift_lift_fuse</span></a> <span class="id" title="tactic">by</span> (<span class="id" title="tactic">instantiate</span> (1 := <span class="id" title="var">j</span>); <span class="id" title="var">lia</span>).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">IHw</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#closed_monotonic"><span class="id" title="lemma">closed_monotonic</span></a>; <span class="id" title="tactic">eauto</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="comment">(*&nbsp;A&nbsp;closed&nbsp;term&nbsp;is&nbsp;invariant&nbsp;under&nbsp;substitution.&nbsp;*)</span><br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="closed_subst_invariant" class="idref" href="#closed_subst_invariant"><span class="id" title="lemma">closed_subst_invariant</span></a>:<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> `{<a id="H:455" class="idref" href="#H:455"><span class="id" title="binder">Lift</span></a> <a id="T:454" class="idref" href="#T:454"><span class="id" title="binder"><span id="H:455" class="id">T</span></span></a>, <a id="H0:457" class="idref" href="#H0:457"><span class="id" title="binder">Subst</span></a> <a id="V:456" class="idref" href="#V:456"><span class="id" title="binder"><span id="H0:457" class="id">V</span></span></a> <a id="H0:457" class="idref" href="#H0:457"><span class="id" title="binder">T</span></a>},<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> { <span class="id" title="var">_</span> : <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#LiftLift"><span class="id" title="class">LiftLift</span></a>},<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> { <span class="id" title="var">_</span> : <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#SubstLift"><span class="id" title="class">SubstLift</span></a>},<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="k:458" class="idref" href="#k:458"><span class="id" title="binder">k</span></a> <a id="t:459" class="idref" href="#t:459"><span class="id" title="binder">t</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#closed"><span class="id" title="definition">closed</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#k:458"><span class="id" title="variable">k</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#t:459"><span class="id" title="variable">t</span></a> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="j:460" class="idref" href="#j:460"><span class="id" title="binder">j</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#j:460"><span class="id" title="variable">j</span></a> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Peano.html#73030c22bc0b1fa771c65aa5414c65f9"><span class="id" title="notation">&gt;=</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#k:458"><span class="id" title="variable">k</span></a> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="v:461" class="idref" href="#v:461"><span class="id" title="binder">v</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#subst"><span class="id" title="method">subst</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#v:461"><span class="id" title="variable">v</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#j:460"><span class="id" title="variable">j</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#t:459"><span class="id" title="variable">t</span></a> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#t:459"><span class="id" title="variable">t</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">h</span>: <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#shift"><span class="id" title="abbreviation">shift</span></a> <span class="id" title="var">j</span> <span class="id" title="var">t</span> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <span class="id" title="var">t</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#closed_monotonic"><span class="id" title="lemma">closed_monotonic</span></a>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">h</span> <span class="id" title="tactic">at</span> 1.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#subst_lift"><span class="id" title="method">subst_lift</span></a>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="comment">(*&nbsp;A&nbsp;variable&nbsp;is&nbsp;not&nbsp;closed.&nbsp;*)</span><br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="closed_var" class="idref" href="#closed_var"><span class="id" title="lemma">closed_var</span></a>:<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="k:462" class="idref" href="#k:462"><span class="id" title="binder">k</span></a> <a id="x:463" class="idref" href="#x:463"><span class="id" title="binder">x</span></a> : <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#x:463"><span class="id" title="variable">x</span></a> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Peano.html#73030c22bc0b1fa771c65aa5414c65f9"><span class="id" title="notation">&gt;=</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#k:462"><span class="id" title="variable">k</span></a> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#closed"><span class="id" title="definition">closed</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#k:462"><span class="id" title="variable">k</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#x:463"><span class="id" title="variable">x</span></a> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#False"><span class="id" title="inductive">False</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#closed"><span class="id" title="definition">closed</span></a>. <span class="id" title="var">just_do_it</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="comment">(*&nbsp;If&nbsp;<span class="inlinecode"><span class="id" title="var">t</span></span>&nbsp;is&nbsp;<span class="inlinecode"><span class="id" title="var">k</span>-<span class="id" title="var">closed</span></span>,&nbsp;then&nbsp;<span class="inlinecode"><span class="id" title="var">shift</span></span> <span class="inlinecode">0</span> <span class="inlinecode"><span class="id" title="var">t</span></span>&nbsp;is&nbsp;<span class="inlinecode"><span class="id" title="var">k</span>+1</span>-closed.&nbsp;*)</span><br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="lift_preserves_closed" class="idref" href="#lift_preserves_closed"><span class="id" title="lemma">lift_preserves_closed</span></a>:<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> `{<a id="H:465" class="idref" href="#H:465"><span class="id" title="binder">Lift</span></a> <a id="T:464" class="idref" href="#T:464"><span class="id" title="binder"><span id="H:465" class="id">T</span></span></a>},<br/>
&nbsp;&nbsp;@<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#LiftLift"><span class="id" title="class">LiftLift</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#T:464"><span class="id" title="variable">T</span></a> <span class="id" title="var">_</span> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="k:466" class="idref" href="#k:466"><span class="id" title="binder">k</span></a> (<a id="t:467" class="idref" href="#t:467"><span class="id" title="binder">t</span></a> : <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#T:464"><span class="id" title="variable">T</span></a>),<br/>
&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#closed"><span class="id" title="definition">closed</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#k:466"><span class="id" title="variable">k</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#t:467"><span class="id" title="variable">t</span></a> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#closed"><span class="id" title="definition">closed</span></a> (<a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Datatypes.html#S"><span class="id" title="constructor">S</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#k:466"><span class="id" title="variable">k</span></a>) (<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#shift"><span class="id" title="abbreviation">shift</span></a> 0 <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#t:467"><span class="id" title="variable">t</span></a>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#closed"><span class="id" title="definition">closed</span></a>. <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">change</span> (<a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Datatypes.html#S"><span class="id" title="constructor">S</span></a> <span class="id" title="var">k</span>) <span class="id" title="keyword">with</span> (1 <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a> <span class="id" title="var">k</span>).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#lift_lift"><span class="id" title="method">lift_lift</span></a> <span class="id" title="tactic">by</span> <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">congruence</span>. <span class="comment">(*&nbsp;wow!&nbsp;*)</span><br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="comment">(*&nbsp;If&nbsp;<span class="inlinecode"><span class="id" title="var">v</span></span>&nbsp;is&nbsp;<span class="inlinecode"><span class="id" title="var">k</span></span>-closed&nbsp;and&nbsp;<span class="inlinecode"><span class="id" title="var">t</span></span>&nbsp;is&nbsp;<span class="inlinecode"><span class="id" title="var">k</span>+1</span>-closed,&nbsp;then&nbsp;<span class="inlinecode"><span class="id" title="tactic">subst</span></span> <span class="inlinecode"><span class="id" title="var">v</span></span> <span class="inlinecode">0</span> <span class="inlinecode"><span class="id" title="var">t</span></span><br/>
&nbsp;&nbsp;&nbsp;is&nbsp;<span class="inlinecode"><span class="id" title="var">k</span></span>-closed.&nbsp;*)</span><br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="subst_preserves_closed" class="idref" href="#subst_preserves_closed"><span class="id" title="lemma">subst_preserves_closed</span></a>:<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> `{<a id="H:469" class="idref" href="#H:469"><span class="id" title="binder">Lift</span></a> <a id="V:468" class="idref" href="#V:468"><span class="id" title="binder"><span id="H:469" class="id">V</span></span></a>, <a id="H0:471" class="idref" href="#H0:471"><span class="id" title="binder">Lift</span></a> <a id="T:470" class="idref" href="#T:470"><span class="id" title="binder"><span id="H0:471" class="id">T</span></span></a>, <a id="H1:472" class="idref" href="#H1:472"><span class="id" title="binder">Subst</span></a> <a id="H1:472" class="idref" href="#H1:472"><span class="id" title="binder">V</span></a> <a id="H1:472" class="idref" href="#H1:472"><span class="id" title="binder">T</span></a>},<br/>
&nbsp;&nbsp;@<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#LiftSubst2"><span class="id" title="class">LiftSubst2</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#V:468"><span class="id" title="variable">V</span></a> <span class="id" title="var">_</span> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#T:470"><span class="id" title="variable">T</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="k:473" class="idref" href="#k:473"><span class="id" title="binder">k</span></a> (<a id="v:474" class="idref" href="#v:474"><span class="id" title="binder">v</span></a> : <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#V:468"><span class="id" title="variable">V</span></a>) (<a id="t:475" class="idref" href="#t:475"><span class="id" title="binder">t</span></a> : <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#T:470"><span class="id" title="variable">T</span></a>),<br/>
&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#closed"><span class="id" title="definition">closed</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#k:473"><span class="id" title="variable">k</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#v:474"><span class="id" title="variable">v</span></a> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#closed"><span class="id" title="definition">closed</span></a> (<a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Datatypes.html#S"><span class="id" title="constructor">S</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#k:473"><span class="id" title="variable">k</span></a>) <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#t:475"><span class="id" title="variable">t</span></a> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#closed"><span class="id" title="definition">closed</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#k:473"><span class="id" title="variable">k</span></a> (<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#subst"><span class="id" title="method">subst</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#v:474"><span class="id" title="variable">v</span></a> 0 <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#t:475"><span class="id" title="variable">t</span></a>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#closed"><span class="id" title="definition">closed</span></a>. <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#lift_subst_2"><span class="id" title="method">lift_subst_2</span></a> <span class="id" title="tactic">by</span> <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">change</span> (1 <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a> <span class="id" title="var">k</span>) <span class="id" title="keyword">with</span> (<a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Datatypes.html#S"><span class="id" title="constructor">S</span></a> <span class="id" title="var">k</span>). <span class="id" title="tactic">congruence</span>. <span class="comment">(*&nbsp;wow!&nbsp;*)</span><br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="comment">(*&nbsp;The&nbsp;tactic&nbsp;<span class="inlinecode"><span class="id" title="var">fold_closed_hyps</span></span>&nbsp;looks&nbsp;for&nbsp;unfolded&nbsp;closedness&nbsp;hypotheses&nbsp;and<br/>
&nbsp;&nbsp;&nbsp;folds&nbsp;them.&nbsp;*)</span><br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="fold_closed" class="idref" href="#fold_closed"><span class="id" title="lemma">fold_closed</span></a>:<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> `{<a id="H:477" class="idref" href="#H:477"><span class="id" title="binder">Lift</span></a> <a id="T:476" class="idref" href="#T:476"><span class="id" title="binder"><span id="H:477" class="id">T</span></span></a>},<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="k:478" class="idref" href="#k:478"><span class="id" title="binder">k</span></a> <a id="t:479" class="idref" href="#t:479"><span class="id" title="binder">t</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#shift"><span class="id" title="abbreviation">shift</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#k:478"><span class="id" title="variable">k</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#t:479"><span class="id" title="variable">t</span></a> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#t:479"><span class="id" title="variable">t</span></a> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#closed"><span class="id" title="definition">closed</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#k:478"><span class="id" title="variable">k</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#t:479"><span class="id" title="variable">t</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">auto</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">fold_closed_hyps</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span> <span class="id" title="var">h</span>: <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#shift"><span class="id" title="abbreviation">shift</span></a> <span class="id" title="var">_</span> ?<span class="id" title="var">t</span> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> ?<span class="id" title="var">t</span> |- <span class="id" title="var">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">generalize</span> (<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#fold_closed"><span class="id" title="lemma">fold_closed</span></a> <span class="id" title="var">_</span> <span class="id" title="var">h</span>); <span class="id" title="tactic">clear</span> <span class="id" title="var">h</span>; <span class="id" title="tactic">intro</span> <span class="id" title="var">h</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="comment">(*&nbsp;The&nbsp;following&nbsp;tactics&nbsp;help&nbsp;invert&nbsp;(destruct)&nbsp;a&nbsp;closedness&nbsp;hypothesis.<br/>
&nbsp;&nbsp;&nbsp;<span class="inlinecode"><span class="id" title="var">inversion_closed_in</span></span> <span class="inlinecode"><span class="id" title="var">h</span></span>&nbsp;destructs&nbsp;a&nbsp;specific&nbsp;closedness&nbsp;hypothesis&nbsp;<span class="inlinecode"><span class="id" title="var">h</span></span>,<br/>
&nbsp;&nbsp;&nbsp;whereas&nbsp;<span class="inlinecode"><span class="id" title="var">inversion_closed</span></span>&nbsp;destructs&nbsp;all&nbsp;closedness&nbsp;hypotheses.&nbsp;*)</span><br/>

<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">inversion_closed_in_internal</span> <span class="id" title="var">h</span> :=<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Unfold&nbsp;the&nbsp;definition&nbsp;of&nbsp;<span class="inlinecode"><span class="id" title="var">closed</span></span>.&nbsp;This&nbsp;exposes&nbsp;<span class="inlinecode"><span class="id" title="var">lift</span></span>.&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#closed"><span class="id" title="definition">closed</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">h</span>;<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;If&nbsp;<span class="inlinecode"><span class="id" title="var">lift</span></span>&nbsp;is&nbsp;applied&nbsp;to&nbsp;a&nbsp;constructor,&nbsp;simplify&nbsp;it.&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#expand_lift"><span class="id" title="lemma">expand_lift</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">h</span>; <span class="id" title="tactic">simpl</span> (@<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#traverse"><span class="id" title="method">traverse</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>) <span class="id" title="tactic">in</span> <span class="id" title="var">h</span>; <span class="id" title="var">simpl_lift</span>;<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;This&nbsp;may&nbsp;result&nbsp;in&nbsp;an&nbsp;equality&nbsp;that&nbsp;involves&nbsp;two&nbsp;constructors.&nbsp;Decompose&nbsp;it.&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" title="tactic">try</span> (<span class="id" title="tactic">injection</span> <span class="id" title="var">h</span>; <span class="id" title="tactic">clear</span> <span class="id" title="var">h</span>; <span class="id" title="tactic">intros</span>).<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;The&nbsp;above&nbsp;line&nbsp;assumes&nbsp;that&nbsp;<span class="inlinecode"><span class="id" title="var">lift</span></span>&nbsp;is&nbsp;opaque.&nbsp;Otherwise,&nbsp;the&nbsp;following&nbsp;would<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;be&nbsp;required:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;(protects&nbsp;@lift&nbsp;do&nbsp;(injection&nbsp;h;&nbsp;clear&nbsp;h;&nbsp;intros))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;We&nbsp;make&nbsp;<span class="inlinecode"><span class="id" title="var">lift</span></span>&nbsp;opaque&nbsp;at&nbsp;the&nbsp;end&nbsp;of&nbsp;this&nbsp;file.<br/>
&nbsp;&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;At&nbsp;this&nbsp;point,&nbsp;<span class="inlinecode"><span class="id" title="var">closed</span></span>&nbsp;is&nbsp;still&nbsp;unfolded.&nbsp;This&nbsp;is&nbsp;intentional.&nbsp;*)</span><br/>

<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">inversion_closed_in</span> <span class="id" title="var">h</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="var">inversion_closed_in_internal</span> <span class="id" title="var">h</span>;<br/>
&nbsp;&nbsp;<span class="id" title="var">fold_closed_hyps</span>.<br/>

<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">inversion_closed</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span> <span class="id" title="var">h</span>: <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#closed"><span class="id" title="definition">closed</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> |- <span class="id" title="var">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">inversion_closed_in_internal</span> <span class="id" title="var">h</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>;<br/>
&nbsp;&nbsp;<span class="id" title="var">fold_closed_hyps</span>.<br/>

<br/>
<span class="comment">(*&nbsp;The&nbsp;tactic&nbsp;solves&nbsp;a&nbsp;closedness&nbsp;goal&nbsp;by&nbsp;using&nbsp;whatever&nbsp;closedness<br/>
&nbsp;&nbsp;&nbsp;hypotheses&nbsp;are&nbsp;available.&nbsp;*)</span><br/>

<br/>
<span class="id" title="keyword">Hint Extern</span> 1 =&gt; <span class="id" title="tactic">f_equal</span> : <span class="id" title="var">construction_closed</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;more&nbsp;hints&nbsp;to&nbsp;be&nbsp;added&nbsp;later&nbsp;on&nbsp;into&nbsp;this&nbsp;database&nbsp;*)</span><br/>

<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">construction_closed</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="tactic">solve</span> [<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;Expose&nbsp;the&nbsp;definition&nbsp;of&nbsp;<span class="inlinecode"><span class="id" title="var">closed</span></span>&nbsp;in&nbsp;terms&nbsp;of&nbsp;<span class="inlinecode"><span class="id" title="var">lift</span></span>.&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#closed"><span class="id" title="definition">closed</span></a> <span class="id" title="tactic">in</span> *;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;Presumably&nbsp;<span class="inlinecode"><span class="id" title="var">lift</span></span>&nbsp;is&nbsp;applied&nbsp;to&nbsp;a&nbsp;constructor&nbsp;in&nbsp;the&nbsp;goal.&nbsp;Simplify&nbsp;it.&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">simpl_lift_goal</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;If&nbsp;we&nbsp;are&nbsp;looking&nbsp;at&nbsp;a&nbsp;variable,&nbsp;the&nbsp;equation&nbsp;should&nbsp;look&nbsp;like&nbsp;this:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="inlinecode"><span class="id" title="var">var</span></span> <span class="inlinecode">(<span class="id" title="var">shift</span></span> <span class="inlinecode"><span class="id" title="var">k</span></span> <span class="inlinecode"><span class="id" title="var">x</span>)</span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">var</span></span> <span class="inlinecode"><span class="id" title="var">x</span></span>.&nbsp;Simplify&nbsp;<span class="inlinecode"><span class="id" title="var">var</span></span>&nbsp;away,&nbsp;and&nbsp;apply&nbsp;the&nbsp;tactic<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="inlinecode"><span class="id" title="var">lift_idx</span></span>&nbsp;to&nbsp;simplify&nbsp;<span class="inlinecode"><span class="id" title="var">shift</span></span>&nbsp;away.&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> (<span class="id" title="tactic">simpl</span>; <span class="id" title="var">lift_idx</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;Conclude.&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eauto</span> <span class="id" title="keyword">with</span> <span class="id" title="var">lia</span> <span class="id" title="var">construction_closed</span><br/>
&nbsp;&nbsp;].<br/>

<br/>
<span class="comment">(*&nbsp;The&nbsp;following&nbsp;hint&nbsp;proves&nbsp;a&nbsp;goal&nbsp;of&nbsp;the&nbsp;form&nbsp;<span class="inlinecode"><span class="id" title="var">shift</span></span> <span class="inlinecode"><span class="id" title="var">x</span></span> <span class="inlinecode"><span class="id" title="var">v</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">v</span></span>&nbsp;when<br/>
&nbsp;&nbsp;&nbsp;the&nbsp;value&nbsp;<span class="inlinecode"><span class="id" title="var">v</span></span>&nbsp;is&nbsp;<span class="inlinecode"><span class="id" title="var">k</span></span>-closed&nbsp;for&nbsp;some&nbsp;<span class="inlinecode"><span class="id" title="var">k</span></span>&nbsp;that&nbsp;is&nbsp;less&nbsp;than&nbsp;or&nbsp;equal<br/>
&nbsp;&nbsp;&nbsp;to&nbsp;<span class="inlinecode"><span class="id" title="var">x</span></span>.&nbsp;*)</span><br/>

<br/>
<span class="id" title="keyword">Hint Extern</span> 1 (<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#shift"><span class="id" title="abbreviation">shift</span></a> ?<span class="id" title="var">x</span> ?<span class="id" title="var">v</span> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> ?<span class="id" title="var">v</span>) =&gt;<br/>
&nbsp;&nbsp;<span class="id" title="tactic">solve</span> [<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#closed_monotonic"><span class="id" title="lemma">closed_monotonic</span></a>; [<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eauto</span> <span class="id" title="keyword">with</span> <span class="id" title="var">typeclass_instances</span> <span class="comment">(*&nbsp;LiftLift&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">construction_closed</span> <span class="comment">(*&nbsp;<span class="inlinecode"><span class="id" title="var">v</span></span>&nbsp;is&nbsp;<span class="inlinecode"><span class="id" title="var">k</span></span>-closed&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">lia</span> <span class="comment">(*&nbsp;<span class="inlinecode"><span class="id" title="var">k</span></span> <span class="inlinecode">&lt;=</span> <span class="inlinecode"><span class="id" title="var">x</span></span>&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;]<br/>
&nbsp;&nbsp;]<br/>
: <span class="id" title="var">shift_closed</span>.<br/>

<br/>
<span class="comment">(*&nbsp;The&nbsp;following&nbsp;tactic&nbsp;replaces&nbsp;<span class="inlinecode"><span class="id" title="var">shift</span></span> <span class="inlinecode"><span class="id" title="var">x</span></span> <span class="inlinecode"><span class="id" title="var">v</span></span>&nbsp;with&nbsp;<span class="inlinecode"><span class="id" title="var">v</span></span>&nbsp;in&nbsp;the&nbsp;goal<br/>
&nbsp;&nbsp;&nbsp;when&nbsp;an&nbsp;explicit&nbsp;hypothesis&nbsp;states&nbsp;that&nbsp;<span class="inlinecode"><span class="id" title="var">v</span></span>&nbsp;is&nbsp;closed.&nbsp;*)</span><br/>

<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">shift_closed</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span> <span class="id" title="var">h</span>: <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#closed"><span class="id" title="definition">closed</span></a> ?<span class="id" title="var">x</span> ?<span class="id" title="var">v</span> |- <span class="id" title="keyword">context</span>[<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#shift"><span class="id" title="abbreviation">shift</span></a> ?<span class="id" title="var">x</span> ?<span class="id" title="var">v</span>] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">replace</span> (<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#shift"><span class="id" title="abbreviation">shift</span></a> <span class="id" title="var">x</span> <span class="id" title="var">v</span>) <span class="id" title="keyword">with</span> <span class="id" title="var">v</span> <span class="comment">(*&nbsp;no&nbsp;subgoals&nbsp;are&nbsp;generated;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;apparently&nbsp;the&nbsp;hypothesis&nbsp;<span class="inlinecode"><span class="id" title="var">h</span></span>&nbsp;allows&nbsp;Coq&nbsp;to&nbsp;recognize<br/>
&nbsp;&nbsp;&nbsp;&nbsp;that&nbsp;these&nbsp;terms&nbsp;are&nbsp;equal&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="comment">(*&nbsp;The&nbsp;following&nbsp;hint&nbsp;proves&nbsp;a&nbsp;goal&nbsp;of&nbsp;the&nbsp;form&nbsp;<span class="inlinecode"><span class="id" title="tactic">subst</span></span> <span class="inlinecode"><span class="id" title="var">w</span></span> <span class="inlinecode"><span class="id" title="var">x</span></span> <span class="inlinecode"><span class="id" title="var">v</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">v</span></span>&nbsp;when<br/>
&nbsp;&nbsp;&nbsp;the&nbsp;value&nbsp;<span class="inlinecode"><span class="id" title="var">v</span></span>&nbsp;is&nbsp;<span class="inlinecode"><span class="id" title="var">k</span></span>-closed&nbsp;for&nbsp;some&nbsp;<span class="inlinecode"><span class="id" title="var">k</span></span>&nbsp;that&nbsp;is&nbsp;less&nbsp;than&nbsp;or&nbsp;equal<br/>
&nbsp;&nbsp;&nbsp;to&nbsp;<span class="inlinecode"><span class="id" title="var">x</span></span>.&nbsp;*)</span><br/>

<br/>
<span class="id" title="keyword">Hint Extern</span> 1 (<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#subst"><span class="id" title="method">subst</span></a> ?<span class="id" title="var">w</span> ?<span class="id" title="var">x</span> ?<span class="id" title="var">v</span> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> ?<span class="id" title="var">v</span>) =&gt;<br/>
&nbsp;&nbsp;<span class="id" title="tactic">solve</span> [<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#closed_subst_invariant"><span class="id" title="lemma">closed_subst_invariant</span></a>; [<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eauto</span> <span class="id" title="keyword">with</span> <span class="id" title="var">typeclass_instances</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="tactic">eauto</span> <span class="id" title="keyword">with</span> <span class="id" title="var">typeclass_instances</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">construction_closed</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">lia</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;]<br/>
&nbsp;&nbsp;]<br/>
: <span class="id" title="var">subst_closed</span>.<br/>

<br/>
<span class="comment">(*&nbsp;------------------------------------------------------------------------------&nbsp;*)</span><br/>

<br/>
<span class="comment">(*&nbsp;A&nbsp;few&nbsp;properties&nbsp;of&nbsp;the&nbsp;function&nbsp;<span class="inlinecode"><span class="id" title="var">rotate</span></span>.&nbsp;*)</span><br/>

<br/>
<span class="comment">(*&nbsp;This&nbsp;lemma&nbsp;ensures&nbsp;that&nbsp;we&nbsp;got&nbsp;the&nbsp;definition&nbsp;right.&nbsp;It&nbsp;is&nbsp;otherwise&nbsp;unused.&nbsp;*)</span><br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="rotate_characterization" class="idref" href="#rotate_characterization"><span class="id" title="lemma">rotate_characterization</span></a>:<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="n:480" class="idref" href="#n:480"><span class="id" title="binder">n</span></a> <a id="k:481" class="idref" href="#k:481"><span class="id" title="binder">k</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">(</span></a><a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#k:481"><span class="id" title="variable">k</span></a> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> 0 <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#rotate"><span class="id" title="definition">rotate</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#n:480"><span class="id" title="variable">n</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#k:481"><span class="id" title="variable">k</span></a> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#n:480"><span class="id" title="variable">n</span></a><a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">(</span></a><a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#k:481"><span class="id" title="variable">k</span></a> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Peano.html#::nat_scope:x_'&gt;'_x"><span class="id" title="notation">&gt;</span></a> 0 <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#k:481"><span class="id" title="variable">k</span></a> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Peano.html#cb53cf0ee22c036a03b4a9281c68b5a3"><span class="id" title="notation">&lt;=</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#n:480"><span class="id" title="variable">n</span></a> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#rotate"><span class="id" title="definition">rotate</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#n:480"><span class="id" title="variable">n</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#k:481"><span class="id" title="variable">k</span></a> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#k:481"><span class="id" title="variable">k</span></a> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Peano.html#::nat_scope:x_'-'_x"><span class="id" title="notation">-</span></a> 1<a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">(</span></a><a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#k:481"><span class="id" title="variable">k</span></a> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Peano.html#::nat_scope:x_'&gt;'_x"><span class="id" title="notation">&gt;</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#n:480"><span class="id" title="variable">n</span></a> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#rotate"><span class="id" title="definition">rotate</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#n:480"><span class="id" title="variable">n</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#k:481"><span class="id" title="variable">k</span></a> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#k:481"><span class="id" title="variable">k</span></a><a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">)</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>; <span class="id" title="tactic">repeat</span> <span class="id" title="tactic">split</span>; <span class="id" title="tactic">intros</span>; <span class="id" title="tactic">unfold</span> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#rotate"><span class="id" title="definition">rotate</span></a>; <span class="id" title="var">just_do_it</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Instance</span> <a id="Rotate1SelfInverse_Algebraic" class="idref" href="#Rotate1SelfInverse_Algebraic"><span class="id" title="instance">Rotate1SelfInverse_Algebraic</span></a>:<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> `{<a id="H:483" class="idref" href="#H:483"><span class="id" title="binder">Var</span></a> <a id="V:482" class="idref" href="#V:482"><span class="id" title="binder"><span id="H:483" class="id">V</span></span></a>, <a id="H0:484" class="idref" href="#H0:484"><span class="id" title="binder">Lift</span></a> <a id="H0:484" class="idref" href="#H0:484"><span class="id" title="binder">V</span></a>, <a id="H1:486" class="idref" href="#H1:486"><span class="id" title="binder">Lift</span></a> <a id="T:485" class="idref" href="#T:485"><span class="id" title="binder"><span id="H1:486" class="id">T</span></span></a>, <a id="H2:487" class="idref" href="#H2:487"><span class="id" title="binder">Subst</span></a> <a id="H2:487" class="idref" href="#H2:487"><span class="id" title="binder">V</span></a> <a id="H2:487" class="idref" href="#H2:487"><span class="id" title="binder">V</span></a>, <a id="H3:488" class="idref" href="#H3:488"><span class="id" title="binder">Subst</span></a> <a id="H3:488" class="idref" href="#H3:488"><span class="id" title="binder">V</span></a> <a id="H3:488" class="idref" href="#H3:488"><span class="id" title="binder">T</span></a>},<br/>
&nbsp;&nbsp;@<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#LiftVar"><span class="id" title="class">LiftVar</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#V:482"><span class="id" title="variable">V</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;@<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#SubstVar"><span class="id" title="class">SubstVar</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#V:482"><span class="id" title="variable">V</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;@<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#LiftLift"><span class="id" title="class">LiftLift</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#T:485"><span class="id" title="variable">T</span></a> <span class="id" title="var">_</span> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;@<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#LiftSubst2"><span class="id" title="class">LiftSubst2</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#V:482"><span class="id" title="variable">V</span></a> <span class="id" title="var">_</span> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#T:485"><span class="id" title="variable">T</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;@<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#SubstSubst"><span class="id" title="class">SubstSubst</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#V:482"><span class="id" title="variable">V</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#T:485"><span class="id" title="variable">T</span></a> <span class="id" title="var">_</span> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;@<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#Pun2"><span class="id" title="class">Pun2</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#V:482"><span class="id" title="variable">V</span></a> <span class="id" title="var">_</span> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#T:485"><span class="id" title="variable">T</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;@<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#Rotate1SelfInverse"><span class="id" title="class">Rotate1SelfInverse</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#V:482"><span class="id" title="variable">V</span></a> <span class="id" title="var">_</span> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#T:485"><span class="id" title="variable">T</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">constructor</span>. <span class="id" title="tactic">intro</span>. <span class="id" title="tactic">unfold</span> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#rotate"><span class="id" title="definition">rotate</span></a>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;We&nbsp;are&nbsp;looking&nbsp;at&nbsp;a&nbsp;subst-lift-subst-lift&nbsp;composition.&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Permute&nbsp;the&nbsp;central&nbsp;lift/subst&nbsp;pair,&nbsp;to&nbsp;obtain&nbsp;subst-subst-lift-lift.&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#lift_subst_2"><span class="id" title="method">lift_subst_2</span></a> <span class="id" title="tactic">by</span> <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Permute&nbsp;the&nbsp;two&nbsp;lifts.&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#lift_lift"><span class="id" title="method">lift_lift</span></a> <span class="id" title="tactic">by</span> <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Simplify.&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#lift_var"><span class="id" title="method">lift_var</span></a>. <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Permute&nbsp;the&nbsp;two&nbsp;substs.&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#subst_subst"><span class="id" title="method">subst_subst</span></a> <span class="id" title="tactic">by</span> <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#subst_var"><span class="id" title="method">subst_var</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#lift_var"><span class="id" title="method">lift_var</span></a>. <span class="id" title="var">subst_idx</span>. <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;De-simplify&nbsp;to&nbsp;prepare&nbsp;the&nbsp;next&nbsp;rewriting&nbsp;step.&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" title="tactic">replace</span> (@<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#var"><span class="id" title="method">var</span></a> <span class="id" title="var">V</span> <span class="id" title="var">_</span> 2) <span class="id" title="keyword">with</span> (<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#shift"><span class="id" title="abbreviation">shift</span></a> 1 (@<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#var"><span class="id" title="method">var</span></a> <span class="id" title="var">V</span> <span class="id" title="var">_</span> 1)) <span class="id" title="tactic">by</span> (<span class="id" title="tactic">rewrite</span> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#lift_var"><span class="id" title="method">lift_var</span></a>; <span class="id" title="tactic">auto</span>).<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Permute&nbsp;the&nbsp;central&nbsp;subst-lift.&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#lift_subst_2"><span class="id" title="method">lift_subst_2</span></a> <span class="id" title="tactic">by</span> <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Identify&nbsp;two&nbsp;puns,&nbsp;and&nbsp;we&nbsp;are&nbsp;done.&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#pun_2"><span class="id" title="method">pun_2</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#pun_2"><span class="id" title="method">pun_2</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;In&nbsp;summary,&nbsp;we&nbsp;have&nbsp;done&nbsp;this:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;substA-liftA-substB-liftB<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;substA-substB-liftA-liftB<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;substB-substA-liftB-liftA<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;substB-liftB-substA-liftA<br/>
&nbsp;&nbsp;*)</span><br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="comment">(*&nbsp;The&nbsp;above&nbsp;algebraic&nbsp;proof&nbsp;was&nbsp;admittedly&nbsp;quite&nbsp;tricky&nbsp;and&nbsp;obscure.&nbsp;Perhaps<br/>
&nbsp;&nbsp;&nbsp;one&nbsp;could&nbsp;come&nbsp;up&nbsp;with&nbsp;a&nbsp;simpler&nbsp;approach.&nbsp;If&nbsp;we&nbsp;are&nbsp;willing&nbsp;to&nbsp;give&nbsp;up&nbsp;a<br/>
&nbsp;&nbsp;&nbsp;tiny&nbsp;bit&nbsp;of&nbsp;generality&nbsp;and&nbsp;assume&nbsp;that&nbsp;<span class="inlinecode"><span class="id" title="var">lift</span></span>&nbsp;and&nbsp;<span class="inlinecode"><span class="id" title="tactic">subst</span></span>&nbsp;arise&nbsp;out&nbsp;of<br/>
&nbsp;&nbsp;&nbsp;<span class="inlinecode"><span class="id" title="var">traverse</span></span>,&nbsp;then&nbsp;we&nbsp;can&nbsp;give&nbsp;a&nbsp;simple&nbsp;proof,&nbsp;as&nbsp;usual,&nbsp;by&nbsp;going&nbsp;down&nbsp;to&nbsp;the<br/>
&nbsp;&nbsp;&nbsp;leaves&nbsp;and&nbsp;using&nbsp;<span class="inlinecode"><span class="id" title="var">just_do_it</span></span>&nbsp;there.&nbsp;I&nbsp;have&nbsp;done&nbsp;this&nbsp;proof,&nbsp;so&nbsp;here&nbsp;it&nbsp;is,<br/>
&nbsp;&nbsp;&nbsp;for&nbsp;the&nbsp;record.&nbsp;*)</span><br/>

<br/>
<span class="id" title="keyword">Instance</span> <a id="Rotate1SelfInverse_Traverse" class="idref" href="#Rotate1SelfInverse_Traverse"><span class="id" title="instance">Rotate1SelfInverse_Traverse</span></a>:<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> `{<a id="H:490" class="idref" href="#H:490"><span class="id" title="binder">Var</span></a> <a id="V:489" class="idref" href="#V:489"><span class="id" title="binder"><span id="H:490" class="id">V</span></span></a>, <a id="H0:491" class="idref" href="#H0:491"><span class="id" title="binder">Traverse</span></a> <a id="H0:491" class="idref" href="#H0:491"><span class="id" title="binder">V</span></a> <a id="H0:491" class="idref" href="#H0:491"><span class="id" title="binder">V</span></a>, <a id="H1:493" class="idref" href="#H1:493"><span class="id" title="binder">Traverse</span></a> <a id="H1:493" class="idref" href="#H1:493"><span class="id" title="binder">V</span></a> <a id="T:492" class="idref" href="#T:492"><span class="id" title="binder"><span id="H1:493" class="id">T</span></span></a>},<br/>
&nbsp;&nbsp;@<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#TraverseVarIsIdentity"><span class="id" title="class">TraverseVarIsIdentity</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#V:489"><span class="id" title="variable">V</span></a> <span class="id" title="var">_</span> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#T:492"><span class="id" title="variable">T</span></a> <span class="id" title="var">_</span> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;@<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#TraverseIdentifiesVar"><span class="id" title="class">TraverseIdentifiesVar</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#V:489"><span class="id" title="variable">V</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;@<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#TraverseFunctorial"><span class="id" title="class">TraverseFunctorial</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#V:489"><span class="id" title="variable">V</span></a> <span class="id" title="var">_</span> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#T:492"><span class="id" title="variable">T</span></a> <span class="id" title="var">_</span> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;@<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#Rotate1SelfInverse"><span class="id" title="class">Rotate1SelfInverse</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#V:489"><span class="id" title="variable">V</span></a> <span class="id" title="var">_</span> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#T:492"><span class="id" title="variable">T</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">constructor</span>. <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#rotate"><span class="id" title="definition">rotate</span></a>, <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#subst"><span class="id" title="method">subst</span></a>, <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#lift"><span class="id" title="method">lift</span></a>, <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#Subst_Traverse"><span class="id" title="instance">Subst_Traverse</span></a>, <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#Lift_Traverse"><span class="id" title="instance">Lift_Traverse</span></a>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Go&nbsp;down&nbsp;to&nbsp;the&nbsp;leaves.&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" title="tactic">do</span> 3 <span class="id" title="tactic">rewrite</span> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#traverse_functorial"><span class="id" title="method">traverse_functorial</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#traverse_var_is_identity"><span class="id" title="method">traverse_var_is_identity</span></a>. <span class="id" title="tactic">intros</span> <span class="id" title="var">l</span> <span class="id" title="var">x</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#traverse_identifies_var"><span class="id" title="method">traverse_identifies_var</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#lift_var"><span class="id" title="method">lift_var</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#subst_idx_var"><span class="id" title="lemma">subst_idx_var</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">do</span> 2 <span class="id" title="tactic">rewrite</span> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#traverse_identifies_var"><span class="id" title="method">traverse_identifies_var</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#lift_var"><span class="id" title="method">lift_var</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#subst_idx_var"><span class="id" title="lemma">subst_idx_var</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">f_equal</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;The&nbsp;goal&nbsp;boils&nbsp;down&nbsp;to&nbsp;proving&nbsp;that&nbsp;a&nbsp;generalized&nbsp;version&nbsp;of<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="inlinecode"><span class="id" title="var">rotate</span></span> <span class="inlinecode">1</span>,&nbsp;which&nbsp;exchanges&nbsp;<span class="inlinecode"><span class="id" title="var">l</span></span>&nbsp;and&nbsp;<span class="inlinecode"><span class="id" title="var">l</span>+1</span>,&nbsp;is&nbsp;its&nbsp;own&nbsp;inverse.&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" title="var">just_do_it</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="comment">(*&nbsp;------------------------------------------------------------------------------&nbsp;*)</span><br/>

<br/>
<span class="comment">(*&nbsp;These&nbsp;tactics&nbsp;are&nbsp;supposed&nbsp;to&nbsp;help&nbsp;the&nbsp;user&nbsp;prove&nbsp;properties&nbsp;of&nbsp;her<br/>
&nbsp;&nbsp;&nbsp;custom&nbsp;<span class="inlinecode"><span class="id" title="var">traverse</span></span>&nbsp;functions.&nbsp;They&nbsp;should&nbsp;work&nbsp;out&nbsp;of&nbsp;the&nbsp;box.&nbsp;*)</span><br/>

<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">prove_traverse_identifies_var</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="tactic">reflexivity</span>.<br/>

<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">prove_traverse_var_injective</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">t1</span> := <span class="id" title="tactic">fresh</span> "t1" <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> ? ? <span class="id" title="var">t1</span>; <span class="id" title="tactic">induction</span> <span class="id" title="var">t1</span>;<br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">t2</span> := <span class="id" title="tactic">fresh</span> "t2" <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<span class="id" title="tactic">intro</span> <span class="id" title="var">t2</span>; <span class="id" title="tactic">destruct</span> <span class="id" title="var">t2</span>; <span class="id" title="tactic">simpl</span>;<br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">h</span> := <span class="id" title="tactic">fresh</span> "h" <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> ? <span class="id" title="var">h</span>; <span class="id" title="tactic">inversion</span> <span class="id" title="var">h</span>;<br/>
&nbsp;&nbsp;<span class="id" title="tactic">f_equal</span>;<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eauto</span> <span class="id" title="keyword">using</span> @<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#traverse_var_injective"><span class="id" title="method">traverse_var_injective</span></a> <span class="id" title="keyword">with</span> <span class="id" title="var">typeclass_instances</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;The&nbsp;lemma&nbsp;<span class="inlinecode"><span class="id" title="var">traverse_var_injective</span></span>&nbsp;can&nbsp;be&nbsp;useful&nbsp;if&nbsp;the&nbsp;<span class="inlinecode"><span class="id" title="var">traverse</span></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;function&nbsp;at&nbsp;hand&nbsp;calls&nbsp;another&nbsp;<span class="inlinecode"><span class="id" title="var">traverse</span></span>&nbsp;function&nbsp;which&nbsp;has&nbsp;already<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;been&nbsp;proved&nbsp;injective.&nbsp;*)</span><br/>

<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">prove_traverse_functorial</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">t</span> := <span class="id" title="tactic">fresh</span> "t" <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> ? ? <span class="id" title="var">t</span>; <span class="id" title="tactic">induction</span> <span class="id" title="var">t</span>; <span class="id" title="tactic">intros</span>; <span class="id" title="tactic">simpl</span>;<br/>
&nbsp;&nbsp;<span class="id" title="tactic">f_equal</span>; <span class="id" title="tactic">eauto</span> <span class="id" title="keyword">using</span> @<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#traverse_functorial"><span class="id" title="method">traverse_functorial</span></a> <span class="id" title="keyword">with</span> <span class="id" title="var">typeclass_instances</span>.<br/>

<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">prove_traverse_relative</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">t</span> := <span class="id" title="tactic">fresh</span> "t" <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> ? ? ? <span class="id" title="var">t</span>; <span class="id" title="tactic">induction</span> <span class="id" title="var">t</span>; <span class="id" title="tactic">intros</span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">simpl</span>;<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eauto</span> <span class="id" title="keyword">using</span> @<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#traverse_relative"><span class="id" title="method">traverse_relative</span></a> <span class="id" title="keyword">with</span> <span class="id" title="tactic">f_equal</span> <span class="id" title="var">lia</span> <span class="id" title="var">typeclass_instances</span>.<br/>

<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">prove_traverse_var_is_identity</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> ? ? <span class="id" title="var">t</span>; <span class="id" title="tactic">induction</span> <span class="id" title="var">t</span>; <span class="id" title="tactic">intros</span>; <span class="id" title="tactic">simpl</span>;<br/>
&nbsp;&nbsp;<span class="id" title="tactic">f_equal</span>; <span class="id" title="tactic">eauto</span> <span class="id" title="keyword">using</span> @<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#traverse_var_is_identity"><span class="id" title="method">traverse_var_is_identity</span></a> <span class="id" title="keyword">with</span> <span class="id" title="var">typeclass_instances</span>.<br/>

<br/>
<span class="comment">(*&nbsp;------------------------------------------------------------------------------&nbsp;*)</span><br/>

<br/>
<span class="comment">(*&nbsp;The&nbsp;following&nbsp;hint&nbsp;databases&nbsp;help&nbsp;<span class="inlinecode"><span class="id" title="tactic">eauto</span></span>&nbsp;solve&nbsp;equality&nbsp;goals&nbsp;that&nbsp;involve<br/>
&nbsp;&nbsp;&nbsp;the&nbsp;above&nbsp;laws.&nbsp;They&nbsp;can&nbsp;be&nbsp;very&nbsp;useful&nbsp;provided&nbsp;one&nbsp;takes&nbsp;care&nbsp;to&nbsp;organize<br/>
&nbsp;&nbsp;&nbsp;one's&nbsp;proof&nbsp;in&nbsp;such&nbsp;a&nbsp;way&nbsp;that&nbsp;these&nbsp;equality&nbsp;goals&nbsp;appear.&nbsp;This&nbsp;is&nbsp;usually<br/>
&nbsp;&nbsp;&nbsp;done&nbsp;by&nbsp;letting&nbsp;explicit&nbsp;equality&nbsp;hypotheses&nbsp;appear&nbsp;in&nbsp;the&nbsp;statement&nbsp;that<br/>
&nbsp;&nbsp;&nbsp;one&nbsp;is&nbsp;trying&nbsp;to&nbsp;establish&nbsp;by&nbsp;induction.&nbsp;*)</span><br/>

<br/>
<span class="comment">(*&nbsp;Using&nbsp;<span class="inlinecode"><span class="id" title="tactic">reflexivity</span></span>&nbsp;just&nbsp;after&nbsp;a&nbsp;<span class="inlinecode"><span class="id" title="tactic">rewrite</span></span>&nbsp;is&nbsp;often&nbsp;successful,&nbsp;and&nbsp;should<br/>
&nbsp;&nbsp;&nbsp;prevent&nbsp;<span class="inlinecode"><span class="id" title="tactic">eauto</span></span>&nbsp;from&nbsp;erring&nbsp;too&nbsp;far&nbsp;away.&nbsp;However,&nbsp;sometimes,&nbsp;this&nbsp;is&nbsp;too<br/>
&nbsp;&nbsp;&nbsp;restrictive:&nbsp;for&nbsp;instance,&nbsp;multiple&nbsp;successive&nbsp;rewrites&nbsp;may&nbsp;be&nbsp;required.<br/>
&nbsp;&nbsp;&nbsp;Thus,&nbsp;we&nbsp;also&nbsp;use&nbsp;hints&nbsp;that&nbsp;involve&nbsp;just&nbsp;a&nbsp;<span class="inlinecode"><span class="id" title="tactic">rewrite</span></span>;&nbsp;this&nbsp;allows&nbsp;<span class="inlinecode"><span class="id" title="tactic">eauto</span></span><br/>
&nbsp;&nbsp;&nbsp;to&nbsp;continue&nbsp;searching.&nbsp;*)</span><br/>

<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">lift_lift_hint</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="tactic">first</span> [<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#lift_lift"><span class="id" title="method">lift_lift</span></a> <span class="id" title="tactic">by</span> <span class="id" title="var">lia</span>; <span class="id" title="tactic">reflexivity</span><br/>
&nbsp;&nbsp;| <span class="id" title="tactic">rewrite</span> &lt;- <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#lift_lift"><span class="id" title="method">lift_lift</span></a> <span class="id" title="tactic">by</span> <span class="id" title="var">lia</span>; <span class="id" title="tactic">reflexivity</span><br/>
&nbsp;&nbsp;| <span class="id" title="tactic">rewrite</span> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#lift_lift"><span class="id" title="method">lift_lift</span></a> <span class="id" title="tactic">by</span> <span class="id" title="var">lia</span><br/>
&nbsp;&nbsp;| <span class="id" title="tactic">rewrite</span> &lt;- <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#lift_lift"><span class="id" title="method">lift_lift</span></a> <span class="id" title="tactic">by</span> <span class="id" title="var">lia</span><br/>
&nbsp;&nbsp;].<br/>

<br/>
<span class="id" title="keyword">Hint Extern</span> 1 (<span class="id" title="var">_</span> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#lift"><span class="id" title="method">lift</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> (<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#lift"><span class="id" title="method">lift</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>)) =&gt; <span class="id" title="var">lift_lift_hint</span> : <span class="id" title="var">lift_lift</span>.<br/>
<span class="id" title="keyword">Hint Extern</span> 1 (<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#lift"><span class="id" title="method">lift</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> (<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#lift"><span class="id" title="method">lift</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>) <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <span class="id" title="var">_</span>) =&gt; <span class="id" title="var">lift_lift_hint</span> : <span class="id" title="var">lift_lift</span>.<br/>

<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">subst_lift_hint</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="tactic">first</span> [<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#subst_lift"><span class="id" title="method">subst_lift</span></a>; <span class="id" title="tactic">reflexivity</span><br/>
&nbsp;&nbsp;| <span class="id" title="tactic">rewrite</span> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#subst_lift"><span class="id" title="method">subst_lift</span></a><br/>
&nbsp;&nbsp;].<br/>

<br/>
<span class="id" title="keyword">Hint Extern</span> 1 (<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#subst"><span class="id" title="method">subst</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> (<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#lift"><span class="id" title="method">lift</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>) <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <span class="id" title="var">_</span>) =&gt; <span class="id" title="var">subst_lift_hint</span> : <span class="id" title="var">subst_lift</span>.<br/>
<span class="id" title="keyword">Hint Extern</span> 1 (<span class="id" title="var">_</span> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#subst"><span class="id" title="method">subst</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> (<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#lift"><span class="id" title="method">lift</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>)) =&gt; <span class="id" title="var">subst_lift_hint</span> : <span class="id" title="var">subst_lift</span>.<br/>
<span class="id" title="keyword">Hint Extern</span> 1 (<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#subst"><span class="id" title="method">subst</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <span class="id" title="var">_</span>) =&gt; <span class="id" title="var">subst_lift_hint</span> : <span class="id" title="var">subst_lift</span>.<br/>
<span class="id" title="keyword">Hint Extern</span> 1 (<span class="id" title="var">_</span> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#subst"><span class="id" title="method">subst</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>) =&gt; <span class="id" title="var">subst_lift_hint</span> : <span class="id" title="var">subst_lift</span>.<br/>

<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">lift_subst_hint</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="tactic">first</span> [<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#lift_subst_1"><span class="id" title="method">lift_subst_1</span></a> <span class="id" title="tactic">by</span> <span class="id" title="var">lia</span>; <span class="id" title="tactic">reflexivity</span><br/>
&nbsp;&nbsp;| <span class="id" title="tactic">rewrite</span> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#lift_subst_2"><span class="id" title="method">lift_subst_2</span></a> <span class="id" title="tactic">by</span> <span class="id" title="var">lia</span>; <span class="id" title="tactic">reflexivity</span><br/>
&nbsp;&nbsp;| <span class="id" title="tactic">rewrite</span> &lt;- <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#lift_subst_1"><span class="id" title="method">lift_subst_1</span></a> <span class="id" title="tactic">by</span> <span class="id" title="var">lia</span>; <span class="id" title="tactic">reflexivity</span><br/>
&nbsp;&nbsp;| <span class="id" title="tactic">rewrite</span> &lt;- <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#lift_subst_2"><span class="id" title="method">lift_subst_2</span></a> <span class="id" title="tactic">by</span> <span class="id" title="var">lia</span>; <span class="id" title="tactic">reflexivity</span><br/>
&nbsp;&nbsp;| <span class="id" title="tactic">rewrite</span> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#lift_subst_1"><span class="id" title="method">lift_subst_1</span></a> <span class="id" title="tactic">by</span> <span class="id" title="var">lia</span><br/>
&nbsp;&nbsp;| <span class="id" title="tactic">rewrite</span> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#lift_subst_2"><span class="id" title="method">lift_subst_2</span></a> <span class="id" title="tactic">by</span> <span class="id" title="var">lia</span><br/>
&nbsp;&nbsp;| <span class="id" title="tactic">rewrite</span> &lt;- <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#lift_subst_1"><span class="id" title="method">lift_subst_1</span></a> <span class="id" title="tactic">by</span> <span class="id" title="var">lia</span><br/>
&nbsp;&nbsp;| <span class="id" title="tactic">rewrite</span> &lt;- <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#lift_subst_2"><span class="id" title="method">lift_subst_2</span></a> <span class="id" title="tactic">by</span> <span class="id" title="var">lia</span><br/>
&nbsp;&nbsp;].<br/>

<br/>
<span class="id" title="keyword">Hint Extern</span> 1 (<span class="id" title="var">_</span> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#lift"><span class="id" title="method">lift</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> (<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#subst"><span class="id" title="method">subst</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>)) =&gt; <span class="id" title="var">lift_subst_hint</span> : <span class="id" title="var">lift_subst</span>.<br/>
<span class="id" title="keyword">Hint Extern</span> 1 (<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#lift"><span class="id" title="method">lift</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> (<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#subst"><span class="id" title="method">subst</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>) <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <span class="id" title="var">_</span>) =&gt; <span class="id" title="var">lift_subst_hint</span> : <span class="id" title="var">lift_subst</span>.<br/>

<br/>
<span class="id" title="keyword">Hint Extern</span> 1 (<span class="id" title="var">_</span> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#lift"><span class="id" title="method">lift</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> (<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#lift"><span class="id" title="method">lift</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> (<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#subst"><span class="id" title="method">subst</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>))) =&gt; <span class="id" title="tactic">do</span> 2 <span class="id" title="var">lift_subst_hint</span> : <span class="id" title="var">lift_subst</span>.<br/>
<span class="id" title="keyword">Hint Extern</span> 1 (<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#lift"><span class="id" title="method">lift</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> (<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#lift"><span class="id" title="method">lift</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> (<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#subst"><span class="id" title="method">subst</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>)) <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <span class="id" title="var">_</span>) =&gt; <span class="id" title="tactic">do</span> 2 <span class="id" title="var">lift_subst_hint</span> : <span class="id" title="var">lift_subst</span>.<br/>

<br/>
<span class="id" title="keyword">Hint Extern</span> 1<br/>
&nbsp;&nbsp;(<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#lift"><span class="id" title="method">lift</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#subst"><span class="id" title="method">subst</span></a> (<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#lift"><span class="id" title="method">lift</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>) <span class="id" title="var">_</span> (<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#lift"><span class="id" title="method">lift</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>)) =&gt; <span class="id" title="var">lift_subst_hint</span> : <span class="id" title="var">lift_subst</span>.<br/>

<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">subst_subst_hint</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="tactic">first</span> [<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#subst_subst"><span class="id" title="method">subst_subst</span></a> <span class="id" title="tactic">by</span> <span class="id" title="var">lia</span>; <span class="id" title="tactic">reflexivity</span><br/>
&nbsp;&nbsp;| <span class="id" title="tactic">rewrite</span> &lt;- <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#subst_subst"><span class="id" title="method">subst_subst</span></a> <span class="id" title="tactic">by</span> <span class="id" title="var">lia</span>; <span class="id" title="tactic">reflexivity</span><br/>
&nbsp;&nbsp;| <span class="id" title="tactic">rewrite</span> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#subst_subst"><span class="id" title="method">subst_subst</span></a> <span class="id" title="tactic">by</span> <span class="id" title="var">lia</span><br/>
&nbsp;&nbsp;| <span class="id" title="tactic">rewrite</span> &lt;- <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#subst_subst"><span class="id" title="method">subst_subst</span></a> <span class="id" title="tactic">by</span> <span class="id" title="var">lia</span><br/>
&nbsp;&nbsp;].<br/>

<br/>
<span class="id" title="keyword">Hint Extern</span> 1 (<span class="id" title="var">_</span> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#subst"><span class="id" title="method">subst</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> (<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#subst"><span class="id" title="method">subst</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>)) =&gt; <span class="id" title="var">subst_subst_hint</span> : <span class="id" title="var">subst_subst</span>.<br/>
<span class="id" title="keyword">Hint Extern</span> 1 (<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#subst"><span class="id" title="method">subst</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> (<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#subst"><span class="id" title="method">subst</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>) <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <span class="id" title="var">_</span>) =&gt; <span class="id" title="var">subst_subst_hint</span> : <span class="id" title="var">subst_subst</span>.<br/>

<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">lift_lift_fuse_hint</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#lift_lift_fuse"><span class="id" title="method">lift_lift_fuse</span></a> <span class="id" title="tactic">by</span> <span class="id" title="var">lia</span>.<br/>

<br/>
<span class="id" title="keyword">Hint Extern</span> 1 (<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#lift"><span class="id" title="method">lift</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> (<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#lift"><span class="id" title="method">lift</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>) <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <span class="id" title="var">_</span>) =&gt; <span class="id" title="var">lift_lift_fuse_hint</span> : <span class="id" title="var">lift_lift_fuse</span>.<br/>
<span class="id" title="keyword">Hint Extern</span> 1 (<span class="id" title="var">_</span> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#lift"><span class="id" title="method">lift</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> (<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#lift"><span class="id" title="method">lift</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>)) =&gt; <span class="id" title="var">lift_lift_fuse_hint</span> : <span class="id" title="var">lift_lift_fuse</span>.<br/>

<br/>
<span class="comment">(*&nbsp;------------------------------------------------------------------------------&nbsp;*)</span><br/>

<br/>
<span class="comment">(*&nbsp;Miscellaneous&nbsp;lemmas,&nbsp;often&nbsp;combinations&nbsp;and/or&nbsp;special&nbsp;cases&nbsp;of&nbsp;the&nbsp;above<br/>
&nbsp;&nbsp;&nbsp;lemmas.&nbsp;*)</span><br/>

<br/>
<span class="comment">(*&nbsp;Lifts&nbsp;are&nbsp;invariant&nbsp;under&nbsp;translation.&nbsp;*)</span><br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="translate_lift" class="idref" href="#translate_lift"><span class="id" title="lemma">translate_lift</span></a>:<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="w:494" class="idref" href="#w:494"><span class="id" title="binder">w</span></a> <a id="x:495" class="idref" href="#x:495"><span class="id" title="binder">x</span></a> <a id="y:496" class="idref" href="#y:496"><span class="id" title="binder">y</span></a> <a id="z:497" class="idref" href="#z:497"><span class="id" title="binder">z</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#lift"><span class="id" title="method">lift</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#w:494"><span class="id" title="variable">w</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#x:495"><span class="id" title="variable">x</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#y:496"><span class="id" title="variable">y</span></a> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#z:497"><span class="id" title="variable">z</span></a> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="k:498" class="idref" href="#k:498"><span class="id" title="binder">k</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#lift"><span class="id" title="method">lift</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#w:494"><span class="id" title="variable">w</span></a> (<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#k:498"><span class="id" title="variable">k</span></a> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#x:495"><span class="id" title="variable">x</span></a>) (<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#k:498"><span class="id" title="variable">k</span></a> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#y:496"><span class="id" title="variable">y</span></a>) <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#k:498"><span class="id" title="variable">k</span></a> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#z:497"><span class="id" title="variable">z</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">just_do_it</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="comment">(*&nbsp;The&nbsp;following&nbsp;is&nbsp;a&nbsp;simple&nbsp;consequence&nbsp;of&nbsp;<span class="inlinecode"><span class="id" title="var">lift_fuse_fuse</span></span>.&nbsp;*)</span><br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="lift_one_lift_zero" class="idref" href="#lift_one_lift_zero"><span class="id" title="lemma">lift_one_lift_zero</span></a>:<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> `{<a id="H0:501" class="idref" href="#H0:501"><span class="id" title="binder">LiftLiftFuse</span></a> <a id="T:499" class="idref" href="#T:499"><span class="id" title="binder"><span id="H0:501" class="id">T</span></span></a>} <a id="t:502" class="idref" href="#t:502"><span class="id" title="binder">t</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#shift"><span class="id" title="abbreviation">shift</span></a> 1 (<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#shift"><span class="id" title="abbreviation">shift</span></a> 0 <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#t:502"><span class="id" title="variable">t</span></a>) <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#shift"><span class="id" title="abbreviation">shift</span></a> 0 (<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#shift"><span class="id" title="abbreviation">shift</span></a> 0 <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#t:502"><span class="id" title="variable">t</span></a>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eauto</span> <span class="id" title="keyword">with</span> <span class="id" title="var">lift_lift_fuse</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="comment">(*&nbsp;The&nbsp;following&nbsp;is&nbsp;a&nbsp;special&nbsp;case&nbsp;of&nbsp;<span class="inlinecode"><span class="id" title="var">lift_lift_fuse</span></span>&nbsp;that&nbsp;is&nbsp;often<br/>
&nbsp;&nbsp;&nbsp;useful.&nbsp;<span class="inlinecode"><span class="id" title="var">ws</span></span>&nbsp;is&nbsp;<span class="inlinecode">1</span>&nbsp;and&nbsp;<span class="inlinecode"><span class="id" title="var">k</span></span>&nbsp;is&nbsp;<span class="inlinecode"><span class="id" title="var">s</span></span>.&nbsp;*)</span><br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="lift_lift_fuse_successor" class="idref" href="#lift_lift_fuse_successor"><span class="id" title="lemma">lift_lift_fuse_successor</span></a>:<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> `{<a id="H0:505" class="idref" href="#H0:505"><span class="id" title="binder">LiftLiftFuse</span></a> <a id="T:503" class="idref" href="#T:503"><span class="id" title="binder"><span id="H0:505" class="id">T</span></span></a>} <a id="t:506" class="idref" href="#t:506"><span class="id" title="binder">t</span></a> <a id="s:507" class="idref" href="#s:507"><span class="id" title="binder">s</span></a> <a id="wk:508" class="idref" href="#wk:508"><span class="id" title="binder">wk</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#lift"><span class="id" title="method">lift</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#wk:508"><span class="id" title="variable">wk</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#s:507"><span class="id" title="variable">s</span></a> (<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#shift"><span class="id" title="abbreviation">shift</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#s:507"><span class="id" title="variable">s</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#t:506"><span class="id" title="variable">t</span></a>) <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#lift"><span class="id" title="method">lift</span></a> (<a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Datatypes.html#S"><span class="id" title="constructor">S</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#wk:508"><span class="id" title="variable">wk</span></a>) <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#s:507"><span class="id" title="variable">s</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#t:506"><span class="id" title="variable">t</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">replace</span> (<a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Datatypes.html#S"><span class="id" title="constructor">S</span></a> <span class="id" title="var">wk</span>) <span class="id" title="keyword">with</span> (<span class="id" title="var">wk</span> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a> 1) <span class="id" title="tactic">by</span> <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#lift_lift_fuse"><span class="id" title="method">lift_lift_fuse</span></a>. <span class="id" title="var">lia</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Hint Extern</span> 1 (<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#lift"><span class="id" title="method">lift</span></a> ?<span class="id" title="var">wk</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#lift"><span class="id" title="method">lift</span></a> (<a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Datatypes.html#S"><span class="id" title="constructor">S</span></a> ?<span class="id" title="var">wk</span>) <span class="id" title="var">_</span> <span class="id" title="var">_</span>) =&gt;<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#lift_lift_fuse_successor"><span class="id" title="lemma">lift_lift_fuse_successor</span></a><br/>
: <span class="id" title="var">lift_lift_fuse_successor</span>.<br/>

<br/>
<span class="comment">(*&nbsp;<span class="inlinecode"><span class="id" title="var">lift_zero</span></span>&nbsp;and&nbsp;<span class="inlinecode"><span class="id" title="var">lift_lift_fuse_successor</span></span>&nbsp;are&nbsp;often&nbsp;useful&nbsp;when<br/>
&nbsp;&nbsp;&nbsp;arguing&nbsp;that&nbsp;<span class="inlinecode"><span class="id" title="var">lift</span></span> <span class="inlinecode"><span class="id" title="var">n</span></span>&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;<span class="inlinecode"><span class="id" title="var">n</span></span>&nbsp;successive&nbsp;applications<br/>
&nbsp;&nbsp;&nbsp;of&nbsp;<span class="inlinecode"><span class="id" title="var">lift</span></span> <span class="inlinecode">1</span>.&nbsp;The&nbsp;following&nbsp;tactic&nbsp;helps&nbsp;with&nbsp;this&nbsp;argument.&nbsp;*)</span><br/>

<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">iterated_lift</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="tactic">first</span> [<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#lift_zero"><span class="id" title="method">lift_zero</span></a><br/>
&nbsp;&nbsp;| <span class="id" title="tactic">rewrite</span> &lt;- <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#lift_lift_fuse_successor"><span class="id" title="lemma">lift_lift_fuse_successor</span></a><br/>
&nbsp;&nbsp;].<br/>

<br/>
<span class="comment">(*&nbsp;The&nbsp;following&nbsp;lemma&nbsp;can&nbsp;be&nbsp;viewed&nbsp;as&nbsp;a&nbsp;general&nbsp;form&nbsp;of&nbsp;<span class="inlinecode"><span class="id" title="var">subst_lift</span></span>.<br/>
&nbsp;&nbsp;&nbsp;Indeed,&nbsp;<span class="inlinecode"><span class="id" title="var">subst_lift</span></span>&nbsp;corresponds&nbsp;to&nbsp;a&nbsp;special&nbsp;case&nbsp;of<br/>
&nbsp;&nbsp;&nbsp;<span class="inlinecode"><span class="id" title="var">subst_lift_generalized</span></span>&nbsp;where&nbsp;<span class="inlinecode"><span class="id" title="var">n</span></span>&nbsp;is&nbsp;zero.&nbsp;*)</span><br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="subst_lift_generalized" class="idref" href="#subst_lift_generalized"><span class="id" title="lemma">subst_lift_generalized</span></a>:<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> `{<a id="H:510" class="idref" href="#H:510"><span class="id" title="binder">Lift</span></a> <a id="T:509" class="idref" href="#T:509"><span class="id" title="binder"><span id="H:510" class="id">T</span></span></a>, <a id="H0:512" class="idref" href="#H0:512"><span class="id" title="binder">Subst</span></a> <a id="V:511" class="idref" href="#V:511"><span class="id" title="binder"><span id="H0:512" class="id">V</span></span></a> <a id="H0:512" class="idref" href="#H0:512"><span class="id" title="binder">T</span></a>},<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> { <span class="id" title="var">_</span> : <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#LiftLift"><span class="id" title="class">LiftLift</span></a> },<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> { <span class="id" title="var">_</span> : <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#LiftLiftFuse"><span class="id" title="class">LiftLiftFuse</span></a> },<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> { <span class="id" title="var">_</span> : <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#SubstLift"><span class="id" title="class">SubstLift</span></a> },<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="n:513" class="idref" href="#n:513"><span class="id" title="binder">n</span></a> <a id="v:514" class="idref" href="#v:514"><span class="id" title="binder">v</span></a> <a id="t:515" class="idref" href="#t:515"><span class="id" title="binder">t</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#subst"><span class="id" title="method">subst</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#v:514"><span class="id" title="variable">v</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#n:513"><span class="id" title="variable">n</span></a> (<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#lift"><span class="id" title="method">lift</span></a> (<a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Datatypes.html#S"><span class="id" title="constructor">S</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#n:513"><span class="id" title="variable">n</span></a>) 0 <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#t:515"><span class="id" title="variable">t</span></a>) <a class="idref" href="http://coq.inria.fr/doc/V9.0.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#lift"><span class="id" title="method">lift</span></a> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#n:513"><span class="id" title="variable">n</span></a> 0 <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#t:515"><span class="id" title="variable">t</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#lift_lift_fuse_successor"><span class="id" title="lemma">lift_lift_fuse_successor</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#lift_lift"><span class="id" title="method">lift_lift</span></a> <span class="id" title="tactic">by</span> <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="lemma">Nat.add_0_r</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#subst_lift"><span class="id" title="method">subst_lift</span></a>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="comment">(*&nbsp;------------------------------------------------------------------------------&nbsp;*)</span><br/>

<br/>
<span class="comment">(*&nbsp;Hopefully,&nbsp;outside&nbsp;of&nbsp;this&nbsp;module,&nbsp;it&nbsp;is&nbsp;never&nbsp;necessary&nbsp;to&nbsp;know&nbsp;how&nbsp;<span class="inlinecode"><span class="id" title="var">lift</span></span><br/>
&nbsp;&nbsp;&nbsp;and&nbsp;<span class="inlinecode"><span class="id" title="tactic">subst</span></span>&nbsp;are&nbsp;defined.&nbsp;We&nbsp;make&nbsp;them&nbsp;opaque.&nbsp;This&nbsp;is&nbsp;useful,&nbsp;as&nbsp;it<br/>
&nbsp;&nbsp;&nbsp;prevents&nbsp;<span class="inlinecode"><span class="id" title="tactic">simpl</span></span>&nbsp;from&nbsp;unfolding&nbsp;the&nbsp;definitions&nbsp;and&nbsp;making&nbsp;a&nbsp;mess.&nbsp;*)</span><br/>

<br/>
<span class="id" title="keyword">Global Opaque</span> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#lift"><span class="id" title="method">lift</span></a>.<br/>
<span class="id" title="keyword">Global Opaque</span> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#subst"><span class="id" title="method">subst</span></a>.<br/>
</div>
</div>
<div id="footer">
  Generated by <a href="http://coq.inria.fr/">coqdoc</a> and improved with <a href="https://github.com/coq-community/coqdocjs">CoqdocJS</a>
</div>
</div>
</body>

</html>
