<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<link href="resources/coqdoc.css" rel="stylesheet" type="text/css" />
<link href="resources/coqdocjs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resources/config.js"></script>
<script type="text/javascript" src="resources/coqdocjs.js"></script>
</head>

<body onload="document.getElementById('content').focus()">
  <div id="header">
    <span class="left">
      <span class="modulename"> <script> document.write(document.title) </script> </span>
    </span>

    <span class="button" id="toggle-proofs"></span>

    <span class="right">
      <a href="../">Project Page</a>
      <a href="./indexpage.html"> Index </a>
      <a href="./toc.html"> Table of Contents </a>
    </span>
</div>
    <div id="content" tabindex="-1" onblur="document.getElementById('content').focus()">
    <div id="main">
<h1 class="libtitle">MailboxTypes.Dblib.Environments</h1>

<div class="code">
<span class="id" title="keyword">Set Implicit Arguments</span>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">Stdlib</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="library">List</span>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">Stdlib</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="library">Arith</span>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">Stdlib</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="library">Lia</span>.<br/>
<span class="id" title="keyword">Opaque</span> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Nat.html#add"><span class="id" title="definition">plus</span></a>. <span class="comment">(*&nbsp;avoid&nbsp;pesky&nbsp;reductions&nbsp;*)</span><br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">MailboxTypes</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#"><span class="id" title="library">Dblib.DeBruijn</span></a>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">MailboxTypes</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="MailboxTypes.Dblib.DblibTactics.html#"><span class="id" title="library">Dblib.DblibTactics</span></a>.<br/>

<br/>
<span class="comment">(*&nbsp;----------------------------------------------------------------------------&nbsp;*)</span><br/>

<br/>
<span class="comment">(*&nbsp;Environments&nbsp;map&nbsp;variables&nbsp;to&nbsp;data.&nbsp;*)</span><br/>

<br/>
<span class="comment">(*&nbsp;Environments&nbsp;are&nbsp;homogeneous&nbsp;--&nbsp;there&nbsp;is&nbsp;only&nbsp;one&nbsp;kind&nbsp;of&nbsp;variables&nbsp;--<br/>
&nbsp;&nbsp;&nbsp;and&nbsp;non-dependent&nbsp;--&nbsp;variables&nbsp;do&nbsp;not&nbsp;occur&nbsp;within&nbsp;data.&nbsp;*)</span><br/>

<br/>
<span class="comment">(*&nbsp;What&nbsp;should&nbsp;be&nbsp;the&nbsp;type&nbsp;of&nbsp;an&nbsp;environment?&nbsp;Multiple&nbsp;answers&nbsp;come&nbsp;to&nbsp;mind,<br/>
&nbsp;&nbsp;&nbsp;such&nbsp;as&nbsp;<span class="inlinecode"><span class="id" title="var">list</span></span> <span class="inlinecode"><span class="id" title="var">A</span></span>,&nbsp;<span class="inlinecode"><span class="id" title="var">nat</span></span> <span class="inlinecode">-&gt;</span> <span class="inlinecode"><span class="id" title="var">option</span></span> <span class="inlinecode"><span class="id" title="var">A</span></span>,&nbsp;<span class="inlinecode"><span class="id" title="var">list</span></span> <span class="inlinecode">(<span class="id" title="var">option</span></span> <span class="inlinecode"><span class="id" title="var">A</span>)</span>,&nbsp;etc.&nbsp;The&nbsp;choice&nbsp;of<br/>
&nbsp;&nbsp;&nbsp;a&nbsp;definition&nbsp;is&nbsp;guided&nbsp;by&nbsp;the&nbsp;desire&nbsp;that&nbsp;<span class="inlinecode"><span class="id" title="var">lookup</span></span>&nbsp;and&nbsp;<span class="inlinecode"><span class="id" title="var">insert</span></span>&nbsp;be&nbsp;total<br/>
&nbsp;&nbsp;&nbsp;functions&nbsp;that&nbsp;satisfy&nbsp;a&nbsp;number&nbsp;of&nbsp;natural&nbsp;laws.&nbsp;In&nbsp;particular,&nbsp;if&nbsp;<span class="inlinecode"><span class="id" title="var">insert</span></span><br/>
&nbsp;&nbsp;&nbsp;is&nbsp;a&nbsp;total&nbsp;function,&nbsp;then&nbsp;we&nbsp;cannot&nbsp;expect&nbsp;the&nbsp;domain&nbsp;of&nbsp;an&nbsp;environment&nbsp;to<br/>
&nbsp;&nbsp;&nbsp;be&nbsp;contiguous.&nbsp;This&nbsp;rules&nbsp;out&nbsp;<span class="inlinecode"><span class="id" title="var">list</span></span> <span class="inlinecode"><span class="id" title="var">A</span></span>.&nbsp;Representing&nbsp;an&nbsp;environment&nbsp;by&nbsp;its<br/>
&nbsp;&nbsp;&nbsp;lookup&nbsp;function,&nbsp;of&nbsp;type&nbsp;<span class="inlinecode"><span class="id" title="var">nat</span></span> <span class="inlinecode">-&gt;</span> <span class="inlinecode"><span class="id" title="var">option</span></span> <span class="inlinecode"><span class="id" title="var">A</span></span>,&nbsp;works,&nbsp;but&nbsp;does&nbsp;not&nbsp;allow<br/>
&nbsp;&nbsp;&nbsp;defining&nbsp;<span class="inlinecode"><span class="id" title="tactic">fold</span></span>&nbsp;over&nbsp;environments.&nbsp;In&nbsp;the&nbsp;end,&nbsp;representing&nbsp;an&nbsp;environment<br/>
&nbsp;&nbsp;&nbsp;by&nbsp;a&nbsp;finite&nbsp;list&nbsp;of&nbsp;possibly-null&nbsp;entries&nbsp;seems&nbsp;to&nbsp;be&nbsp;a&nbsp;reasonable<br/>
&nbsp;&nbsp;&nbsp;choice.&nbsp;*)</span><br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="env" class="idref" href="#env"><span class="id" title="definition">env</span></a> <a id="A:1" class="idref" href="#A:1"><span class="id" title="binder">A</span></a> :=<br/>
&nbsp;&nbsp;<a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> (<a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#option"><span class="id" title="inductive">option</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#A:1"><span class="id" title="variable">A</span></a>).<br/>

<br/>
<span class="comment">(*&nbsp;What&nbsp;notion&nbsp;of&nbsp;equality&nbsp;over&nbsp;environments&nbsp;do&nbsp;we&nbsp;need?&nbsp;Extensional&nbsp;equality<br/>
&nbsp;&nbsp;&nbsp;of&nbsp;the&nbsp;<span class="inlinecode"><span class="id" title="var">lookup</span></span>&nbsp;functions&nbsp;seems&nbsp;to&nbsp;be&nbsp;the&nbsp;most&nbsp;natural&nbsp;notion.&nbsp;The<br/>
&nbsp;&nbsp;&nbsp;predicate&nbsp;<span class="inlinecode"><span class="id" title="var">agree</span></span>,&nbsp;defined&nbsp;below,&nbsp;is&nbsp;a&nbsp;bounded&nbsp;version&nbsp;of&nbsp;this<br/>
&nbsp;&nbsp;&nbsp;notion.&nbsp;Perhaps&nbsp;by&nbsp;chance,&nbsp;the&nbsp;basic&nbsp;laws&nbsp;that&nbsp;relate&nbsp;<span class="inlinecode"><span class="id" title="var">lookup</span></span>,&nbsp;<span class="inlinecode"><span class="id" title="var">insert</span></span>,<br/>
&nbsp;&nbsp;&nbsp;and&nbsp;<span class="inlinecode"><span class="id" title="var">map</span></span>&nbsp;are&nbsp;valid&nbsp;with&nbsp;respect&nbsp;to&nbsp;Leibniz&nbsp;equality,&nbsp;so&nbsp;we&nbsp;do&nbsp;not&nbsp;define<br/>
&nbsp;&nbsp;&nbsp;extensional&nbsp;equality.&nbsp;*)</span><br/>

<br/>
<span class="comment">(*&nbsp;----------------------------------------------------------------------------&nbsp;*)</span><br/>

<br/>
<span class="comment">(*&nbsp;Operations&nbsp;on&nbsp;environments.&nbsp;*)</span><br/>

<br/>
<span class="comment">(*&nbsp;The&nbsp;empty&nbsp;environment&nbsp;is&nbsp;undefined&nbsp;everywhere.&nbsp;*)</span><br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="empty" class="idref" href="#empty"><span class="id" title="definition">empty</span></a> <a id="A:2" class="idref" href="#A:2"><span class="id" title="binder">A</span></a> : <a class="idref" href="MailboxTypes.Dblib.Environments.html#env"><span class="id" title="definition">env</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#A:2"><span class="id" title="variable">A</span></a> :=<br/>
&nbsp;&nbsp;<a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#nil"><span class="id" title="constructor">nil</span></a>.<br/>

<br/>
<span class="comment">(*&nbsp;Environment&nbsp;lookup.&nbsp;*)</span><br/>

<br/>
<span class="id" title="keyword">Fixpoint</span> <a id="lookup" class="idref" href="#lookup"><span class="id" title="definition">lookup</span></a> <a id="A:3" class="idref" href="#A:3"><span class="id" title="binder">A</span></a> (<a id="x:4" class="idref" href="#x:4"><span class="id" title="binder">x</span></a> : <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>) (<a id="e:5" class="idref" href="#e:5"><span class="id" title="binder">e</span></a> : <a class="idref" href="MailboxTypes.Dblib.Environments.html#env"><span class="id" title="definition">env</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#A:3"><span class="id" title="variable">A</span></a>) : <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#option"><span class="id" title="inductive">option</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#A:3"><span class="id" title="variable">A</span></a> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="MailboxTypes.Dblib.Environments.html#e:5"><span class="id" title="variable">e</span></a>, <a class="idref" href="MailboxTypes.Dblib.Environments.html#x:4"><span class="id" title="variable">x</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#nil"><span class="id" title="constructor">nil</span></a>, <span class="id" title="var">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#None"><span class="id" title="constructor">None</span></a><br/>
&nbsp;&nbsp;| <span class="id" title="var">entry</span> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#::list_scope:x_'::'_x"><span class="id" title="notation">::</span></a> <span class="id" title="var">_</span>, 0 =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">entry</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">_</span> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#::list_scope:x_'::'_x"><span class="id" title="notation">::</span></a> <span class="id" title="var">e</span>, <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#S"><span class="id" title="constructor">S</span></a> <span class="id" title="var">x</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.Environments.html#lookup:6"><span class="id" title="definition">lookup</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#x:4"><span class="id" title="variable">x</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#e:5"><span class="id" title="variable">e</span></a><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="comment">(*&nbsp;<span class="inlinecode"><span class="id" title="var">insert</span></span> <span class="inlinecode"><span class="id" title="var">x</span></span> <span class="inlinecode"><span class="id" title="var">a</span></span> <span class="inlinecode"><span class="id" title="var">e</span></span>&nbsp;inserts&nbsp;a&nbsp;new&nbsp;variable&nbsp;<span class="inlinecode"><span class="id" title="var">x</span></span>,&nbsp;associated&nbsp;with&nbsp;data&nbsp;<span class="inlinecode"><span class="id" title="var">a</span></span>,&nbsp;in&nbsp;the<br/>
&nbsp;&nbsp;&nbsp;environment&nbsp;<span class="inlinecode"><span class="id" title="var">e</span></span>.&nbsp;The&nbsp;pre-existing&nbsp;environment&nbsp;entries&nbsp;at&nbsp;index&nbsp;<span class="inlinecode"><span class="id" title="var">x</span></span>&nbsp;and<br/>
&nbsp;&nbsp;&nbsp;above&nbsp;are&nbsp;shifted&nbsp;up.&nbsp;Thus,&nbsp;<span class="inlinecode"><span class="id" title="var">insert</span></span> <span class="inlinecode"><span class="id" title="var">x</span></span>&nbsp;is&nbsp;closely&nbsp;analogous&nbsp;to&nbsp;<span class="inlinecode"><span class="id" title="var">shift</span></span> <span class="inlinecode"><span class="id" title="var">x</span></span><br/>
&nbsp;&nbsp;&nbsp;for&nbsp;terms.&nbsp;*)</span><br/>

<br/>
<span class="comment">(*&nbsp;<span class="inlinecode"><span class="id" title="var">insert</span></span>&nbsp;inserts&nbsp;a&nbsp;non-null&nbsp;entry&nbsp;in&nbsp;the&nbsp;environment.&nbsp;We&nbsp;define&nbsp;it&nbsp;in&nbsp;terms<br/>
&nbsp;&nbsp;&nbsp;of&nbsp;<span class="inlinecode"><span class="id" title="var">raw_insert</span></span>,&nbsp;which&nbsp;can&nbsp;also&nbsp;be&nbsp;used&nbsp;to&nbsp;insert&nbsp;a&nbsp;null&nbsp;entry.&nbsp;<span class="inlinecode"><span class="id" title="var">raw_insert</span></span><br/>
&nbsp;&nbsp;&nbsp;is&nbsp;useful&nbsp;because&nbsp;it&nbsp;allows&nbsp;generating&nbsp;every&nbsp;environment&nbsp;(thus,&nbsp;it&nbsp;can&nbsp;be<br/>
&nbsp;&nbsp;&nbsp;used&nbsp;in&nbsp;the&nbsp;formulation&nbsp;of&nbsp;an&nbsp;induction&nbsp;principle).&nbsp;*)</span><br/>

<br/>
<span class="id" title="keyword">Fixpoint</span> <a id="raw_insert" class="idref" href="#raw_insert"><span class="id" title="definition">raw_insert</span></a> <a id="A:9" class="idref" href="#A:9"><span class="id" title="binder">A</span></a> (<a id="x:10" class="idref" href="#x:10"><span class="id" title="binder">x</span></a> : <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>) (<a id="o:11" class="idref" href="#o:11"><span class="id" title="binder">o</span></a> : <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#option"><span class="id" title="inductive">option</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#A:9"><span class="id" title="variable">A</span></a>) (<a id="e:12" class="idref" href="#e:12"><span class="id" title="binder">e</span></a> : <a class="idref" href="MailboxTypes.Dblib.Environments.html#env"><span class="id" title="definition">env</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#A:9"><span class="id" title="variable">A</span></a>) : <a class="idref" href="MailboxTypes.Dblib.Environments.html#env"><span class="id" title="definition">env</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#A:9"><span class="id" title="variable">A</span></a> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="MailboxTypes.Dblib.Environments.html#x:10"><span class="id" title="variable">x</span></a>, <a class="idref" href="MailboxTypes.Dblib.Environments.html#e:12"><span class="id" title="variable">e</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| 0, <span class="id" title="var">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.Environments.html#o:11"><span class="id" title="variable">o</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#::list_scope:x_'::'_x"><span class="id" title="notation">::</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#e:12"><span class="id" title="variable">e</span></a><br/>
&nbsp;&nbsp;| <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#S"><span class="id" title="constructor">S</span></a> <span class="id" title="var">x</span>, <span class="id" title="var">entry</span> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#::list_scope:x_'::'_x"><span class="id" title="notation">::</span></a> <span class="id" title="var">e</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">entry</span> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#::list_scope:x_'::'_x"><span class="id" title="notation">::</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#raw_insert:13"><span class="id" title="definition">raw_insert</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#x:10"><span class="id" title="variable">x</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#o:11"><span class="id" title="variable">o</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#e:12"><span class="id" title="variable">e</span></a><br/>
&nbsp;&nbsp;| <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#S"><span class="id" title="constructor">S</span></a> <span class="id" title="var">x</span>, <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#nil"><span class="id" title="constructor">nil</span></a> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#None"><span class="id" title="constructor">None</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#::list_scope:x_'::'_x"><span class="id" title="notation">::</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#raw_insert:13"><span class="id" title="definition">raw_insert</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#x:10"><span class="id" title="variable">x</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#o:11"><span class="id" title="variable">o</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#e:12"><span class="id" title="variable">e</span></a><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Notation</span> <a id="insert" class="idref" href="#insert"><span class="id" title="abbreviation">insert</span></a> <span class="id" title="var">x</span> <span class="id" title="var">a</span> <span class="id" title="var">e</span> :=<br/>
&nbsp;&nbsp;(<a class="idref" href="MailboxTypes.Dblib.Environments.html#raw_insert"><span class="id" title="definition">raw_insert</span></a> <span class="id" title="var">x</span> (<a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <span class="id" title="var">a</span>) <span class="id" title="var">e</span>).<br/>

<br/>
<span class="comment">(*&nbsp;<span class="inlinecode"><span class="id" title="var">map</span></span> <span class="inlinecode"><span class="id" title="var">f</span></span> <span class="inlinecode"><span class="id" title="var">e</span></span>&nbsp;is&nbsp;the&nbsp;environment&nbsp;obtained&nbsp;by&nbsp;applying&nbsp;<span class="inlinecode"><span class="id" title="var">f</span></span>&nbsp;to&nbsp;every&nbsp;datum<br/>
&nbsp;&nbsp;&nbsp;in&nbsp;the&nbsp;environment&nbsp;<span class="inlinecode"><span class="id" title="var">e</span></span>.&nbsp;*)</span><br/>

<br/>
<span class="id" title="keyword">Fixpoint</span> <a id="map" class="idref" href="#map"><span class="id" title="definition">map</span></a> <a id="A:16" class="idref" href="#A:16"><span class="id" title="binder">A</span></a> <a id="B:17" class="idref" href="#B:17"><span class="id" title="binder">B</span></a> (<a id="f:18" class="idref" href="#f:18"><span class="id" title="binder">f</span></a> : <a class="idref" href="MailboxTypes.Dblib.Environments.html#A:16"><span class="id" title="variable">A</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#B:17"><span class="id" title="variable">B</span></a>) (<a id="e:19" class="idref" href="#e:19"><span class="id" title="binder">e</span></a> : <a class="idref" href="MailboxTypes.Dblib.Environments.html#env"><span class="id" title="definition">env</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#A:16"><span class="id" title="variable">A</span></a>) :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="MailboxTypes.Dblib.Environments.html#e:19"><span class="id" title="variable">e</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#nil"><span class="id" title="constructor">nil</span></a> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#nil"><span class="id" title="constructor">nil</span></a><br/>
&nbsp;&nbsp;| <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#None"><span class="id" title="constructor">None</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#::list_scope:x_'::'_x"><span class="id" title="notation">::</span></a> <span class="id" title="var">e</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#None"><span class="id" title="constructor">None</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#::list_scope:x_'::'_x"><span class="id" title="notation">::</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#map:20"><span class="id" title="definition">map</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#f:18"><span class="id" title="variable">f</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#e:19"><span class="id" title="variable">e</span></a><br/>
&nbsp;&nbsp;| <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <span class="id" title="var">a</span> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#::list_scope:x_'::'_x"><span class="id" title="notation">::</span></a> <span class="id" title="var">e</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="MailboxTypes.Dblib.Environments.html#f:18"><span class="id" title="variable">f</span></a> <span class="id" title="var">a</span>) <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#::list_scope:x_'::'_x"><span class="id" title="notation">::</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#map:20"><span class="id" title="definition">map</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#f:18"><span class="id" title="variable">f</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#e:19"><span class="id" title="variable">e</span></a><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="comment">(*&nbsp;<span class="inlinecode"><span class="id" title="tactic">fold</span></span> <span class="inlinecode"><span class="id" title="var">f</span></span> <span class="inlinecode"><span class="id" title="var">e</span></span> <span class="inlinecode"><span class="id" title="var">accu</span></span>&nbsp;performs&nbsp;an&nbsp;iteration&nbsp;over&nbsp;all&nbsp;entries&nbsp;in&nbsp;the&nbsp;environment.<br/>
&nbsp;&nbsp;&nbsp;Older&nbsp;entries&nbsp;are&nbsp;visited&nbsp;first:&nbsp;in&nbsp;other&nbsp;words,&nbsp;the&nbsp;initial&nbsp;accumulator<br/>
&nbsp;&nbsp;&nbsp;should&nbsp;make&nbsp;sense&nbsp;at&nbsp;the&nbsp;toplevel,&nbsp;outside&nbsp;of&nbsp;the&nbsp;environment,&nbsp;and&nbsp;is<br/>
&nbsp;&nbsp;&nbsp;pushed&nbsp;successively&nbsp;into&nbsp;every&nbsp;binding,&nbsp;so&nbsp;as&nbsp;to&nbsp;yield&nbsp;a&nbsp;final&nbsp;accumulator<br/>
&nbsp;&nbsp;&nbsp;that&nbsp;makes&nbsp;sense&nbsp;inside&nbsp;this&nbsp;environment.&nbsp;*)</span><br/>

<br/>
<span class="id" title="keyword">Fixpoint</span> <a id="fold" class="idref" href="#fold"><span class="id" title="definition">fold</span></a> <a id="A:22" class="idref" href="#A:22"><span class="id" title="binder">A</span></a> <a id="B:23" class="idref" href="#B:23"><span class="id" title="binder">B</span></a> (<a id="f:24" class="idref" href="#f:24"><span class="id" title="binder">f</span></a> : <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#option"><span class="id" title="inductive">option</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#A:22"><span class="id" title="variable">A</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#B:23"><span class="id" title="variable">B</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#B:23"><span class="id" title="variable">B</span></a>) (<a id="e:25" class="idref" href="#e:25"><span class="id" title="binder">e</span></a> : <a class="idref" href="MailboxTypes.Dblib.Environments.html#env"><span class="id" title="definition">env</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#A:22"><span class="id" title="variable">A</span></a>) (<a id="accu:26" class="idref" href="#accu:26"><span class="id" title="binder">accu</span></a> : <a class="idref" href="MailboxTypes.Dblib.Environments.html#B:23"><span class="id" title="variable">B</span></a>) : <a class="idref" href="MailboxTypes.Dblib.Environments.html#B:23"><span class="id" title="variable">B</span></a> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="MailboxTypes.Dblib.Environments.html#e:25"><span class="id" title="variable">e</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#nil"><span class="id" title="constructor">nil</span></a> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.Environments.html#accu:26"><span class="id" title="variable">accu</span></a><br/>
&nbsp;&nbsp;| <span class="id" title="var">o</span> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#::list_scope:x_'::'_x"><span class="id" title="notation">::</span></a> <span class="id" title="var">e</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.Environments.html#f:24"><span class="id" title="variable">f</span></a> <span class="id" title="var">o</span> (<a class="idref" href="MailboxTypes.Dblib.Environments.html#fold:27"><span class="id" title="definition">fold</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#f:24"><span class="id" title="variable">f</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#e:25"><span class="id" title="variable">e</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#accu:26"><span class="id" title="variable">accu</span></a>)<br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="comment">(*&nbsp;----------------------------------------------------------------------------&nbsp;*)</span><br/>

<br/>
<span class="comment">(*&nbsp;Basic&nbsp;arithmetic&nbsp;simplifications.&nbsp;*)</span><br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="one_plus_x_minus_one_left" class="idref" href="#one_plus_x_minus_one_left"><span class="id" title="lemma">one_plus_x_minus_one_left</span></a>:<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="x:29" class="idref" href="#x:29"><span class="id" title="binder">x</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Peano.html#::nat_scope:x_'-'_x"><span class="id" title="notation">(</span></a>1 <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#x:29"><span class="id" title="variable">x</span></a><a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Peano.html#::nat_scope:x_'-'_x"><span class="id" title="notation">)</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Peano.html#::nat_scope:x_'-'_x"><span class="id" title="notation">-</span></a> 1 <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#x:29"><span class="id" title="variable">x</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="var">lia</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="one_plus_x_minus_one_right" class="idref" href="#one_plus_x_minus_one_right"><span class="id" title="lemma">one_plus_x_minus_one_right</span></a>:<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="x:30" class="idref" href="#x:30"><span class="id" title="binder">x</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.Environments.html#x:30"><span class="id" title="variable">x</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Peano.html#::nat_scope:x_'&gt;'_x"><span class="id" title="notation">&gt;</span></a> 0 <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;1 <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">(</span></a><a class="idref" href="MailboxTypes.Dblib.Environments.html#x:30"><span class="id" title="variable">x</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Peano.html#::nat_scope:x_'-'_x"><span class="id" title="notation">-</span></a> 1<a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">)</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#x:30"><span class="id" title="variable">x</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="var">lia</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">one_plus_x_minus_one</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="tactic">rewrite</span> <a class="idref" href="MailboxTypes.Dblib.Environments.html#one_plus_x_minus_one_left"><span class="id" title="lemma">one_plus_x_minus_one_left</span></a> <span class="id" title="tactic">in</span> *;<br/>
&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="tactic">rewrite</span> <a class="idref" href="MailboxTypes.Dblib.Environments.html#one_plus_x_minus_one_right"><span class="id" title="lemma">one_plus_x_minus_one_right</span></a> <span class="id" title="tactic">in</span> * <span class="id" title="tactic">by</span> <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;I&nbsp;tried&nbsp;<span class="inlinecode"><span class="id" title="tactic">autorewrite</span></span> <span class="inlinecode"><span class="id" title="keyword">with</span></span> <span class="inlinecode">...</span> <span class="inlinecode"><span class="id" title="keyword">using</span></span> <span class="inlinecode"><span class="id" title="var">lia</span></span>;&nbsp;it&nbsp;does&nbsp;not&nbsp;work.&nbsp;*)</span><br/>

<br/>
<span class="comment">(*&nbsp;----------------------------------------------------------------------------&nbsp;*)</span><br/>

<br/>
<span class="comment">(*&nbsp;Trivial&nbsp;facts.&nbsp;*)</span><br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="raw_insert_zero" class="idref" href="#raw_insert_zero"><span class="id" title="lemma">raw_insert_zero</span></a>:<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="A:31" class="idref" href="#A:31"><span class="id" title="binder">A</span></a> <a id="o:32" class="idref" href="#o:32"><span class="id" title="binder">o</span></a> (<a id="e:33" class="idref" href="#e:33"><span class="id" title="binder">e</span></a> : <a class="idref" href="MailboxTypes.Dblib.Environments.html#env"><span class="id" title="definition">env</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#A:31"><span class="id" title="variable">A</span></a>),<br/>
&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.Environments.html#raw_insert"><span class="id" title="definition">raw_insert</span></a> 0 <a class="idref" href="MailboxTypes.Dblib.Environments.html#o:32"><span class="id" title="variable">o</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#e:33"><span class="id" title="variable">e</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#o:32"><span class="id" title="variable">o</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#::list_scope:x_'::'_x"><span class="id" title="notation">::</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#e:33"><span class="id" title="variable">e</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">reflexivity</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="raw_insert_successor" class="idref" href="#raw_insert_successor"><span class="id" title="lemma">raw_insert_successor</span></a>:<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="A:34" class="idref" href="#A:34"><span class="id" title="binder">A</span></a> <a id="x:35" class="idref" href="#x:35"><span class="id" title="binder">x</span></a> <a id="o:36" class="idref" href="#o:36"><span class="id" title="binder">o</span></a> (<a id="e:37" class="idref" href="#e:37"><span class="id" title="binder">e</span></a> : <a class="idref" href="MailboxTypes.Dblib.Environments.html#env"><span class="id" title="definition">env</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#A:34"><span class="id" title="variable">A</span></a>),<br/>
&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.Environments.html#raw_insert"><span class="id" title="definition">raw_insert</span></a> (<a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#S"><span class="id" title="constructor">S</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#x:35"><span class="id" title="variable">x</span></a>) <a class="idref" href="MailboxTypes.Dblib.Environments.html#o:36"><span class="id" title="variable">o</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#e:37"><span class="id" title="variable">e</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.Environments.html#lookup"><span class="id" title="definition">lookup</span></a> 0 <a class="idref" href="MailboxTypes.Dblib.Environments.html#e:37"><span class="id" title="variable">e</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#::list_scope:x_'::'_x"><span class="id" title="notation">::</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#raw_insert"><span class="id" title="definition">raw_insert</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#x:35"><span class="id" title="variable">x</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#o:36"><span class="id" title="variable">o</span></a> (<span class="id" title="abbreviation">tail</span> <a class="idref" href="MailboxTypes.Dblib.Environments.html#e:37"><span class="id" title="variable">e</span></a>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">e</span>; <span class="id" title="tactic">reflexivity</span>. <span class="comment">(*&nbsp;!&nbsp;*)</span><br/>
<span class="id" title="keyword">Qed</span>. <span class="comment">(*&nbsp;Maybe&nbsp;this&nbsp;should&nbsp;be&nbsp;the&nbsp;definition&nbsp;of&nbsp;<span class="inlinecode"><span class="id" title="var">raw_insert</span></span>.&nbsp;*)</span><br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="empty_eq_insert" class="idref" href="#empty_eq_insert"><span class="id" title="lemma">empty_eq_insert</span></a>:<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="A:38" class="idref" href="#A:38"><span class="id" title="binder">A</span></a> <a id="x:39" class="idref" href="#x:39"><span class="id" title="binder">x</span></a> <a id="o:40" class="idref" href="#o:40"><span class="id" title="binder">o</span></a> (<a id="e:41" class="idref" href="#e:41"><span class="id" title="binder">e</span></a> : <a class="idref" href="MailboxTypes.Dblib.Environments.html#env"><span class="id" title="definition">env</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#A:38"><span class="id" title="variable">A</span></a>),<br/>
&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.Environments.html#empty"><span class="id" title="definition">empty</span></a> <span class="id" title="var">_</span> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#insert"><span class="id" title="abbreviation">insert</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#x:39"><span class="id" title="variable">x</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#o:40"><span class="id" title="variable">o</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#e:41"><span class="id" title="variable">e</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#False"><span class="id" title="inductive">False</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="MailboxTypes.Dblib.Environments.html#empty"><span class="id" title="definition">empty</span></a>; <span class="id" title="tactic">intros</span>; <span class="id" title="tactic">destruct</span> <span class="id" title="var">x</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">rewrite</span> <a class="idref" href="MailboxTypes.Dblib.Environments.html#raw_insert_zero"><span class="id" title="lemma">raw_insert_zero</span></a> <span class="id" title="tactic">in</span> *. <span class="id" title="tactic">congruence</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">rewrite</span> <a class="idref" href="MailboxTypes.Dblib.Environments.html#raw_insert_successor"><span class="id" title="lemma">raw_insert_successor</span></a> <span class="id" title="tactic">in</span> *. <span class="id" title="tactic">congruence</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="comment">(*&nbsp;----------------------------------------------------------------------------&nbsp;*)</span><br/>

<br/>
<span class="comment">(*&nbsp;Interaction&nbsp;between&nbsp;<span class="inlinecode"><span class="id" title="var">lookup</span></span>&nbsp;and&nbsp;<span class="inlinecode"><span class="id" title="var">empty</span></span>.&nbsp;*)</span><br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="lookup_empty_None" class="idref" href="#lookup_empty_None"><span class="id" title="lemma">lookup_empty_None</span></a>:<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="A:42" class="idref" href="#A:42"><span class="id" title="binder">A</span></a> <a id="x:43" class="idref" href="#x:43"><span class="id" title="binder">x</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.Environments.html#lookup"><span class="id" title="definition">lookup</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#x:43"><span class="id" title="variable">x</span></a> (@<a class="idref" href="MailboxTypes.Dblib.Environments.html#empty"><span class="id" title="definition">empty</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#A:42"><span class="id" title="variable">A</span></a>) <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#None"><span class="id" title="constructor">None</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">x</span>; <span class="id" title="tactic">simpl</span>; <span class="id" title="tactic">reflexivity</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="lookup_empty_Some" class="idref" href="#lookup_empty_Some"><span class="id" title="lemma">lookup_empty_Some</span></a>:<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="A:44" class="idref" href="#A:44"><span class="id" title="binder">A</span></a> <a id="x:45" class="idref" href="#x:45"><span class="id" title="binder">x</span></a> (<a id="a:46" class="idref" href="#a:46"><span class="id" title="binder">a</span></a> : <a class="idref" href="MailboxTypes.Dblib.Environments.html#A:44"><span class="id" title="variable">A</span></a>),<br/>
&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.Environments.html#lookup"><span class="id" title="definition">lookup</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#x:45"><span class="id" title="variable">x</span></a> (@<a class="idref" href="MailboxTypes.Dblib.Environments.html#empty"><span class="id" title="definition">empty</span></a> <span class="id" title="var">_</span>) <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#a:46"><span class="id" title="variable">a</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#False"><span class="id" title="inductive">False</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">x</span>; <span class="id" title="tactic">simpl</span>; <span class="id" title="tactic">congruence</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="lookup_successor" class="idref" href="#lookup_successor"><span class="id" title="lemma">lookup_successor</span></a>:<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="A:47" class="idref" href="#A:47"><span class="id" title="binder">A</span></a> <a id="x:48" class="idref" href="#x:48"><span class="id" title="binder">x</span></a> (<a id="e:49" class="idref" href="#e:49"><span class="id" title="binder">e</span></a> : <a class="idref" href="MailboxTypes.Dblib.Environments.html#env"><span class="id" title="definition">env</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#A:47"><span class="id" title="variable">A</span></a>),<br/>
&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.Environments.html#lookup"><span class="id" title="definition">lookup</span></a> (<a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#S"><span class="id" title="constructor">S</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#x:48"><span class="id" title="variable">x</span></a>) <a class="idref" href="MailboxTypes.Dblib.Environments.html#e:49"><span class="id" title="variable">e</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#lookup"><span class="id" title="definition">lookup</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#x:48"><span class="id" title="variable">x</span></a> (<span class="id" title="abbreviation">tail</span> <a class="idref" href="MailboxTypes.Dblib.Environments.html#e:49"><span class="id" title="variable">e</span></a>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">e</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">do</span> 2 <span class="id" title="tactic">rewrite</span> <a class="idref" href="MailboxTypes.Dblib.Environments.html#lookup_empty_None"><span class="id" title="lemma">lookup_empty_None</span></a>. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">reflexivity</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="comment">(*&nbsp;----------------------------------------------------------------------------&nbsp;*)</span><br/>

<br/>
<span class="comment">(*&nbsp;Interaction&nbsp;between&nbsp;<span class="inlinecode"><span class="id" title="var">lookup</span></span>&nbsp;and&nbsp;<span class="inlinecode"><span class="id" title="var">insert</span></span>.&nbsp;*)</span><br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="lookup_insert_bingo" class="idref" href="#lookup_insert_bingo"><span class="id" title="lemma">lookup_insert_bingo</span></a>:<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="A:50" class="idref" href="#A:50"><span class="id" title="binder">A</span></a> <a id="x:51" class="idref" href="#x:51"><span class="id" title="binder">x</span></a> <a id="y:52" class="idref" href="#y:52"><span class="id" title="binder">y</span></a> (<a id="o:53" class="idref" href="#o:53"><span class="id" title="binder">o</span></a> : <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#option"><span class="id" title="inductive">option</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#A:50"><span class="id" title="variable">A</span></a>) <a id="e:54" class="idref" href="#e:54"><span class="id" title="binder">e</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.Environments.html#x:51"><span class="id" title="variable">x</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#y:52"><span class="id" title="variable">y</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.Environments.html#lookup"><span class="id" title="definition">lookup</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#x:51"><span class="id" title="variable">x</span></a> (<a class="idref" href="MailboxTypes.Dblib.Environments.html#raw_insert"><span class="id" title="definition">raw_insert</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#y:52"><span class="id" title="variable">y</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#o:53"><span class="id" title="variable">o</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#e:54"><span class="id" title="variable">e</span></a>) <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#o:53"><span class="id" title="variable">o</span></a>.<br/>
<span class="comment">(*&nbsp;Hence,&nbsp;<span class="inlinecode"><span class="id" title="var">lookup</span></span> <span class="inlinecode"><span class="id" title="var">x</span></span> <span class="inlinecode">(<span class="id" title="var">insert</span></span> <span class="inlinecode"><span class="id" title="var">y</span></span> <span class="inlinecode"><span class="id" title="var">a</span></span> <span class="inlinecode"><span class="id" title="var">e</span>)</span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">Some</span></span> <span class="inlinecode"><span class="id" title="var">a</span></span>.&nbsp;*)</span><br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">x</span>; <span class="id" title="tactic">intros</span>; <span class="id" title="tactic">destruct</span> <span class="id" title="var">y</span>; <span class="id" title="tactic">destruct</span> <span class="id" title="var">e</span>; <span class="id" title="tactic">simpl</span>; <span class="id" title="tactic">intuition</span>; <span class="id" title="var">lia</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="lookup_insert_recent" class="idref" href="#lookup_insert_recent"><span class="id" title="lemma">lookup_insert_recent</span></a>:<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="A:55" class="idref" href="#A:55"><span class="id" title="binder">A</span></a> <a id="x:56" class="idref" href="#x:56"><span class="id" title="binder">x</span></a> <a id="y:57" class="idref" href="#y:57"><span class="id" title="binder">y</span></a> (<a id="o:58" class="idref" href="#o:58"><span class="id" title="binder">o</span></a> : <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#option"><span class="id" title="inductive">option</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#A:55"><span class="id" title="variable">A</span></a>) <a id="e:59" class="idref" href="#e:59"><span class="id" title="binder">e</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.Environments.html#x:56"><span class="id" title="variable">x</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Peano.html#::nat_scope:x_'&lt;'_x"><span class="id" title="notation">&lt;</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#y:57"><span class="id" title="variable">y</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.Environments.html#lookup"><span class="id" title="definition">lookup</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#x:56"><span class="id" title="variable">x</span></a> (<a class="idref" href="MailboxTypes.Dblib.Environments.html#raw_insert"><span class="id" title="definition">raw_insert</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#y:57"><span class="id" title="variable">y</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#o:58"><span class="id" title="variable">o</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#e:59"><span class="id" title="variable">e</span></a>) <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#lookup"><span class="id" title="definition">lookup</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#x:56"><span class="id" title="variable">x</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#e:59"><span class="id" title="variable">e</span></a>.<br/>
<span class="comment">(*&nbsp;Hence,&nbsp;<span class="inlinecode"><span class="id" title="var">lookup</span></span> <span class="inlinecode"><span class="id" title="var">x</span></span> <span class="inlinecode">(<span class="id" title="var">insert</span></span> <span class="inlinecode"><span class="id" title="var">y</span></span> <span class="inlinecode"><span class="id" title="var">a</span></span> <span class="inlinecode"><span class="id" title="var">e</span>)</span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">lookup</span></span> <span class="inlinecode"><span class="id" title="var">x</span></span> <span class="inlinecode"><span class="id" title="var">e</span></span>.&nbsp;*)</span><br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">x</span>; <span class="id" title="tactic">intros</span>; <span class="id" title="tactic">destruct</span> <span class="id" title="var">y</span>; <span class="id" title="tactic">destruct</span> <span class="id" title="var">e</span>; <span class="id" title="tactic">simpl</span>; <span class="id" title="tactic">intuition</span>; <span class="id" title="tactic">try</span> <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="comment">(*&nbsp;One&nbsp;troublesome&nbsp;case.&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">erewrite</span> &lt;- <a class="idref" href="MailboxTypes.Dblib.Environments.html#lookup_empty_None"><span class="id" title="lemma">lookup_empty_None</span></a>. <span class="id" title="tactic">intuition</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="lookup_insert_old" class="idref" href="#lookup_insert_old"><span class="id" title="lemma">lookup_insert_old</span></a>:<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="A:60" class="idref" href="#A:60"><span class="id" title="binder">A</span></a> <a id="x:61" class="idref" href="#x:61"><span class="id" title="binder">x</span></a> <a id="y:62" class="idref" href="#y:62"><span class="id" title="binder">y</span></a> (<a id="o:63" class="idref" href="#o:63"><span class="id" title="binder">o</span></a> : <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#option"><span class="id" title="inductive">option</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#A:60"><span class="id" title="variable">A</span></a>) <a id="e:64" class="idref" href="#e:64"><span class="id" title="binder">e</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.Environments.html#x:61"><span class="id" title="variable">x</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Peano.html#::nat_scope:x_'&gt;'_x"><span class="id" title="notation">&gt;</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#y:62"><span class="id" title="variable">y</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.Environments.html#lookup"><span class="id" title="definition">lookup</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#x:61"><span class="id" title="variable">x</span></a> (<a class="idref" href="MailboxTypes.Dblib.Environments.html#raw_insert"><span class="id" title="definition">raw_insert</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#y:62"><span class="id" title="variable">y</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#o:63"><span class="id" title="variable">o</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#e:64"><span class="id" title="variable">e</span></a>) <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#lookup"><span class="id" title="definition">lookup</span></a> (<a class="idref" href="MailboxTypes.Dblib.Environments.html#x:61"><span class="id" title="variable">x</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Peano.html#::nat_scope:x_'-'_x"><span class="id" title="notation">-</span></a> 1) <a class="idref" href="MailboxTypes.Dblib.Environments.html#e:64"><span class="id" title="variable">e</span></a>.<br/>
<span class="comment">(*&nbsp;Hence,&nbsp;<span class="inlinecode"><span class="id" title="var">lookup</span></span> <span class="inlinecode"><span class="id" title="var">x</span></span> <span class="inlinecode">(<span class="id" title="var">insert</span></span> <span class="inlinecode"><span class="id" title="var">y</span></span> <span class="inlinecode"><span class="id" title="var">a</span></span> <span class="inlinecode"><span class="id" title="var">e</span>)</span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">lookup</span></span> <span class="inlinecode">(<span class="id" title="var">x</span></span> <span class="inlinecode">-</span> <span class="inlinecode">1)</span> <span class="inlinecode"><span class="id" title="var">e</span></span>.&nbsp;*)</span><br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Induction&nbsp;over&nbsp;<span class="inlinecode"><span class="id" title="var">x</span></span>,&nbsp;which&nbsp;is&nbsp;non-zero.&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">x</span>; <span class="id" title="tactic">intros</span>; [ <span class="id" title="var">exfalso</span>; <span class="id" title="var">lia</span> | <span class="id" title="tactic">replace</span> (<a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#S"><span class="id" title="constructor">S</span></a> <span class="id" title="var">x</span> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Peano.html#::nat_scope:x_'-'_x"><span class="id" title="notation">-</span></a> 1) <span class="id" title="keyword">with</span> <span class="id" title="var">x</span> <span class="id" title="tactic">by</span> <span class="id" title="var">lia</span> ].<br/>
&nbsp;&nbsp;- { <span class="comment">(*&nbsp;Case&nbsp;analysis.&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">y</span>; <span class="id" title="tactic">destruct</span> <span class="id" title="var">e</span>; <span class="id" title="tactic">simpl</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">solve</span> [ <span class="id" title="tactic">eauto</span> ].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="comment">(*&nbsp;One&nbsp;troublesome&nbsp;case.&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <a class="idref" href="MailboxTypes.Dblib.Environments.html#lookup_empty_None"><span class="id" title="lemma">lookup_empty_None</span></a>. <span class="id" title="var">erewrite</span> &lt;- <a class="idref" href="MailboxTypes.Dblib.Environments.html#lookup_empty_None"><span class="id" title="lemma">lookup_empty_None</span></a>. <span class="id" title="tactic">intuition</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="comment">(*&nbsp;Another&nbsp;troublesome&nbsp;case.&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">x</span>; <span class="id" title="tactic">intros</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[ <span class="id" title="var">exfalso</span>; <span class="id" title="var">lia</span> | <span class="id" title="tactic">replace</span> (<a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#S"><span class="id" title="constructor">S</span></a> <span class="id" title="var">x</span> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Peano.html#::nat_scope:x_'-'_x"><span class="id" title="notation">-</span></a> 1) <span class="id" title="keyword">with</span> <span class="id" title="var">x</span> <span class="id" title="tactic">in</span> * <span class="id" title="tactic">by</span> <span class="id" title="var">lia</span> ].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simpl</span> <a class="idref" href="MailboxTypes.Dblib.Environments.html#lookup"><span class="id" title="definition">lookup</span></a> <span class="id" title="tactic">at</span> 2.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intuition</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="lookup_shift_insert" class="idref" href="#lookup_shift_insert"><span class="id" title="lemma">lookup_shift_insert</span></a>:<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="A:65" class="idref" href="#A:65"><span class="id" title="binder">A</span></a> <a id="x:66" class="idref" href="#x:66"><span class="id" title="binder">x</span></a> <a id="y:67" class="idref" href="#y:67"><span class="id" title="binder">y</span></a> (<a id="o:68" class="idref" href="#o:68"><span class="id" title="binder">o</span></a> : <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#option"><span class="id" title="inductive">option</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#A:65"><span class="id" title="variable">A</span></a>) <a id="e:69" class="idref" href="#e:69"><span class="id" title="binder">e</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.Environments.html#lookup"><span class="id" title="definition">lookup</span></a> (<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#shift"><span class="id" title="abbreviation">shift</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#y:67"><span class="id" title="variable">y</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#x:66"><span class="id" title="variable">x</span></a>) (<a class="idref" href="MailboxTypes.Dblib.Environments.html#raw_insert"><span class="id" title="definition">raw_insert</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#y:67"><span class="id" title="variable">y</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#o:68"><span class="id" title="variable">o</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#e:69"><span class="id" title="variable">e</span></a>) <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#lookup"><span class="id" title="definition">lookup</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#x:66"><span class="id" title="variable">x</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#e:69"><span class="id" title="variable">e</span></a>.<br/>
<span class="comment">(*&nbsp;Hence,&nbsp;<span class="inlinecode"><span class="id" title="var">lookup</span></span> <span class="inlinecode">(<span class="id" title="var">shift</span></span> <span class="inlinecode"><span class="id" title="var">y</span></span> <span class="inlinecode"><span class="id" title="var">x</span>)</span> <span class="inlinecode">(<span class="id" title="var">insert</span></span> <span class="inlinecode"><span class="id" title="var">y</span></span> <span class="inlinecode"><span class="id" title="var">a</span></span> <span class="inlinecode"><span class="id" title="var">e</span>)</span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">lookup</span></span> <span class="inlinecode"><span class="id" title="var">x</span></span> <span class="inlinecode"><span class="id" title="var">e</span></span>.&nbsp;*)</span><br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="var">destruct_lift_idx</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">rewrite</span> <a class="idref" href="MailboxTypes.Dblib.Environments.html#lookup_insert_old"><span class="id" title="lemma">lookup_insert_old</span></a> <span class="id" title="tactic">by</span> <span class="id" title="var">lia</span>. <span class="id" title="tactic">f_equal</span>. <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">rewrite</span> <a class="idref" href="MailboxTypes.Dblib.Environments.html#lookup_insert_recent"><span class="id" title="lemma">lookup_insert_recent</span></a> <span class="id" title="tactic">by</span> <span class="id" title="var">lia</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">lookup_insert</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="tactic">first</span> [<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <a class="idref" href="MailboxTypes.Dblib.Environments.html#lookup_insert_bingo"><span class="id" title="lemma">lookup_insert_bingo</span></a> <span class="id" title="tactic">by</span> <span class="id" title="var">lia</span><br/>
&nbsp;&nbsp;| <span class="id" title="tactic">rewrite</span> <a class="idref" href="MailboxTypes.Dblib.Environments.html#lookup_insert_old"><span class="id" title="lemma">lookup_insert_old</span></a> <span class="id" title="tactic">by</span> <span class="id" title="var">lia</span>; <span class="id" title="var">one_plus_x_minus_one</span><br/>
&nbsp;&nbsp;| <span class="id" title="tactic">rewrite</span> <a class="idref" href="MailboxTypes.Dblib.Environments.html#lookup_insert_recent"><span class="id" title="lemma">lookup_insert_recent</span></a> <span class="id" title="tactic">by</span> <span class="id" title="var">lia</span><br/>
&nbsp;&nbsp;| <span class="id" title="tactic">rewrite</span> <a class="idref" href="MailboxTypes.Dblib.Environments.html#lookup_shift_insert"><span class="id" title="lemma">lookup_shift_insert</span></a><br/>
&nbsp;&nbsp;].<br/>

<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">lookup_insert_all</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="tactic">first</span> [<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <a class="idref" href="MailboxTypes.Dblib.Environments.html#lookup_insert_bingo"><span class="id" title="lemma">lookup_insert_bingo</span></a> <span class="id" title="tactic">in</span> * <span class="id" title="tactic">by</span> <span class="id" title="var">lia</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> <span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span> <span class="id" title="var">h</span>: <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <span class="id" title="var">_</span> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <span class="id" title="var">_</span> |- <span class="id" title="var">_</span> =&gt; <span class="id" title="tactic">injection</span> <span class="id" title="var">h</span>; <span class="id" title="tactic">intro</span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">clear</span> <span class="id" title="var">h</span> <span class="id" title="keyword">end</span><br/>
&nbsp;&nbsp;| <span class="id" title="tactic">rewrite</span> <a class="idref" href="MailboxTypes.Dblib.Environments.html#lookup_insert_old"><span class="id" title="lemma">lookup_insert_old</span></a> <span class="id" title="tactic">in</span> * <span class="id" title="tactic">by</span> <span class="id" title="var">lia</span>; <span class="id" title="var">one_plus_x_minus_one</span><br/>
&nbsp;&nbsp;| <span class="id" title="tactic">rewrite</span> <a class="idref" href="MailboxTypes.Dblib.Environments.html#lookup_insert_recent"><span class="id" title="lemma">lookup_insert_recent</span></a> <span class="id" title="tactic">in</span> * <span class="id" title="tactic">by</span> <span class="id" title="var">lia</span><br/>
&nbsp;&nbsp;| <span class="id" title="tactic">rewrite</span> <a class="idref" href="MailboxTypes.Dblib.Environments.html#lookup_shift_insert"><span class="id" title="lemma">lookup_shift_insert</span></a> <span class="id" title="tactic">in</span> *<br/>
&nbsp;&nbsp;].<br/>

<br/>
<span class="id" title="keyword">Hint Extern</span> 1 (<a class="idref" href="MailboxTypes.Dblib.Environments.html#lookup"><span class="id" title="definition">lookup</span></a> <span class="id" title="var">_</span> (<a class="idref" href="MailboxTypes.Dblib.Environments.html#raw_insert"><span class="id" title="definition">raw_insert</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>) <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <span class="id" title="var">_</span>) =&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">lookup_insert</span><br/>
: <span class="id" title="var">lookup_insert</span>.<br/>

<br/>
<span class="id" title="keyword">Hint Extern</span> 1 (<a class="idref" href="MailboxTypes.Dblib.Environments.html#lookup"><span class="id" title="definition">lookup</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <span class="id" title="var">_</span>) =&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">lookup_insert_all</span><br/>
: <span class="id" title="var">lookup_insert</span>.<br/>

<br/>
<span class="comment">(*&nbsp;----------------------------------------------------------------------------&nbsp;*)</span><br/>

<br/>
<span class="comment">(*&nbsp;Interaction&nbsp;between&nbsp;<span class="inlinecode"><span class="id" title="var">map</span></span>&nbsp;and&nbsp;<span class="inlinecode"><span class="id" title="var">empty</span></span>.&nbsp;*)</span><br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="map_empty" class="idref" href="#map_empty"><span class="id" title="lemma">map_empty</span></a>:<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="A:70" class="idref" href="#A:70"><span class="id" title="binder">A</span></a> <a id="B:71" class="idref" href="#B:71"><span class="id" title="binder">B</span></a> (<a id="f:72" class="idref" href="#f:72"><span class="id" title="binder">f</span></a> : <a class="idref" href="MailboxTypes.Dblib.Environments.html#A:70"><span class="id" title="variable">A</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#B:71"><span class="id" title="variable">B</span></a>),<br/>
&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.Environments.html#map"><span class="id" title="definition">map</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#f:72"><span class="id" title="variable">f</span></a> (@<a class="idref" href="MailboxTypes.Dblib.Environments.html#empty"><span class="id" title="definition">empty</span></a> <span class="id" title="var">_</span>) <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> @<a class="idref" href="MailboxTypes.Dblib.Environments.html#empty"><span class="id" title="definition">empty</span></a> <span class="id" title="var">_</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">reflexivity</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="comment">(*&nbsp;----------------------------------------------------------------------------&nbsp;*)</span><br/>

<br/>
<span class="comment">(*&nbsp;Interaction&nbsp;between&nbsp;<span class="inlinecode"><span class="id" title="var">lookup</span></span>&nbsp;and&nbsp;<span class="inlinecode"><span class="id" title="var">map</span></span>.&nbsp;*)</span><br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="lookup_map_none" class="idref" href="#lookup_map_none"><span class="id" title="lemma">lookup_map_none</span></a>:<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="A:73" class="idref" href="#A:73"><span class="id" title="binder">A</span></a> <a id="B:74" class="idref" href="#B:74"><span class="id" title="binder">B</span></a> <a id="x:75" class="idref" href="#x:75"><span class="id" title="binder">x</span></a> <a id="e:76" class="idref" href="#e:76"><span class="id" title="binder">e</span></a> (<a id="f:77" class="idref" href="#f:77"><span class="id" title="binder">f</span></a> : <a class="idref" href="MailboxTypes.Dblib.Environments.html#A:73"><span class="id" title="variable">A</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#B:74"><span class="id" title="variable">B</span></a>),<br/>
&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.Environments.html#lookup"><span class="id" title="definition">lookup</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#x:75"><span class="id" title="variable">x</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#e:76"><span class="id" title="variable">e</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#None"><span class="id" title="constructor">None</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.Environments.html#lookup"><span class="id" title="definition">lookup</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#x:75"><span class="id" title="variable">x</span></a> (<a class="idref" href="MailboxTypes.Dblib.Environments.html#map"><span class="id" title="definition">map</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#f:77"><span class="id" title="variable">f</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#e:76"><span class="id" title="variable">e</span></a>) <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#None"><span class="id" title="constructor">None</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">x</span>; <span class="id" title="tactic">intros</span>; <span class="id" title="tactic">destruct</span> <span class="id" title="var">e</span> <span class="id" title="keyword">as</span> [ | [ | ] ? ]; <span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> *; <span class="id" title="tactic">subst</span>;<br/>
&nbsp;&nbsp;<span class="id" title="tactic">solve</span> [ <span class="id" title="tactic">eauto</span> | <span class="id" title="tactic">congruence</span> ].<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="lookup_map_some" class="idref" href="#lookup_map_some"><span class="id" title="lemma">lookup_map_some</span></a>:<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="A:78" class="idref" href="#A:78"><span class="id" title="binder">A</span></a> <a id="B:79" class="idref" href="#B:79"><span class="id" title="binder">B</span></a> <a id="x:80" class="idref" href="#x:80"><span class="id" title="binder">x</span></a> <a id="a:81" class="idref" href="#a:81"><span class="id" title="binder">a</span></a> <a id="e:82" class="idref" href="#e:82"><span class="id" title="binder">e</span></a> (<a id="f:83" class="idref" href="#f:83"><span class="id" title="binder">f</span></a> : <a class="idref" href="MailboxTypes.Dblib.Environments.html#A:78"><span class="id" title="variable">A</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#B:79"><span class="id" title="variable">B</span></a>),<br/>
&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.Environments.html#lookup"><span class="id" title="definition">lookup</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#x:80"><span class="id" title="variable">x</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#e:82"><span class="id" title="variable">e</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#a:81"><span class="id" title="variable">a</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.Environments.html#lookup"><span class="id" title="definition">lookup</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#x:80"><span class="id" title="variable">x</span></a> (<a class="idref" href="MailboxTypes.Dblib.Environments.html#map"><span class="id" title="definition">map</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#f:83"><span class="id" title="variable">f</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#e:82"><span class="id" title="variable">e</span></a>) <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="MailboxTypes.Dblib.Environments.html#f:83"><span class="id" title="variable">f</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#a:81"><span class="id" title="variable">a</span></a>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">x</span>; <span class="id" title="tactic">intros</span>; <span class="id" title="tactic">destruct</span> <span class="id" title="var">e</span> <span class="id" title="keyword">as</span> [ | [ | ] ? ]; <span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> *; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">solve</span> [<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">congruence</span><br/>
&nbsp;&nbsp;| <span class="id" title="tactic">eauto</span><br/>
&nbsp;&nbsp;].<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="lookup_map_some_reverse" class="idref" href="#lookup_map_some_reverse"><span class="id" title="lemma">lookup_map_some_reverse</span></a>:<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="A:84" class="idref" href="#A:84"><span class="id" title="binder">A</span></a> <a id="B:85" class="idref" href="#B:85"><span class="id" title="binder">B</span></a> <a id="x:86" class="idref" href="#x:86"><span class="id" title="binder">x</span></a> <a id="b:87" class="idref" href="#b:87"><span class="id" title="binder">b</span></a> <a id="e:88" class="idref" href="#e:88"><span class="id" title="binder">e</span></a> (<a id="f:89" class="idref" href="#f:89"><span class="id" title="binder">f</span></a> : <a class="idref" href="MailboxTypes.Dblib.Environments.html#A:84"><span class="id" title="variable">A</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#B:85"><span class="id" title="variable">B</span></a>),<br/>
&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.Environments.html#lookup"><span class="id" title="definition">lookup</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#x:86"><span class="id" title="variable">x</span></a> (<a class="idref" href="MailboxTypes.Dblib.Environments.html#map"><span class="id" title="definition">map</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#f:89"><span class="id" title="variable">f</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#e:88"><span class="id" title="variable">e</span></a>) <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#b:87"><span class="id" title="variable">b</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">exists</span></a> <a id="a:90" class="idref" href="#a:90"><span class="id" title="binder">a</span></a><a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">,</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.Environments.html#lookup"><span class="id" title="definition">lookup</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#x:86"><span class="id" title="variable">x</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#e:88"><span class="id" title="variable">e</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#a:90"><span class="id" title="variable">a</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#b:87"><span class="id" title="variable">b</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#f:89"><span class="id" title="variable">f</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#a:90"><span class="id" title="variable">a</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">x</span>; <span class="id" title="tactic">intros</span>; <span class="id" title="tactic">destruct</span> <span class="id" title="var">e</span> <span class="id" title="keyword">as</span> [ | [ | ] ? ]; <span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> *; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">solve</span> [<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">congruence</span><br/>
&nbsp;&nbsp;| <span class="id" title="tactic">eauto</span><br/>
&nbsp;&nbsp;].<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">eexists</span>. <span class="id" title="tactic">split</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="tactic">congruence</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="comment">(*&nbsp;----------------------------------------------------------------------------&nbsp;*)</span><br/>

<br/>
<span class="comment">(*&nbsp;<span class="inlinecode"><span class="id" title="var">insert</span></span>&nbsp;commutes&nbsp;with&nbsp;itself,&nbsp;just&nbsp;like&nbsp;<span class="inlinecode"><span class="id" title="var">lift</span></span>&nbsp;commutes&nbsp;with&nbsp;itself.&nbsp;*)</span><br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="insert_insert" class="idref" href="#insert_insert"><span class="id" title="lemma">insert_insert</span></a>:<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="A:91" class="idref" href="#A:91"><span class="id" title="binder">A</span></a> <a id="k:92" class="idref" href="#k:92"><span class="id" title="binder">k</span></a> <a id="s:93" class="idref" href="#s:93"><span class="id" title="binder">s</span></a> (<a id="a:94" class="idref" href="#a:94"><span class="id" title="binder">a</span></a> <a id="b:95" class="idref" href="#b:95"><span class="id" title="binder">b</span></a> : <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#option"><span class="id" title="inductive">option</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#A:91"><span class="id" title="variable">A</span></a>) <a id="e:96" class="idref" href="#e:96"><span class="id" title="binder">e</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.Environments.html#k:92"><span class="id" title="variable">k</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Peano.html#cb53cf0ee22c036a03b4a9281c68b5a3"><span class="id" title="notation">&lt;=</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#s:93"><span class="id" title="variable">s</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.Environments.html#raw_insert"><span class="id" title="definition">raw_insert</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#k:92"><span class="id" title="variable">k</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#a:94"><span class="id" title="variable">a</span></a> (<a class="idref" href="MailboxTypes.Dblib.Environments.html#raw_insert"><span class="id" title="definition">raw_insert</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#s:93"><span class="id" title="variable">s</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#b:95"><span class="id" title="variable">b</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#e:96"><span class="id" title="variable">e</span></a>) <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#raw_insert"><span class="id" title="definition">raw_insert</span></a> (1 <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#s:93"><span class="id" title="variable">s</span></a>) <a class="idref" href="MailboxTypes.Dblib.Environments.html#b:95"><span class="id" title="variable">b</span></a> (<a class="idref" href="MailboxTypes.Dblib.Environments.html#raw_insert"><span class="id" title="definition">raw_insert</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#k:92"><span class="id" title="variable">k</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#a:94"><span class="id" title="variable">a</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#e:96"><span class="id" title="variable">e</span></a>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> ? <span class="id" title="var">k</span> <span class="id" title="var">s</span>. <span class="id" title="tactic">generalize</span> <span class="id" title="var">s</span> <span class="id" title="var">k</span>; <span class="id" title="tactic">clear</span> <span class="id" title="var">s</span> <span class="id" title="var">k</span>. <span class="id" title="tactic">induction</span> <span class="id" title="var">s</span>; <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;Case&nbsp;<span class="inlinecode"><span class="id" title="var">s</span></span> <span class="inlinecode">=</span> <span class="inlinecode">0</span>.&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">k</span>; [ | <span class="id" title="var">exfalso</span>; <span class="id" title="var">lia</span> ]. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;Case&nbsp;<span class="inlinecode"><span class="id" title="var">s</span></span> <span class="inlinecode">&gt;</span> <span class="inlinecode">0</span>.&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">destruct</span> <span class="id" title="var">k</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="comment">(*&nbsp;Sub-case&nbsp;<span class="inlinecode"><span class="id" title="var">k</span></span> <span class="inlinecode">=</span> <span class="inlinecode">0</span>.&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="comment">(*&nbsp;Sub-case&nbsp;<span class="inlinecode"><span class="id" title="var">k</span></span> <span class="inlinecode">&gt;</span> <span class="inlinecode">0</span>.&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">e</span>; <span class="id" title="tactic">replace</span> (1 <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#S"><span class="id" title="constructor">S</span></a> <span class="id" title="var">s</span>) <span class="id" title="keyword">with</span> (<a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#S"><span class="id" title="constructor">S</span></a> (1 <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a> <span class="id" title="var">s</span>)) <span class="id" title="tactic">by</span> <span class="id" title="var">lia</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simpl</span>; <span class="id" title="tactic">f_equal</span>; <span class="id" title="tactic">intuition</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="comment">(*&nbsp;Even&nbsp;when&nbsp;it&nbsp;is&nbsp;not&nbsp;known&nbsp;which&nbsp;of&nbsp;<span class="inlinecode"><span class="id" title="var">k</span></span>&nbsp;and&nbsp;<span class="inlinecode"><span class="id" title="var">s</span></span>&nbsp;is&nbsp;greater,&nbsp;<span class="inlinecode"><span class="id" title="var">insert</span></span>&nbsp;commutes<br/>
&nbsp;&nbsp;&nbsp;with&nbsp;itself.&nbsp;The&nbsp;formula&nbsp;is&nbsp;slightly&nbsp;horrid,&nbsp;but&nbsp;can&nbsp;be&nbsp;very&nbsp;useful.&nbsp;*)</span><br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="insert_insert_always" class="idref" href="#insert_insert_always"><span class="id" title="lemma">insert_insert_always</span></a>:<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="A:97" class="idref" href="#A:97"><span class="id" title="binder">A</span></a> <a id="k:98" class="idref" href="#k:98"><span class="id" title="binder">k</span></a> <a id="s:99" class="idref" href="#s:99"><span class="id" title="binder">s</span></a> (<a id="a:100" class="idref" href="#a:100"><span class="id" title="binder">a</span></a> <a id="b:101" class="idref" href="#b:101"><span class="id" title="binder">b</span></a> : <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#option"><span class="id" title="inductive">option</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#A:97"><span class="id" title="variable">A</span></a>) <a id="e:102" class="idref" href="#e:102"><span class="id" title="binder">e</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.Environments.html#raw_insert"><span class="id" title="definition">raw_insert</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#k:98"><span class="id" title="variable">k</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#a:100"><span class="id" title="variable">a</span></a> (<a class="idref" href="MailboxTypes.Dblib.Environments.html#raw_insert"><span class="id" title="definition">raw_insert</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#s:99"><span class="id" title="variable">s</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#b:101"><span class="id" title="variable">b</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#e:102"><span class="id" title="variable">e</span></a>) <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.Environments.html#raw_insert"><span class="id" title="definition">raw_insert</span></a> (<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#shift"><span class="id" title="abbreviation">shift</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#k:98"><span class="id" title="variable">k</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#s:99"><span class="id" title="variable">s</span></a>) <a class="idref" href="MailboxTypes.Dblib.Environments.html#b:101"><span class="id" title="variable">b</span></a> (<a class="idref" href="MailboxTypes.Dblib.Environments.html#raw_insert"><span class="id" title="definition">raw_insert</span></a> (<span class="id" title="keyword">if</span> <span class="id" title="definition">le_gt_dec</span> <a class="idref" href="MailboxTypes.Dblib.Environments.html#k:98"><span class="id" title="variable">k</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#s:99"><span class="id" title="variable">s</span></a> <span class="id" title="keyword">then</span> <a class="idref" href="MailboxTypes.Dblib.Environments.html#k:98"><span class="id" title="variable">k</span></a> <span class="id" title="keyword">else</span> <a class="idref" href="MailboxTypes.Dblib.Environments.html#k:98"><span class="id" title="variable">k</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Peano.html#::nat_scope:x_'-'_x"><span class="id" title="notation">-</span></a> 1) <a class="idref" href="MailboxTypes.Dblib.Environments.html#a:100"><span class="id" title="variable">a</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#e:102"><span class="id" title="variable">e</span></a>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="definition">le_gt_dec</span> <span class="id" title="var">k</span> <span class="id" title="var">s</span>).<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">rewrite</span> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#lift_idx_old"><span class="id" title="lemma">lift_idx_old</span></a> <span class="id" title="tactic">by</span> <span class="id" title="tactic">assumption</span>. <span class="id" title="tactic">eauto</span> <span class="id" title="keyword">using</span> <a class="idref" href="MailboxTypes.Dblib.Environments.html#insert_insert"><span class="id" title="lemma">insert_insert</span></a>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">rewrite</span> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#lift_idx_recent"><span class="id" title="lemma">lift_idx_recent</span></a> <span class="id" title="tactic">by</span> <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">replace</span> <span class="id" title="var">k</span> <span class="id" title="keyword">with</span> (1 <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">(</span></a><span class="id" title="var">k</span> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Peano.html#::nat_scope:x_'-'_x"><span class="id" title="notation">-</span></a> 1<a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">)</span></a>) <span class="id" title="tactic">in</span> * <span class="id" title="tactic">by</span> <span class="id" title="var">lia</span>. <span class="id" title="tactic">rewrite</span> &lt;- <a class="idref" href="MailboxTypes.Dblib.Environments.html#insert_insert"><span class="id" title="lemma">insert_insert</span></a> <span class="id" title="tactic">by</span> <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">do</span> 2 <span class="id" title="tactic">f_equal</span>. <span class="id" title="var">lia</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="comment">(*&nbsp;Attempting&nbsp;to&nbsp;rewrite&nbsp;in&nbsp;both&nbsp;directions&nbsp;may&nbsp;seem&nbsp;redundant,&nbsp;because&nbsp;of&nbsp;the<br/>
&nbsp;&nbsp;&nbsp;symmetry&nbsp;of&nbsp;the&nbsp;law&nbsp;<span class="inlinecode"><span class="id" title="var">insert_insert</span></span>.&nbsp;It&nbsp;is&nbsp;not:&nbsp;because&nbsp;<span class="inlinecode"><span class="id" title="var">lia</span></span>&nbsp;fails&nbsp;in<br/>
&nbsp;&nbsp;&nbsp;the&nbsp;presence&nbsp;of&nbsp;meta-variables,&nbsp;rewriting&nbsp;in&nbsp;one&nbsp;direction&nbsp;may&nbsp;be&nbsp;possible<br/>
&nbsp;&nbsp;&nbsp;while&nbsp;the&nbsp;other&nbsp;direction&nbsp;fails.&nbsp;*)</span><br/>

<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">insert_insert</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="tactic">first</span> [<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span>    <a class="idref" href="MailboxTypes.Dblib.Environments.html#insert_insert"><span class="id" title="lemma">insert_insert</span></a>; [ <span class="id" title="tactic">reflexivity</span> | <span class="id" title="var">lia</span> ]<br/>
&nbsp;&nbsp;| <span class="id" title="tactic">rewrite</span> &lt;- <a class="idref" href="MailboxTypes.Dblib.Environments.html#insert_insert"><span class="id" title="lemma">insert_insert</span></a>; [ <span class="id" title="tactic">reflexivity</span> | <span class="id" title="var">lia</span> ]<br/>
&nbsp;&nbsp;].<br/>

<br/>
<span class="id" title="keyword">Hint Extern</span> 1 (<a class="idref" href="MailboxTypes.Dblib.Environments.html#raw_insert"><span class="id" title="definition">raw_insert</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <span class="id" title="var">_</span>) =&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">insert_insert</span><br/>
: <span class="id" title="var">insert_insert</span>.<br/>

<br/>
<span class="id" title="keyword">Hint Extern</span> 1 (<span class="id" title="var">_</span> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#raw_insert"><span class="id" title="definition">raw_insert</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>) =&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">insert_insert</span><br/>
: <span class="id" title="var">insert_insert</span>.<br/>

<br/>
<span class="comment">(*&nbsp;The&nbsp;result&nbsp;of&nbsp;an&nbsp;insertion&nbsp;cannot&nbsp;be&nbsp;nil.&nbsp;*)</span><br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="insert_nil" class="idref" href="#insert_nil"><span class="id" title="lemma">insert_nil</span></a>:<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="A:103" class="idref" href="#A:103"><span class="id" title="binder">A</span></a> <a id="x:104" class="idref" href="#x:104"><span class="id" title="binder">x</span></a> <a id="a:105" class="idref" href="#a:105"><span class="id" title="binder">a</span></a> (<a id="e:106" class="idref" href="#e:106"><span class="id" title="binder">e</span></a> : <a class="idref" href="MailboxTypes.Dblib.Environments.html#env"><span class="id" title="definition">env</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#A:103"><span class="id" title="variable">A</span></a>),<br/>
&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.Environments.html#insert"><span class="id" title="abbreviation">insert</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#x:104"><span class="id" title="variable">x</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#a:105"><span class="id" title="variable">a</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#e:106"><span class="id" title="variable">e</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#nil"><span class="id" title="constructor">nil</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#False"><span class="id" title="inductive">False</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">x</span>; <span class="id" title="tactic">destruct</span> <span class="id" title="var">e</span>; <span class="id" title="tactic">simpl</span>; <span class="id" title="tactic">congruence</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="comment">(*&nbsp;Two&nbsp;lemmas&nbsp;about&nbsp;equations&nbsp;of&nbsp;the&nbsp;form&nbsp;<span class="inlinecode"><span class="id" title="var">insert</span></span> <span class="inlinecode"><span class="id" title="var">x</span></span> <span class="inlinecode"><span class="id" title="var">a1</span></span> <span class="inlinecode"><span class="id" title="var">e1</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">insert</span></span> <span class="inlinecode"><span class="id" title="var">x</span></span> <span class="inlinecode"><span class="id" title="var">a2</span></span> <span class="inlinecode"><span class="id" title="var">e2</span></span>.<br/>
&nbsp;&nbsp;&nbsp;Note&nbsp;that&nbsp;we&nbsp;have&nbsp;<span class="inlinecode"><span class="id" title="var">a1</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">a2</span></span>,&nbsp;but&nbsp;not&nbsp;<span class="inlinecode"><span class="id" title="var">e1</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">e2</span></span>,&nbsp;due&nbsp;to&nbsp;padding.&nbsp;*)</span><br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="insert_eq_insert_1" class="idref" href="#insert_eq_insert_1"><span class="id" title="lemma">insert_eq_insert_1</span></a>:<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="A:107" class="idref" href="#A:107"><span class="id" title="binder">A</span></a> <a id="x:108" class="idref" href="#x:108"><span class="id" title="binder">x</span></a> <a id="a1:109" class="idref" href="#a1:109"><span class="id" title="binder">a1</span></a> <a id="a2:110" class="idref" href="#a2:110"><span class="id" title="binder">a2</span></a> (<a id="e1:111" class="idref" href="#e1:111"><span class="id" title="binder">e1</span></a> <a id="e2:112" class="idref" href="#e2:112"><span class="id" title="binder">e2</span></a> : <a class="idref" href="MailboxTypes.Dblib.Environments.html#env"><span class="id" title="definition">env</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#A:107"><span class="id" title="variable">A</span></a>),<br/>
&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.Environments.html#insert"><span class="id" title="abbreviation">insert</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#x:108"><span class="id" title="variable">x</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#a1:109"><span class="id" title="variable">a1</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#e1:111"><span class="id" title="variable">e1</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#insert"><span class="id" title="abbreviation">insert</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#x:108"><span class="id" title="variable">x</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#a2:110"><span class="id" title="variable">a2</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#e2:112"><span class="id" title="variable">e2</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.Environments.html#a1:109"><span class="id" title="variable">a1</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#a2:110"><span class="id" title="variable">a2</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<a class="idref" href="MailboxTypes.Dblib.Environments.html#lookup"><span class="id" title="definition">lookup</span></a> <span class="id" title="var">x</span> (<a class="idref" href="MailboxTypes.Dblib.Environments.html#insert"><span class="id" title="abbreviation">insert</span></a> <span class="id" title="var">x</span> <span class="id" title="var">a1</span> <span class="id" title="var">e1</span>) <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <span class="id" title="var">a1</span>). <span class="id" title="tactic">eauto</span> <span class="id" title="keyword">using</span> <a class="idref" href="MailboxTypes.Dblib.Environments.html#lookup_insert_bingo"><span class="id" title="lemma">lookup_insert_bingo</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<a class="idref" href="MailboxTypes.Dblib.Environments.html#lookup"><span class="id" title="definition">lookup</span></a> <span class="id" title="var">x</span> (<a class="idref" href="MailboxTypes.Dblib.Environments.html#insert"><span class="id" title="abbreviation">insert</span></a> <span class="id" title="var">x</span> <span class="id" title="var">a2</span> <span class="id" title="var">e2</span>) <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <span class="id" title="var">a2</span>). <span class="id" title="tactic">eauto</span> <span class="id" title="keyword">using</span> <a class="idref" href="MailboxTypes.Dblib.Environments.html#lookup_insert_bingo"><span class="id" title="lemma">lookup_insert_bingo</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">congruence</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="insert_eq_insert_2" class="idref" href="#insert_eq_insert_2"><span class="id" title="lemma">insert_eq_insert_2</span></a>:<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="A:113" class="idref" href="#A:113"><span class="id" title="binder">A</span></a> <a id="x:114" class="idref" href="#x:114"><span class="id" title="binder">x</span></a> <a id="a1:115" class="idref" href="#a1:115"><span class="id" title="binder">a1</span></a> <a id="a2:116" class="idref" href="#a2:116"><span class="id" title="binder">a2</span></a> (<a id="e1:117" class="idref" href="#e1:117"><span class="id" title="binder">e1</span></a> <a id="e2:118" class="idref" href="#e2:118"><span class="id" title="binder">e2</span></a> : <a class="idref" href="MailboxTypes.Dblib.Environments.html#env"><span class="id" title="definition">env</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#A:113"><span class="id" title="variable">A</span></a>),<br/>
&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.Environments.html#insert"><span class="id" title="abbreviation">insert</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#x:114"><span class="id" title="variable">x</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#a1:115"><span class="id" title="variable">a1</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#e1:117"><span class="id" title="variable">e1</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#insert"><span class="id" title="abbreviation">insert</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#x:114"><span class="id" title="variable">x</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#a2:116"><span class="id" title="variable">a2</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#e2:118"><span class="id" title="variable">e2</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="b:119" class="idref" href="#b:119"><span class="id" title="binder">b</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.Environments.html#insert"><span class="id" title="abbreviation">insert</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#x:114"><span class="id" title="variable">x</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#b:119"><span class="id" title="variable">b</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#e1:117"><span class="id" title="variable">e1</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#insert"><span class="id" title="abbreviation">insert</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#x:114"><span class="id" title="variable">x</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#b:119"><span class="id" title="variable">b</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#e2:118"><span class="id" title="variable">e2</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">x</span>; <span class="id" title="tactic">simpl</span>; <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">congruence</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">destruct</span> <span class="id" title="var">e1</span>; <span class="id" title="tactic">destruct</span> <span class="id" title="var">e2</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span> <span class="id" title="var">h</span>: <span class="id" title="var">_</span> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <span class="id" title="var">_</span> |- <span class="id" title="var">_</span> =&gt; <span class="id" title="tactic">injection</span> <span class="id" title="var">h</span>; <span class="id" title="tactic">clear</span> <span class="id" title="var">h</span>; <span class="id" title="tactic">intros</span> <span class="id" title="keyword">end</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">f_equal</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">congruence</span>; <span class="id" title="tactic">eauto</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="comment">(*&nbsp;This&nbsp;is&nbsp;a&nbsp;really&nbsp;crazy&nbsp;diamond&nbsp;lemma&nbsp;that&nbsp;says,&nbsp;roughly,&nbsp;if&nbsp;the&nbsp;equation<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="inlinecode"><span class="id" title="var">insert</span></span> <span class="inlinecode"><span class="id" title="var">x1</span></span> <span class="inlinecode"><span class="id" title="var">a1</span></span> <span class="inlinecode"><span class="id" title="var">e1</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">insert</span></span> <span class="inlinecode"><span class="id" title="var">x2</span></span> <span class="inlinecode"><span class="id" title="var">a2</span></span> <span class="inlinecode"><span class="id" title="var">e2</span></span>&nbsp;holds,&nbsp;then&nbsp;<span class="inlinecode"><span class="id" title="var">e1</span></span>&nbsp;and&nbsp;<span class="inlinecode"><span class="id" title="var">e2</span></span>&nbsp;can&nbsp;be<br/>
&nbsp;&nbsp;&nbsp;&nbsp;constructed&nbsp;out&nbsp;of&nbsp;a&nbsp;common&nbsp;environment&nbsp;<span class="inlinecode"><span class="id" title="var">e</span></span>.&nbsp;We&nbsp;would&nbsp;like&nbsp;to&nbsp;conclude<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="inlinecode"><span class="id" title="var">e1</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">insert</span></span> <span class="inlinecode"><span class="id" title="var">x2</span></span> <span class="inlinecode"><span class="id" title="var">a2</span></span> <span class="inlinecode"><span class="id" title="var">e</span></span> <span class="inlinecode">/\</span> <span class="inlinecode"><span class="id" title="var">e2</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">insert</span></span> <span class="inlinecode"><span class="id" title="var">x1</span></span> <span class="inlinecode"><span class="id" title="var">a1</span></span> <span class="inlinecode"><span class="id" title="var">e</span></span>,&nbsp;but&nbsp;this&nbsp;is&nbsp;false,&nbsp;because<br/>
&nbsp;&nbsp;&nbsp;&nbsp;one&nbsp;of&nbsp;the&nbsp;indices&nbsp;is&nbsp;off-by-one&nbsp;in&nbsp;one&nbsp;way&nbsp;or&nbsp;the&nbsp;other.&nbsp;We&nbsp;need&nbsp;to<br/>
&nbsp;&nbsp;&nbsp;&nbsp;adjust,&nbsp;and&nbsp;the&nbsp;arithmetic&nbsp;is&nbsp;a&nbsp;bit&nbsp;painful.&nbsp;*)</span><br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="insert_eq_insert_3" class="idref" href="#insert_eq_insert_3"><span class="id" title="lemma">insert_eq_insert_3</span></a>:<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="A:120" class="idref" href="#A:120"><span class="id" title="binder">A</span></a> <a id="x1:121" class="idref" href="#x1:121"><span class="id" title="binder">x1</span></a> <a id="x2:122" class="idref" href="#x2:122"><span class="id" title="binder">x2</span></a> <a id="a1:123" class="idref" href="#a1:123"><span class="id" title="binder">a1</span></a> <a id="a2:124" class="idref" href="#a2:124"><span class="id" title="binder">a2</span></a> (<a id="e1:125" class="idref" href="#e1:125"><span class="id" title="binder">e1</span></a> <a id="e2:126" class="idref" href="#e2:126"><span class="id" title="binder">e2</span></a> : <a class="idref" href="MailboxTypes.Dblib.Environments.html#env"><span class="id" title="definition">env</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#A:120"><span class="id" title="variable">A</span></a>),<br/>
&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.Environments.html#insert"><span class="id" title="abbreviation">insert</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#x1:121"><span class="id" title="variable">x1</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#a1:123"><span class="id" title="variable">a1</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#e1:125"><span class="id" title="variable">e1</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#insert"><span class="id" title="abbreviation">insert</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#x2:122"><span class="id" title="variable">x2</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#a2:124"><span class="id" title="variable">a2</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#e2:126"><span class="id" title="variable">e2</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.Environments.html#x1:121"><span class="id" title="variable">x1</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'&lt;&gt;'_x"><span class="id" title="notation">&lt;&gt;</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#x2:122"><span class="id" title="variable">x2</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">exists</span></a> <a id="e:127" class="idref" href="#e:127"><span class="id" title="binder">e</span></a> <a id="y1:128" class="idref" href="#y1:128"><span class="id" title="binder">y1</span></a> <a id="y2:129" class="idref" href="#y2:129"><span class="id" title="binder">y2</span></a><a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">,</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.Environments.html#e1:125"><span class="id" title="variable">e1</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#insert"><span class="id" title="abbreviation">insert</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#y1:128"><span class="id" title="variable">y1</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#a2:124"><span class="id" title="variable">a2</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#e:127"><span class="id" title="variable">e</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.Environments.html#e2:126"><span class="id" title="variable">e2</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#insert"><span class="id" title="abbreviation">insert</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#y2:129"><span class="id" title="variable">y2</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#a1:123"><span class="id" title="variable">a1</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#e:127"><span class="id" title="variable">e</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#shift"><span class="id" title="abbreviation">shift</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#x1:121"><span class="id" title="variable">x1</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#y1:128"><span class="id" title="variable">y1</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#x2:122"><span class="id" title="variable">x2</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.Environments.html#y2:129"><span class="id" title="variable">y2</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">(</span></a><span class="id" title="keyword">if</span> <span class="id" title="definition">le_gt_dec</span> <a class="idref" href="MailboxTypes.Dblib.Environments.html#x1:121"><span class="id" title="variable">x1</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#y1:128"><span class="id" title="variable">y1</span></a> <span class="id" title="keyword">then</span> <a class="idref" href="MailboxTypes.Dblib.Environments.html#x1:121"><span class="id" title="variable">x1</span></a> <span class="id" title="keyword">else</span> <a class="idref" href="MailboxTypes.Dblib.Environments.html#x1:121"><span class="id" title="variable">x1</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Peano.html#::nat_scope:x_'-'_x"><span class="id" title="notation">-</span></a> 1<a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">)</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">x1</span>; <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;Case&nbsp;<span class="inlinecode"><span class="id" title="var">x1</span></span> <span class="inlinecode">=</span> <span class="inlinecode">0</span>.&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">destruct</span> <span class="id" title="var">x2</span>; [ <span class="id" title="var">lia</span> | ].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">rewrite</span> <a class="idref" href="MailboxTypes.Dblib.Environments.html#raw_insert_zero"><span class="id" title="lemma">raw_insert_zero</span></a> <span class="id" title="tactic">in</span> *. <span class="id" title="tactic">rewrite</span> <a class="idref" href="MailboxTypes.Dblib.Environments.html#raw_insert_successor"><span class="id" title="lemma">raw_insert_successor</span></a> <span class="id" title="tactic">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span> <span class="id" title="var">h</span>: <span class="id" title="var">_</span> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <span class="id" title="var">_</span> |- <span class="id" title="var">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">injection</span> <span class="id" title="var">h</span>; <span class="id" title="tactic">clear</span> <span class="id" title="var">h</span>; <span class="id" title="tactic">intros</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">destruct</span> <span class="id" title="var">e2</span>; [ <span class="id" title="tactic">congruence</span> | ].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">subst</span>. <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">exists</span> <span class="id" title="var">e2</span>. <span class="id" title="tactic">exists</span> <span class="id" title="var">x2</span>. <span class="id" title="tactic">exists</span> 0. <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;Case&nbsp;<span class="inlinecode"><span class="id" title="var">x1</span></span> <span class="inlinecode">&gt;</span> <span class="inlinecode">0</span>.&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">destruct</span> <span class="id" title="var">x2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="comment">(*&nbsp;Sub-case&nbsp;<span class="inlinecode"><span class="id" title="var">x2</span></span> <span class="inlinecode">=</span> <span class="inlinecode">0</span>.&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <a class="idref" href="MailboxTypes.Dblib.Environments.html#raw_insert_zero"><span class="id" title="lemma">raw_insert_zero</span></a> <span class="id" title="tactic">in</span> *. <span class="id" title="tactic">rewrite</span> <a class="idref" href="MailboxTypes.Dblib.Environments.html#raw_insert_successor"><span class="id" title="lemma">raw_insert_successor</span></a> <span class="id" title="tactic">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span> <span class="id" title="var">h</span>: <span class="id" title="var">_</span> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <span class="id" title="var">_</span> |- <span class="id" title="var">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">injection</span> <span class="id" title="var">h</span>; <span class="id" title="tactic">clear</span> <span class="id" title="var">h</span>; <span class="id" title="tactic">intros</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">destruct</span> <span class="id" title="var">e1</span>; [ <span class="id" title="tactic">congruence</span> | ]. <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">exists</span> <span class="id" title="var">e1</span>. <span class="id" title="tactic">exists</span> 0. <span class="id" title="tactic">exists</span> <span class="id" title="var">x1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">split</span>. <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">split</span>. <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">split</span>. <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">dblib_by_cases</span>. <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="comment">(*&nbsp;Sub-case&nbsp;<span class="inlinecode"><span class="id" title="var">x2</span></span> <span class="inlinecode">&gt;</span> <span class="inlinecode">0</span>.&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">do</span> 2 <span class="id" title="tactic">rewrite</span> <a class="idref" href="MailboxTypes.Dblib.Environments.html#raw_insert_successor"><span class="id" title="lemma">raw_insert_successor</span></a> <span class="id" title="tactic">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">xx</span>: <span class="id" title="var">x1</span> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'&lt;&gt;'_x"><span class="id" title="notation">&lt;&gt;</span></a> <span class="id" title="var">x2</span>). <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span> <span class="id" title="var">h</span>: <span class="id" title="var">_</span> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <span class="id" title="var">_</span> |- <span class="id" title="var">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">injection</span> <span class="id" title="var">h</span>; <span class="id" title="tactic">clear</span> <span class="id" title="var">h</span>; <span class="id" title="tactic">intros</span> <span class="id" title="var">h</span> ?;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">generalize</span> (<span class="id" title="var">IHx1</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">h</span> <span class="id" title="var">xx</span>); <span class="id" title="tactic">intros</span> [ <span class="id" title="var">e</span> [ <span class="id" title="var">y1</span> [ <span class="id" title="var">y2</span> [ ? [ ? [ ? ? ]]]]]]<br/>
        <span class="id" title="keyword">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;<span class="inlinecode"><span class="id" title="var">e1</span></span>&nbsp;and&nbsp;<span class="inlinecode"><span class="id" title="var">e2</span></span>&nbsp;must&nbsp;be&nbsp;non-nil.&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">destruct</span> <span class="id" title="var">e1</span>; <span class="id" title="tactic">simpl</span> <span class="id" title="definition">tl</span> <span class="id" title="tactic">in</span> *; [ <span class="id" title="var">exfalso</span>; <span class="id" title="tactic">eauto</span> <span class="id" title="keyword">using</span> <a class="idref" href="MailboxTypes.Dblib.Environments.html#insert_nil"><span class="id" title="lemma">insert_nil</span></a> | ].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">destruct</span> <span class="id" title="var">e2</span>; <span class="id" title="tactic">simpl</span> <span class="id" title="definition">tl</span> <span class="id" title="tactic">in</span> *; [ <span class="id" title="var">exfalso</span>; <span class="id" title="tactic">eauto</span> <span class="id" title="keyword">using</span> <a class="idref" href="MailboxTypes.Dblib.Environments.html#insert_nil"><span class="id" title="lemma">insert_nil</span></a> | ].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">exists</span> (<span class="id" title="var">o</span> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#::list_scope:x_'::'_x"><span class="id" title="notation">::</span></a> <span class="id" title="var">e</span>). <span class="id" title="tactic">exists</span> (<a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#S"><span class="id" title="constructor">S</span></a> <span class="id" title="var">y1</span>). <span class="id" title="tactic">exists</span> (<a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#S"><span class="id" title="constructor">S</span></a> <span class="id" title="var">y2</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">split</span>. <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">split</span>. <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">split</span>. <span class="id" title="tactic">eapply</span> <a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#translate_lift"><span class="id" title="lemma">translate_lift</span></a> <span class="id" title="keyword">with</span> (<span class="id" title="var">k</span> := 1). <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">dblib_by_cases</span>; <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}}<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="comment">(*&nbsp;----------------------------------------------------------------------------&nbsp;*)</span><br/>

<br/>
<span class="comment">(*&nbsp;Interaction&nbsp;between&nbsp;<span class="inlinecode"><span class="id" title="var">map</span></span>&nbsp;and&nbsp;<span class="inlinecode"><span class="id" title="var">insert</span></span>.&nbsp;*)</span><br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="map_insert" class="idref" href="#map_insert"><span class="id" title="lemma">map_insert</span></a>:<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="A:130" class="idref" href="#A:130"><span class="id" title="binder">A</span></a> <a id="B:131" class="idref" href="#B:131"><span class="id" title="binder">B</span></a> (<a id="f:132" class="idref" href="#f:132"><span class="id" title="binder">f</span></a> : <a class="idref" href="MailboxTypes.Dblib.Environments.html#A:130"><span class="id" title="variable">A</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#B:131"><span class="id" title="variable">B</span></a>) <a id="x:133" class="idref" href="#x:133"><span class="id" title="binder">x</span></a> <a id="a:134" class="idref" href="#a:134"><span class="id" title="binder">a</span></a> <a id="e:135" class="idref" href="#e:135"><span class="id" title="binder">e</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.Environments.html#map"><span class="id" title="definition">map</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#f:132"><span class="id" title="variable">f</span></a> (<a class="idref" href="MailboxTypes.Dblib.Environments.html#insert"><span class="id" title="abbreviation">insert</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#x:133"><span class="id" title="variable">x</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#a:134"><span class="id" title="variable">a</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#e:135"><span class="id" title="variable">e</span></a>) <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#insert"><span class="id" title="abbreviation">insert</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#x:133"><span class="id" title="variable">x</span></a> (<a class="idref" href="MailboxTypes.Dblib.Environments.html#f:132"><span class="id" title="variable">f</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#a:134"><span class="id" title="variable">a</span></a>) (<a class="idref" href="MailboxTypes.Dblib.Environments.html#map"><span class="id" title="definition">map</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#f:132"><span class="id" title="variable">f</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#e:135"><span class="id" title="variable">e</span></a>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">x</span>; <span class="id" title="tactic">intros</span>; <span class="id" title="tactic">destruct</span> <span class="id" title="var">e</span>; <span class="id" title="tactic">simpl</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">rewrite</span> <span class="id" title="var">IHx</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span> <span class="id" title="var">o</span>: <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#option"><span class="id" title="inductive">option</span></a> <span class="id" title="var">_</span> |- <span class="id" title="var">_</span> =&gt; <span class="id" title="tactic">destruct</span> <span class="id" title="var">o</span> <span class="id" title="keyword">end</span>; <span class="id" title="tactic">f_equal</span>; <span class="id" title="tactic">eauto</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="comment">(*&nbsp;The&nbsp;following&nbsp;variant&nbsp;is&nbsp;easier&nbsp;to&nbsp;use&nbsp;for&nbsp;<span class="inlinecode"><span class="id" title="tactic">eauto</span></span>.&nbsp;*)</span><br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="map_insert_eq" class="idref" href="#map_insert_eq"><span class="id" title="lemma">map_insert_eq</span></a>:<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="A:136" class="idref" href="#A:136"><span class="id" title="binder">A</span></a> <a id="B:137" class="idref" href="#B:137"><span class="id" title="binder">B</span></a> (<a id="f:138" class="idref" href="#f:138"><span class="id" title="binder">f</span></a> : <a class="idref" href="MailboxTypes.Dblib.Environments.html#A:136"><span class="id" title="variable">A</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#B:137"><span class="id" title="variable">B</span></a>) <a id="x:139" class="idref" href="#x:139"><span class="id" title="binder">x</span></a> <a id="a:140" class="idref" href="#a:140"><span class="id" title="binder">a</span></a> <a id="b:141" class="idref" href="#b:141"><span class="id" title="binder">b</span></a> <a id="e:142" class="idref" href="#e:142"><span class="id" title="binder">e</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.Environments.html#f:138"><span class="id" title="variable">f</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#a:140"><span class="id" title="variable">a</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#b:141"><span class="id" title="variable">b</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.Environments.html#map"><span class="id" title="definition">map</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#f:138"><span class="id" title="variable">f</span></a> (<a class="idref" href="MailboxTypes.Dblib.Environments.html#insert"><span class="id" title="abbreviation">insert</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#x:139"><span class="id" title="variable">x</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#a:140"><span class="id" title="variable">a</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#e:142"><span class="id" title="variable">e</span></a>) <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#insert"><span class="id" title="abbreviation">insert</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#x:139"><span class="id" title="variable">x</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#b:141"><span class="id" title="variable">b</span></a> (<a class="idref" href="MailboxTypes.Dblib.Environments.html#map"><span class="id" title="definition">map</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#f:138"><span class="id" title="variable">f</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#e:142"><span class="id" title="variable">e</span></a>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>; <span class="id" title="tactic">subst</span>. <span class="id" title="tactic">eapply</span> <a class="idref" href="MailboxTypes.Dblib.Environments.html#map_insert"><span class="id" title="lemma">map_insert</span></a>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">map_insert</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="tactic">first</span> [<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <a class="idref" href="MailboxTypes.Dblib.Environments.html#map_insert"><span class="id" title="lemma">map_insert</span></a>; <span class="id" title="tactic">reflexivity</span><br/>
&nbsp;&nbsp;| <span class="id" title="tactic">rewrite</span> &lt;- <a class="idref" href="MailboxTypes.Dblib.Environments.html#map_insert"><span class="id" title="lemma">map_insert</span></a>; <span class="id" title="tactic">reflexivity</span><br/>
&nbsp;&nbsp;].<br/>

<br/>
<span class="id" title="keyword">Hint Extern</span> 1 (<a class="idref" href="MailboxTypes.Dblib.Environments.html#map"><span class="id" title="definition">map</span></a> <span class="id" title="var">_</span> (<a class="idref" href="MailboxTypes.Dblib.Environments.html#insert"><span class="id" title="abbreviation">insert</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>) <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#insert"><span class="id" title="abbreviation">insert</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> (<a class="idref" href="MailboxTypes.Dblib.Environments.html#map"><span class="id" title="definition">map</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span>)) =&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">map_insert</span><br/>
: <span class="id" title="var">map_insert</span>.<br/>

<br/>
<span class="id" title="keyword">Hint Extern</span> 1 (<a class="idref" href="MailboxTypes.Dblib.Environments.html#insert"><span class="id" title="abbreviation">insert</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> (<a class="idref" href="MailboxTypes.Dblib.Environments.html#map"><span class="id" title="definition">map</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span>) <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#map"><span class="id" title="definition">map</span></a> <span class="id" title="var">_</span> (<a class="idref" href="MailboxTypes.Dblib.Environments.html#insert"><span class="id" title="abbreviation">insert</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>)) =&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">map_insert</span><br/>
: <span class="id" title="var">map_insert</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="map_raw_insert" class="idref" href="#map_raw_insert"><span class="id" title="lemma">map_raw_insert</span></a>:<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="A:143" class="idref" href="#A:143"><span class="id" title="binder">A</span></a> <a id="B:144" class="idref" href="#B:144"><span class="id" title="binder">B</span></a> (<a id="f:145" class="idref" href="#f:145"><span class="id" title="binder">f</span></a> : <a class="idref" href="MailboxTypes.Dblib.Environments.html#A:143"><span class="id" title="variable">A</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#B:144"><span class="id" title="variable">B</span></a>) <a id="x:146" class="idref" href="#x:146"><span class="id" title="binder">x</span></a> <a id="e:147" class="idref" href="#e:147"><span class="id" title="binder">e</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.Environments.html#map"><span class="id" title="definition">map</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#f:145"><span class="id" title="variable">f</span></a> (<a class="idref" href="MailboxTypes.Dblib.Environments.html#raw_insert"><span class="id" title="definition">raw_insert</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#x:146"><span class="id" title="variable">x</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#None"><span class="id" title="constructor">None</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#e:147"><span class="id" title="variable">e</span></a>) <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#raw_insert"><span class="id" title="definition">raw_insert</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#x:146"><span class="id" title="variable">x</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#None"><span class="id" title="constructor">None</span></a> (<a class="idref" href="MailboxTypes.Dblib.Environments.html#map"><span class="id" title="definition">map</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#f:145"><span class="id" title="variable">f</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#e:147"><span class="id" title="variable">e</span></a>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">x</span>; <span class="id" title="tactic">intros</span>; <span class="id" title="tactic">destruct</span> <span class="id" title="var">e</span>; <span class="id" title="tactic">simpl</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">rewrite</span> <span class="id" title="var">IHx</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span> <span class="id" title="var">o</span>: <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#option"><span class="id" title="inductive">option</span></a> <span class="id" title="var">_</span> |- <span class="id" title="var">_</span> =&gt; <span class="id" title="tactic">destruct</span> <span class="id" title="var">o</span> <span class="id" title="keyword">end</span>; <span class="id" title="tactic">f_equal</span>; <span class="id" title="tactic">eauto</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="comment">(*&nbsp;----------------------------------------------------------------------------&nbsp;*)</span><br/>

<br/>
<span class="comment">(*&nbsp;<span class="inlinecode"><span class="id" title="var">map</span></span>&nbsp;composes&nbsp;with&nbsp;itself.&nbsp;*)</span><br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="map_map_fuse" class="idref" href="#map_map_fuse"><span class="id" title="lemma">map_map_fuse</span></a>:<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="A:148" class="idref" href="#A:148"><span class="id" title="binder">A</span></a> <a id="B:149" class="idref" href="#B:149"><span class="id" title="binder">B</span></a> <a id="C:150" class="idref" href="#C:150"><span class="id" title="binder">C</span></a> (<a id="f:151" class="idref" href="#f:151"><span class="id" title="binder">f</span></a> : <a class="idref" href="MailboxTypes.Dblib.Environments.html#B:149"><span class="id" title="variable">B</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#C:150"><span class="id" title="variable">C</span></a>) (<a id="g:152" class="idref" href="#g:152"><span class="id" title="binder">g</span></a> : <a class="idref" href="MailboxTypes.Dblib.Environments.html#A:148"><span class="id" title="variable">A</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#B:149"><span class="id" title="variable">B</span></a>) <a id="h:153" class="idref" href="#h:153"><span class="id" title="binder">h</span></a> <a id="e:154" class="idref" href="#e:154"><span class="id" title="binder">e</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">(</span></a><span class="id" title="keyword">forall</span> (<a id="d:155" class="idref" href="#d:155"><span class="id" title="binder">d</span></a> : <a class="idref" href="MailboxTypes.Dblib.Environments.html#A:148"><span class="id" title="variable">A</span></a>), <a class="idref" href="MailboxTypes.Dblib.Environments.html#f:151"><span class="id" title="variable">f</span></a> (<a class="idref" href="MailboxTypes.Dblib.Environments.html#g:152"><span class="id" title="variable">g</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#d:155"><span class="id" title="variable">d</span></a>) <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#h:153"><span class="id" title="variable">h</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#d:155"><span class="id" title="variable">d</span></a><a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">)</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.Environments.html#map"><span class="id" title="definition">map</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#f:151"><span class="id" title="variable">f</span></a> (<a class="idref" href="MailboxTypes.Dblib.Environments.html#map"><span class="id" title="definition">map</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#g:152"><span class="id" title="variable">g</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#e:154"><span class="id" title="variable">e</span></a>) <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#map"><span class="id" title="definition">map</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#h:153"><span class="id" title="variable">h</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#e:154"><span class="id" title="variable">e</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">e</span>; <span class="id" title="tactic">intros</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> <span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span> <span class="id" title="var">o</span>: <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#option"><span class="id" title="inductive">option</span></a> <span class="id" title="var">_</span> |- <span class="id" title="var">_</span> =&gt; <span class="id" title="tactic">destruct</span> <span class="id" title="var">o</span> <span class="id" title="keyword">end</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simpl</span>; <span class="id" title="tactic">eauto</span> <span class="id" title="keyword">with</span> <span class="id" title="tactic">f_equal</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="map_map_exchange" class="idref" href="#map_map_exchange"><span class="id" title="lemma">map_map_exchange</span></a>:<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="A:156" class="idref" href="#A:156"><span class="id" title="binder">A</span></a> <a id="F:157" class="idref" href="#F:157"><span class="id" title="binder">F</span></a> <a id="G:158" class="idref" href="#G:158"><span class="id" title="binder">G</span></a> <a id="B:159" class="idref" href="#B:159"><span class="id" title="binder">B</span></a> (<a id="f1:160" class="idref" href="#f1:160"><span class="id" title="binder">f1</span></a> : <a class="idref" href="MailboxTypes.Dblib.Environments.html#F:157"><span class="id" title="variable">F</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#B:159"><span class="id" title="variable">B</span></a>) (<a id="f2:161" class="idref" href="#f2:161"><span class="id" title="binder">f2</span></a> : <a class="idref" href="MailboxTypes.Dblib.Environments.html#A:156"><span class="id" title="variable">A</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#F:157"><span class="id" title="variable">F</span></a>) (<a id="g1:162" class="idref" href="#g1:162"><span class="id" title="binder">g1</span></a> : <a class="idref" href="MailboxTypes.Dblib.Environments.html#G:158"><span class="id" title="variable">G</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#B:159"><span class="id" title="variable">B</span></a>) (<a id="g2:163" class="idref" href="#g2:163"><span class="id" title="binder">g2</span></a> : <a class="idref" href="MailboxTypes.Dblib.Environments.html#A:156"><span class="id" title="variable">A</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#G:158"><span class="id" title="variable">G</span></a>) <a id="e:164" class="idref" href="#e:164"><span class="id" title="binder">e</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">(</span></a><span class="id" title="keyword">forall</span> (<a id="d:165" class="idref" href="#d:165"><span class="id" title="binder">d</span></a> : <a class="idref" href="MailboxTypes.Dblib.Environments.html#A:156"><span class="id" title="variable">A</span></a>), <a class="idref" href="MailboxTypes.Dblib.Environments.html#f1:160"><span class="id" title="variable">f1</span></a> (<a class="idref" href="MailboxTypes.Dblib.Environments.html#f2:161"><span class="id" title="variable">f2</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#d:165"><span class="id" title="variable">d</span></a>) <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#g1:162"><span class="id" title="variable">g1</span></a> (<a class="idref" href="MailboxTypes.Dblib.Environments.html#g2:163"><span class="id" title="variable">g2</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#d:165"><span class="id" title="variable">d</span></a>)<a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">)</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.Environments.html#map"><span class="id" title="definition">map</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#f1:160"><span class="id" title="variable">f1</span></a> (<a class="idref" href="MailboxTypes.Dblib.Environments.html#map"><span class="id" title="definition">map</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#f2:161"><span class="id" title="variable">f2</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#e:164"><span class="id" title="variable">e</span></a>) <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#map"><span class="id" title="definition">map</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#g1:162"><span class="id" title="variable">g1</span></a> (<a class="idref" href="MailboxTypes.Dblib.Environments.html#map"><span class="id" title="definition">map</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#g2:163"><span class="id" title="variable">g2</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#e:164"><span class="id" title="variable">e</span></a>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">e</span>; <span class="id" title="tactic">intros</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> <span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span> <span class="id" title="var">o</span>: <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#option"><span class="id" title="inductive">option</span></a> <span class="id" title="var">_</span> |- <span class="id" title="var">_</span> =&gt; <span class="id" title="tactic">destruct</span> <span class="id" title="var">o</span> <span class="id" title="keyword">end</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simpl</span>; <span class="id" title="tactic">eauto</span> <span class="id" title="keyword">with</span> <span class="id" title="tactic">f_equal</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="map_lift_map_lift" class="idref" href="#map_lift_map_lift"><span class="id" title="lemma">map_lift_map_lift</span></a>:<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="T:166" class="idref" href="#T:166"><span class="id" title="binder">T</span></a> <a id="k:167" class="idref" href="#k:167"><span class="id" title="binder">k</span></a> <a id="s:168" class="idref" href="#s:168"><span class="id" title="binder">s</span></a> <a id="wk:169" class="idref" href="#wk:169"><span class="id" title="binder">wk</span></a> <a id="ws:170" class="idref" href="#ws:170"><span class="id" title="binder">ws</span></a> (<a id="e:171" class="idref" href="#e:171"><span class="id" title="binder">e</span></a> : <a class="idref" href="MailboxTypes.Dblib.Environments.html#env"><span class="id" title="definition">env</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#T:166"><span class="id" title="variable">T</span></a>),<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> `{<a id="H:172" class="idref" href="#H:172"><span class="id" title="binder">Lift</span></a> <a id="H:172" class="idref" href="#H:172"><span class="id" title="binder">T</span></a>},<br/>
&nbsp;&nbsp;@<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#LiftLift"><span class="id" title="class">LiftLift</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#T:166"><span class="id" title="variable">T</span></a> <span class="id" title="var">_</span> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.Environments.html#k:167"><span class="id" title="variable">k</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Peano.html#cb53cf0ee22c036a03b4a9281c68b5a3"><span class="id" title="notation">&lt;=</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#s:168"><span class="id" title="variable">s</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.Environments.html#map"><span class="id" title="definition">map</span></a> (<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#lift"><span class="id" title="method">lift</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#wk:169"><span class="id" title="variable">wk</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#k:167"><span class="id" title="variable">k</span></a>) (<a class="idref" href="MailboxTypes.Dblib.Environments.html#map"><span class="id" title="definition">map</span></a> (<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#lift"><span class="id" title="method">lift</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#ws:170"><span class="id" title="variable">ws</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#s:168"><span class="id" title="variable">s</span></a>) <a class="idref" href="MailboxTypes.Dblib.Environments.html#e:171"><span class="id" title="variable">e</span></a>) <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#map"><span class="id" title="definition">map</span></a> (<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#lift"><span class="id" title="method">lift</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#ws:170"><span class="id" title="variable">ws</span></a> (<a class="idref" href="MailboxTypes.Dblib.Environments.html#wk:169"><span class="id" title="variable">wk</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#s:168"><span class="id" title="variable">s</span></a>)) (<a class="idref" href="MailboxTypes.Dblib.Environments.html#map"><span class="id" title="definition">map</span></a> (<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#lift"><span class="id" title="method">lift</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#wk:169"><span class="id" title="variable">wk</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#k:167"><span class="id" title="variable">k</span></a>) <a class="idref" href="MailboxTypes.Dblib.Environments.html#e:171"><span class="id" title="variable">e</span></a>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eauto</span> <span class="id" title="keyword">using</span> <a class="idref" href="MailboxTypes.Dblib.Environments.html#map_map_exchange"><span class="id" title="lemma">map_map_exchange</span></a>, @<a class="idref" href="MailboxTypes.Dblib.DeBruijn.html#lift_lift"><span class="id" title="method">lift_lift</span></a>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="map_insert_map" class="idref" href="#map_insert_map"><span class="id" title="lemma">map_insert_map</span></a>:<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="A:173" class="idref" href="#A:173"><span class="id" title="binder">A</span></a> (<a id="f:174" class="idref" href="#f:174"><span class="id" title="binder">f</span></a> <a id="g:175" class="idref" href="#g:175"><span class="id" title="binder">g</span></a> <a id="h:176" class="idref" href="#h:176"><span class="id" title="binder">h</span></a> : <a class="idref" href="MailboxTypes.Dblib.Environments.html#A:173"><span class="id" title="variable">A</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#A:173"><span class="id" title="variable">A</span></a>) <a id="x:177" class="idref" href="#x:177"><span class="id" title="binder">x</span></a> (<a id="a:178" class="idref" href="#a:178"><span class="id" title="binder">a</span></a> : <a class="idref" href="MailboxTypes.Dblib.Environments.html#A:173"><span class="id" title="variable">A</span></a>) <a id="e:179" class="idref" href="#e:179"><span class="id" title="binder">e</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">(</span></a><span class="id" title="keyword">forall</span> <a id="a:180" class="idref" href="#a:180"><span class="id" title="binder">a</span></a>, <a class="idref" href="MailboxTypes.Dblib.Environments.html#f:174"><span class="id" title="variable">f</span></a> (<a class="idref" href="MailboxTypes.Dblib.Environments.html#g:175"><span class="id" title="variable">g</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#a:180"><span class="id" title="variable">a</span></a>) <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#g:175"><span class="id" title="variable">g</span></a> (<a class="idref" href="MailboxTypes.Dblib.Environments.html#h:176"><span class="id" title="variable">h</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#a:180"><span class="id" title="variable">a</span></a>)<a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">)</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.Environments.html#map"><span class="id" title="definition">map</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#f:174"><span class="id" title="variable">f</span></a> (<a class="idref" href="MailboxTypes.Dblib.Environments.html#insert"><span class="id" title="abbreviation">insert</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#x:177"><span class="id" title="variable">x</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#a:178"><span class="id" title="variable">a</span></a> (<a class="idref" href="MailboxTypes.Dblib.Environments.html#map"><span class="id" title="definition">map</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#g:175"><span class="id" title="variable">g</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#e:179"><span class="id" title="variable">e</span></a>)) <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.Environments.html#insert"><span class="id" title="abbreviation">insert</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#x:177"><span class="id" title="variable">x</span></a> (<a class="idref" href="MailboxTypes.Dblib.Environments.html#f:174"><span class="id" title="variable">f</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#a:178"><span class="id" title="variable">a</span></a>) (<a class="idref" href="MailboxTypes.Dblib.Environments.html#map"><span class="id" title="definition">map</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#g:175"><span class="id" title="variable">g</span></a> (<a class="idref" href="MailboxTypes.Dblib.Environments.html#map"><span class="id" title="definition">map</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#h:176"><span class="id" title="variable">h</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#e:179"><span class="id" title="variable">e</span></a>)).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <a class="idref" href="MailboxTypes.Dblib.Environments.html#map_insert"><span class="id" title="lemma">map_insert</span></a>. <span class="id" title="tactic">f_equal</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <a class="idref" href="MailboxTypes.Dblib.Environments.html#map_map_exchange"><span class="id" title="lemma">map_map_exchange</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eauto</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="map_map_vanish" class="idref" href="#map_map_vanish"><span class="id" title="lemma">map_map_vanish</span></a>:<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="A:181" class="idref" href="#A:181"><span class="id" title="binder">A</span></a> <a id="B:182" class="idref" href="#B:182"><span class="id" title="binder">B</span></a> (<a id="f:183" class="idref" href="#f:183"><span class="id" title="binder">f</span></a> : <a class="idref" href="MailboxTypes.Dblib.Environments.html#B:182"><span class="id" title="variable">B</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#A:181"><span class="id" title="variable">A</span></a>) (<a id="g:184" class="idref" href="#g:184"><span class="id" title="binder">g</span></a> : <a class="idref" href="MailboxTypes.Dblib.Environments.html#A:181"><span class="id" title="variable">A</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#B:182"><span class="id" title="variable">B</span></a>) (<a id="e:185" class="idref" href="#e:185"><span class="id" title="binder">e</span></a> : <a class="idref" href="MailboxTypes.Dblib.Environments.html#env"><span class="id" title="definition">env</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#A:181"><span class="id" title="variable">A</span></a>),<br/>
&nbsp;&nbsp;<a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">(</span></a><span class="id" title="keyword">forall</span> <a id="x:186" class="idref" href="#x:186"><span class="id" title="binder">x</span></a>, <a class="idref" href="MailboxTypes.Dblib.Environments.html#f:183"><span class="id" title="variable">f</span></a> (<a class="idref" href="MailboxTypes.Dblib.Environments.html#g:184"><span class="id" title="variable">g</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#x:186"><span class="id" title="variable">x</span></a>) <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#x:186"><span class="id" title="variable">x</span></a><a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">)</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.Environments.html#map"><span class="id" title="definition">map</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#f:183"><span class="id" title="variable">f</span></a> (<a class="idref" href="MailboxTypes.Dblib.Environments.html#map"><span class="id" title="definition">map</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#g:184"><span class="id" title="variable">g</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#e:185"><span class="id" title="variable">e</span></a>) <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#e:185"><span class="id" title="variable">e</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">e</span>; <span class="id" title="tactic">intros</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> <span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span> <span class="id" title="var">o</span>: <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#option"><span class="id" title="inductive">option</span></a> <span class="id" title="var">_</span> |- <span class="id" title="var">_</span> =&gt; <span class="id" title="tactic">destruct</span> <span class="id" title="var">o</span> <span class="id" title="keyword">end</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simpl</span>; <span class="id" title="tactic">eauto</span> <span class="id" title="keyword">with</span> <span class="id" title="tactic">f_equal</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="comment">(*&nbsp;----------------------------------------------------------------------------&nbsp;*)</span><br/>

<br/>
<span class="comment">(*&nbsp;Properties&nbsp;of&nbsp;<span class="inlinecode"><span class="id" title="tactic">fold</span></span>.&nbsp;*)</span><br/>

<br/>
<span class="comment">(*&nbsp;Interaction&nbsp;between&nbsp;<span class="inlinecode"><span class="id" title="tactic">fold</span></span>&nbsp;and&nbsp;<span class="inlinecode"><span class="id" title="var">empty</span></span>.&nbsp;*)</span><br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="fold_empty" class="idref" href="#fold_empty"><span class="id" title="lemma">fold_empty</span></a>:<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="A:187" class="idref" href="#A:187"><span class="id" title="binder">A</span></a> <a id="B:188" class="idref" href="#B:188"><span class="id" title="binder">B</span></a> (<a id="f:189" class="idref" href="#f:189"><span class="id" title="binder">f</span></a> : <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#option"><span class="id" title="inductive">option</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#A:187"><span class="id" title="variable">A</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#B:188"><span class="id" title="variable">B</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#B:188"><span class="id" title="variable">B</span></a>) <a id="accu:190" class="idref" href="#accu:190"><span class="id" title="binder">accu</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.Environments.html#fold"><span class="id" title="definition">fold</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#f:189"><span class="id" title="variable">f</span></a> (@<a class="idref" href="MailboxTypes.Dblib.Environments.html#empty"><span class="id" title="definition">empty</span></a> <span class="id" title="var">_</span>) <a class="idref" href="MailboxTypes.Dblib.Environments.html#accu:190"><span class="id" title="variable">accu</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#accu:190"><span class="id" title="variable">accu</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">reflexivity</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="comment">(*&nbsp;Interaction&nbsp;between&nbsp;<span class="inlinecode"><span class="id" title="tactic">fold</span></span>&nbsp;and&nbsp;<span class="inlinecode"><span class="id" title="var">insert</span></span>.&nbsp;*)</span><br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="fold_insert" class="idref" href="#fold_insert"><span class="id" title="lemma">fold_insert</span></a>:<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="A:191" class="idref" href="#A:191"><span class="id" title="binder">A</span></a> <a id="B:192" class="idref" href="#B:192"><span class="id" title="binder">B</span></a> (<a id="f:193" class="idref" href="#f:193"><span class="id" title="binder">f</span></a> : <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#option"><span class="id" title="inductive">option</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#A:191"><span class="id" title="variable">A</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#B:192"><span class="id" title="variable">B</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#B:192"><span class="id" title="variable">B</span></a>) <a id="o:194" class="idref" href="#o:194"><span class="id" title="binder">o</span></a> <a id="e:195" class="idref" href="#e:195"><span class="id" title="binder">e</span></a> <a id="accu:196" class="idref" href="#accu:196"><span class="id" title="binder">accu</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.Environments.html#fold"><span class="id" title="definition">fold</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#f:193"><span class="id" title="variable">f</span></a> (<a class="idref" href="MailboxTypes.Dblib.Environments.html#raw_insert"><span class="id" title="definition">raw_insert</span></a> 0 <a class="idref" href="MailboxTypes.Dblib.Environments.html#o:194"><span class="id" title="variable">o</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#e:195"><span class="id" title="variable">e</span></a>) <a class="idref" href="MailboxTypes.Dblib.Environments.html#accu:196"><span class="id" title="variable">accu</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#f:193"><span class="id" title="variable">f</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#o:194"><span class="id" title="variable">o</span></a> (<a class="idref" href="MailboxTypes.Dblib.Environments.html#fold"><span class="id" title="definition">fold</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#f:193"><span class="id" title="variable">f</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#e:195"><span class="id" title="variable">e</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#accu:196"><span class="id" title="variable">accu</span></a>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">reflexivity</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="comment">(*&nbsp;An&nbsp;induction&nbsp;principle.&nbsp;In&nbsp;order&nbsp;to&nbsp;prove&nbsp;that&nbsp;a&nbsp;property&nbsp;<span class="inlinecode"><span class="id" title="var">P</span></span>&nbsp;holds&nbsp;of<br/>
&nbsp;&nbsp;&nbsp;<span class="inlinecode"><span class="id" title="tactic">fold</span></span> <span class="inlinecode"><span class="id" title="var">f</span></span> <span class="inlinecode"><span class="id" title="var">e</span></span> <span class="inlinecode"><span class="id" title="var">accu</span></span>,&nbsp;it&nbsp;suffices&nbsp;to&nbsp;hold&nbsp;that&nbsp;it&nbsp;holds&nbsp;of&nbsp;the&nbsp;initial<br/>
&nbsp;&nbsp;&nbsp;accumulator&nbsp;and&nbsp;that&nbsp;it&nbsp;is&nbsp;preserved&nbsp;by&nbsp;one&nbsp;iteration.&nbsp;The&nbsp;statement&nbsp;is<br/>
&nbsp;&nbsp;&nbsp;expressed&nbsp;in&nbsp;terms&nbsp;of&nbsp;<span class="inlinecode"><span class="id" title="var">empty</span></span>&nbsp;and&nbsp;<span class="inlinecode"><span class="id" title="var">raw_insert</span></span>,&nbsp;so&nbsp;the&nbsp;fact&nbsp;that<br/>
&nbsp;&nbsp;&nbsp;environments&nbsp;are&nbsp;implemented&nbsp;as&nbsp;lists&nbsp;is&nbsp;not&nbsp;exposed.&nbsp;*)</span><br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="fold_invariant" class="idref" href="#fold_invariant"><span class="id" title="lemma">fold_invariant</span></a>:<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="A:197" class="idref" href="#A:197"><span class="id" title="binder">A</span></a> <a id="B:198" class="idref" href="#B:198"><span class="id" title="binder">B</span></a> (<a id="P:199" class="idref" href="#P:199"><span class="id" title="binder">P</span></a> : <a class="idref" href="MailboxTypes.Dblib.Environments.html#env"><span class="id" title="definition">env</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#A:197"><span class="id" title="variable">A</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#B:198"><span class="id" title="variable">B</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <span class="id" title="keyword">Prop</span>) <a id="f:200" class="idref" href="#f:200"><span class="id" title="binder">f</span></a> <a id="accu:201" class="idref" href="#accu:201"><span class="id" title="binder">accu</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.Environments.html#P:199"><span class="id" title="variable">P</span></a> (@<a class="idref" href="MailboxTypes.Dblib.Environments.html#empty"><span class="id" title="definition">empty</span></a> <span class="id" title="var">_</span>) <a class="idref" href="MailboxTypes.Dblib.Environments.html#accu:201"><span class="id" title="variable">accu</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">(</span></a><span class="id" title="keyword">forall</span> <a id="o:202" class="idref" href="#o:202"><span class="id" title="binder">o</span></a> <a id="e:203" class="idref" href="#e:203"><span class="id" title="binder">e</span></a> <a id="accu:204" class="idref" href="#accu:204"><span class="id" title="binder">accu</span></a>, <a class="idref" href="MailboxTypes.Dblib.Environments.html#P:199"><span class="id" title="variable">P</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#e:203"><span class="id" title="variable">e</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#accu:204"><span class="id" title="variable">accu</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#P:199"><span class="id" title="variable">P</span></a> (<a class="idref" href="MailboxTypes.Dblib.Environments.html#raw_insert"><span class="id" title="definition">raw_insert</span></a> 0 <a class="idref" href="MailboxTypes.Dblib.Environments.html#o:202"><span class="id" title="variable">o</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#e:203"><span class="id" title="variable">e</span></a>) (<a class="idref" href="MailboxTypes.Dblib.Environments.html#f:200"><span class="id" title="variable">f</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#o:202"><span class="id" title="variable">o</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#accu:204"><span class="id" title="variable">accu</span></a>)<a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">)</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="e:205" class="idref" href="#e:205"><span class="id" title="binder">e</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.Environments.html#P:199"><span class="id" title="variable">P</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#e:205"><span class="id" title="variable">e</span></a> (<a class="idref" href="MailboxTypes.Dblib.Environments.html#fold"><span class="id" title="definition">fold</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#f:200"><span class="id" title="variable">f</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#e:205"><span class="id" title="variable">e</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#accu:201"><span class="id" title="variable">accu</span></a>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> ? ? ? ? ? <span class="id" title="var">init</span> <span class="id" title="var">step</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">e</span>; <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">eapply</span> <span class="id" title="var">init</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">eapply</span> <span class="id" title="var">step</span>. <span class="id" title="tactic">eauto</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="comment">(*&nbsp;----------------------------------------------------------------------------&nbsp;*)</span><br/>

<br/>
<span class="comment">(*&nbsp;<span class="inlinecode"><span class="id" title="var">length</span></span> <span class="inlinecode"><span class="id" title="var">e</span></span>&nbsp;should&nbsp;be&nbsp;viewed&nbsp;as&nbsp;an&nbsp;upper&nbsp;bound&nbsp;on&nbsp;the&nbsp;true&nbsp;length&nbsp;of&nbsp;the<br/>
&nbsp;&nbsp;&nbsp;environment&nbsp;<span class="inlinecode"><span class="id" title="var">e</span></span>,&nbsp;since&nbsp;there&nbsp;may&nbsp;be&nbsp;useless&nbsp;<span class="inlinecode"><span class="id" title="var">None</span></span>&nbsp;entries&nbsp;at&nbsp;the&nbsp;end.<br/>
&nbsp;&nbsp;&nbsp;We&nbsp;are&nbsp;careful&nbsp;to&nbsp;always&nbsp;work&nbsp;with&nbsp;hypotheses&nbsp;and&nbsp;goals&nbsp;of&nbsp;the&nbsp;form<br/>
&nbsp;&nbsp;&nbsp;<span class="inlinecode"><span class="id" title="var">length</span></span> <span class="inlinecode"><span class="id" title="var">e</span></span> <span class="inlinecode">&lt;=</span> <span class="inlinecode"><span class="id" title="var">k</span></span>.&nbsp;*)</span><br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="length_monotonic" class="idref" href="#length_monotonic"><span class="id" title="lemma">length_monotonic</span></a>:<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="A:206" class="idref" href="#A:206"><span class="id" title="binder">A</span></a> (<a id="e:207" class="idref" href="#e:207"><span class="id" title="binder">e</span></a> : <a class="idref" href="MailboxTypes.Dblib.Environments.html#env"><span class="id" title="definition">env</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#A:206"><span class="id" title="variable">A</span></a>) <a id="k1:208" class="idref" href="#k1:208"><span class="id" title="binder">k1</span></a> <a id="k2:209" class="idref" href="#k2:209"><span class="id" title="binder">k2</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#length"><span class="id" title="definition">length</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#e:207"><span class="id" title="variable">e</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Peano.html#cb53cf0ee22c036a03b4a9281c68b5a3"><span class="id" title="notation">&lt;=</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#k1:208"><span class="id" title="variable">k1</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.Environments.html#k1:208"><span class="id" title="variable">k1</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Peano.html#cb53cf0ee22c036a03b4a9281c68b5a3"><span class="id" title="notation">&lt;=</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#k2:209"><span class="id" title="variable">k2</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#length"><span class="id" title="definition">length</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#e:207"><span class="id" title="variable">e</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Peano.html#cb53cf0ee22c036a03b4a9281c68b5a3"><span class="id" title="notation">&lt;=</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#k2:209"><span class="id" title="variable">k2</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="var">lia</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="lookup_beyond_length" class="idref" href="#lookup_beyond_length"><span class="id" title="lemma">lookup_beyond_length</span></a>:<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="A:210" class="idref" href="#A:210"><span class="id" title="binder">A</span></a> (<a id="e:211" class="idref" href="#e:211"><span class="id" title="binder">e</span></a> : <a class="idref" href="MailboxTypes.Dblib.Environments.html#env"><span class="id" title="definition">env</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#A:210"><span class="id" title="variable">A</span></a>) <a id="x:212" class="idref" href="#x:212"><span class="id" title="binder">x</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#length"><span class="id" title="definition">length</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#e:211"><span class="id" title="variable">e</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Peano.html#cb53cf0ee22c036a03b4a9281c68b5a3"><span class="id" title="notation">&lt;=</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#x:212"><span class="id" title="variable">x</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.Environments.html#lookup"><span class="id" title="definition">lookup</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#x:212"><span class="id" title="variable">x</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#e:211"><span class="id" title="variable">e</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#None"><span class="id" title="constructor">None</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">e</span>; <span class="id" title="tactic">simpl</span>; <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">eapply</span> <a class="idref" href="MailboxTypes.Dblib.Environments.html#lookup_empty_None"><span class="id" title="lemma">lookup_empty_None</span></a>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">destruct</span> <span class="id" title="var">x</span>; [ <span class="id" title="var">lia</span> | ]. <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">IHe</span>. <span class="id" title="var">lia</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="comment">(*&nbsp;Every&nbsp;variable&nbsp;that&nbsp;is&nbsp;defined&nbsp;in&nbsp;the&nbsp;environment&nbsp;is&nbsp;less&nbsp;than&nbsp;the<br/>
&nbsp;&nbsp;&nbsp;length&nbsp;of&nbsp;the&nbsp;environment.&nbsp;*)</span><br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="defined_implies_below_length" class="idref" href="#defined_implies_below_length"><span class="id" title="lemma">defined_implies_below_length</span></a>:<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="A:213" class="idref" href="#A:213"><span class="id" title="binder">A</span></a> (<a id="e:214" class="idref" href="#e:214"><span class="id" title="binder">e</span></a> : <a class="idref" href="MailboxTypes.Dblib.Environments.html#env"><span class="id" title="definition">env</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#A:213"><span class="id" title="variable">A</span></a>) <a id="x:215" class="idref" href="#x:215"><span class="id" title="binder">x</span></a> <a id="k:216" class="idref" href="#k:216"><span class="id" title="binder">k</span></a> <a id="a:217" class="idref" href="#a:217"><span class="id" title="binder">a</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#length"><span class="id" title="definition">length</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#e:214"><span class="id" title="variable">e</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Peano.html#cb53cf0ee22c036a03b4a9281c68b5a3"><span class="id" title="notation">&lt;=</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#k:216"><span class="id" title="variable">k</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.Environments.html#lookup"><span class="id" title="definition">lookup</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#x:215"><span class="id" title="variable">x</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#e:214"><span class="id" title="variable">e</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#a:217"><span class="id" title="variable">a</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.Environments.html#x:215"><span class="id" title="variable">x</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Peano.html#::nat_scope:x_'&lt;'_x"><span class="id" title="notation">&lt;</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#k:216"><span class="id" title="variable">k</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;If&nbsp;<span class="inlinecode"><span class="id" title="var">x</span></span> <span class="inlinecode">&lt;</span> <span class="inlinecode"><span class="id" title="var">k</span></span>&nbsp;holds,&nbsp;the&nbsp;result&nbsp;is&nbsp;immediate.&nbsp;Consider&nbsp;the&nbsp;other&nbsp;case,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="inlinecode"><span class="id" title="var">k</span></span> <span class="inlinecode">&lt;=</span> <span class="inlinecode"><span class="id" title="var">x</span></span>.&nbsp;*)</span><br/>
&nbsp;&nbsp;{ <span class="id" title="tactic">case</span> (<span class="id" title="definition">le_gt_dec</span> <span class="id" title="var">k</span> <span class="id" title="var">x</span>); <span class="id" title="tactic">intro</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">tauto</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;By&nbsp;definition&nbsp;of&nbsp;<span class="inlinecode"><span class="id" title="var">length</span></span>,&nbsp;<span class="inlinecode"><span class="id" title="var">lookup</span></span> <span class="inlinecode"><span class="id" title="var">x</span></span> <span class="inlinecode"><span class="id" title="var">e</span></span>&nbsp;is&nbsp;<span class="inlinecode"><span class="id" title="var">None</span></span>.&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<a class="idref" href="MailboxTypes.Dblib.Environments.html#lookup"><span class="id" title="definition">lookup</span></a> <span class="id" title="var">x</span> <span class="id" title="var">e</span> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#None"><span class="id" title="constructor">None</span></a>). <span class="id" title="tactic">eapply</span> <a class="idref" href="MailboxTypes.Dblib.Environments.html#lookup_beyond_length"><span class="id" title="lemma">lookup_beyond_length</span></a>. <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;We&nbsp;obtain&nbsp;a&nbsp;contradiction.&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">congruence</span>.<br/>
&nbsp;&nbsp;}<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Hint Resolve</span> <span class="id" title="var">defined_implies_below_length</span> : <span class="id" title="var">lift_idx_hints</span>.<br/>

<br/>
<span class="comment">(*&nbsp;The&nbsp;empty&nbsp;environment&nbsp;has&nbsp;zero&nbsp;length.&nbsp;*)</span><br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="length_empty" class="idref" href="#length_empty"><span class="id" title="lemma">length_empty</span></a>:<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="A:218" class="idref" href="#A:218"><span class="id" title="binder">A</span></a> <a id="k:219" class="idref" href="#k:219"><span class="id" title="binder">k</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#length"><span class="id" title="definition">length</span></a> (@<a class="idref" href="MailboxTypes.Dblib.Environments.html#empty"><span class="id" title="definition">empty</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#A:218"><span class="id" title="variable">A</span></a>) <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Peano.html#cb53cf0ee22c036a03b4a9281c68b5a3"><span class="id" title="notation">&lt;=</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#k:219"><span class="id" title="variable">k</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="var">lia</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="comment">(*&nbsp;This&nbsp;definition&nbsp;of&nbsp;<span class="inlinecode"><span class="id" title="var">max</span></span>&nbsp;is&nbsp;much&nbsp;more&nbsp;pleasant&nbsp;to&nbsp;work&nbsp;with&nbsp;than&nbsp;the<br/>
&nbsp;&nbsp;&nbsp;one&nbsp;found&nbsp;in&nbsp;Coq's&nbsp;standard&nbsp;library.&nbsp;It&nbsp;can&nbsp;be&nbsp;easily&nbsp;unfolded,&nbsp;and<br/>
&nbsp;&nbsp;&nbsp;then&nbsp;<span class="inlinecode"><span class="id" title="var">lia</span></span>&nbsp;takes&nbsp;control.&nbsp;*)</span><br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="mymax" class="idref" href="#mymax"><span class="id" title="definition">mymax</span></a> <a id="m:220" class="idref" href="#m:220"><span class="id" title="binder">m</span></a> <a id="n:221" class="idref" href="#n:221"><span class="id" title="binder">n</span></a> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">if</span> <span class="id" title="definition">le_gt_dec</span> <a class="idref" href="MailboxTypes.Dblib.Environments.html#m:220"><span class="id" title="variable">m</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#n:221"><span class="id" title="variable">n</span></a> <span class="id" title="keyword">then</span> <a class="idref" href="MailboxTypes.Dblib.Environments.html#n:221"><span class="id" title="variable">n</span></a> <span class="id" title="keyword">else</span> <a class="idref" href="MailboxTypes.Dblib.Environments.html#m:220"><span class="id" title="variable">m</span></a>.<br/>

<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">mymax</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="MailboxTypes.Dblib.Environments.html#mymax"><span class="id" title="definition">mymax</span></a> <span class="id" title="tactic">in</span> *; <span class="id" title="var">dblib_by_cases</span>; <span class="id" title="tactic">try</span> <span class="id" title="var">lia</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="mymax_l" class="idref" href="#mymax_l"><span class="id" title="lemma">mymax_l</span></a>:<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="i:222" class="idref" href="#i:222"><span class="id" title="binder">i</span></a> <a id="j:223" class="idref" href="#j:223"><span class="id" title="binder">j</span></a>, <a class="idref" href="MailboxTypes.Dblib.Environments.html#mymax"><span class="id" title="definition">mymax</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#i:222"><span class="id" title="variable">i</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#j:223"><span class="id" title="variable">j</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Peano.html#73030c22bc0b1fa771c65aa5414c65f9"><span class="id" title="notation">&gt;=</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#i:222"><span class="id" title="variable">i</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="var">mymax</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="mymax_r" class="idref" href="#mymax_r"><span class="id" title="lemma">mymax_r</span></a>:<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="i:224" class="idref" href="#i:224"><span class="id" title="binder">i</span></a> <a id="j:225" class="idref" href="#j:225"><span class="id" title="binder">j</span></a>, <a class="idref" href="MailboxTypes.Dblib.Environments.html#mymax"><span class="id" title="definition">mymax</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#i:224"><span class="id" title="variable">i</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#j:225"><span class="id" title="variable">j</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Peano.html#73030c22bc0b1fa771c65aa5414c65f9"><span class="id" title="notation">&gt;=</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#j:225"><span class="id" title="variable">j</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="var">mymax</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Hint Resolve</span> <span class="id" title="var">mymax_l</span> <span class="id" title="var">mymax_r</span> : <span class="id" title="var">mymax</span>.<br/>

<br/>
<span class="comment">(*&nbsp;Extending&nbsp;an&nbsp;environment&nbsp;increments&nbsp;its&nbsp;length&nbsp;by&nbsp;one,&nbsp;in&nbsp;the&nbsp;usual&nbsp;case.<br/>
&nbsp;&nbsp;&nbsp;It&nbsp;can&nbsp;be&nbsp;extended&nbsp;by&nbsp;more&nbsp;than&nbsp;one&nbsp;if&nbsp;<span class="inlinecode"><span class="id" title="var">x</span></span>&nbsp;is&nbsp;far&nbsp;away.&nbsp;*)</span><br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="length_insert_general" class="idref" href="#length_insert_general"><span class="id" title="lemma">length_insert_general</span></a>:<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="A:226" class="idref" href="#A:226"><span class="id" title="binder">A</span></a> <a id="x:227" class="idref" href="#x:227"><span class="id" title="binder">x</span></a> <a id="k:228" class="idref" href="#k:228"><span class="id" title="binder">k</span></a> <a id="o:229" class="idref" href="#o:229"><span class="id" title="binder">o</span></a> (<a id="e:230" class="idref" href="#e:230"><span class="id" title="binder">e</span></a> : <a class="idref" href="MailboxTypes.Dblib.Environments.html#env"><span class="id" title="definition">env</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#A:226"><span class="id" title="variable">A</span></a>),<br/>
&nbsp;&nbsp;<a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#length"><span class="id" title="definition">length</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#e:230"><span class="id" title="variable">e</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#k:228"><span class="id" title="variable">k</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#length"><span class="id" title="definition">length</span></a> (<a class="idref" href="MailboxTypes.Dblib.Environments.html#raw_insert"><span class="id" title="definition">raw_insert</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#x:227"><span class="id" title="variable">x</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#o:229"><span class="id" title="variable">o</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#e:230"><span class="id" title="variable">e</span></a>) <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#mymax"><span class="id" title="definition">mymax</span></a> (1 <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#k:228"><span class="id" title="variable">k</span></a>) (1 <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#x:227"><span class="id" title="variable">x</span></a>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">x</span>; <span class="id" title="tactic">simpl</span>; <span class="id" title="tactic">intros</span>; <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="var">mymax</span>.<br/>
&nbsp;&nbsp;- { <span class="id" title="tactic">destruct</span> <span class="id" title="var">e</span>; <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">mymax</span>. <span class="id" title="var">erewrite</span> <span class="id" title="var">IHx</span> <span class="id" title="tactic">by</span> <span class="id" title="tactic">reflexivity</span>. <span class="id" title="tactic">simpl</span>. <span class="id" title="var">mymax</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">erewrite</span> <span class="id" title="var">IHx</span> <span class="id" title="tactic">by</span> <span class="id" title="tactic">reflexivity</span>. <span class="id" title="var">mymax</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="comment">(*&nbsp;This&nbsp;should&nbsp;be&nbsp;the&nbsp;usual&nbsp;case.&nbsp;*)</span><br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="length_insert" class="idref" href="#length_insert"><span class="id" title="lemma">length_insert</span></a>:<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="A:231" class="idref" href="#A:231"><span class="id" title="binder">A</span></a> <a id="x:232" class="idref" href="#x:232"><span class="id" title="binder">x</span></a> <a id="k:233" class="idref" href="#k:233"><span class="id" title="binder">k</span></a> <a id="km1:234" class="idref" href="#km1:234"><span class="id" title="binder">km1</span></a> <a id="o:235" class="idref" href="#o:235"><span class="id" title="binder">o</span></a> (<a id="e:236" class="idref" href="#e:236"><span class="id" title="binder">e</span></a> : <a class="idref" href="MailboxTypes.Dblib.Environments.html#env"><span class="id" title="definition">env</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#A:231"><span class="id" title="variable">A</span></a>),<br/>
&nbsp;&nbsp;<a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#length"><span class="id" title="definition">length</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#e:236"><span class="id" title="variable">e</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Peano.html#cb53cf0ee22c036a03b4a9281c68b5a3"><span class="id" title="notation">&lt;=</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#km1:234"><span class="id" title="variable">km1</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.Environments.html#km1:234"><span class="id" title="variable">km1</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Peano.html#cb53cf0ee22c036a03b4a9281c68b5a3"><span class="id" title="notation">&lt;=</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#k:233"><span class="id" title="variable">k</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Peano.html#::nat_scope:x_'-'_x"><span class="id" title="notation">-</span></a> 1 <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.Environments.html#x:232"><span class="id" title="variable">x</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Peano.html#::nat_scope:x_'&lt;'_x"><span class="id" title="notation">&lt;</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#k:233"><span class="id" title="variable">k</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#length"><span class="id" title="definition">length</span></a> (<a class="idref" href="MailboxTypes.Dblib.Environments.html#raw_insert"><span class="id" title="definition">raw_insert</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#x:232"><span class="id" title="variable">x</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#o:235"><span class="id" title="variable">o</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#e:236"><span class="id" title="variable">e</span></a>) <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Peano.html#cb53cf0ee22c036a03b4a9281c68b5a3"><span class="id" title="notation">&lt;=</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#k:233"><span class="id" title="variable">k</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="var">erewrite</span> <a class="idref" href="MailboxTypes.Dblib.Environments.html#length_insert_general"><span class="id" title="lemma">length_insert_general</span></a> <span class="id" title="tactic">by</span> <span class="id" title="tactic">reflexivity</span>. <span class="id" title="var">mymax</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="comment">(*&nbsp;Pain,&nbsp;pain.&nbsp;*)</span><br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="length_insert_reverse_1" class="idref" href="#length_insert_reverse_1"><span class="id" title="lemma">length_insert_reverse_1</span></a>:<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="A:237" class="idref" href="#A:237"><span class="id" title="binder">A</span></a> (<a id="e:238" class="idref" href="#e:238"><span class="id" title="binder">e</span></a> : <a class="idref" href="MailboxTypes.Dblib.Environments.html#env"><span class="id" title="definition">env</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#A:237"><span class="id" title="variable">A</span></a>) <a id="k:239" class="idref" href="#k:239"><span class="id" title="binder">k</span></a> <a id="x:240" class="idref" href="#x:240"><span class="id" title="binder">x</span></a> <a id="a:241" class="idref" href="#a:241"><span class="id" title="binder">a</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#length"><span class="id" title="definition">length</span></a> (<a class="idref" href="MailboxTypes.Dblib.Environments.html#insert"><span class="id" title="abbreviation">insert</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#x:240"><span class="id" title="variable">x</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#a:241"><span class="id" title="variable">a</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#e:238"><span class="id" title="variable">e</span></a>) <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Peano.html#cb53cf0ee22c036a03b4a9281c68b5a3"><span class="id" title="notation">&lt;=</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#k:239"><span class="id" title="variable">k</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.Environments.html#x:240"><span class="id" title="variable">x</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Peano.html#::nat_scope:x_'&lt;'_x"><span class="id" title="notation">&lt;</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#k:239"><span class="id" title="variable">k</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="var">erewrite</span> <a class="idref" href="MailboxTypes.Dblib.Environments.html#length_insert_general"><span class="id" title="lemma">length_insert_general</span></a> <span class="id" title="tactic">in</span> * <span class="id" title="tactic">by</span> <span class="id" title="tactic">reflexivity</span>. <span class="id" title="var">mymax</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="length_insert_reverse_2" class="idref" href="#length_insert_reverse_2"><span class="id" title="lemma">length_insert_reverse_2</span></a>:<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="A:242" class="idref" href="#A:242"><span class="id" title="binder">A</span></a> (<a id="e:243" class="idref" href="#e:243"><span class="id" title="binder">e</span></a> : <a class="idref" href="MailboxTypes.Dblib.Environments.html#env"><span class="id" title="definition">env</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#A:242"><span class="id" title="variable">A</span></a>) <a id="k:244" class="idref" href="#k:244"><span class="id" title="binder">k</span></a> <a id="x:245" class="idref" href="#x:245"><span class="id" title="binder">x</span></a> <a id="a:246" class="idref" href="#a:246"><span class="id" title="binder">a</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#length"><span class="id" title="definition">length</span></a> (<a class="idref" href="MailboxTypes.Dblib.Environments.html#insert"><span class="id" title="abbreviation">insert</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#x:245"><span class="id" title="variable">x</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#a:246"><span class="id" title="variable">a</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#e:243"><span class="id" title="variable">e</span></a>) <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Peano.html#cb53cf0ee22c036a03b4a9281c68b5a3"><span class="id" title="notation">&lt;=</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#k:244"><span class="id" title="variable">k</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a> 1 <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#length"><span class="id" title="definition">length</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#e:243"><span class="id" title="variable">e</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Peano.html#cb53cf0ee22c036a03b4a9281c68b5a3"><span class="id" title="notation">&lt;=</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#k:244"><span class="id" title="variable">k</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="var">erewrite</span> <a class="idref" href="MailboxTypes.Dblib.Environments.html#length_insert_general"><span class="id" title="lemma">length_insert_general</span></a> <span class="id" title="tactic">in</span> * <span class="id" title="tactic">by</span> <span class="id" title="tactic">reflexivity</span>. <span class="id" title="var">mymax</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="length_insert_independent" class="idref" href="#length_insert_independent"><span class="id" title="lemma">length_insert_independent</span></a>:<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="A:247" class="idref" href="#A:247"><span class="id" title="binder">A</span></a> (<a id="e:248" class="idref" href="#e:248"><span class="id" title="binder">e</span></a> : <a class="idref" href="MailboxTypes.Dblib.Environments.html#env"><span class="id" title="definition">env</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#A:247"><span class="id" title="variable">A</span></a>) <a id="k:249" class="idref" href="#k:249"><span class="id" title="binder">k</span></a> <a id="x:250" class="idref" href="#x:250"><span class="id" title="binder">x</span></a> <a id="a:251" class="idref" href="#a:251"><span class="id" title="binder">a</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#length"><span class="id" title="definition">length</span></a> (<a class="idref" href="MailboxTypes.Dblib.Environments.html#insert"><span class="id" title="abbreviation">insert</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#x:250"><span class="id" title="variable">x</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#a:251"><span class="id" title="variable">a</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#e:248"><span class="id" title="variable">e</span></a>) <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Peano.html#cb53cf0ee22c036a03b4a9281c68b5a3"><span class="id" title="notation">&lt;=</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#k:249"><span class="id" title="variable">k</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="y:252" class="idref" href="#y:252"><span class="id" title="binder">y</span></a> <a id="o:253" class="idref" href="#o:253"><span class="id" title="binder">o</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.Environments.html#y:252"><span class="id" title="variable">y</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Peano.html#::nat_scope:x_'&lt;'_x"><span class="id" title="notation">&lt;</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#k:249"><span class="id" title="variable">k</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#length"><span class="id" title="definition">length</span></a> (<a class="idref" href="MailboxTypes.Dblib.Environments.html#raw_insert"><span class="id" title="definition">raw_insert</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#y:252"><span class="id" title="variable">y</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#o:253"><span class="id" title="variable">o</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#e:248"><span class="id" title="variable">e</span></a>) <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Peano.html#cb53cf0ee22c036a03b4a9281c68b5a3"><span class="id" title="notation">&lt;=</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#k:249"><span class="id" title="variable">k</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="var">erewrite</span> <a class="idref" href="MailboxTypes.Dblib.Environments.html#length_insert_general"><span class="id" title="lemma">length_insert_general</span></a> <span class="id" title="tactic">in</span> * <span class="id" title="tactic">by</span> <span class="id" title="tactic">reflexivity</span>. <span class="id" title="var">mymax</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="comment">(*&nbsp;Applying&nbsp;a&nbsp;transformation&nbsp;to&nbsp;an&nbsp;environment&nbsp;does&nbsp;not&nbsp;affect&nbsp;its&nbsp;length.&nbsp;*)</span><br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="length_map_general" class="idref" href="#length_map_general"><span class="id" title="lemma">length_map_general</span></a>:<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="A:254" class="idref" href="#A:254"><span class="id" title="binder">A</span></a> <a id="B:255" class="idref" href="#B:255"><span class="id" title="binder">B</span></a> (<a id="f:256" class="idref" href="#f:256"><span class="id" title="binder">f</span></a> : <a class="idref" href="MailboxTypes.Dblib.Environments.html#A:254"><span class="id" title="variable">A</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#B:255"><span class="id" title="variable">B</span></a>) (<a id="e:257" class="idref" href="#e:257"><span class="id" title="binder">e</span></a> : <a class="idref" href="MailboxTypes.Dblib.Environments.html#env"><span class="id" title="definition">env</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#A:254"><span class="id" title="variable">A</span></a>),<br/>
&nbsp;&nbsp;<a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#length"><span class="id" title="definition">length</span></a> (<a class="idref" href="MailboxTypes.Dblib.Environments.html#map"><span class="id" title="definition">map</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#f:256"><span class="id" title="variable">f</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#e:257"><span class="id" title="variable">e</span></a>) <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#length"><span class="id" title="definition">length</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#e:257"><span class="id" title="variable">e</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">e</span> <span class="id" title="keyword">as</span> [| [|] ]; <span class="id" title="tactic">simpl</span>; <span class="id" title="tactic">intros</span>; <span class="id" title="tactic">congruence</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="length_map" class="idref" href="#length_map"><span class="id" title="lemma">length_map</span></a>:<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="A:258" class="idref" href="#A:258"><span class="id" title="binder">A</span></a> <a id="B:259" class="idref" href="#B:259"><span class="id" title="binder">B</span></a> (<a id="f:260" class="idref" href="#f:260"><span class="id" title="binder">f</span></a> : <a class="idref" href="MailboxTypes.Dblib.Environments.html#A:258"><span class="id" title="variable">A</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#B:259"><span class="id" title="variable">B</span></a>) (<a id="e:261" class="idref" href="#e:261"><span class="id" title="binder">e</span></a> : <a class="idref" href="MailboxTypes.Dblib.Environments.html#env"><span class="id" title="definition">env</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#A:258"><span class="id" title="variable">A</span></a>) <a id="k:262" class="idref" href="#k:262"><span class="id" title="binder">k</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#length"><span class="id" title="definition">length</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#e:261"><span class="id" title="variable">e</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Peano.html#cb53cf0ee22c036a03b4a9281c68b5a3"><span class="id" title="notation">&lt;=</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#k:262"><span class="id" title="variable">k</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#length"><span class="id" title="definition">length</span></a> (<a class="idref" href="MailboxTypes.Dblib.Environments.html#map"><span class="id" title="definition">map</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#f:260"><span class="id" title="variable">f</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#e:261"><span class="id" title="variable">e</span></a>) <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Peano.html#cb53cf0ee22c036a03b4a9281c68b5a3"><span class="id" title="notation">&lt;=</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#k:262"><span class="id" title="variable">k</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="tactic">rewrite</span> <a class="idref" href="MailboxTypes.Dblib.Environments.html#length_map_general"><span class="id" title="lemma">length_map_general</span></a>. <span class="id" title="tactic">assumption</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Hint Resolve</span> <span class="id" title="var">length_empty</span> <span class="id" title="var">length_insert</span> <span class="id" title="var">length_map</span> : <span class="id" title="var">length</span>.<br/>

<br/>
<span class="id" title="keyword">Hint Resolve</span> <span class="id" title="var">length_insert</span> <span class="id" title="var">length_map</span> : <span class="id" title="var">construction_closed</span>.<br/>

<br/>
<span class="comment">(*&nbsp;----------------------------------------------------------------------------&nbsp;*)</span><br/>

<br/>
<span class="comment">(*&nbsp;The&nbsp;definitions&nbsp;and&nbsp;properties&nbsp;that&nbsp;follow&nbsp;should&nbsp;be&nbsp;independent&nbsp;of&nbsp;the<br/>
&nbsp;&nbsp;&nbsp;details&nbsp;of&nbsp;the&nbsp;definitions&nbsp;of&nbsp;<span class="inlinecode"><span class="id" title="var">empty</span></span>,&nbsp;<span class="inlinecode"><span class="id" title="var">lookup</span></span>,&nbsp;<span class="inlinecode"><span class="id" title="var">insert</span></span>,&nbsp;and&nbsp;<span class="inlinecode"><span class="id" title="var">map</span></span>.&nbsp;*)</span><br/>

<br/>
<span class="id" title="keyword">Opaque</span> <a class="idref" href="MailboxTypes.Dblib.Environments.html#empty"><span class="id" title="definition">empty</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#lookup"><span class="id" title="definition">lookup</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#raw_insert"><span class="id" title="definition">raw_insert</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#map"><span class="id" title="definition">map</span></a>.<br/>

<br/>
<span class="comment">(*&nbsp;----------------------------------------------------------------------------&nbsp;*)</span><br/>

<br/>
<span class="comment">(*&nbsp;A&nbsp;definition&nbsp;of&nbsp;when&nbsp;two&nbsp;environments&nbsp;agree&nbsp;up&nbsp;to&nbsp;length&nbsp;<span class="inlinecode"><span class="id" title="var">k</span></span>.&nbsp;*)</span><br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="agree" class="idref" href="#agree"><span class="id" title="definition">agree</span></a> <a id="A:263" class="idref" href="#A:263"><span class="id" title="binder">A</span></a> (<a id="e1:264" class="idref" href="#e1:264"><span class="id" title="binder">e1</span></a> <a id="e2:265" class="idref" href="#e2:265"><span class="id" title="binder">e2</span></a> : <a class="idref" href="MailboxTypes.Dblib.Environments.html#env"><span class="id" title="definition">env</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#A:263"><span class="id" title="variable">A</span></a>) (<a id="k:266" class="idref" href="#k:266"><span class="id" title="binder">k</span></a> : <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>) :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="x:267" class="idref" href="#x:267"><span class="id" title="binder">x</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.Environments.html#x:267"><span class="id" title="variable">x</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Peano.html#::nat_scope:x_'&lt;'_x"><span class="id" title="notation">&lt;</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#k:266"><span class="id" title="variable">k</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.Environments.html#lookup"><span class="id" title="definition">lookup</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#x:267"><span class="id" title="variable">x</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#e1:264"><span class="id" title="variable">e1</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#lookup"><span class="id" title="definition">lookup</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#x:267"><span class="id" title="variable">x</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#e2:265"><span class="id" title="variable">e2</span></a>.<br/>

<br/>
<span class="comment">(*&nbsp;A&nbsp;simple&nbsp;consequence&nbsp;of&nbsp;the&nbsp;definition.&nbsp;*)</span><br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="agree_below" class="idref" href="#agree_below"><span class="id" title="lemma">agree_below</span></a>:<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="A:268" class="idref" href="#A:268"><span class="id" title="binder">A</span></a> (<a id="e1:269" class="idref" href="#e1:269"><span class="id" title="binder">e1</span></a> <a id="e2:270" class="idref" href="#e2:270"><span class="id" title="binder">e2</span></a> : <a class="idref" href="MailboxTypes.Dblib.Environments.html#env"><span class="id" title="definition">env</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#A:268"><span class="id" title="variable">A</span></a>) <a id="x:271" class="idref" href="#x:271"><span class="id" title="binder">x</span></a> <a id="a:272" class="idref" href="#a:272"><span class="id" title="binder">a</span></a> <a id="k:273" class="idref" href="#k:273"><span class="id" title="binder">k</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.Environments.html#lookup"><span class="id" title="definition">lookup</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#x:271"><span class="id" title="variable">x</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#e1:269"><span class="id" title="variable">e1</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#a:272"><span class="id" title="variable">a</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.Environments.html#x:271"><span class="id" title="variable">x</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Peano.html#::nat_scope:x_'&lt;'_x"><span class="id" title="notation">&lt;</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#k:273"><span class="id" title="variable">k</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.Environments.html#agree"><span class="id" title="definition">agree</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#e1:269"><span class="id" title="variable">e1</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#e2:270"><span class="id" title="variable">e2</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#k:273"><span class="id" title="variable">k</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.Environments.html#lookup"><span class="id" title="definition">lookup</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#x:271"><span class="id" title="variable">x</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#e2:270"><span class="id" title="variable">e2</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#a:272"><span class="id" title="variable">a</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">do</span> 6 <span class="id" title="tactic">intro</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">hlookup</span> ? ?.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">hlookup</span>. <span class="id" title="tactic">symmetry</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eauto</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="comment">(*&nbsp;The&nbsp;empty&nbsp;environment&nbsp;agrees&nbsp;with&nbsp;every&nbsp;environment&nbsp;up&nbsp;to&nbsp;length&nbsp;<span class="inlinecode">0</span>.&nbsp;*)</span><br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="agree_empty_left" class="idref" href="#agree_empty_left"><span class="id" title="lemma">agree_empty_left</span></a>:<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="A:274" class="idref" href="#A:274"><span class="id" title="binder">A</span></a> (<a id="e:275" class="idref" href="#e:275"><span class="id" title="binder">e</span></a> : <a class="idref" href="MailboxTypes.Dblib.Environments.html#env"><span class="id" title="definition">env</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#A:274"><span class="id" title="variable">A</span></a>),<br/>
&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.Environments.html#agree"><span class="id" title="definition">agree</span></a> (@<a class="idref" href="MailboxTypes.Dblib.Environments.html#empty"><span class="id" title="definition">empty</span></a> <span class="id" title="var">_</span>) <a class="idref" href="MailboxTypes.Dblib.Environments.html#e:275"><span class="id" title="variable">e</span></a> 0.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="MailboxTypes.Dblib.Environments.html#agree"><span class="id" title="definition">agree</span></a>. <span class="id" title="tactic">intros</span>. <span class="id" title="var">exfalso</span>. <span class="id" title="var">lia</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="agree_empty_right" class="idref" href="#agree_empty_right"><span class="id" title="lemma">agree_empty_right</span></a>:<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="A:276" class="idref" href="#A:276"><span class="id" title="binder">A</span></a> (<a id="e:277" class="idref" href="#e:277"><span class="id" title="binder">e</span></a> : <a class="idref" href="MailboxTypes.Dblib.Environments.html#env"><span class="id" title="definition">env</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#A:276"><span class="id" title="variable">A</span></a>),<br/>
&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.Environments.html#agree"><span class="id" title="definition">agree</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#e:277"><span class="id" title="variable">e</span></a> (@<a class="idref" href="MailboxTypes.Dblib.Environments.html#empty"><span class="id" title="definition">empty</span></a> <span class="id" title="var">_</span>) 0.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="MailboxTypes.Dblib.Environments.html#agree"><span class="id" title="definition">agree</span></a>. <span class="id" title="tactic">intros</span>. <span class="id" title="var">exfalso</span>. <span class="id" title="var">lia</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="comment">(*&nbsp;If&nbsp;two&nbsp;environments&nbsp;that&nbsp;agree&nbsp;up&nbsp;to&nbsp;<span class="inlinecode"><span class="id" title="var">k</span></span>&nbsp;are&nbsp;extended&nbsp;with&nbsp;a&nbsp;new&nbsp;variable,<br/>
&nbsp;&nbsp;&nbsp;then&nbsp;they&nbsp;agree&nbsp;up&nbsp;to&nbsp;<span class="inlinecode"><span class="id" title="var">k</span>+1</span>.&nbsp;*)</span><br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="agree_insert" class="idref" href="#agree_insert"><span class="id" title="lemma">agree_insert</span></a>:<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="A:278" class="idref" href="#A:278"><span class="id" title="binder">A</span></a> (<a id="e1:279" class="idref" href="#e1:279"><span class="id" title="binder">e1</span></a> <a id="e2:280" class="idref" href="#e2:280"><span class="id" title="binder">e2</span></a> : <a class="idref" href="MailboxTypes.Dblib.Environments.html#env"><span class="id" title="definition">env</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#A:278"><span class="id" title="variable">A</span></a>) <a id="k:281" class="idref" href="#k:281"><span class="id" title="binder">k</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.Environments.html#agree"><span class="id" title="definition">agree</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#e1:279"><span class="id" title="variable">e1</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#e2:280"><span class="id" title="variable">e2</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#k:281"><span class="id" title="variable">k</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="x:282" class="idref" href="#x:282"><span class="id" title="binder">x</span></a> <a id="o:283" class="idref" href="#o:283"><span class="id" title="binder">o</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.Environments.html#x:282"><span class="id" title="variable">x</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Peano.html#cb53cf0ee22c036a03b4a9281c68b5a3"><span class="id" title="notation">&lt;=</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#k:281"><span class="id" title="variable">k</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.Environments.html#agree"><span class="id" title="definition">agree</span></a> (<a class="idref" href="MailboxTypes.Dblib.Environments.html#raw_insert"><span class="id" title="definition">raw_insert</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#x:282"><span class="id" title="variable">x</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#o:283"><span class="id" title="variable">o</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#e1:279"><span class="id" title="variable">e1</span></a>) (<a class="idref" href="MailboxTypes.Dblib.Environments.html#raw_insert"><span class="id" title="definition">raw_insert</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#x:282"><span class="id" title="variable">x</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#o:283"><span class="id" title="variable">o</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#e2:280"><span class="id" title="variable">e2</span></a>) (1 <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#k:281"><span class="id" title="variable">k</span></a>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="MailboxTypes.Dblib.Environments.html#agree"><span class="id" title="definition">agree</span></a>. <span class="id" title="tactic">intros</span> * <span class="id" title="var">H</span> * ? <span class="id" title="var">n</span> **.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Reason&nbsp;by&nbsp;cases:&nbsp;<span class="inlinecode"><span class="id" title="var">x</span></span> <span class="inlinecode">&lt;</span> <span class="inlinecode"><span class="id" title="var">n</span></span>,&nbsp;<span class="inlinecode"><span class="id" title="var">x</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">n</span></span>,&nbsp;<span class="inlinecode"><span class="id" title="var">x</span></span> <span class="inlinecode">&gt;</span> <span class="inlinecode"><span class="id" title="var">n</span></span>.&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="definition">lt_eq_lt_dec</span> <span class="id" title="var">x</span> <span class="id" title="var">n</span>) <span class="id" title="keyword">as</span> [[] | ]; <span class="id" title="tactic">intros</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;In&nbsp;each&nbsp;case,&nbsp;<span class="inlinecode"><span class="id" title="var">lookup_insert</span></span>&nbsp;simplifies&nbsp;the&nbsp;goal.&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">do</span> 2 <span class="id" title="var">lookup_insert</span>;<br/>
&nbsp;&nbsp;(<span class="id" title="tactic">apply</span> <span class="id" title="var">H</span>; <span class="id" title="var">lia</span>) || <span class="id" title="tactic">reflexivity</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Hint Resolve</span> <span class="id" title="var">defined_implies_below_length</span> <span class="id" title="var">agree_below</span> <span class="id" title="var">agree_empty_left</span><br/>
<span class="id" title="var">agree_empty_right</span> <span class="id" title="var">agree_insert</span> : <span class="id" title="var">agree</span>.<br/>

<br/>
<span class="comment">(*&nbsp;----------------------------------------------------------------------------&nbsp;*)</span><br/>

<br/>
<span class="comment">(*&nbsp;A&nbsp;definition&nbsp;of&nbsp;when&nbsp;an&nbsp;environment&nbsp;subsumes&nbsp;another,&nbsp;up&nbsp;to&nbsp;a&nbsp;notion&nbsp;of<br/>
&nbsp;&nbsp;&nbsp;subsumption&nbsp;on&nbsp;environment&nbsp;entries.&nbsp;*)</span><br/>

<br/>
<span class="id" title="keyword">Section</span> <a id="Subsume" class="idref" href="#Subsume"><span class="id" title="section">Subsume</span></a>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Variable</span> <a id="Subsume.A" class="idref" href="#Subsume.A"><span class="id" title="variable">A</span></a> : <span class="id" title="keyword">Type</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Variable</span> <a id="Subsume.sub" class="idref" href="#Subsume.sub"><span class="id" title="variable">sub</span></a> : <a class="idref" href="MailboxTypes.Dblib.Environments.html#Subsume.A"><span class="id" title="variable">A</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#Subsume.A"><span class="id" title="variable">A</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <span class="id" title="keyword">Prop</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Variable</span> <a id="Subsume.sub_reflexive" class="idref" href="#Subsume.sub_reflexive"><span class="id" title="variable">sub_reflexive</span></a>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="a:288" class="idref" href="#a:288"><span class="id" title="binder">a</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.Environments.html#Subsume.sub"><span class="id" title="variable">sub</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#a:288"><span class="id" title="variable">a</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#a:288"><span class="id" title="variable">a</span></a>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Variable</span> <a id="Subsume.sub_transitive" class="idref" href="#Subsume.sub_transitive"><span class="id" title="variable">sub_transitive</span></a>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="a1:291" class="idref" href="#a1:291"><span class="id" title="binder">a1</span></a> <a id="a2:292" class="idref" href="#a2:292"><span class="id" title="binder">a2</span></a> <a id="a3:293" class="idref" href="#a3:293"><span class="id" title="binder">a3</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.Environments.html#Subsume.sub"><span class="id" title="variable">sub</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#a1:291"><span class="id" title="variable">a1</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#a2:292"><span class="id" title="variable">a2</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.Environments.html#Subsume.sub"><span class="id" title="variable">sub</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#a2:292"><span class="id" title="variable">a2</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#a3:293"><span class="id" title="variable">a3</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.Environments.html#Subsume.sub"><span class="id" title="variable">sub</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#a1:291"><span class="id" title="variable">a1</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#a3:293"><span class="id" title="variable">a3</span></a>.<br/>

<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Subsumption&nbsp;is&nbsp;first&nbsp;extended&nbsp;to&nbsp;options.&nbsp;*)</span><br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="osub" class="idref" href="#osub"><span class="id" title="definition">osub</span></a> (<a id="o1:296" class="idref" href="#o1:296"><span class="id" title="binder">o1</span></a> <a id="o2:297" class="idref" href="#o2:297"><span class="id" title="binder">o2</span></a> : <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#option"><span class="id" title="inductive">option</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#Subsume.A"><span class="id" title="variable">A</span></a>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="a2:298" class="idref" href="#a2:298"><span class="id" title="binder">a2</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.Environments.html#o2:297"><span class="id" title="variable">o2</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#a2:298"><span class="id" title="variable">a2</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">exists</span></a> <a id="a1:299" class="idref" href="#a1:299"><span class="id" title="binder">a1</span></a><a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">,</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.Environments.html#o1:296"><span class="id" title="variable">o1</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#a1:299"><span class="id" title="variable">a1</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#Subsume.sub"><span class="id" title="variable">sub</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#a1:299"><span class="id" title="variable">a1</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#a2:298"><span class="id" title="variable">a2</span></a>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <a id="osub_None" class="idref" href="#osub_None"><span class="id" title="lemma">osub_None</span></a>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="o:300" class="idref" href="#o:300"><span class="id" title="binder">o</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.Environments.html#osub"><span class="id" title="definition">osub</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#o:300"><span class="id" title="variable">o</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#None"><span class="id" title="constructor">None</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="MailboxTypes.Dblib.Environments.html#osub"><span class="id" title="definition">osub</span></a>. <span class="id" title="tactic">congruence</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <a id="osub_Some_Some" class="idref" href="#osub_Some_Some"><span class="id" title="lemma">osub_Some_Some</span></a>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="a1:301" class="idref" href="#a1:301"><span class="id" title="binder">a1</span></a> <a id="a2:302" class="idref" href="#a2:302"><span class="id" title="binder">a2</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.Environments.html#Subsume.sub"><span class="id" title="variable">sub</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#a1:301"><span class="id" title="variable">a1</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#a2:302"><span class="id" title="variable">a2</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.Environments.html#osub"><span class="id" title="definition">osub</span></a> (<a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#a1:301"><span class="id" title="variable">a1</span></a>) (<a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#a2:302"><span class="id" title="variable">a2</span></a>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="MailboxTypes.Dblib.Environments.html#osub"><span class="id" title="definition">osub</span></a>. <span class="id" title="tactic">intros</span> ? ? ? ? <span class="id" title="var">h</span>. <span class="id" title="tactic">injection</span> <span class="id" title="var">h</span>; <span class="id" title="tactic">clear</span> <span class="id" title="var">h</span>; <span class="id" title="tactic">intro</span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <a id="osub_None_Some" class="idref" href="#osub_None_Some"><span class="id" title="lemma">osub_None_Some</span></a>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="a2:303" class="idref" href="#a2:303"><span class="id" title="binder">a2</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.Environments.html#osub"><span class="id" title="definition">osub</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#None"><span class="id" title="constructor">None</span></a> (<a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#a2:303"><span class="id" title="variable">a2</span></a>) <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#False"><span class="id" title="inductive">False</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="MailboxTypes.Dblib.Environments.html#osub"><span class="id" title="definition">osub</span></a>. <span class="id" title="tactic">intros</span> ? <span class="id" title="var">h</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">generalize</span> (<span class="id" title="var">h</span> <span class="id" title="var">_</span> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#eq_refl"><span class="id" title="constructor">eq_refl</span></a>). <span class="id" title="tactic">clear</span> <span class="id" title="var">h</span>. <span class="id" title="tactic">intros</span> [ <span class="id" title="var">a1</span> [ ? ? ]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">congruence</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <a id="osub_Some_inversion" class="idref" href="#osub_Some_inversion"><span class="id" title="lemma">osub_Some_inversion</span></a>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="o1:304" class="idref" href="#o1:304"><span class="id" title="binder">o1</span></a> <a id="a2:305" class="idref" href="#a2:305"><span class="id" title="binder">a2</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.Environments.html#osub"><span class="id" title="definition">osub</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#o1:304"><span class="id" title="variable">o1</span></a> (<a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#a2:305"><span class="id" title="variable">a2</span></a>) <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">exists</span></a> <a id="a1:306" class="idref" href="#a1:306"><span class="id" title="binder">a1</span></a><a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">,</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.Environments.html#o1:304"><span class="id" title="variable">o1</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#a1:306"><span class="id" title="variable">a1</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#Subsume.sub"><span class="id" title="variable">sub</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#a1:306"><span class="id" title="variable">a1</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#a2:305"><span class="id" title="variable">a2</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">o1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">exfalso</span>. <span class="id" title="tactic">eauto</span> <span class="id" title="keyword">using</span> <a class="idref" href="MailboxTypes.Dblib.Environments.html#osub_None_Some"><span class="id" title="lemma">osub_None_Some</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Then,&nbsp;it&nbsp;is&nbsp;extended&nbsp;pointwise&nbsp;to&nbsp;environments.&nbsp;*)</span><br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="subsume" class="idref" href="#subsume"><span class="id" title="definition">subsume</span></a> (<a id="e1:307" class="idref" href="#e1:307"><span class="id" title="binder">e1</span></a> <a id="e2:308" class="idref" href="#e2:308"><span class="id" title="binder">e2</span></a> : <a class="idref" href="MailboxTypes.Dblib.Environments.html#env"><span class="id" title="definition">env</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#Subsume.A"><span class="id" title="variable">A</span></a>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="x:309" class="idref" href="#x:309"><span class="id" title="binder">x</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.Environments.html#osub"><span class="id" title="definition">osub</span></a> (<a class="idref" href="MailboxTypes.Dblib.Environments.html#lookup"><span class="id" title="definition">lookup</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#x:309"><span class="id" title="variable">x</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#e1:307"><span class="id" title="variable">e1</span></a>) (<a class="idref" href="MailboxTypes.Dblib.Environments.html#lookup"><span class="id" title="definition">lookup</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#x:309"><span class="id" title="variable">x</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#e2:308"><span class="id" title="variable">e2</span></a>).<br/>

<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Subsumption&nbsp;of&nbsp;environments&nbsp;is&nbsp;reflexive&nbsp;and&nbsp;transitive.&nbsp;*)</span><br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <a id="osub_reflexive" class="idref" href="#osub_reflexive"><span class="id" title="lemma">osub_reflexive</span></a>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="o:310" class="idref" href="#o:310"><span class="id" title="binder">o</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.Environments.html#osub"><span class="id" title="definition">osub</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#o:310"><span class="id" title="variable">o</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#o:310"><span class="id" title="variable">o</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="MailboxTypes.Dblib.Environments.html#osub"><span class="id" title="definition">osub</span></a>. <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <a id="subsume_reflexive" class="idref" href="#subsume_reflexive"><span class="id" title="lemma">subsume_reflexive</span></a>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="e:311" class="idref" href="#e:311"><span class="id" title="binder">e</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.Environments.html#subsume"><span class="id" title="definition">subsume</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#e:311"><span class="id" title="variable">e</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#e:311"><span class="id" title="variable">e</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="MailboxTypes.Dblib.Environments.html#subsume"><span class="id" title="definition">subsume</span></a>. <span class="id" title="tactic">eauto</span> <span class="id" title="keyword">using</span> <a class="idref" href="MailboxTypes.Dblib.Environments.html#osub_reflexive"><span class="id" title="lemma">osub_reflexive</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <a id="osub_transitive" class="idref" href="#osub_transitive"><span class="id" title="lemma">osub_transitive</span></a>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="o1:312" class="idref" href="#o1:312"><span class="id" title="binder">o1</span></a> <a id="o2:313" class="idref" href="#o2:313"><span class="id" title="binder">o2</span></a> <a id="o3:314" class="idref" href="#o3:314"><span class="id" title="binder">o3</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.Environments.html#osub"><span class="id" title="definition">osub</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#o1:312"><span class="id" title="variable">o1</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#o2:313"><span class="id" title="variable">o2</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.Environments.html#osub"><span class="id" title="definition">osub</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#o2:313"><span class="id" title="variable">o2</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#o3:314"><span class="id" title="variable">o3</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.Environments.html#osub"><span class="id" title="definition">osub</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#o1:312"><span class="id" title="variable">o1</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#o3:314"><span class="id" title="variable">o3</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="MailboxTypes.Dblib.Environments.html#osub"><span class="id" title="definition">osub</span></a>. <span class="id" title="tactic">intros</span> ? ? ? <span class="id" title="var">hs1</span> <span class="id" title="var">hs2</span> <span class="id" title="var">a3</span> <span class="id" title="var">h3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">generalize</span> (<span class="id" title="var">hs2</span> <span class="id" title="var">_</span> <span class="id" title="var">h3</span>); <span class="id" title="tactic">intros</span> [ <span class="id" title="var">a2</span> [ <span class="id" title="var">h2</span> ? ]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">generalize</span> (<span class="id" title="var">hs1</span> <span class="id" title="var">_</span> <span class="id" title="var">h2</span>); <span class="id" title="tactic">intros</span> [ <span class="id" title="var">a1</span> [ <span class="id" title="var">h1</span> ? ]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <a id="subsume_transitive" class="idref" href="#subsume_transitive"><span class="id" title="lemma">subsume_transitive</span></a>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="e1:315" class="idref" href="#e1:315"><span class="id" title="binder">e1</span></a> <a id="e2:316" class="idref" href="#e2:316"><span class="id" title="binder">e2</span></a> <a id="e3:317" class="idref" href="#e3:317"><span class="id" title="binder">e3</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.Environments.html#subsume"><span class="id" title="definition">subsume</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#e1:315"><span class="id" title="variable">e1</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#e2:316"><span class="id" title="variable">e2</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.Environments.html#subsume"><span class="id" title="definition">subsume</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#e2:316"><span class="id" title="variable">e2</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#e3:317"><span class="id" title="variable">e3</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.Environments.html#subsume"><span class="id" title="definition">subsume</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#e1:315"><span class="id" title="variable">e1</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#e3:317"><span class="id" title="variable">e3</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="MailboxTypes.Dblib.Environments.html#subsume"><span class="id" title="definition">subsume</span></a>. <span class="id" title="tactic">eauto</span> <span class="id" title="keyword">using</span> <a class="idref" href="MailboxTypes.Dblib.Environments.html#osub_transitive"><span class="id" title="lemma">osub_transitive</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Every&nbsp;environment&nbsp;subsumes&nbsp;the&nbsp;empty&nbsp;environment.&nbsp;*)</span><br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <a id="subsume_empty" class="idref" href="#subsume_empty"><span class="id" title="lemma">subsume_empty</span></a>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="e:318" class="idref" href="#e:318"><span class="id" title="binder">e</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.Environments.html#subsume"><span class="id" title="definition">subsume</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#e:318"><span class="id" title="variable">e</span></a> (@<a class="idref" href="MailboxTypes.Dblib.Environments.html#empty"><span class="id" title="definition">empty</span></a> <span class="id" title="var">_</span>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="MailboxTypes.Dblib.Environments.html#subsume"><span class="id" title="definition">subsume</span></a>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">rewrite</span> <a class="idref" href="MailboxTypes.Dblib.Environments.html#lookup_empty_None"><span class="id" title="lemma">lookup_empty_None</span></a>. <span class="id" title="tactic">apply</span> <a class="idref" href="MailboxTypes.Dblib.Environments.html#osub_None"><span class="id" title="lemma">osub_None</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Extending&nbsp;two&nbsp;environments&nbsp;with&nbsp;a&nbsp;new&nbsp;variable&nbsp;preserves&nbsp;subsumption.&nbsp;*)</span><br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <a id="subsume_insert" class="idref" href="#subsume_insert"><span class="id" title="lemma">subsume_insert</span></a>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="e1:319" class="idref" href="#e1:319"><span class="id" title="binder">e1</span></a> <a id="e2:320" class="idref" href="#e2:320"><span class="id" title="binder">e2</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.Environments.html#subsume"><span class="id" title="definition">subsume</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#e1:319"><span class="id" title="variable">e1</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#e2:320"><span class="id" title="variable">e2</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="x:321" class="idref" href="#x:321"><span class="id" title="binder">x</span></a> <a id="o1:322" class="idref" href="#o1:322"><span class="id" title="binder">o1</span></a> <a id="o2:323" class="idref" href="#o2:323"><span class="id" title="binder">o2</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.Environments.html#osub"><span class="id" title="definition">osub</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#o1:322"><span class="id" title="variable">o1</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#o2:323"><span class="id" title="variable">o2</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.Environments.html#subsume"><span class="id" title="definition">subsume</span></a> (<a class="idref" href="MailboxTypes.Dblib.Environments.html#raw_insert"><span class="id" title="definition">raw_insert</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#x:321"><span class="id" title="variable">x</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#o1:322"><span class="id" title="variable">o1</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#e1:319"><span class="id" title="variable">e1</span></a>) (<a class="idref" href="MailboxTypes.Dblib.Environments.html#raw_insert"><span class="id" title="definition">raw_insert</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#x:321"><span class="id" title="variable">x</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#o2:323"><span class="id" title="variable">o2</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#e2:320"><span class="id" title="variable">e2</span></a>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="MailboxTypes.Dblib.Environments.html#subsume"><span class="id" title="definition">subsume</span></a>. <span class="id" title="tactic">do</span> 7 <span class="id" title="tactic">intro</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">n</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;Reason&nbsp;by&nbsp;cases:&nbsp;<span class="inlinecode"><span class="id" title="var">x</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">n</span></span>,&nbsp;<span class="inlinecode"><span class="id" title="var">x</span></span> <span class="inlinecode">&lt;</span> <span class="inlinecode"><span class="id" title="var">n</span></span>,&nbsp;<span class="inlinecode"><span class="id" title="var">x</span></span> <span class="inlinecode">&gt;</span> <span class="inlinecode"><span class="id" title="var">n</span></span>.&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">case</span> (<span class="id" title="definition">le_gt_dec</span> <span class="id" title="var">x</span> <span class="id" title="var">n</span>); [ <span class="id" title="tactic">case</span> (<span class="id" title="abbreviation">eq_nat_dec</span> <span class="id" title="var">x</span> <span class="id" title="var">n</span>) | ]; <span class="id" title="tactic">intros</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;In&nbsp;each&nbsp;case,&nbsp;<span class="inlinecode"><span class="id" title="var">lookup_insert</span></span>&nbsp;simplifies&nbsp;the&nbsp;goal.&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="var">lookup_insert</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <a id="subsume_cons" class="idref" href="#subsume_cons"><span class="id" title="lemma">subsume_cons</span></a>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="o:324" class="idref" href="#o:324"><span class="id" title="binder">o</span></a> <a id="e1:325" class="idref" href="#e1:325"><span class="id" title="binder">e1</span></a> <a id="e2:326" class="idref" href="#e2:326"><span class="id" title="binder">e2</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.Environments.html#osub"><span class="id" title="definition">osub</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#o:324"><span class="id" title="variable">o</span></a> (<a class="idref" href="MailboxTypes.Dblib.Environments.html#lookup"><span class="id" title="definition">lookup</span></a> 0 <a class="idref" href="MailboxTypes.Dblib.Environments.html#e2:326"><span class="id" title="variable">e2</span></a>) <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.Environments.html#subsume"><span class="id" title="definition">subsume</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#e1:325"><span class="id" title="variable">e1</span></a> (<span class="id" title="definition">tl</span> <a class="idref" href="MailboxTypes.Dblib.Environments.html#e2:326"><span class="id" title="variable">e2</span></a>) <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.Environments.html#subsume"><span class="id" title="definition">subsume</span></a> (<a class="idref" href="MailboxTypes.Dblib.Environments.html#o:324"><span class="id" title="variable">o</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#::list_scope:x_'::'_x"><span class="id" title="notation">::</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#e1:325"><span class="id" title="variable">e1</span></a>) <a class="idref" href="MailboxTypes.Dblib.Environments.html#e2:326"><span class="id" title="variable">e2</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">do</span> 3 <span class="id" title="tactic">intro</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">h1</span> <span class="id" title="var">h2</span>. <span class="id" title="tactic">intro</span> <span class="id" title="var">n</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">n</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">do</span> 2 <span class="id" title="tactic">rewrite</span> <a class="idref" href="MailboxTypes.Dblib.Environments.html#lookup_successor"><span class="id" title="lemma">lookup_successor</span></a>. <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <a id="subsume_cons_cons_inversion" class="idref" href="#subsume_cons_cons_inversion"><span class="id" title="lemma">subsume_cons_cons_inversion</span></a>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="o1:327" class="idref" href="#o1:327"><span class="id" title="binder">o1</span></a> <a id="o2:328" class="idref" href="#o2:328"><span class="id" title="binder">o2</span></a> <a id="e1:329" class="idref" href="#e1:329"><span class="id" title="binder">e1</span></a> <a id="e2:330" class="idref" href="#e2:330"><span class="id" title="binder">e2</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.Environments.html#subsume"><span class="id" title="definition">subsume</span></a> (<a class="idref" href="MailboxTypes.Dblib.Environments.html#o1:327"><span class="id" title="variable">o1</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#::list_scope:x_'::'_x"><span class="id" title="notation">::</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#e1:329"><span class="id" title="variable">e1</span></a>) (<a class="idref" href="MailboxTypes.Dblib.Environments.html#o2:328"><span class="id" title="variable">o2</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#::list_scope:x_'::'_x"><span class="id" title="notation">::</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#e2:330"><span class="id" title="variable">e2</span></a>) <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.Environments.html#osub"><span class="id" title="definition">osub</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#o1:327"><span class="id" title="variable">o1</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#o2:328"><span class="id" title="variable">o2</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.Environments.html#subsume"><span class="id" title="definition">subsume</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#e1:329"><span class="id" title="variable">e1</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#e2:330"><span class="id" title="variable">e2</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">do</span> 4 <span class="id" title="tactic">intro</span>. <span class="id" title="tactic">intro</span> <span class="id" title="var">h</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">eapply</span> (<span class="id" title="var">h</span> 0).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">intro</span> <span class="id" title="var">n</span>. <span class="id" title="tactic">eapply</span> (<span class="id" title="var">h</span> (1 <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a> <span class="id" title="var">n</span>)).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <a id="subsume_insert_inversion" class="idref" href="#subsume_insert_inversion"><span class="id" title="lemma">subsume_insert_inversion</span></a>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="e1:331" class="idref" href="#e1:331"><span class="id" title="binder">e1</span></a> <a id="x:332" class="idref" href="#x:332"><span class="id" title="binder">x</span></a> <a id="a2:333" class="idref" href="#a2:333"><span class="id" title="binder">a2</span></a> <a id="e2:334" class="idref" href="#e2:334"><span class="id" title="binder">e2</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.Environments.html#subsume"><span class="id" title="definition">subsume</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#e1:331"><span class="id" title="variable">e1</span></a> (<a class="idref" href="MailboxTypes.Dblib.Environments.html#insert"><span class="id" title="abbreviation">insert</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#x:332"><span class="id" title="variable">x</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#a2:333"><span class="id" title="variable">a2</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#e2:334"><span class="id" title="variable">e2</span></a>) <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">exists</span></a> <a id="f1:335" class="idref" href="#f1:335"><span class="id" title="binder">f1</span></a> <a id="a1:336" class="idref" href="#a1:336"><span class="id" title="binder">a1</span></a><a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">,</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.Environments.html#e1:331"><span class="id" title="variable">e1</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#insert"><span class="id" title="abbreviation">insert</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#x:332"><span class="id" title="variable">x</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#a1:336"><span class="id" title="variable">a1</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#f1:335"><span class="id" title="variable">f1</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.Environments.html#subsume"><span class="id" title="definition">subsume</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#f1:335"><span class="id" title="variable">f1</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#e2:334"><span class="id" title="variable">e2</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.Environments.html#Subsume.sub"><span class="id" title="variable">sub</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#a1:336"><span class="id" title="variable">a1</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#a2:333"><span class="id" title="variable">a2</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;Really&nbsp;painful.&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">e1</span>; <span class="id" title="tactic">simpl</span>; <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="comment">(*&nbsp;Base.&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">exfalso</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span> <span class="id" title="var">h</span>: <a class="idref" href="MailboxTypes.Dblib.Environments.html#subsume"><span class="id" title="definition">subsume</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#nil"><span class="id" title="constructor">nil</span></a> <span class="id" title="var">_</span> |- <span class="id" title="var">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">generalize</span> (<span class="id" title="var">h</span> <span class="id" title="var">x</span>); <span class="id" title="tactic">clear</span> <span class="id" title="var">h</span>; <span class="id" title="tactic">intro</span> <span class="id" title="var">h</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <a class="idref" href="MailboxTypes.Dblib.Environments.html#lookup_insert_bingo"><span class="id" title="lemma">lookup_insert_bingo</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">h</span> <span class="id" title="tactic">by</span> <span class="id" title="tactic">reflexivity</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <a class="idref" href="MailboxTypes.Dblib.Environments.html#lookup_empty_None"><span class="id" title="lemma">lookup_empty_None</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">h</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">solve</span> [ <span class="id" title="tactic">eauto</span> <span class="id" title="keyword">using</span> <a class="idref" href="MailboxTypes.Dblib.Environments.html#osub_None_Some"><span class="id" title="lemma">osub_None_Some</span></a> ].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="comment">(*&nbsp;Step.&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">destruct</span> <span class="id" title="var">x</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="comment">(*&nbsp;Case&nbsp;<span class="inlinecode"><span class="id" title="var">x</span></span> <span class="inlinecode">=</span> <span class="inlinecode">0</span>.&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span> <span class="id" title="var">h</span>: <a class="idref" href="MailboxTypes.Dblib.Environments.html#subsume"><span class="id" title="definition">subsume</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> |- <span class="id" title="var">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <a class="idref" href="MailboxTypes.Dblib.Environments.html#raw_insert_zero"><span class="id" title="lemma">raw_insert_zero</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">h</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">generalize</span> (<a class="idref" href="MailboxTypes.Dblib.Environments.html#subsume_cons_cons_inversion"><span class="id" title="lemma">subsume_cons_cons_inversion</span></a> <span class="id" title="var">h</span>); <span class="id" title="tactic">clear</span> <span class="id" title="var">h</span>; <span class="id" title="tactic">intros</span> [ <span class="id" title="var">h</span> ? ];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">generalize</span> (<a class="idref" href="MailboxTypes.Dblib.Environments.html#osub_Some_inversion"><span class="id" title="lemma">osub_Some_inversion</span></a> <span class="id" title="var">h</span>); <span class="id" title="tactic">intros</span> [ ? [ ? ? ]]; <span class="id" title="tactic">subst</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">do</span> 2 <span class="id" title="tactic">eexists</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <a class="idref" href="MailboxTypes.Dblib.Environments.html#raw_insert_zero"><span class="id" title="lemma">raw_insert_zero</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">solve</span> [ <span class="id" title="tactic">eauto</span> ].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="comment">(*&nbsp;Case&nbsp;<span class="inlinecode"><span class="id" title="var">x</span></span> <span class="inlinecode">&gt;</span> <span class="inlinecode">0</span>.&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span> <span class="id" title="var">h</span>: <a class="idref" href="MailboxTypes.Dblib.Environments.html#subsume"><span class="id" title="definition">subsume</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> |- <span class="id" title="var">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <a class="idref" href="MailboxTypes.Dblib.Environments.html#raw_insert_successor"><span class="id" title="lemma">raw_insert_successor</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">h</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">generalize</span> (<a class="idref" href="MailboxTypes.Dblib.Environments.html#subsume_cons_cons_inversion"><span class="id" title="lemma">subsume_cons_cons_inversion</span></a> <span class="id" title="var">h</span>); <span class="id" title="tactic">clear</span> <span class="id" title="var">h</span>; <span class="id" title="tactic">intros</span> [ ? <span class="id" title="var">h</span> ];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">generalize</span> (<span class="id" title="var">IHe1</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">h</span>); <span class="id" title="tactic">clear</span> <span class="id" title="var">IHe1</span>; <span class="id" title="tactic">intros</span> [ <span class="id" title="var">f1</span> [ <span class="id" title="var">a1</span> [ ? [ ? ? ]]]]; <span class="id" title="tactic">subst</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">exists</span> (<span class="id" title="var">a</span> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#::list_scope:x_'::'_x"><span class="id" title="notation">::</span></a> <span class="id" title="var">f1</span>). <span class="id" title="tactic">exists</span> <span class="id" title="var">a1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <a class="idref" href="MailboxTypes.Dblib.Environments.html#raw_insert_successor"><span class="id" title="lemma">raw_insert_successor</span></a>. <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">split</span>; [ | <span class="id" title="tactic">split</span> ].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eauto</span> <span class="id" title="keyword">using</span> <a class="idref" href="MailboxTypes.Dblib.Environments.html#subsume_cons"><span class="id" title="lemma">subsume_cons</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Applying&nbsp;a&nbsp;transformation&nbsp;<span class="inlinecode"><span class="id" title="var">f</span></span>&nbsp;pointwise&nbsp;to&nbsp;two&nbsp;environments&nbsp;preserves<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;environment&nbsp;subsumption,&nbsp;provided&nbsp;<span class="inlinecode"><span class="id" title="var">f</span></span>&nbsp;preserves&nbsp;<span class="inlinecode"><span class="id" title="var">sub</span></span>.&nbsp;*)</span><br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <a id="subsume_map" class="idref" href="#subsume_map"><span class="id" title="lemma">subsume_map</span></a>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="f:337" class="idref" href="#f:337"><span class="id" title="binder">f</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">(</span></a><span class="id" title="keyword">forall</span> <a id="a1:338" class="idref" href="#a1:338"><span class="id" title="binder">a1</span></a> <a id="a2:339" class="idref" href="#a2:339"><span class="id" title="binder">a2</span></a>, <a class="idref" href="MailboxTypes.Dblib.Environments.html#Subsume.sub"><span class="id" title="variable">sub</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#a1:338"><span class="id" title="variable">a1</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#a2:339"><span class="id" title="variable">a2</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#Subsume.sub"><span class="id" title="variable">sub</span></a> (<a class="idref" href="MailboxTypes.Dblib.Environments.html#f:337"><span class="id" title="variable">f</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#a1:338"><span class="id" title="variable">a1</span></a>) (<a class="idref" href="MailboxTypes.Dblib.Environments.html#f:337"><span class="id" title="variable">f</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#a2:339"><span class="id" title="variable">a2</span></a>)<a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">)</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="e1:340" class="idref" href="#e1:340"><span class="id" title="binder">e1</span></a> <a id="e2:341" class="idref" href="#e2:341"><span class="id" title="binder">e2</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.Environments.html#subsume"><span class="id" title="definition">subsume</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#e1:340"><span class="id" title="variable">e1</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#e2:341"><span class="id" title="variable">e2</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.Environments.html#subsume"><span class="id" title="definition">subsume</span></a> (<a class="idref" href="MailboxTypes.Dblib.Environments.html#map"><span class="id" title="definition">map</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#f:337"><span class="id" title="variable">f</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#e1:340"><span class="id" title="variable">e1</span></a>) (<a class="idref" href="MailboxTypes.Dblib.Environments.html#map"><span class="id" title="definition">map</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#f:337"><span class="id" title="variable">f</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#e2:341"><span class="id" title="variable">e2</span></a>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> ? <span class="id" title="var">hf</span> ? ? <span class="id" title="var">hs</span>. <span class="id" title="tactic">intros</span> ? <span class="id" title="var">b2</span> <span class="id" title="var">hlm2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">generalize</span> (<a class="idref" href="MailboxTypes.Dblib.Environments.html#lookup_map_some_reverse"><span class="id" title="lemma">lookup_map_some_reverse</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">hlm2</span>); <span class="id" title="tactic">intros</span> [ ? [ <span class="id" title="var">hl2</span> ? ]]. <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">generalize</span> (<span class="id" title="var">hs</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">hl2</span>); <span class="id" title="tactic">intros</span> [ <span class="id" title="var">a1</span> [ ? ? ]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eauto</span> <span class="id" title="keyword">using</span> <a class="idref" href="MailboxTypes.Dblib.Environments.html#lookup_map_some"><span class="id" title="lemma">lookup_map_some</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">End</span> <a class="idref" href="MailboxTypes.Dblib.Environments.html#Subsume"><span class="id" title="section">Subsume</span></a>.<br/>

<br/>
<span class="id" title="keyword">Hint Resolve</span> <span class="id" title="var">osub_reflexive</span> <span class="id" title="var">osub_Some_Some</span> <span class="id" title="var">subsume_reflexive</span><br/>
<span class="id" title="var">subsume_transitive</span> <span class="id" title="var">subsume_empty</span> <span class="id" title="var">subsume_insert</span> <span class="id" title="var">subsume_map</span> : <span class="id" title="var">subsume</span>.<br/>

<br/>
<span class="comment">(*&nbsp;----------------------------------------------------------------------------&nbsp;*)</span><br/>

<br/>
<span class="comment">(*&nbsp;Extending&nbsp;an&nbsp;environment&nbsp;with&nbsp;a&nbsp;list&nbsp;of&nbsp;bindings&nbsp;found&nbsp;in&nbsp;a&nbsp;pattern.&nbsp;*)</span><br/>

<br/>
<span class="comment">(*&nbsp;Note&nbsp;that&nbsp;we&nbsp;cannot&nbsp;define&nbsp;the&nbsp;concatenation&nbsp;of&nbsp;two&nbsp;environments,&nbsp;because<br/>
&nbsp;&nbsp;&nbsp;we&nbsp;view&nbsp;environments&nbsp;as&nbsp;total&nbsp;functions,&nbsp;so&nbsp;we&nbsp;do&nbsp;not&nbsp;have&nbsp;precise&nbsp;control<br/>
&nbsp;&nbsp;&nbsp;over&nbsp;their&nbsp;domain.&nbsp;Only&nbsp;a&nbsp;list&nbsp;has&nbsp;finite&nbsp;domain.&nbsp;*)</span><br/>

<br/>
<span class="comment">(*&nbsp;Concatenation&nbsp;is&nbsp;just&nbsp;an&nbsp;iterated&nbsp;version&nbsp;of&nbsp;<span class="inlinecode"><span class="id" title="var">insert</span></span> <span class="inlinecode">0</span>.&nbsp;*)</span><br/>

<br/>
<span class="id" title="keyword">Fixpoint</span> <a id="concat" class="idref" href="#concat"><span class="id" title="definition">concat</span></a> (<a id="A:342" class="idref" href="#A:342"><span class="id" title="binder">A</span></a> : <span class="id" title="keyword">Type</span>) (<a id="e1:343" class="idref" href="#e1:343"><span class="id" title="binder">e1</span></a> : <a class="idref" href="MailboxTypes.Dblib.Environments.html#env"><span class="id" title="definition">env</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#A:342"><span class="id" title="variable">A</span></a>) (<a id="e2:344" class="idref" href="#e2:344"><span class="id" title="binder">e2</span></a> : <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#A:342"><span class="id" title="variable">A</span></a>) : <a class="idref" href="MailboxTypes.Dblib.Environments.html#env"><span class="id" title="definition">env</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#A:342"><span class="id" title="variable">A</span></a> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="MailboxTypes.Dblib.Environments.html#e2:344"><span class="id" title="variable">e2</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#nil"><span class="id" title="constructor">nil</span></a> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.Environments.html#e1:343"><span class="id" title="variable">e1</span></a><br/>
&nbsp;&nbsp;| <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#cons"><span class="id" title="constructor">cons</span></a> <span class="id" title="var">a</span> <span class="id" title="var">e2</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.Environments.html#concat:345"><span class="id" title="definition">concat</span></a> (<a class="idref" href="MailboxTypes.Dblib.Environments.html#insert"><span class="id" title="abbreviation">insert</span></a> 0 <span class="id" title="var">a</span> <a class="idref" href="MailboxTypes.Dblib.Environments.html#e1:343"><span class="id" title="variable">e1</span></a>) <a class="idref" href="MailboxTypes.Dblib.Environments.html#e2:344"><span class="id" title="variable">e2</span></a><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="comment">(*&nbsp;Concatenation&nbsp;acts&nbsp;upon&nbsp;the&nbsp;length&nbsp;of&nbsp;the&nbsp;environment&nbsp;in&nbsp;an&nbsp;obvious<br/>
&nbsp;&nbsp;&nbsp;manner.&nbsp;*)</span><br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="lia_hint_1" class="idref" href="#lia_hint_1"><span class="id" title="lemma">lia_hint_1</span></a>:<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="n:347" class="idref" href="#n:347"><span class="id" title="binder">n</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.Environments.html#n:347"><span class="id" title="variable">n</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Peano.html#cb53cf0ee22c036a03b4a9281c68b5a3"><span class="id" title="notation">&lt;=</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Peano.html#::nat_scope:x_'-'_x"><span class="id" title="notation">(</span></a><a class="idref" href="MailboxTypes.Dblib.Environments.html#n:347"><span class="id" title="variable">n</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a> 1<a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Peano.html#::nat_scope:x_'-'_x"><span class="id" title="notation">)</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Peano.html#::nat_scope:x_'-'_x"><span class="id" title="notation">-</span></a> 1.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="var">lia</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="length_concat" class="idref" href="#length_concat"><span class="id" title="lemma">length_concat</span></a>:<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="A:348" class="idref" href="#A:348"><span class="id" title="binder">A</span></a> (<a id="e2:349" class="idref" href="#e2:349"><span class="id" title="binder">e2</span></a> : <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#A:348"><span class="id" title="variable">A</span></a>) (<a id="e1:350" class="idref" href="#e1:350"><span class="id" title="binder">e1</span></a> : <a class="idref" href="MailboxTypes.Dblib.Environments.html#env"><span class="id" title="definition">env</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#A:348"><span class="id" title="variable">A</span></a>) <a id="n1:351" class="idref" href="#n1:351"><span class="id" title="binder">n1</span></a> <a id="n:352" class="idref" href="#n:352"><span class="id" title="binder">n</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#length"><span class="id" title="definition">length</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#e1:350"><span class="id" title="variable">e1</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Peano.html#cb53cf0ee22c036a03b4a9281c68b5a3"><span class="id" title="notation">&lt;=</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#n1:351"><span class="id" title="variable">n1</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.Environments.html#n1:351"><span class="id" title="variable">n1</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#length"><span class="id" title="definition">length</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#e2:349"><span class="id" title="variable">e2</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#n:352"><span class="id" title="variable">n</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#length"><span class="id" title="definition">length</span></a> (<a class="idref" href="MailboxTypes.Dblib.Environments.html#concat"><span class="id" title="definition">concat</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#e1:350"><span class="id" title="variable">e1</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#e2:349"><span class="id" title="variable">e2</span></a>) <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Peano.html#cb53cf0ee22c036a03b4a9281c68b5a3"><span class="id" title="notation">&lt;=</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#n:352"><span class="id" title="variable">n</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">e2</span>; <span class="id" title="tactic">simpl</span>; <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">replace</span> <span class="id" title="var">n</span> <span class="id" title="keyword">with</span> <span class="id" title="var">n1</span> <span class="id" title="tactic">by</span> <span class="id" title="var">lia</span>. <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">eauto</span> <span class="id" title="keyword">using</span> <a class="idref" href="MailboxTypes.Dblib.Environments.html#length_insert"><span class="id" title="lemma">length_insert</span></a>, <a class="idref" href="MailboxTypes.Dblib.Environments.html#lia_hint_1"><span class="id" title="lemma">lia_hint_1</span></a> <span class="id" title="keyword">with</span> <span class="id" title="var">lia</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Hint Resolve</span> <span class="id" title="var">length_concat</span> : <span class="id" title="var">length</span> <span class="id" title="var">construction_closed</span>.<br/>

<br/>
<span class="comment">(*&nbsp;If&nbsp;<span class="inlinecode"><span class="id" title="var">e1</span></span>&nbsp;and&nbsp;<span class="inlinecode"><span class="id" title="var">e2</span></span>&nbsp;agree&nbsp;up&nbsp;to&nbsp;depth&nbsp;<span class="inlinecode"><span class="id" title="var">k</span></span>,&nbsp;then,&nbsp;after&nbsp;extending&nbsp;them<br/>
&nbsp;&nbsp;&nbsp;with&nbsp;a&nbsp;common&nbsp;suffix&nbsp;<span class="inlinecode"><span class="id" title="var">e</span></span>,&nbsp;they&nbsp;agree&nbsp;up&nbsp;to&nbsp;depth&nbsp;<span class="inlinecode"><span class="id" title="var">k</span></span> <span class="inlinecode">+</span> <span class="inlinecode"><span class="id" title="var">length</span></span> <span class="inlinecode"><span class="id" title="var">e</span></span>.&nbsp;*)</span><br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="agree_concat" class="idref" href="#agree_concat"><span class="id" title="lemma">agree_concat</span></a>:<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="A:353" class="idref" href="#A:353"><span class="id" title="binder">A</span></a> (<a id="e:354" class="idref" href="#e:354"><span class="id" title="binder">e</span></a> : <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#A:353"><span class="id" title="variable">A</span></a>) (<a id="e1:355" class="idref" href="#e1:355"><span class="id" title="binder">e1</span></a> <a id="e2:356" class="idref" href="#e2:356"><span class="id" title="binder">e2</span></a> : <a class="idref" href="MailboxTypes.Dblib.Environments.html#env"><span class="id" title="definition">env</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#A:353"><span class="id" title="variable">A</span></a>) <a id="k:357" class="idref" href="#k:357"><span class="id" title="binder">k</span></a> <a id="n:358" class="idref" href="#n:358"><span class="id" title="binder">n</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.Environments.html#agree"><span class="id" title="definition">agree</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#e1:355"><span class="id" title="variable">e1</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#e2:356"><span class="id" title="variable">e2</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#k:357"><span class="id" title="variable">k</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.Environments.html#k:357"><span class="id" title="variable">k</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#length"><span class="id" title="definition">length</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#e:354"><span class="id" title="variable">e</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#n:358"><span class="id" title="variable">n</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.Environments.html#agree"><span class="id" title="definition">agree</span></a> (<a class="idref" href="MailboxTypes.Dblib.Environments.html#concat"><span class="id" title="definition">concat</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#e1:355"><span class="id" title="variable">e1</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#e:354"><span class="id" title="variable">e</span></a>) (<a class="idref" href="MailboxTypes.Dblib.Environments.html#concat"><span class="id" title="definition">concat</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#e2:356"><span class="id" title="variable">e2</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#e:354"><span class="id" title="variable">e</span></a>) <a class="idref" href="MailboxTypes.Dblib.Environments.html#n:358"><span class="id" title="variable">n</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">e</span>; <span class="id" title="tactic">simpl</span>; <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">replace</span> <span class="id" title="var">n</span> <span class="id" title="keyword">with</span> <span class="id" title="var">k</span> <span class="id" title="tactic">by</span> <span class="id" title="var">lia</span>. <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">eauto</span> <span class="id" title="keyword">using</span> <a class="idref" href="MailboxTypes.Dblib.Environments.html#agree_insert"><span class="id" title="lemma">agree_insert</span></a> <span class="id" title="keyword">with</span> <span class="id" title="var">lia</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Hint Resolve</span> <span class="id" title="var">agree_concat</span> : <span class="id" title="var">agree</span>.<br/>

<br/>
<span class="comment">(*&nbsp;Concatenation&nbsp;and&nbsp;insertion&nbsp;commute.&nbsp;*)</span><br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="insert_concat" class="idref" href="#insert_concat"><span class="id" title="lemma">insert_concat</span></a>:<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> (<a id="A:359" class="idref" href="#A:359"><span class="id" title="binder">A</span></a> : <span class="id" title="keyword">Type</span>) <a id="n:360" class="idref" href="#n:360"><span class="id" title="binder">n</span></a> <a id="x:361" class="idref" href="#x:361"><span class="id" title="binder">x</span></a> <a id="nx:362" class="idref" href="#nx:362"><span class="id" title="binder">nx</span></a> (<a id="o:363" class="idref" href="#o:363"><span class="id" title="binder">o</span></a> : <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#option"><span class="id" title="inductive">option</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#A:359"><span class="id" title="variable">A</span></a>) <a id="e1:364" class="idref" href="#e1:364"><span class="id" title="binder">e1</span></a> <a id="e2:365" class="idref" href="#e2:365"><span class="id" title="binder">e2</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#length"><span class="id" title="definition">length</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#e2:365"><span class="id" title="variable">e2</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#n:360"><span class="id" title="variable">n</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.Environments.html#n:360"><span class="id" title="variable">n</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#x:361"><span class="id" title="variable">x</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#nx:362"><span class="id" title="variable">nx</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.Environments.html#raw_insert"><span class="id" title="definition">raw_insert</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#nx:362"><span class="id" title="variable">nx</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#o:363"><span class="id" title="variable">o</span></a> (<a class="idref" href="MailboxTypes.Dblib.Environments.html#concat"><span class="id" title="definition">concat</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#e1:364"><span class="id" title="variable">e1</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#e2:365"><span class="id" title="variable">e2</span></a>) <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#concat"><span class="id" title="definition">concat</span></a> (<a class="idref" href="MailboxTypes.Dblib.Environments.html#raw_insert"><span class="id" title="definition">raw_insert</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#x:361"><span class="id" title="variable">x</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#o:363"><span class="id" title="variable">o</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#e1:364"><span class="id" title="variable">e1</span></a>) <a class="idref" href="MailboxTypes.Dblib.Environments.html#e2:365"><span class="id" title="variable">e2</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">n</span>; <span class="id" title="tactic">intros</span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">destruct</span> <span class="id" title="var">e2</span>; <span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> *; <span class="id" title="tactic">try</span> <span class="id" title="tactic">discriminate</span>; <span class="id" title="tactic">auto</span>.<br/>
- <span class="id" title="tactic">rewrite</span> <a class="idref" href="MailboxTypes.Dblib.Environments.html#insert_insert"><span class="id" title="lemma">insert_insert</span></a> <span class="id" title="tactic">by</span> <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">erewrite</span> &lt;- (<span class="id" title="var">IHn</span> (1 <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a> <span class="id" title="var">x</span>)) <span class="id" title="tactic">by</span> <span class="id" title="tactic">first</span> [ <span class="id" title="tactic">congruence</span> | <span class="id" title="tactic">eauto</span> ].<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eauto</span> <span class="id" title="keyword">with</span> <span class="id" title="tactic">f_equal</span> <span class="id" title="var">lia</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="concat_app" class="idref" href="#concat_app"><span class="id" title="lemma">concat_app</span></a>:<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> (<a id="A:366" class="idref" href="#A:366"><span class="id" title="binder">A</span></a> : <span class="id" title="keyword">Type</span>) <a id="e1:367" class="idref" href="#e1:367"><span class="id" title="binder">e1</span></a> (<a id="e2:368" class="idref" href="#e2:368"><span class="id" title="binder">e2</span></a> <a id="e3:369" class="idref" href="#e3:369"><span class="id" title="binder">e3</span></a> : <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#A:366"><span class="id" title="variable">A</span></a>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.Environments.html#concat"><span class="id" title="definition">concat</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#e1:367"><span class="id" title="variable">e1</span></a> (<a class="idref" href="MailboxTypes.Dblib.Environments.html#e2:368"><span class="id" title="variable">e2</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#bc347c51eaf667706ae54503b26d52c6"><span class="id" title="notation">++</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#e3:369"><span class="id" title="variable">e3</span></a>) <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#concat"><span class="id" title="definition">concat</span></a> (<a class="idref" href="MailboxTypes.Dblib.Environments.html#concat"><span class="id" title="definition">concat</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#e1:367"><span class="id" title="variable">e1</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#e2:368"><span class="id" title="variable">e2</span></a>) <a class="idref" href="MailboxTypes.Dblib.Environments.html#e3:369"><span class="id" title="variable">e3</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">A</span> <span class="id" title="var">e1</span> <span class="id" title="var">e2</span> <span class="id" title="var">e3</span>. <span class="id" title="tactic">generalize</span> <span class="id" title="var">e1</span>. <span class="id" title="tactic">clear</span> <span class="id" title="var">e1</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">e2</span>; <span class="id" title="tactic">intro</span> <span class="id" title="var">e1</span>; <span class="id" title="tactic">simpl</span>; <span class="id" title="tactic">auto</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="comment">(*&nbsp;<span class="inlinecode"><span class="id" title="var">replicate</span></span> <span class="inlinecode"><span class="id" title="var">n</span></span> <span class="inlinecode"><span class="id" title="var">a</span></span>&nbsp;is&nbsp;a&nbsp;list&nbsp;of&nbsp;<span class="inlinecode"><span class="id" title="var">n</span></span>&nbsp;elements,&nbsp;all&nbsp;of&nbsp;which&nbsp;are<br/>
&nbsp;&nbsp;&nbsp;equal&nbsp;to&nbsp;<span class="inlinecode"><span class="id" title="var">a</span></span>.&nbsp;*)</span><br/>

<br/>
<span class="id" title="keyword">Fixpoint</span> <a id="replicate" class="idref" href="#replicate"><span class="id" title="definition">replicate</span></a> (<a id="A:370" class="idref" href="#A:370"><span class="id" title="binder">A</span></a> : <span class="id" title="keyword">Type</span>) (<a id="n:371" class="idref" href="#n:371"><span class="id" title="binder">n</span></a> : <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>) (<a id="a:372" class="idref" href="#a:372"><span class="id" title="binder">a</span></a> : <a class="idref" href="MailboxTypes.Dblib.Environments.html#A:370"><span class="id" title="variable">A</span></a>) : <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#A:370"><span class="id" title="variable">A</span></a> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="MailboxTypes.Dblib.Environments.html#n:371"><span class="id" title="variable">n</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| 0 =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@<a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#nil"><span class="id" title="constructor">nil</span></a> <span class="id" title="var">_</span><br/>
&nbsp;&nbsp;| <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#S"><span class="id" title="constructor">S</span></a> <span class="id" title="var">n</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#cons"><span class="id" title="constructor">cons</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#a:372"><span class="id" title="variable">a</span></a> (<a class="idref" href="MailboxTypes.Dblib.Environments.html#replicate:373"><span class="id" title="definition">replicate</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#n:371"><span class="id" title="variable">n</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#a:372"><span class="id" title="variable">a</span></a>)<br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="comment">(*&nbsp;The&nbsp;list&nbsp;<span class="inlinecode"><span class="id" title="var">replicate</span></span> <span class="inlinecode"><span class="id" title="var">n</span></span> <span class="inlinecode"><span class="id" title="var">a</span></span>&nbsp;has&nbsp;length&nbsp;<span class="inlinecode"><span class="id" title="var">n</span></span>.&nbsp;*)</span><br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="length_replicate" class="idref" href="#length_replicate"><span class="id" title="lemma">length_replicate</span></a>:<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> (<a id="A:375" class="idref" href="#A:375"><span class="id" title="binder">A</span></a> : <span class="id" title="keyword">Type</span>) <a id="n:376" class="idref" href="#n:376"><span class="id" title="binder">n</span></a> (<a id="a:377" class="idref" href="#a:377"><span class="id" title="binder">a</span></a> : <a class="idref" href="MailboxTypes.Dblib.Environments.html#A:375"><span class="id" title="variable">A</span></a>),<br/>
&nbsp;&nbsp;<a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#length"><span class="id" title="definition">length</span></a> (<a class="idref" href="MailboxTypes.Dblib.Environments.html#replicate"><span class="id" title="definition">replicate</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#n:376"><span class="id" title="variable">n</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#a:377"><span class="id" title="variable">a</span></a>) <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#n:376"><span class="id" title="variable">n</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">n</span>; <span class="id" title="tactic">simpl</span>; <span class="id" title="tactic">auto</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="comment">(*&nbsp;A&nbsp;special&nbsp;case&nbsp;of&nbsp;<span class="inlinecode"><span class="id" title="var">insert_concat</span></span>.&nbsp;*)</span><br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="insert_concat_replicate" class="idref" href="#insert_concat_replicate"><span class="id" title="lemma">insert_concat_replicate</span></a>:<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> (<a id="A:378" class="idref" href="#A:378"><span class="id" title="binder">A</span></a> : <span class="id" title="keyword">Type</span>) <a id="n:379" class="idref" href="#n:379"><span class="id" title="binder">n</span></a> <a id="x:380" class="idref" href="#x:380"><span class="id" title="binder">x</span></a> <a id="nx:381" class="idref" href="#nx:381"><span class="id" title="binder">nx</span></a> (<a id="a:382" class="idref" href="#a:382"><span class="id" title="binder">a</span></a> : <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#option"><span class="id" title="inductive">option</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#A:378"><span class="id" title="variable">A</span></a>) (<a id="b:383" class="idref" href="#b:383"><span class="id" title="binder">b</span></a> : <a class="idref" href="MailboxTypes.Dblib.Environments.html#A:378"><span class="id" title="variable">A</span></a>) <a id="e1:384" class="idref" href="#e1:384"><span class="id" title="binder">e1</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.Environments.html#n:379"><span class="id" title="variable">n</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#x:380"><span class="id" title="variable">x</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#nx:381"><span class="id" title="variable">nx</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.Environments.html#raw_insert"><span class="id" title="definition">raw_insert</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#nx:381"><span class="id" title="variable">nx</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#a:382"><span class="id" title="variable">a</span></a> (<a class="idref" href="MailboxTypes.Dblib.Environments.html#concat"><span class="id" title="definition">concat</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#e1:384"><span class="id" title="variable">e1</span></a> (<a class="idref" href="MailboxTypes.Dblib.Environments.html#replicate"><span class="id" title="definition">replicate</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#n:379"><span class="id" title="variable">n</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#b:383"><span class="id" title="variable">b</span></a>)) <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#concat"><span class="id" title="definition">concat</span></a> (<a class="idref" href="MailboxTypes.Dblib.Environments.html#raw_insert"><span class="id" title="definition">raw_insert</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#x:380"><span class="id" title="variable">x</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#a:382"><span class="id" title="variable">a</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#e1:384"><span class="id" title="variable">e1</span></a>) (<a class="idref" href="MailboxTypes.Dblib.Environments.html#replicate"><span class="id" title="definition">replicate</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#n:379"><span class="id" title="variable">n</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#b:383"><span class="id" title="variable">b</span></a>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eauto</span> <span class="id" title="keyword">using</span> <a class="idref" href="MailboxTypes.Dblib.Environments.html#insert_concat"><span class="id" title="lemma">insert_concat</span></a>, <a class="idref" href="MailboxTypes.Dblib.Environments.html#length_replicate"><span class="id" title="lemma">length_replicate</span></a>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="comment">(*&nbsp;<span class="inlinecode"><span class="id" title="var">concat</span></span> <span class="inlinecode">.</span> <span class="inlinecode">(<span class="id" title="var">replicate</span></span> <span class="inlinecode">.</span> <span class="inlinecode"><span class="id" title="var">a</span>)</span>&nbsp;is&nbsp;just&nbsp;an&nbsp;iterated&nbsp;version&nbsp;of&nbsp;<span class="inlinecode"><span class="id" title="var">insert</span></span> <span class="inlinecode">.</span> <span class="inlinecode"><span class="id" title="var">a</span></span>.&nbsp;*)</span><br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="concat_replicate_is_iterated_insert" class="idref" href="#concat_replicate_is_iterated_insert"><span class="id" title="lemma">concat_replicate_is_iterated_insert</span></a>:<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> (<a id="A:385" class="idref" href="#A:385"><span class="id" title="binder">A</span></a> : <span class="id" title="keyword">Type</span>) <a id="n:386" class="idref" href="#n:386"><span class="id" title="binder">n</span></a> (<a id="a:387" class="idref" href="#a:387"><span class="id" title="binder">a</span></a> : <a class="idref" href="MailboxTypes.Dblib.Environments.html#A:385"><span class="id" title="variable">A</span></a>) <a id="e:388" class="idref" href="#e:388"><span class="id" title="binder">e</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.Environments.html#insert"><span class="id" title="abbreviation">insert</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#n:386"><span class="id" title="variable">n</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#a:387"><span class="id" title="variable">a</span></a> (<a class="idref" href="MailboxTypes.Dblib.Environments.html#concat"><span class="id" title="definition">concat</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#e:388"><span class="id" title="variable">e</span></a> (<a class="idref" href="MailboxTypes.Dblib.Environments.html#replicate"><span class="id" title="definition">replicate</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#n:386"><span class="id" title="variable">n</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#a:387"><span class="id" title="variable">a</span></a>)) <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.Environments.html#concat"><span class="id" title="definition">concat</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#e:388"><span class="id" title="variable">e</span></a> (<a class="idref" href="MailboxTypes.Dblib.Environments.html#replicate"><span class="id" title="definition">replicate</span></a> (<a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#S"><span class="id" title="constructor">S</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#n:386"><span class="id" title="variable">n</span></a>) <a class="idref" href="MailboxTypes.Dblib.Environments.html#a:387"><span class="id" title="variable">a</span></a>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">eauto</span> <span class="id" title="keyword">using</span> <a class="idref" href="MailboxTypes.Dblib.Environments.html#insert_concat"><span class="id" title="lemma">insert_concat</span></a>, <a class="idref" href="MailboxTypes.Dblib.Environments.html#length_replicate"><span class="id" title="lemma">length_replicate</span></a>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Hint Resolve</span> <span class="id" title="var">insert_concat</span> <span class="id" title="var">length_replicate</span> <span class="id" title="var">insert_concat_replicate</span><br/>
<span class="id" title="var">concat_replicate_is_iterated_insert</span> : <span class="id" title="var">insert_concat</span>.<br/>

<br/>
<span class="comment">(*&nbsp;A&nbsp;special&nbsp;case&nbsp;of&nbsp;<span class="inlinecode"><span class="id" title="var">length_concat</span></span>.&nbsp;*)</span><br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="length_concat_replicate" class="idref" href="#length_concat_replicate"><span class="id" title="lemma">length_concat_replicate</span></a>:<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="A:389" class="idref" href="#A:389"><span class="id" title="binder">A</span></a> (<a id="a:390" class="idref" href="#a:390"><span class="id" title="binder">a</span></a> : <a class="idref" href="MailboxTypes.Dblib.Environments.html#A:389"><span class="id" title="variable">A</span></a>) (<a id="e1:391" class="idref" href="#e1:391"><span class="id" title="binder">e1</span></a> : <a class="idref" href="MailboxTypes.Dblib.Environments.html#env"><span class="id" title="definition">env</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#A:389"><span class="id" title="variable">A</span></a>) <a id="n1:392" class="idref" href="#n1:392"><span class="id" title="binder">n1</span></a> <a id="n2:393" class="idref" href="#n2:393"><span class="id" title="binder">n2</span></a> <a id="n:394" class="idref" href="#n:394"><span class="id" title="binder">n</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#length"><span class="id" title="definition">length</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#e1:391"><span class="id" title="variable">e1</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Peano.html#cb53cf0ee22c036a03b4a9281c68b5a3"><span class="id" title="notation">&lt;=</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#n1:392"><span class="id" title="variable">n1</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="MailboxTypes.Dblib.Environments.html#n1:392"><span class="id" title="variable">n1</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#n2:393"><span class="id" title="variable">n2</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#n:394"><span class="id" title="variable">n</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#length"><span class="id" title="definition">length</span></a> (<a class="idref" href="MailboxTypes.Dblib.Environments.html#concat"><span class="id" title="definition">concat</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#e1:391"><span class="id" title="variable">e1</span></a> (<a class="idref" href="MailboxTypes.Dblib.Environments.html#replicate"><span class="id" title="definition">replicate</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#n2:393"><span class="id" title="variable">n2</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#a:390"><span class="id" title="variable">a</span></a>)) <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Peano.html#cb53cf0ee22c036a03b4a9281c68b5a3"><span class="id" title="notation">&lt;=</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#n:394"><span class="id" title="variable">n</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="tactic">eapply</span> <a class="idref" href="MailboxTypes.Dblib.Environments.html#length_concat"><span class="id" title="lemma">length_concat</span></a>. <span class="id" title="tactic">eauto</span>. <span class="id" title="tactic">rewrite</span> <a class="idref" href="MailboxTypes.Dblib.Environments.html#length_replicate"><span class="id" title="lemma">length_replicate</span></a>. <span class="id" title="tactic">eauto</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Hint Resolve</span> <span class="id" title="var">length_concat_replicate</span> : <span class="id" title="var">length</span> <span class="id" title="var">construction_closed</span>.<br/>

<br/>
<span class="comment">(*&nbsp;----------------------------------------------------------------------------&nbsp;*)</span><br/>

<br/>
<span class="comment">(*&nbsp;Make&nbsp;some&nbsp;definitions&nbsp;opaque,&nbsp;so&nbsp;that&nbsp;Coq&nbsp;does&nbsp;not&nbsp;over-simplify&nbsp;in<br/>
&nbsp;&nbsp;&nbsp;unexpected&nbsp;(and&nbsp;fragile)&nbsp;ways.&nbsp;*)</span><br/>

<br/>
<span class="id" title="keyword">Global Opaque</span> <a class="idref" href="MailboxTypes.Dblib.Environments.html#empty"><span class="id" title="definition">empty</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#lookup"><span class="id" title="definition">lookup</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#raw_insert"><span class="id" title="definition">raw_insert</span></a> <a class="idref" href="MailboxTypes.Dblib.Environments.html#map"><span class="id" title="definition">map</span></a>.<br/>
</div>
</div>
<div id="footer">
  Generated by <a href="http://coq.inria.fr/">coqdoc</a> and improved with <a href="https://github.com/coq-community/coqdocjs">CoqdocJS</a>
</div>
</div>
</body>

</html>
